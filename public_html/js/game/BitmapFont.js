(function(z,g){d.k_iDrawCharRGB=0;d.k_iDrawCharPixel=1;d.k_iDrawCharImage=2;d.k_bUseIndex=true;d.k_iTypeDrawChar=d.k_iDrawCharRGB;d.k_bUseSingleSetColorSign=false;d.k_iDefaultColor=0;d.k_sSingleSetColorSign="^_&";d.k_cDoubleSetColorSign="^";d.k_aiColor=[16777215,0,16711680,16777215,255,16777215];d.k_iCharNewLine="\n";d.k_iSpaceBetweenLine=4;d.k_SpaceCharWidth=2;d.k_MaxLinePerString=100;var l=0;var y=0;var t=4294967295;var j=4280381061;var o=true;var x=0;var a=[];var m=[];var c=[];var i=[];var u=[];var v=1;var r=0;var e=0;var h=0;var w=0;var p;function d(B){p=d.k_aiColor.length>>1;this.LoadFont(B)}d.prototype.LoadFont=function(C){if(C.charAt(0)!="/"){C="/"+C}try{var B=CGame.__superproto__.GetResourceAsStream.call(this,C);if(B==null){return false}var H=0;x=B.read();if(x==-1){return false}H=B.read();if(H==-1){return false}x=x|(H<<8);a=LowAPI.Gen_Array([x],0);i=LowAPI.Gen_Array([x],0);u=LowAPI.Gen_Array([x],0);l=B.read();y=l+d.k_iSpaceBetweenLine;if(l==-1){return false}c=LowAPI.Gen_Array([l*l*2],0);v=B.read();r=4-v;if(v==1){e=7;h=1;w=0}else{e=3;h=3;w=1}var G=LowAPI.Gen_Array([2],0);var F=0;for(var E=0;E<x;E++){H=B.read(G,0,2);if(H==-1){return false}a[E]=((G[0]&255)|((G[1]&255)<<8));H=B.read();if(H==-1){return false}i[E]=H;F=1+((i[E]*l)>>r);u[E]=LowAPI.Gen_Array([F],0);H=B.read(u[E],0,F);if(H==-1){return false}}B.close();if(d.k_bUseIndex){m=a}}catch(D){Dbg("Load Bitmap font error : "+D.message);return false}return true};d.prototype.SetColor=function(B){t=B&4294967295};d.prototype.SetBorderColor=function(B){o=true;j=B&4294967295};d.prototype.SetBorderHidden=function(){o=false};d.prototype.GetColor=function(){return t};d.prototype.DrawChar=function(D,C,B,E){if(d.k_iTypeDrawChar==d.k_iDrawCharRGB){return this.DrawCharImage(D,C,B,E,true)}else{if(d.k_iTypeDrawChar==k_iDrawCharPixel){return DrawCharPixel(D,C,B,E)}else{return this.DrawCharImage(D,C,B,E,false)}}};d.prototype.DrawCharImage=function(E,B,J,G,H){var D=this.MapChar(B);if(D==-1){return 0}this.DecodeFont(D,c);var C=i[D];if(H){E.drawRGB(c,0,C,J,G,C,l,true)}else{try{var I=Image.createRGBImage(c,C,l,true);E.drawImage(I,J,G,0)}catch(F){Dbg("------------------------ DrawCharImage  error : "+F.message)}}Dbg("------------------------ sorry we don't support drawRGB  !!!!!!! ");return C};d.prototype.DrawCharPixel=function(I,C,L,K){var G=this.MapChar(C);if(G==-1){return 0}var D=i[G];var B=l*D;var H=0;var J=0;var E=L;I.setColor(t);for(var F=0;F<B;F++){H=F>>r;J=((F&e)<<w);if(((u[G][H]>>J)&h)==1){I.drawLine(E,K,E,K)}else{if(o&&(((u[G][H]>>J)&h)==2)){I.setColor(j);I.drawLine(E,K,E,K);I.setColor(t)}}E++;if((E-L)>=D){E=L;K++}}return D};var A=LowAPI.Gen_Array([2],0);var k=LowAPI.Gen_Array([8],0);var b=false;var n=false;d.prototype.SetLimitLine=function(B,C){b=true;A[0]=B;A[1]=C};d.prototype.ResetLimitLine=function(){b=false};d.prototype.SetLimitClip=function(E,B,F,C,D){n=true;k[0]=B;k[1]=F;k[2]=C;k[3]=D;k[4]=E.getClipX();k[5]=E.getClipY();k[6]=E.getClipWidth();k[7]=E.getClipHeight();E.setClip(B,F,C,D)};d.prototype.ResetLimitClip=function(B){n=false;B.setClip(k[4],k[5],k[6],k[7])};var q=LowAPI.Gen_Array([d.k_MaxLinePerString],0);var s=LowAPI.Gen_Array([d.k_MaxLinePerString],0);var f;d.prototype.DrawString=function(G,M,K,I,F){if(M==null||M==""){return}f=0;var H=M.length;var J=0;var C;while(J<H){C=M.charAt(J);if(C==k_iCharNewLine){s[f]=J-1;++J;++f;continue}if(k_bUseSingleSetColorSign){if(k_sSingleSetColorSign.indexOf(C)>=0){++J;continue}}else{if(C==k_cDoubleSetColorSign){J+=2;continue}}q[f]+=GetCharWidth(C);++J}s[f]=J-1;++f;var D=0;var B=I;var E=0;if((F&Graphics.BOTTOM)!=0){B-=y*f}else{if((F&Graphics.VCENTER)!=0){B-=(y>>1)*f}}var L=-1;J=0;if(n){SetLimitLine((k[1]-I)/y,(k[3]/y)+1)}if(b&&(A[0]>0)){J=s[A[0]]+2}while(J<H){C=M.charAt(J);if(C==k_iCharNewLine||J==0){++L;D=K;if((F&Graphics.RIGHT)!=0){D=K-s[L]}else{if((F&Graphics.HCENTER)!=0){D=K-(s[L]>>1)}}if(C==k_iCharNewLine){B+=y}if(b&&(L>A[1])){break}}if(k_bUseSingleSetColorSign){E=k_sSingleSetColorSign.indexOf(C);if(E>=0){if(E<p){SetColor(k_aiColor[E*2]);SetBorderColor(k_aiColor[E*2+1])}++J;continue}}else{if(C==k_cDoubleSetColorSign){C=M.charAt(J+1);E=C-"0";if(E<p){SetColor(k_aiColor[E*2]);SetBorderColor(k_aiColor[E*2+1])}J+=2;continue}}D+=DrawChar(G,C,D,B);++J}if(n){ResetLimitClip(G)}if(b){ResetLimitLine()}};d.prototype.GetFontHeight=function(){return l};d.prototype.GetCharWidth=function(B){var C=this.MapChar(B);if(C==-1){return 0}return i[C]};d.prototype.GetStringWidth=function(D){var B=0;for(var C=0;C<D.length;C++){B+=GetCharWidth(D.charAt(C))}return B};d.prototype.MapChar=function(E){if(d.k_bUseIndex){return m.indexOf(E)}else{var D=0;var B=x-1;var C=0;while(D<=B){C=(D+B)>>1;if(a[C]==E){return C}else{if(a[C]<E){D=C+1}else{B=C-1}}}}return -1};d.prototype.DecodeFont=function(G,B){var D=l*i[G];var E=0;var F=0;if(B==null){B=LowAPI.Gen_Array([D],0)}for(var C=0;C<D;C++){E=C>>r;F=((C&e)<<w);if(((u[G][E]>>F)&h)==1){B[C]=t&4294967295}else{if(o&&(((u[G][E]>>F)&h)==2)){B[C]=j&4294967295}else{B[C]=0}}}};d.ZoomImage=function(){if(arguments){switch(arguments.length){case 1:return d.ZoomImage1.apply(this,arguments);case 3:return d.ZoomImage3.apply(this,arguments);default:throw new Error("InvalidArguments")}}else{throw new Error("InvalidArguments")}};d.ZoomImage1=function(G){if(G==null){return null}var M=G.getWidth();var I=G.getHeight();var C=M*I;var L=LowAPI.Gen_Array([C],0);var F=LowAPI.Gen_Array([C<<2],0);try{G.getRGB(L,0,M,0,0,M,I);var B=0,H=0;for(H=0;H<I;++H){var K=H*M;var E=K<<2;for(B=0;B<M;++B){var D=L[K+B];F[E+(B<<1)]=D;F[E+(B<<1)+1]=D}System.arraycopy(F,E,F,E+(M<<1),(M<<1))}}catch(J){System.out.println("AAAAAAAAAAAA ____ Error _______ ZoomImage ____ "+J.getMessage())}return Image.createRGBImage(F,M<<1,I<<1,false)};d.ZoomImage3=function(K,L,H){if(K==null){return null}var C=L*H;var F=LowAPI.Gen_Array([C<<2],0);try{var B=0,G=0;for(G=0;G<H;++G){var J=G*L;var E=J<<2;for(B=0;B<L;++B){var D=K[J+B];F[E+(B<<1)]=D;F[E+(B<<1)+1]=D}System.arraycopy(F,E,F,E+(L<<1),(L<<1))}}catch(I){System.out.println("BBBBBBBBBBB ____ Error _______ ZoomImage ____ "+I.getMessage())}return F};d.prototype.DrawZoomChar=function(E,D,B,I){var G=this.MapChar(D);if(G==-1){return 0}this.DecodeFont(G,c);var H=i[G];if(d.k_iTypeDrawChar==d.k_iDrawCharRGB){E.drawRGB(ZoomImage(c,H,l),0,H<<1,B,I,H<<1,l<<1,true)}else{try{var C=Image.createRGBImage(ZoomImage(c,H,l),H<<1,l<<1,true);E.drawImage(C,B,I,0)}catch(F){}}return H<<1};LowAPI.extendObject(z,{BitmapFont:d,},true)})(window);