(function(aF,bh){function e(c3,c4){if(jQuery(window).width()>jQuery(window).height()){if(!isMobile){overlayID.style.display="none";modalID.style.display="none"}else{overlayID.style.display="inline";modalID.style.display="inline";startAtLandscape=true}}e.__superclass__.call(this,c3,c4);if(B){e.m_chtFont=new BitmapFont("/chtFont")}GGTracking.getInstance().init();Game_KeySetKeyCode(true,32,GLKey.k_fire);Game_KeySetKeyCode(true,83,GLKey.k_fire);Game_KeySetKeyCode(true,68,GLKey.k_right);Game_KeySetKeyCode(true,65,GLKey.k_left);Game_KeySetKeyCode(true,111,GLKey.k_up);Game_KeySetKeyCode(true,87,GLKey.k_up);Game_KeySetKeyCode(true,88,GLKey.k_down);Game_KeySetKeyCode(true,46,GLLibConfig.keycodeLeftSoftkey);Game_KeySetKeyCode(true,34,GLLibConfig.keycodeRightSoftkey)}LowAPI.extendClass(e,GLLib);var b5={};b5.LANGUAGE=0;b5.SOUND_ENABLED=b5.LANGUAGE+1;b5.FIRST_DAY_PLAY=b5.SOUND_ENABLED+1;b5.LAST_TIME_STAMP=b5.FIRST_DAY_PLAY+1;b5.SOUND_LEVEL=b5.LAST_TIME_STAMP+1;b5.GAME_PROGRESS=b5.SOUND_LEVEL+1;b5.LEVEL_INDEX=b5.GAME_PROGRESS+1;b5.LEVEL_INFO_STRAT=b5.LEVEL_INDEX+1;b5.LEVEL_INFO_NUM=28;b5.LEVEL_FINAL_INFO1=b5.LEVEL_INFO_STRAT+b5.LEVEL_INFO_NUM;b5.LEVEL_FINAL_INFO2=b5.LEVEL_FINAL_INFO1+1;b5.PLAYER_INFO_STRAT=b5.LEVEL_FINAL_INFO2+1;b5.PLAYER_INFO_NUM=5;b5.LEVEL_STAR_INFO_START=b5.PLAYER_INFO_STRAT+b5.PLAYER_INFO_NUM;b5.LEVEL_STAR_INFO_NUM=DAI.LEVELS_NUM_MAX*DAI.STAR_INFO_SIZE;b5.LEVEL_TOTAL_SCORE_START=b5.LEVEL_STAR_INFO_START+b5.LEVEL_STAR_INFO_NUM*2;b5.LEVEL_TOTAL_SCORE_NUM=DAI.LEVELS_NUM_MAX;b5.SIZE=b5.LEVEL_TOTAL_SCORE_START+b5.LEVEL_TOTAL_SCORE_NUM*4;window.STATE={};STATE.QUIT=-1;STATE.INIT=STATE.QUIT+1;STATE.SELECT_LANGUAGE_INIT=STATE.INIT+1;STATE.SELECT_LANGUAGE=STATE.SELECT_LANGUAGE_INIT+1;STATE.GAMELOFT_LOGO=STATE.SELECT_LANGUAGE+1;STATE.COPYRIGHT=STATE.GAMELOFT_LOGO+1;STATE.ASK_SOUND=STATE.COPYRIGHT+1;STATE.SPLASH=STATE.ASK_SOUND+1;STATE.MENU_MAIN=STATE.SPLASH+1;STATE.MENU_NEW_GAME=STATE.MENU_MAIN+1;STATE.CONTINUE_GAME=STATE.MENU_NEW_GAME+1;STATE.MENU_MAP=STATE.CONTINUE_GAME+1;STATE.MENU_SELECT_WORLD=STATE.MENU_MAP+1;STATE.MENU_SELECT_LEVEL=STATE.MENU_SELECT_WORLD+1;STATE.LOAD_UNLOAD=STATE.MENU_SELECT_LEVEL+1;STATE.GAMEPLAY_UPDATE=STATE.LOAD_UNLOAD+1;STATE.GAMEOVER=STATE.GAMEPLAY_UPDATE+1;STATE.GAMEEND=STATE.GAMEOVER+1;STATE.GAME_STATISTIC=STATE.GAMEEND+1;STATE.MENU_OPTIONS=STATE.GAME_STATISTIC+1;STATE.MENU_GET_MORE_GAMES_INIT=STATE.MENU_OPTIONS+1;STATE.MENU_GET_MORE_GAMES=STATE.MENU_GET_MORE_GAMES_INIT+1;STATE.MENU_HELP=STATE.MENU_GET_MORE_GAMES+1;STATE.MENU_ABOUT=STATE.MENU_HELP+1;STATE.MENU_EXIT=STATE.MENU_ABOUT+1;STATE.RESET_GAME=STATE.MENU_EXIT+1;STATE.RESUME_GAME=STATE.RESET_GAME+1;STATE.BACK_TO_MINIMAP=STATE.RESUME_GAME+1;STATE.RESTART_LEVEL=STATE.BACK_TO_MINIMAP+1;STATE.MENU_INIT=STATE.RESTART_LEVEL+1;STATE.NO=STATE.MENU_INIT+1;STATE.YES=STATE.NO+1;STATE.MENU_INGAME=STATE.YES+1;STATE.MENU_INGAME_OPTIONS=STATE.MENU_INGAME+1;STATE.MENU_INGAME_MAIN_MENU=STATE.MENU_INGAME_OPTIONS+1;STATE.ASK_SOUND_LEVEL=STATE.MENU_INGAME_MAIN_MENU+1;STATE.SOUND_OFF=STATE.ASK_SOUND_LEVEL+1;STATE.SOUND_LOW=STATE.SOUND_OFF+1;STATE.SOUND_MEDIUM=STATE.SOUND_LOW+1;STATE.SOUND_HIGH=STATE.SOUND_MEDIUM+1;STATE.IGP=STATE.SOUND_HIGH+1;STATE.K_MRC_INIT=STATE.IGP+1;STATE.K_MRC_VALIDATING=STATE.K_MRC_INIT+1;STATE.K_MRC_EXPIRED=STATE.K_MRC_VALIDATING+1;STATE.K_MRC_NETWORK_FAILED=STATE.K_MRC_EXPIRED+1;STATE.END_GAME_IGP=STATE.K_MRC_NETWORK_FAILED+1;STATE.NEW_STATE2=STATE.END_GAME_IGP+1;STATE.NEW_STATE3=STATE.NEW_STATE2+1;STATE.NEW_STATE4=STATE.NEW_STATE3+1;STATE.NEW_STATE5=STATE.NEW_STATE4+1;STATE.LOADING_ADS=STATE.NEW_STATE5+1;var D=false;var a9=STATE.INIT;var aE;var al;var az=480;var aJ=640;var cD=240;var cz=320;var a3=LowAPI.Gen_Array([az],0);var a1=LowAPI.Gen_Array([aJ],0);var j=null;e.s_next_game_state_after_unload=-1;e._mapTileCountWidth=0;e._mapTileCountHeight=0;e._entityCount=0;e._phyData;e._topLayerData=null;e._topLayerFlip=null;e._entityMap=new Hashtable(10000);e._entitiesRowTable=new Hashtable(10000);e._entitiesRowData=null;e._entityRowDataCount=0;e._entityMaxId=0;var ak=8192;var U=16384;var u=24576;e._segmentCount=0;e._segments=null;e._segmentParams=null;e._segmentAngles=null;var m=0;var bb=1;e._gameProgress=m;e._levelId=-1;e._worldId=0;e._tempLevelId=0;e._levelFinalInfo1=0;e._levelFinalInfo2=0;e._finalLevelIndex=20;e._levelUnlocked=-1;e._isIntroLevel=false;e._levelInfo=LowAPI.Gen_Array([b5.LEVEL_INFO_NUM],0);e._playerInfo=LowAPI.Gen_Array([b5.PLAYER_INFO_NUM],0);e._levelTotalScore=LowAPI.Gen_Array([DAI.LEVELS_NUM_MAX],0);e._levelStarInfo=LowAPI.Gen_Array([DAI.LEVELS_NUM_MAX*DAI.STAR_INFO_SIZE],0);var cI=0;var cY=0;var x=0;var bI=0;var c0=0;var ao=0;var an=0;e._inCinematicBlackScreen=false;e._class2sprites=null;e._level2tiled=null;var aH=null;var cV=null;e._interface=null;var br=null;var a0=null;var J=null;var w=null;var V=null;e._balanceImageData=null;e._balanceImageSize=null;var be=null;var aW=null;var bc=0;e._velocityRate=0;e._frameDT=0;e._frameDT_Real=0;var bZ=0;var Y=0;var cU=0;var bo=false;var cK=false;var by=33;var bT=66;var aP=100;var C=false;var cF=false;var bM=false;e.getsound_channelSlot=function(){for(var c3=1;c3<GLLibConfiguration.sound_numberOfChannels;c3++){if(DEF.dbgEnable){Dbg("----------------------- getsound_channelSlot: "+c3+" -- "+GLLibPlayer.Snd_IsPlaying(c3))}if(!GLLibPlayer.Snd_IsPlaying(c3)){return c3}}if(DEF.dbgEnable){Dbg("----------------------- getsound_channelSlot----------------------- ")}return 1};e.prototype.Pause=function(){if(DEF.dbgEnable){Dbg("Pause ========================== s_game_state : "+a9)}bg=true;if(DSound_Channel.SFX!=DSound_Channel.BGM){e.StopSound(DSound_Channel.SFX)}if(GLLibConfig.sound_enableThread){GLLibPlayer.Snd_ForceExecOnThreadOnGamePause()}else{GLLibPlayer.Snd_Update()}if(a9==STATE.GAMEPLAY_UPDATE||a9==STATE.MENU_MAP){e.initIngameMenu(STATE.MENU_INGAME)}else{e.PauseSoundBGM()}if(GLLibConfig.sound_enableThread){GLLibPlayer.Snd_ForceExecOnThreadOnGamePause()}else{GLLibPlayer.Snd_Update()}if(av==DATA.SOUND_BGM_CUTSCENE_STORY){M=false}};e.prototype.Resume=function(){if(DEF.dbgEnable){Dbg("Resume ========================== s_game_state : "+a9)}bg=false;if(e.s_isShowAd){return}if(a9!=STATE.MENU_INGAME&&a9>0){this.ResumeSoundBGM()}};e.prototype.showNotify=function(){e.__superproto__.showNotify.call(this);this.Resume()};e.prototype.hideNotify=function(){e.__superproto__.hideNotify.call(this);this.Pause()};e.PauseSoundBGM=function(){var c4=false;try{c4=GLLibPlayer.Snd_IsPlaying(DSound_Channel.BGM)}catch(c3){if(DEF.dbgEnable){Dbg("-------------------- error : "+c3.message)}}if(c4){GLLibPlayer.Snd_Pause(DSound_Channel.BGM);bM=true}else{GLLibPlayer.Snd_Stop(DSound_Channel.BGM)}};e.prototype.ResumeSoundBGM=function(){if(!e.bIsPaused){if(bM){GLLibPlayer.Snd_Resume(DSound_Channel.BGM)}else{e.PlaySoundBGM()}bM=false}};e.isSoundEnabled=false;e.prototype.startSound=function(){if(!e.isSoundEnabled){e.isSoundEnabled=true}if(e.bIsPaused){e.PlaySound(DSound_Channel.SFX,DATA.SOUND_MENU_CONFIRM)}else{e.PlaySound(DSound_Channel.BGM,DATA.SOUND_BGM_MENU)}};e.prototype.StopSound=function(){if(e.isSoundEnabled){GLLibPlayer.Snd_StopAllSounds();e.isSoundEnabled=false;bM=false}};e.StopSound=function(c3){GLLibPlayer.Snd_Stop(c3)};var M=false;var av=-1;e.PlaySoundBGM=function(){e.StopSound(DSound_Channel.BGM);if(a9==STATE.MENU_MAP){e.PlaySound(DSound_Channel.BGM,DATA.SOUND_BGM_STAGE_CHOOSE)}else{if(a9==STATE.GAMEPLAY_UPDATE){var c3=DATA.SOUND_BGM_LABYRINTH_LEVEL;if(e._worldId%2!=0){c3=DATA.SOUND_BGM_01}else{c3=DATA.SOUND_BGM_02}if(e._tempLevelId%DAI.LEVELS_NUM_PRE_WORLD==DAI.LEVLE_ID_BOSS_FIGHT){c3=DATA.SOUND_BGM_BOSS_FIGHT}if(e._tempLevelId==DAI.LEVEL_ID_CASTLE_FINAL_BOSS){c3=DATA.SOUND_BGM_BOSS_FIGHT}if(e._tempLevelId>DAI.LEVEL_ID_CASTLE_FINAL_BOSS){c3=DATA.SOUND_BGM_CUTSCENE_STORY}av=c3;e.PlaySound(DSound_Channel.BGM,c3)}else{if(a9!=STATE.LOAD_UNLOAD&&!e.bIsPaused){e.PlaySound(DSound_Channel.BGM,DATA.SOUND_BGM_MENU)}}}};e.PlaySound=function(c6,c7){if(s_game_isPaused){return}if(e.isSoundEnabled){var c5=DGUI.SOUND_VOLUME;var c3=1;if(c6==DSound_Channel.BGM){c3=0}if(c7==DATA.SOUND_BGM_LOSE||c7==DATA.SOUND_BGM_LEVEL_CLEAR){c3=1}if(c6==DSound_Channel.BGM){GLLibPlayer.Snd_Play(c6,c7,c3,c5,DATA.NAME[c7][1])}else{var c4=e.getsound_channelSlot();GLLibPlayer.Snd_Play(c4,c7,c3,c5,DATA.NAME[c7][1])}}};var bL=-1;var q=-2;var p=16777215;var l=10;var I;var h;e.prototype.drawSoftKeys=function(){e.txtSetFont(cL);b9.SetCurrentPalette(0);if(I>bL){if(I!=TEXT.MENU_SK_SELECT){e.txtDraw(cv,Text_GetString(I),0,GLLibConfig.screenHeight+DGUI.MENU_OFFSET_Y,BOTTOM|LEFT)}}if(h>bL){e.txtDraw(cv,Text_GetString(h),GLLibConfig.screenWidth,GLLibConfig.screenHeight+DGUI.MENU_OFFSET_Y,BOTTOM|RIGHT)}if(I==q){SetColor(p)}if(h==q){SetColor(p)}};e.prototype.setSoftKeys=function(c4,c3){if(GLLibConfig.softkeyOKOnLeft){I=c4;h=c3}else{I=c3;h=c4}};e.prototype.clearSoftKeys=function(){I=h=bL};var aC=14666147;var a5=0;var bO=2283938338;var aM=DGUI.MENU_MAIN_X;var aL=DGUI.MENU_MAIN_Y;var cj=DGUI.MENU_IGM_X;var ci=DGUI.MENU_IGM_Y;var ax=DGUI.MENU_OPTIONS_Y_OFFSET;var cH=DGUI.MENU_OPTIONS_SPACING;var R=80;var bK=50;var bv=DGUI.MENU_IGP_X_OFF;var aB=DGUI.MENU_IGP_Y_OFF;var o=0;var cv=0;var bX=0;var ct=1;var aA=3;var b8=null;var bR=0;var y;var cx;var f={};f.STATE=0;f.TITLE_AS_CHILD=f.STATE+1;f.TITLE_AS_PARENT=f.TITLE_AS_CHILD+1;f.LSK_TEXT=f.TITLE_AS_PARENT+1;f.RSK_TEXT=f.LSK_TEXT+1;f.CHILD_INDEXES=f.RSK_TEXT+1;f.MAX_DEPTH=10;var cq=[STATE.ASK_SOUND_LEVEL,TEXT.MENU_SOUND,TEXT.MENU_SOUND,TEXT.MENU_SK_SELECT,TEXT.MENU_SK_BACK,11,12];var aG=[STATE.ASK_SOUND_LEVEL,TEXT.MENU_SOUND,TEXT.MENU_SOUND,TEXT.MENU_SK_SELECT,TEXT.MENU_SK_BACK,17,18,19,20];var z=[[STATE.MENU_MAIN,TEXT.MENU_MAIN_MENU,-1,TEXT.MENU_SK_SELECT,bL,39,35,2,4,5],[STATE.MENU_SELECT_LEVEL,TEXT.MENU_SELECT_LEVEL,TEXT.MENU_SELECT_LEVEL,TEXT.MENU_SK_SELECT,TEXT.MENU_SK_BACK,23,24,25,26,27],[STATE.MENU_OPTIONS,TEXT.MENU_OPTIONS,TEXT.MENU_OPTIONS,TEXT.MENU_SK_SELECT,TEXT.MENU_SK_BACK,16,9,10],[],[STATE.MENU_HELP,TEXT.MENU_HELP,TEXT.MENU_HELP,TEXT.MENU_SK_NEXT,TEXT.MENU_SK_BACK,],[STATE.MENU_ABOUT,TEXT.MENU_ABOUT,TEXT.MENU_ABOUT,bL,TEXT.MENU_SK_BACK,],[STATE.MENU_GET_MORE_GAMES,TEXT.MENU_GET_MORE_GAMES],[STATE.MENU_EXIT,TEXT.MENU_EXIT,TEXT.MENU_ARE_YOU_SURE,TEXT.MENU_SK_SELECT,TEXT.MENU_SK_BACK,11,12],[STATE.ASK_SOUND,TEXT.MENU_SOUND,TEXT.MENU_ENABLE_SOUND_QUESTION,TEXT.MENU_SK_SELECT,bL,11,12],[STATE.SELECT_LANGUAGE,TEXT.MENU_LANGUAGE,TEXT.MENU_LANGUAGE,TEXT.MENU_SK_SELECT,TEXT.MENU_SK_BACK,],[STATE.RESET_GAME,TEXT.MENU_RESET_GAME,TEXT.MENU_THE_GAME_DATA,TEXT.MENU_SK_SELECT,TEXT.MENU_SK_BACK,11,12],[STATE.NO,TEXT.MENU_SK_NO],[STATE.YES,TEXT.MENU_SK_YES],[STATE.MENU_INGAME,TEXT.MENU_INGAME,TEXT.MENU_INGAME,TEXT.MENU_SK_SELECT,TEXT.MENU_SK_BACK,36,37,41,14,4,15],[STATE.MENU_INGAME_OPTIONS,TEXT.MENU_OPTIONS,TEXT.MENU_OPTIONS,TEXT.MENU_SK_SELECT,TEXT.MENU_SK_BACK,16,],[STATE.MENU_INGAME_MAIN_MENU,TEXT.MENU_MAIN_MENU,TEXT.MENU_ARE_YOU_SURE,TEXT.MENU_SK_SELECT,TEXT.MENU_SK_BACK,11,12],cq,[STATE.SOUND_OFF,TEXT.MENU_OFF],[STATE.SOUND_LOW,TEXT.MENU_SND_LOW],[STATE.SOUND_MEDIUM,TEXT.MENU_SND_MEDIUM],[STATE.SOUND_HIGH,TEXT.MENU_SND_LOUD],[STATE.GAMEPLAY_UPDATE,TEXT.MENU_SELECT_LEVEL,],[STATE.GAMEOVER,TEXT.MENU_GAME_OVER,],[STATE.LOAD_UNLOAD,TEXT.MENU_LEVEL1,],[STATE.LOAD_UNLOAD,TEXT.MENU_LEVEL2,],[STATE.LOAD_UNLOAD,TEXT.MENU_LEVEL3,],[STATE.LOAD_UNLOAD,TEXT.MENU_LEVEL4,],[STATE.LOAD_UNLOAD,TEXT.MENU_LEVEL5,],[STATE.MENU_SELECT_WORLD,TEXT.MENU_SELECT_WORLD,TEXT.MENU_SELECT_WORLD,TEXT.MENU_SK_SELECT,TEXT.MENU_SK_BACK,29,30,31,32,33,34],[STATE.MENU_SELECT_LEVEL,TEXT.MENU_LABYRINTH_WORLD,TEXT.MENU_SELECT_LEVEL,TEXT.MENU_SK_SELECT,TEXT.MENU_SK_BACK,23,24,25,26,27],[STATE.MENU_SELECT_LEVEL,TEXT.MENU_PIRATE_SHIP,TEXT.MENU_SELECT_LEVEL,TEXT.MENU_SK_SELECT,TEXT.MENU_SK_BACK,23,24,25,26,27],[STATE.MENU_SELECT_LEVEL,TEXT.MENU_CAKE_WORLD,TEXT.MENU_SELECT_LEVEL,TEXT.MENU_SK_SELECT,TEXT.MENU_SK_BACK,23,24,25,26,27],[STATE.MENU_SELECT_LEVEL,TEXT.MENU_ICE_WORLD,TEXT.MENU_SELECT_LEVEL,TEXT.MENU_SK_SELECT,TEXT.MENU_SK_BACK,23,24,25,26,27],[STATE.MENU_SELECT_LEVEL,TEXT.MENU_SPACE_WORLD,TEXT.MENU_SELECT_LEVEL,TEXT.MENU_SK_SELECT,TEXT.MENU_SK_BACK,23,24,25,26,27],[STATE.MENU_SELECT_LEVEL,TEXT.MENU_GHOST_TOWN,TEXT.MENU_SELECT_LEVEL,TEXT.MENU_SK_SELECT,TEXT.MENU_SK_BACK,23,24,25,26,27],[STATE.MENU_NEW_GAME,TEXT.MENU_NEW_GAME,TEXT.MENU_THE_GAME_DATA,TEXT.MENU_SK_SELECT,TEXT.MENU_SK_BACK,11,12],[STATE.RESUME_GAME,TEXT.MENU_RESUME,],[STATE.RESTART_LEVEL,TEXT.MENU_RESTART_LEVEL,TEXT.MENU_ARE_YOU_SURE,TEXT.MENU_SK_SELECT,TEXT.MENU_SK_BACK,11,12],[STATE.GAME_STATISTIC,TEXT.MENU_GAME_OVER,],[STATE.CONTINUE_GAME,TEXT.MENU_CONTINUE,-1,bL,bL,40,-1],[STATE.MENU_MAP,TEXT.MENU_CONTINUE,-1,bL,bL,-1,-1],[STATE.BACK_TO_MINIMAP,TEXT.MENU_BACK_TO_CASTLE,TEXT.MENU_ARE_YOU_SURE,TEXT.MENU_SK_SELECT,TEXT.MENU_SK_BACK,11,12],[STATE.GAMEEND,TEXT.MENU_THE_END,],];var bi=13;var bE=5;var ar=8;var bn=28;var t=42;e.initMenus=function(){cx=LowAPI.Gen_Array([f.MAX_DEPTH],0);y=LowAPI.Gen_Array([f.MAX_DEPTH],0);bR=0;if(aH==null){Pack_Open(DATA.PACK_SPLASH);if(DEF.dbgEnable){Dbg("---------------------- splash.. load")}aH=e.LoadSprite(DATA.SPLASH_SPLASH,-1,true,false);Pack_Close();GGTracking.getInstance().push(POINTCUTID.MAINMENU)}if(e._interface==null){Pack_Open(DATA.PACK_SPRITE);e._interface=e.LoadSprite(DATA.SPRITE_INTERFACE,-1,true,false);Pack_Close()}if(br==null){Pack_Open(DATA.PACK_SPRITE);br=e.LoadSprite(DATA.SPRITE_TOUCHINTERFACE,-1,true,false);Pack_Close()}if(J==null){Pack_Open(DATA.PACK_SPRITE);J=e.LoadSprite(DATA.SPRITE_MENUINGAME,-1,true,false);Pack_Close()}if(w==null){Pack_Open(DATA.PACK_SPRITE);w=e.LoadSprite(DATA.SPRITE_FIREWORK,-1,true,false);Pack_Close()}};var bV;var bu=null;var bp=null;var a8;var S=[1,2,3,4,5,6,5];var b7=0;var bW=S[b7];var bN=S[b7+4];e._menuShiftPos=0;var cM=false;var cp=false;var bS=0;var bs=0;var at=false;e.prototype.updateMenu=function(){while((Language.count==1&&z[z[y[bR]][f.CHILD_INDEXES+cx[bR]]][f.STATE]==STATE.SELECT_LANGUAGE)||(z[z[y[bR]][f.CHILD_INDEXES+cx[bR]]][f.STATE]==STATE.CONTINUE_GAME&&e._gameProgress==m)||(z[z[y[bR]][f.CHILD_INDEXES+cx[bR]]][f.STATE]==STATE.RESTART_LEVEL&&e.bIsMiniMap)||(z[z[y[bR]][f.CHILD_INDEXES+cx[bR]]][f.STATE]==STATE.BACK_TO_MINIMAP&&e.bIsMiniMap)||(z[z[y[bR]][f.CHILD_INDEXES+cx[bR]]][f.STATE]==STATE.RESTART_LEVEL&&(e._tempLevelId==DAI.LEVEL_ID_INTRO_NEW_GAME||e._tempLevelId==DAI.LEVEL_ID_INTRO_THE_END))||(z[z[y[bR]][f.CHILD_INDEXES+cx[bR]]][f.STATE]==STATE.BACK_TO_MINIMAP&&(e._tempLevelId==DAI.LEVEL_ID_INTRO_NEW_GAME||e._tempLevelId==DAI.LEVEL_ID_INTRO_THE_END))||(!(Build.useIGP&&C)&&z[z[y[bR]][f.CHILD_INDEXES+cx[bR]]][f.STATE]==STATE.MENU_GET_MORE_GAMES)){cx[bR]++;if(cx[bR]>z[y[bR]].length-f.CHILD_INDEXES-1){cx[bR]=0}e.redrawAll=true}e.redrawAll=true;var dE=0;var c9=0;var c7=0;var dJ=0;var dU=false;at=false;if(z[y[bR]][f.STATE]==STATE.MENU_MAIN){for(var dN=0;dN<S.length;dN++){if(cx[bR]==S[dN]){dJ=dN;break}}c9=S[dJ]}if(e.redrawAll||bg){var dy=GLLibConfig.screenWidth/2;var db=GLLibConfig.screenHeightActual/2;if(e.bIsPaused){if(e.bIsMiniMap){this.DrawMiniMap()}else{this.gameDraw()}}g.setClip(0,0,GLLibConfig.screenWidth,GLLibConfig.screenHeightActual);var dg=0;var dx=0;var dq=0;if(e.bIsPaused){var dj=LowAPI.Gen_Array([4],0);var dd,dn;J.GetAFrameRect(dj,DAnimID.MENU_INGAME_INGAMEMENU,0,0,0,0);dd=dj[DEF.BOX_RIGHT]-dj[DEF.BOX_LEFT];dn=dj[DEF.BOX_BOTTOM]-dj[DEF.BOX_TOP];var c8=dy-(dd>>1);var c6=db-(dn>>1);dg=dn-DGUI.INGAMEMENU_BACKGROUND_WH;dx=c6+DGUI.INGAMEMENU_BACKGROUND_XY;e.FillArgbRect(c8,c6+DGUI.INGAMEMENU_BACKGROUND_XY-13,DEF.VIEW_W,dn-DGUI.BACKGROUND_OFFSET_H,3355443200|aC);J.PaintAFrame(g,DAnimID.MENU_INGAME_INGAMEMENU,0,c8-dj[DEF.BOX_LEFT],c6-dj[DEF.BOX_TOP],0)}else{g.fillRect(0,0,GLLibConfig.screenWidth,GLLibConfig.screenHeightActual);aH.PaintAFrame(g,aj,0,DEF.SCR_W_D2-DGUI.SPLASH_OFFSET_X,DEF.SCR_H_D2+DGUI.MENU_OFFSET_Y,0)}var c5=z[y[bR]][f.TITLE_AS_PARENT];var dw=0;var dt=DEF.VIEW_W-0;var dv=0;var df=10;var dL=1;var dr=5;if(c5>0&&!e.bIsPaused){e.DrawMultiLineText(g,Text_GetString(c5),dy,(e.bIsPaused?ci:aL-R),dL,2,dt,dv,df,dr);dw+=bK}else{if(e.bIsPaused){if(c5==TEXT.MENU_ARE_YOU_SURE){e.txtDraw(o,Text_GetString(c5),dy,(e.bIsPaused?ci:aL),TOP|HCENTER)}var da=z[y[bR]].length-f.CHILD_INDEXES;for(var dN=0,dM=0;dN<z[y[bR]].length-f.CHILD_INDEXES;dN++){var dF=z[z[y[bR]][f.CHILD_INDEXES+dN]];if((Language.count==1&&dF[f.STATE]==STATE.SELECT_LANGUAGE)||(dF[f.STATE]==STATE.CONTINUE_GAME&&e._gameProgress==m)||(dF[f.STATE]==STATE.RESTART_LEVEL&&e.bIsMiniMap)||(dF[f.STATE]==STATE.BACK_TO_MINIMAP&&e.bIsMiniMap)||(dF[f.STATE]==STATE.RESTART_LEVEL&&(e._tempLevelId==DAI.LEVEL_ID_INTRO_NEW_GAME||e._tempLevelId==DAI.LEVEL_ID_INTRO_THE_END))||(dF[f.STATE]==STATE.BACK_TO_MINIMAP&&(e._tempLevelId==DAI.LEVEL_ID_INTRO_NEW_GAME||e._tempLevelId==DAI.LEVEL_ID_INTRO_THE_END))||(!(Build.useIGP&&C)&&dF[f.STATE]==STATE.MENU_GET_MORE_GAMES)){--da;continue}}var dO=(cH+6)*(da)-ASprite.GetCurrentStringHeight();var dP=dx+(dg-dO)/2;dq=dP}}var dR=-1*cH;var dI=(db+ax+dw)-5*DScreen.RATIO;var dc=dI+cH*5;if(z[y[bR]][f.STATE]==STATE.MENU_MAIN){if(c9>bN){b7=dJ-4;bW=S[b7];bN=S[b7+4];bS=(dJ-4)*(dR);e._menuShiftPos=(-1)*(dR);cM=true}if(c9<bW){b7=dJ;bW=S[b7];bN=S[b7+4];bS=bS-(dR);e._menuShiftPos=(dR);cp=true}}for(var dN=0,dM=0;dN<z[y[bR]].length-f.CHILD_INDEXES;dN++){var dF=z[z[y[bR]][f.CHILD_INDEXES+dN]];if((Language.count==1&&dF[f.STATE]==STATE.SELECT_LANGUAGE)||(dF[f.STATE]==STATE.CONTINUE_GAME&&e._gameProgress==m)||(dF[f.STATE]==STATE.RESTART_LEVEL&&e.bIsMiniMap)||(dF[f.STATE]==STATE.BACK_TO_MINIMAP&&e.bIsMiniMap)||(dF[f.STATE]==STATE.RESTART_LEVEL&&(e._tempLevelId==DAI.LEVEL_ID_INTRO_NEW_GAME||e._tempLevelId==DAI.LEVEL_ID_INTRO_THE_END))||(dF[f.STATE]==STATE.BACK_TO_MINIMAP&&(e._tempLevelId==DAI.LEVEL_ID_INTRO_NEW_GAME||e._tempLevelId==DAI.LEVEL_ID_INTRO_THE_END))||(!(Build.useIGP&&C)&&dF[f.STATE]==STATE.MENU_GET_MORE_GAMES)){continue}if(at){continue}if(z[y[bR]][f.STATE]==STATE.MENU_MAIN){S[dM++]=dN;bW=S[b7];bN=S[b7+4]}if(!e.bIsPaused){var dD=ASprite.GetCurrentStringHeight()>>1}var de=dF[f.TITLE_AS_CHILD];if(a9==STATE.MENU_SELECT_LEVEL){de=this.GetLevelTextByLevelId(e._worldId*DAI.LEVELS_NUM_PRE_WORLD)+dN}var dG;if(z[y[bR]][f.STATE]==STATE.MENU_MAIN){g.setClip(DGUI.MENU_MAIN_CLIPX,(db+ax+dw)-DGUI.MENU_MAIN_CLIPOFFSETH,DGUI.MENU_MAIN_CLIPW,cH*5);dG=(db+ax+dw)+dE+bS}else{dG=(db+ax+dw)+dE}if(e.bIsPaused){dG=dq+dE}var du=null;var ds=Text_GetString(de);if(Language.count>1&&z[y[bR]][f.STATE]==STATE.SELECT_LANGUAGE){var dC=dF[f.TITLE_AS_CHILD]-TEXT.MENU_LANGUAGE_NAME;ds=cP[dC]}var dA=Text_GetString(TEXT.MENU_ON);var dK=Text_GetString(TEXT.MENU_OFF);var dB=[" "+dA," "+dK];if(e.isSoundEnabled){bs=0}else{bs=1}if(z[y[bR]][f.STATE]!=STATE.MENU_MAIN){if((ds==(Text_GetString(TEXT.MENU_SOUND))||ds==(Text_GetString(TEXT.MENU_OPTIONS)))){ds=Text_GetString(TEXT.MENU_SOUND)+dB[bs];if(cx[bR]==dN){dU=true}}}if(bg){cx[bR]=0;b7=0;bS=0;bW=S[b7];bN=S[b7+4]}if(cx[bR]==dN){c7=dF[f.TITLE_AS_CHILD];if(a9==STATE.MENU_SELECT_LEVEL){c7=this.GetLevelTextByLevelId(e._worldId*DAI.LEVELS_NUM_PRE_WORLD)+dN}du=this.txtDrawSpecialEffectWave(cx[bR]==dN?ct:bX,ds,dy,dG+e._menuShiftPos,LEFT)}else{var dp=(cx[bR]==dN?ct:bX);if(dF[f.STATE]==STATE.MENU_GET_MORE_GAMES){dp=aA}e.txtDraw(dp,ds,dy,dG+e._menuShiftPos,TOP|HCENTER)}g.setClip(0,DGUI.MENU_OFFSET_Y,DEF.VIEW_W,DEF.VIEW_H+DGUI.MENU_OFFSET_Y);if(cx[bR]==dN){var dm,dl;if(e.bIsPaused){dm=du[0]-15*DScreen.RATIO;dl=du[1]+15*DScreen.RATIO;dG+=ASprite.GetCurrentStringHeight()>>1}else{var dQ=LowAPI.Gen_Array([4],0);e._interface.GetAFrameRect(dQ,DAnimID.INTERFACE_MENU_CURSOR,0,0,0,0);dm=du[0]-DGUI.MENU_ICON_OFFX;dl=du[1]+DGUI.MENU_ICON_OFFX;dG+=ASprite.GetCurrentStringHeight()>>1}e._interface.PaintAFrame(g,DAnimID.INTERFACE_MENU_CURSOR,s_game_currentFrameNB%e._interface.GetAFrames(DAnimID.INTERFACE_MENU_CURSOR),dm,dG,0);e._interface.PaintAFrame(g,DAnimID.INTERFACE_MENU_CURSOR,s_game_currentFrameNB%e._interface.GetAFrames(DAnimID.INTERFACE_MENU_CURSOR),dl,dG,0)}else{if(!e.bIsPaused){dG+=ASprite.GetCurrentStringHeight()>>1}}if(e.bIsPaused){dG+=(ASprite.GetCurrentStringHeight()>>1)+cl}var dk=false;var dT=false;var c4=false;var di=0;var dh=(e._gameProgress==m?6:5);if((bN>S[3]&&bN<S[6])){dk=true}if((bW>S[0]&&bW<=S[4])){dT=true}if(e.isPointInRect(cj,dG-(W>>1),GetScreenWidth()-(cj<<1),W)){if(z[y[bR]][f.STATE]==STATE.MENU_MAIN&&((dk&&dN==dh&&!dT)||(dT&&dN==di&&!dk))){c4=true}if(DEF.dbgEnable){Dbg("******************************************* isArrowIgnoreListener "+c4)}if(!c4){if((!dU&&((a9==STATE.MENU_OPTIONS&&dN==0)||(a9==STATE.MENU_INGAME&&dN==3)))){if(DEF.dbgEnable){Dbg("******************************************* SOUND OFF -> ON")}dU=true}this.keyPressed(GLLibConfig.keycodeFire);this.keyReleased(GLLibConfig.keycodeFire);e.UpdateKeyState()}cx[bR]=dN;if(DEF.dbgEnable){Dbg("------------------------------------------- click , soundSelected : "+dU+" i : "+dN)}}if(z[y[bR]][f.STATE]==STATE.MENU_MAIN){dE+=cH}else{dE+=cH+6}}if(z[y[bR]][f.STATE]==STATE.MENU_MAIN){if(bN>S[3]&&bN<S[6]){}if(bW>S[0]&&bW<=S[4]){}}e.redrawAll=false}bG=WasAnyKeyReleased();if(bG>=0){if(DEF.dbgEnable){Dbg("******************************************* _keycode : "+bG+" s_game_state : "+a9)}if(((bG==GLKey.k_menuOK)||(bG==GLKey.k_fire))&&bR<f.MAX_DEPTH){var dH=z[z[y[bR]][f.CHILD_INDEXES+cx[bR]]][f.STATE];if(e.bIsPaused){var dS=Text_GetString(c7);if(dS==(Text_GetString(TEXT.MENU_HELP))||dH==STATE.MENU_HELP){at=true}}if(dU&&(dH==STATE.ASK_SOUND_LEVEL||dH==STATE.MENU_INGAME_OPTIONS)){if(bs==0){if(e.isSoundEnabled){this.StopSound();e.isSoundEnabled=false}e.RMS_Save()}else{this.startSound();e.RMS_Save()}bs=++bs%2}else{}}else{if(bG==GLKey.k_menuBack){if(bR>0&&z[y[bR]][f.RSK_TEXT]!=-1){bR--;a9=z[y[bR]][f.STATE]}else{if(e.bIsPaused&&a9==STATE.MENU_INGAME){if(e.bIsMiniMap){a9=STATE.MENU_MAP}else{a9=STATE.GAMEPLAY_UPDATE}e.bIsPaused=false;this.ResumeSoundBGM()}}e.PlaySound(DSound_Channel.SFX,DATA.SOUND_MENU_CONFIRM)}}if(bG==GLKey.k_up){if(z[y[bR]][f.STATE]==STATE.MENU_MAIN){if(bW>S[0]||c9!=bW){cx[bR]--}}else{cx[bR]--}if(cx[bR]<0){cx[bR]=z[y[bR]].length-f.CHILD_INDEXES-1}while((Language.count==1&&z[z[y[bR]][f.CHILD_INDEXES+cx[bR]]][f.STATE]==STATE.SELECT_LANGUAGE)||(z[z[y[bR]][f.CHILD_INDEXES+cx[bR]]][f.STATE]==STATE.CONTINUE_GAME&&e._gameProgress==m)||(z[z[y[bR]][f.CHILD_INDEXES+cx[bR]]][f.STATE]==STATE.RESTART_LEVEL&&e.bIsMiniMap)||(z[z[y[bR]][f.CHILD_INDEXES+cx[bR]]][f.STATE]==STATE.BACK_TO_MINIMAP&&e.bIsMiniMap)||(z[z[y[bR]][f.CHILD_INDEXES+cx[bR]]][f.STATE]==STATE.RESTART_LEVEL&&(e._tempLevelId==DAI.LEVEL_ID_INTRO_NEW_GAME||e._tempLevelId==DAI.LEVEL_ID_INTRO_THE_END))||(z[z[y[bR]][f.CHILD_INDEXES+cx[bR]]][f.STATE]==STATE.BACK_TO_MINIMAP&&(e._tempLevelId==DAI.LEVEL_ID_INTRO_NEW_GAME||e._tempLevelId==DAI.LEVEL_ID_INTRO_THE_END))||(!(Build.useIGP&&C)&&z[z[y[bR]][f.CHILD_INDEXES+cx[bR]]][f.STATE]==STATE.MENU_GET_MORE_GAMES)){cx[bR]--;if(cx[bR]<0){cx[bR]=z[y[bR]].length-f.CHILD_INDEXES-1}}}else{if(bG==GLKey.k_down){if(z[y[bR]][f.STATE]==STATE.MENU_MAIN){if(bN<S[6]||c9!=bN){cx[bR]++}}else{cx[bR]++}if(cx[bR]>z[y[bR]].length-f.CHILD_INDEXES-1){cx[bR]=0}}}e.redrawAll=true;ResetKey()}if(cM){e._menuShiftPos-=4*DScreen.RATIO;if(e._menuShiftPos<=0){cM=false;e._menuShiftPos=0}}if(cp){e._menuShiftPos+=4*DScreen.RATIO;if(e._menuShiftPos>=0){cp=false;e._menuShiftPos=0}}if(!at){this.setSoftKeys(z[y[bR]][f.LSK_TEXT],z[y[bR]][f.RSK_TEXT]);this.drawSoftKeys()}var dH=z[z[y[bR]][f.CHILD_INDEXES+cx[bR]]][f.STATE];if((((bG==GLKey.k_menuOK)&&a9!=STATE.MENU_INGAME)||(bG==GLKey.k_fire))&&bR<f.MAX_DEPTH&&dH!=STATE.ASK_SOUND_LEVEL&&dH!=STATE.MENU_INGAME_OPTIONS){var c3=a9;a9=z[z[y[bR]][f.CHILD_INDEXES+cx[bR]]][f.STATE];var dz=z[y[bR]][f.CHILD_INDEXES+cx[bR]];bR++;y[bR]=dz;cx[bR]=0;if(Language.count>1&&c3!=STATE.SELECT_LANGUAGE&&a9==STATE.SELECT_LANGUAGE){cx[bR]=e.curLanguage}e.PlaySound(DSound_Channel.SFX,DATA.SOUND_MENU_CONFIRM)}return a9};e._isInputEvent=false;e._eventCallback=null;e.prototype._FakegetMousePos=function(c3){return e.__superproto__._FakegetMousePos.call(this,c3)};e.prototype.requireUserInputEvent=function(){gllib_runtime.requireUserInputEvent(function(c3){e._eventCallback=c3;e._isInputEvent=true;Player.processUserInputEvent()})};e.GAMELOFT_LOGO_WAIT_TIME=2000;e.bIsPaused=false;e.bIsMiniMap=false;e.bIsMainMain=false;e.redrawAll=false;e.loadingPhase=0;e.s_next_state=0;e.gameAreaX=0;e.gameAreaY=0;e.gameAreaWidth=0;e.gameAreaHeight=0;e.playerCar=null;e.mFristDayPlay="";e.mLastTimeStamp="";e.curLanguage=0;var bY=0;e.bSetLanguage=false;e.bSetSound=false;var v;e.keyToIGPMap=null;e.s_License=null;e.prototype.preUpdate=function(){bZ+=e._frameDT;var c3=bZ+(DEF.ANIMATION_FRAME_TICK/4);bc=c3/DEF.ANIMATION_FRAME_TICK;bZ=bZ-(bc*DEF.ANIMATION_FRAME_TICK);e._velocityRate=Math_IntToFixedPoint(DEF.VELOCITY_FRAME_TICK)/1000;if(Y==s_game_keyJustPressed){if(s_game_keyPressedTime-cU>DEF.DOUBLE_PRESSED_INTERVAL){cU=s_game_keyPressedTime}}else{if(s_game_keyJustPressed!=-1){Y=s_game_keyJustPressed;cU=s_game_keyPressedTime}}};var aj=2;var b2=0;e.prototype.Game_update=function(){e._frameDT_Real=s_game_frameDT;s_game_frameDT=1000/GLLibConfig.FPSLimiter;e._frameDT=1000/GLLibConfig.FPSLimiter;R=0;bK=30;this.preUpdate();this.UpdatePointerEvents(false);switch(a9){case STATE.QUIT:a9=-1;if(window.getReferrer){console.log(window.getReferrer());window.open(window.getReferrer(),"_self")}break;case STATE.LOADING_ADS:this.UpdateGameState_LOADING_ADS();break;case STATE.INIT:this.UpdateGameState_INIT();break;case STATE.GAMELOFT_LOGO:this.UpdateGameState_GAMELOFT_LOGO();break;case STATE.SPLASH:this.UpdateGameState_SPLASH();break;case STATE.SELECT_LANGUAGE_INIT:this.UpdateGameState_SELECT_LANGUAGE_INIT();break;case STATE.SELECT_LANGUAGE:this.UpdateGameState_SELECT_LANGUAGE();break;case STATE.LOAD_UNLOAD:this.UpdateGameState_LOAD_UNLOAD();break;case STATE.MENU_INIT:this.UpdateGameState_MENU_INIT();break;case STATE.ASK_SOUND:this.UpdateGameState_ASK_SOUND();break;case STATE.ASK_SOUND_LEVEL:this.UpdateGameState_ASK_SOUND_LEVEL();break;case STATE.MENU_EXIT:this.UpdateGameState_MENU_EXIT();break;case STATE.IGP:this.UpdateGameState_IGP();break;case STATE.MENU_GET_MORE_GAMES_INIT:this.UpdateGameState_MENU_GET_MORE_GAMES_INIT();break;case STATE.MENU_MAIN:this.UpdateGameState_MENU_MAIN();break;case STATE.MENU_INGAME_MAIN_MENU:this.UpdateGameState_MENU_INGAME_MAIN_MENU();break;case STATE.BACK_TO_MINIMAP:this.UpdateGameState_BACK_TO_MINIMAP();break;case STATE.GAMEPLAY_UPDATE:this.UpdateGameState_GAMEPLAY_UPDATE();break;case STATE.K_MRC_INIT:this.UpdateGameState_K_MRC_INIT();break;case STATE.K_MRC_VALIDATING:this.UpdateGameState_K_MRC_VALIDATING();break;case STATE.K_MRC_EXPIRED:this.UpdateGameState_K_MRC_EXPIRED();break;case STATE.K_MRC_NETWORK_FAILED:this.UpdateGameState_K_MRC_NETWORK_FAILED();break;case STATE.GAMEOVER:this.UpdateGameState_GAMEOVER();break;case STATE.GAMEEND:this.UpdateGameState_GAMEEND();break;case STATE.GAME_STATISTIC:this.UpdateGameState_GAME_STATISTIC();break;case STATE.END_GAME_IGP:this.UpdateGameState_END_GAME_IGP();break;case STATE.MENU_SELECT_LEVEL:var c3=e._level2tiled.length>>2;switch(this.updateMenu()){case STATE.LOAD_UNLOAD:e._levelId+=z[y[bR]][f.TITLE_AS_CHILD]-TEXT.MENU_LEVEL1;e._tempLevelId=e._levelId;break}break;case STATE.MENU_SELECT_WORLD:switch(this.updateMenu()){case STATE.MENU_SELECT_LEVEL:e._worldId=(z[y[bR]][f.TITLE_AS_CHILD]-TEXT.MENU_LABYRINTH_WORLD);e._levelId=e._worldId*DAI.LEVELS_NUM_PRE_WORLD;break}break;case STATE.MENU_HELP:e._needSpecialProcess=true;if(bR>0&&z[y[bR]][f.RSK_TEXT]!=-1){this.UpdateGameState_MENU_HELP()}e._needSpecialProcess=false;break;case STATE.MENU_ABOUT:aj=1;R=80*DScreen.RATIO;e._needSpecialProcess=true;if(bR>0&&z[y[bR]][f.RSK_TEXT]!=-1){this.UpdateGameState_MENU_ABOUT()}e._needSpecialProcess=false;break;case STATE.RESET_GAME:aj=1;bK=0;R=70*DScreen.RATIO;switch(this.updateMenu()){case STATE.YES:e.RMS_Init();bR-=2;a9=z[y[bR]][f.STATE];if((z[y[bR]][f.STATE]==STATE.MENU_MAIN)){a9=STATE.MENU_NEW_GAME}break;case STATE.NO:bR-=2;a9=z[y[bR]][f.STATE];break}break;case STATE.MENU_OPTIONS:aj=1;bK=-20;R=80;switch(this.updateMenu()){}break;case STATE.RESUME_GAME:if(e.bIsMiniMap){a9=STATE.MENU_MAP}else{a9=STATE.GAMEPLAY_UPDATE}e.bIsPaused=false;this.ResumeSoundBGM();break;case STATE.RESTART_LEVEL:switch(this.updateMenu()){case STATE.YES:e._checkPointData=null;e.GotoRestart(false);break;case STATE.NO:bR-=2;a9=z[y[bR]][f.STATE];break}break;case STATE.MENU_INGAME:if(DEF.dbgEnableCheat){if((this.useCheatCode()==a9)||DEF.dbgEnableGodMode||DEF.dbgUnlockLevel){if(DEF.dbgEnable){Dbg("_________ s_game_state: "+a9)}e.godModeUnlock=true}}switch(this.updateMenu()){case STATE.MENU_GET_MORE_GAMES:a9=STATE.MENU_GET_MORE_GAMES_INIT;break}break;case STATE.MENU_INGAME_OPTIONS:switch(this.updateMenu()){}break;case STATE.MENU_NEW_GAME:if(e._gameProgress==m){e._tempLevelId=DAI.LEVEL_ID_INTRO_NEW_GAME;a9=STATE.LOAD_UNLOAD;e._gameProgress++;e.RMS_Save()}else{a9=STATE.RESET_GAME}break;case STATE.CONTINUE_GAME:e.GotoMiniMap();break;case STATE.MENU_MAP:this.UpdateMiniMap();this.DrawMiniMap();if(WasKeyReleased(GLKey.k_menuOK)){e.initIngameMenu(STATE.MENU_INGAME)}break}GLLibPlayer.Snd_Update();this.UpdatePointerEvents(true);this.RenderPointerEvent();this.ClearPointer()};e.NewAlgo=function(c4,c5){var c6=240;var c3=0;c5.getRGB(aE,0,c6,0,0,240,320);e.DrawZoom(c4,0,0);e.DrawZoom(c4,120,0);e.DrawZoom(c4,0,80);e.DrawZoom(c4,120,80);e.DrawZoom(c4,0,160);e.DrawZoom(c4,120,160);e.DrawZoom(c4,0,240);e.DrawZoom(c4,120,240)};e.DrawZoom=function(c6,c7,c5){var c4=0;var c8;for(var c9=c5;c9<(c5+80);++c9){for(var c3=c7;c3<(c7+120);++c3){c8=aE[(c9)*240+(c3)];al[c4++]=c8;al[c4++]=c8}for(var c3=c7;c3<(c7+120);++c3){c8=aE[(c9)*240+(c3)];al[c4++]=c8;al[c4++]=c8}}};var c=false;var G=0;var cQ=0;var bD=DEF.VIEW_H;var cf=false;var ai=255;var ap=255;e.ShowTheStory=function(){g.setColor(0);g.setClip(0,0,DEF.VIEW_W,DEF.VIEW_H);g.fillRect(0,0,DEF.VIEW_W,DEF.VIEW_H);G=DGUI.TOPLINEOFSTORYTEXT_OFFSET_Y;e.txtSetFont(aS);e.txtDraw(2,Text_GetString(TEXT.MENU_SK_SKIP),GLLibConfig.screenWidth,GLLibConfig.screenHeight,BOTTOM|RIGHT);if(cf){bD=G+10}if(cQ<3){g.setClip(0,0,DEF.VIEW_W,DEF.VIEW_H-25);var c4=0;e.DrawMultiLineText(g,Text_GetString(TEXT.MENU_STORY_B1+cQ),10,G+10,0,2,DEF.VIEW_W-10,0,10,c4);if(!cf){ai-=6;if(ai<=0){ai=0}}else{ai+=12;if(ai>=ap){ai=ap}}var c3=ai<<24;e.FillArgbRect(0,0,DEF.VIEW_W,DEF.VIEW_H-20,c3|a5)}if(bD--<G+10&&!cf){cf=true;e._lastFrameNB=s_game_currentFrameNB}if(s_game_currentFrameNB-e._lastFrameNB==15){bD=DEF.VIEW_H;cQ++;cf=false;ai=255}if(cQ==3){cQ=0;e.txtSetFont(cL);c=true}if(IsKeyDown(GLKey.k_menuBack)){cQ=0;e.txtSetFont(cL);c=true}};e.godModeUnlock=false;var cr=[[1,GLKey.k_num1,GLKey.k_num9,GLKey.k_num7,GLKey.k_num3,STATE.MENU_MAIN],[1,GLKey.k_num3,GLKey.k_num7,GLKey.k_num9,GLKey.k_num1,STATE.MENU_INGAME],];var aV=0;var b1=1000;var ay=false;var a=2;var aw=0;e.prototype.useCheatCode=function(){var c4,c3=-1;for(var c5=0;c5<cr.length;c5++){c4=cr[c5][0];if(WasAnyKeyPressed()!=GLKey.k_invalid){if(WasKeyPressed(cr[c5][c4])){c4++;if(c4==cr[c5].length-1){c3=cr[c5][c4];cr[c5][0]=1;break}}else{cr[c5][0]=1;continue}}cr[c5][0]=c4}aw=1;if(a9==STATE.MENU_MAIN){aw=0}if(ay){aV=System.currentTimeMillis();ay=false}if(e.isPointInRect(0,0,50*DScreen.RATIO,50*DScreen.RATIO)){if(System.currentTimeMillis()-aV<b1){a++}else{a=2}ay=true}if(e.isPointInRect(GLLibConfig.screenWidth-50*DScreen.RATIO,0,50*DScreen.RATIO,50*DScreen.RATIO)){if(a==cr[aw].length-1){c3=cr[aw][a]}}if(c3==STATE.MENU_INGAME){if(DEF.dbgEnable){Dbg("____________ ingame, cheat")}}if(c3==STATE.MENU_MAIN){if(DEF.dbgEnable){Dbg("____________ main menu, cheat")}}return c3};e.InitSelectMenuLanguage=function(){for(var c4=0;c4<Language.count;c4++){Text_LoadTextFromPack_INI("/"+Text_GetLanguageAsString(am[c4]),DATA.TEXT_INIT);cP[c4]=Text_GetString(TEXT.INIT_LANGUAGE_NAME)}var c3=z.length;var c5=9;for(var c4=0;c4<am.length;c4++){var c6=[STATE.YES,TEXT.MENU_LANGUAGE_NAME+c4];z.push(c6);z[c5].push(c3+c4)}};e.prototype.UpdateGameState_LOADING_ADS=function(){g.setClip(0,0,GLLibConfig.screenWidth,GLLibConfig.screenHeightActual);g.fillRect(0,0,GLLibConfig.screenWidth,GLLibConfig.screenHeightActual);if(cR<STATE.MENU_MAIN){if(DEF.dbgEnable){Dbg("loading ads in game ...")}if(!e.isShowAds()){a9=STATE.GAMELOFT_LOGO}}if(cR==STATE.MENU_MAP){if(!e.isShowAds()){this._gotoGamplay()}}else{if(cR==STATE.GAMEOVER){if(!e.isShowAds()){e.ads_show=false;a9=cR}}}};e.prototype.ReInitializeDGUI=function(){DGUI.MENU_OFFSET_Y=0;if(GLLibConfig.screenHeightActual>GLLibConfig.screenHeight){var c3=GLLibConfig.screenHeightActual-GLLibConfig.screenHeight;c3=c3-(GLLibConfig.screenHeightActual-1250)/2;DGUI.INTERFACE_DPAD_Y=c3+DGUI.INTERFACE_DPAD_Y;DGUI.INTERFACE_DPAD_JUMP_Y=c3+DGUI.INTERFACE_DPAD_JUMP_Y;DGUI.INTERFACE_DPAD_CROUCH_Y=c3+DGUI.INTERFACE_DPAD_CROUCH_Y;DGUI.INTERFACE_DPAD_ATTACK_Y=c3+DGUI.INTERFACE_DPAD_ATTACK_Y;DGUI.INTERFACE_DPAD_LEFT_Y=c3+DGUI.INTERFACE_DPAD_LEFT_Y;DGUI.INTERFACE_DPAD_RIGHT_Y=c3+DGUI.INTERFACE_DPAD_RIGHT_Y;O[cW]=[DGUI.INTERFACE_DPAD_LEFT_X-Q/2,DGUI.INTERFACE_DPAD_LEFT_Y-ac/2,Q,ac];O[cd]=[DGUI.INTERFACE_DPAD_RIGHT_X-Q/2,DGUI.INTERFACE_DPAD_RIGHT_Y-ac/2,Q,ac];O[b0]=[DGUI.INTERFACE_DPAD_CROUCH_X,DGUI.INTERFACE_DPAD_CROUCH_Y,ch,cs];O[d]=[DGUI.INTERFACE_DPAD_JUMP_X,DGUI.INTERFACE_DPAD_JUMP_Y,ch,cs];O[ae]=[DGUI.INTERFACE_DPAD_ATTACK_X,DGUI.INTERFACE_DPAD_ATTACK_Y,cm,cE];DGUI.MENU_OFFSET_Y=(GLLibConfig.screenHeightActual-GLLibConfig.screenHeight)/2;DGUI.INTERFACE_LOAD_UNLOAD_WORLDICON_POS_Y=DGUI.INTERFACE_LOAD_UNLOAD_WORLDICON_POS_Y+DGUI.MENU_OFFSET_Y;DGUI.MENU_MAIN_Y=DGUI.MENU_MAIN_Y+DGUI.MENU_OFFSET_Y;aL=DGUI.MENU_MAIN_Y;DGUI.MENU_IGM_Y=DGUI.MENU_IGM_Y+DGUI.MENU_OFFSET_Y;ci=DGUI.MENU_IGM_Y;DGUI.HELP_POSY=DGUI.HELP_POSY+DGUI.MENU_OFFSET_Y}};e.prototype.UpdateGameState_INIT=function(){this.ReInitializeDGUI();Math_Init(DATA.PACK_MISC,DATA.MISC_COS,DATA.MISC_SQRT);if(DEF.dbgEnable){Dbg("loading mime type")}Pack_LoadMIME(DATA.PACK_MIME_TYPE);Text_SetEncoding(Build.encoding);this.LoadMisc();am=LowAPI.Gen_Array([Language.count],0);cP=LowAPI.Gen_Array([Language.count],0);var c6=0;if(Language.EN){am[c6++]=GLLang.EN}if(Language.DE){am[c6++]=GLLang.DE}if(Language.FR){am[c6++]=GLLang.FR}if(Language.IT){am[c6++]=GLLang.IT}if(Language.ES){am[c6++]=GLLang.ES}if(Language.BR){am[c6++]=GLLang.BR}if(Language.PT){am[c6++]=GLLang.PT}if(Language.RU){am[c6++]=GLLang.RU}if(Language.JP){am[c6++]=GLLang.JP}if(Language.CN){am[c6++]=GLLang.CN}if(Language.KR){am[c6++]=GLLang.KR}e.InitSelectMenuLanguage();ASprite.InitCachePool(2);ASprite.InitPoolSize(0,100);ASprite.InitPoolSize(1,100);if(DEF.dbgEnable){Dbg("loading RMS")}e.RMS_Load();var c8=new Date();var dg=0;var c3="";var db="";var c7=false;if(e.mFristDayPlay==""){c7=true;e.mFristDayPlay=Date.parse(c8.toString().replace(/[ap]m$/i,""));e.mLastTimeStamp=e.mFristDayPlay;e.RMS_Save()}var dd=Number(e.mFristDayPlay);c3=new Date(dd);dg=((c8-c3)/(1000*3600*24)).castToInt();var c4=Number(e.mLastTimeStamp);db=new Date(c4);var c9=((c8-db)/(1000*3600*24));if(c7||c9>1){var de=""+c3.getFullYear();var df=""+("00"+(c3.getMonth()+1)).slice(-2);var dc=""+("00"+c3.getDate()).slice(-2);var c5=de+df+dc}if(c7){GGTracking.getInstance().push(POINTCUTID.GAMERETENTION,"D00")}else{if(c9>1){GGTracking.getInstance().push(POINTCUTID.GAMERETENTION,"D"+dg)}}e.mLastTimeStamp=Date.parse(c8.toString().replace(/[ap]m$/i,""));e.RMS_Save();if(DEF.dbgEnable){Dbg("loading fonts")}this.fontLoad();GLLibPlayer.Snd_Init(DATA.SOUND_MAX);e.LoadUnload(DLoadState.LOAD_SOUND);if(cK){for(var da=0;da<z.length;da++){if(z[da]==cq){z[da]=aG}}}a9=STATE.LOADING_ADS;if(Build.useIGP){if(DEF.dbgEnable){Dbg("initializing IGPs")}C=true}};var bg=false;e.prototype.LoadMisc=function(){Pack_Open(DATA.PACK_MISC);e._class2sprites=Pack_ReadData(DATA.MISC_CLASS2SPRIT);e._level2tiled=Pack_ReadData(DATA.MISC_LEVEL2TILED);Pack_Close()};e.prototype.UpdateGameState_GAMELOFT_LOGO=function(){if(e.spriteArray[DSpriteID.GAMELOFT_LOGO]==null){if(DEF.dbgEnable){Dbg("loading gameloft logo")}Pack_Open(DATA.PACK_SPRITE);e.spriteLoad(DSpriteID.GAMELOFT_LOGO,DATA.SPRITE_GAMELOFT_LOGO,true,false);Pack_Close();e.redrawAll=true;v=System.currentTimeMillis()+e.GAMELOFT_LOGO_WAIT_TIME}else{if(e.redrawAll){SetColor(4278190080);FillRect(0,0,GLLibConfig.screenWidth,GLLibConfig.screenHeightActual);e.spriteArray[DSpriteID.GAMELOFT_LOGO].PaintFrame(g,DAnimID.LOGO_FRAME_MAIN,(GLLibConfig.screenWidth/2)-(e.spriteArray[DSpriteID.GAMELOFT_LOGO].GetFrameWidth(DAnimID.LOGO_FRAME_MAIN)/2),(GLLibConfig.screenHeightActual/2)-(e.spriteArray[DSpriteID.GAMELOFT_LOGO].GetFrameHeight(DAnimID.LOGO_FRAME_MAIN)/2),0);e.redrawAll=false}}v=Math.min(v,System.currentTimeMillis()+e.GAMELOFT_LOGO_WAIT_TIME);if(System.currentTimeMillis()>v){e.spriteUnLoad(DSpriteID.GAMELOFT_LOGO);if(bo){aX=DATA.PACK_TEXT;a9=STATE.MENU_INIT;e.loadingPhase=0}else{a9=STATE.SELECT_LANGUAGE_INIT}e.redrawAll=true;this.requireUserInputEvent()}};e.prototype.UpdateGameState_SPLASH=function(){if(e.redrawAll||bg){aH.PaintAFrame(g,0,0,DEF.SCR_W_D2-DGUI.SPLASH_OFFSET_X,DEF.SCR_H_D2+DGUI.MENU_OFFSET_Y,0);var c3=3;if((s_game_currentFrameNB%10)>5){e.DrawMultiLineText(g,Text_GetString(TEXT.INIT_PRESS_ANY_KEY_TOUCH),GLLibConfig.screenWidth/2,GLLibConfig.screenHeight+DGUI.MENU_OFFSET_Y-30*DScreen.RATIO,BOTTOM|HCENTER,c3,GLLibConfig.screenWidth,0,10,15)}e.redrawAll=false}e.redrawAll=true;if(WasKeyReleased(GLKey.k_fire)){a9=STATE.MENU_INIT}};e.prototype.UpdateGameState_SELECT_LANGUAGE_INIT=function(){e.loadingPhase=0;if(Language.count==1){aX=DATA.PACK_TEXT}else{aX="/"+Text_GetLanguageAsString(am[e.curLanguage])}if(e.bSetLanguage){e.curLanguage=0;var c4=(navigator.language||navigator.userLanguage).substring(0,2).toUpperCase();if(DEF.dbgEnable){Dbg("------------------------- "+c4)}for(var c3=0;c3<Language.count;c3++){if(c4==Text_GetLanguageAsString(am[c3])){e.curLanguage=c3;break}}e.initMenus();aX="/"+Text_GetLanguageAsString(am[e.curLanguage]);e.bSetLanguage=false;a9=STATE.SPLASH;e.RMS_Save()}else{if(e.bSetSound){e.initMenus();y[bR]=ar;a9=STATE.ASK_SOUND}else{e.initMenus();a9=STATE.SPLASH}}if(!bo){Text_LoadTextFromPack_INI(aX,DATA.TEXT_INIT)}bY=e.curLanguage;e.redrawAll=true};var cc=["x",GLLang.EN,GLLang.DE,GLLang.FR,GLLang.IT,GLLang.ES,GLLang.BR,GLLang.PT];var n=["x",GLLang.RU];e.prototype.UpdateGameState_SELECT_LANGUAGE=function(){aj=1;bK=-70*DScreen.RATIO;R=100*DScreen.RATIO;switch(this.updateMenu()){case STATE.YES:var c3=e.curLanguage;e.curLanguage=z[y[bR]][f.TITLE_AS_CHILD]-TEXT.MENU_LANGUAGE_NAME;e.RMS_Save();if(cc.indexOf(am[c3])*n.indexOf(am[e.curLanguage])>0){if(DEF.dbgEnable){Dbg("-------------------------- Reload font ...")}this.fontLoad()}aX="/"+Text_GetLanguageAsString(am[e.curLanguage]);Text_LoadTextFromPack_INI(aX,DATA.TEXT_MENU);if(e.bSetSound){Text_LoadTextFromPack_INI(aX,DATA.TEXT_INIT);y[bR]=ar;a9=STATE.ASK_SOUND;e.bSetLanguage=false}else{bR-=1;a9=z[y[bR]][f.STATE]}break}};e.prototype.GetLevelPaletteIdByWorldId=function(c3){if(c3>DAI.WORLD_ID_ICE){c3++}return c3+1};e.prototype.GetLevelMapActorBossByWorldId=function(c3){return DAnimID.MAP_ACTOR_BOSS_1+c3};e.prototype.GetWorldMapActorIconByWorldId=function(c3){if(c3>DAI.WORLD_ID_ICE){c3++}return DAnimID.MAP_ACTOR_ICON_LABYRINTH+c3};e.prototype.GetLevelTextByLevelId=function(c3){if(c3>=(DAI.WORLD_ID_ICE+1)*DAI.LEVELS_NUM_PRE_WORLD){c3+=DAI.LEVELS_NUM_PRE_WORLD}var c4=c3-DAI.LEVELS_NUM_PRE_WORLD;return TEXT.MENU_LEVEL1+c3};e.prototype.GetLevelMenuTextByLevelId=function(c3){var c4=c3;return TEXT.MENU_LV1_1+c3};e.prototype.GetLevelWizardTextByWorldId=function(c3){if(c3>DAI.WORLD_ID_ICE){c3++}return TEXT.MENU_WIZARD_LABYRINTH+c3+1};e.prototype.DrawSpecialEffect_Load_Unload=function(dc){var dd=0;var de=0;FillRect(0,0,GLLibConfig.screenWidth,GLLibConfig.screenHeightActual);aH.PaintAFrame(g,1,0,DEF.SCR_W_D2-DGUI.SPLASH_OFFSET_X,DEF.SCR_H_D2+DGUI.MENU_OFFSET_Y,0);dc=this.GetWorldMapActorIconByWorldId(dc);var dm=e.spriteArray[DSpriteID.MAP_ACTOR].GetAnimFrame(dc,0);de=e.spriteArray[DSpriteID.MAP_ACTOR].GetFrameWidth(dm);var dj=e.spriteArray[DSpriteID.MAP_ACTOR].GetFrameModuleX(dm,0);var c4=0-dj;if(e._gameProgress>bb&&dc<=DAnimID.MAP_ACTOR_ICON_SPACE){e.spriteArray[DSpriteID.MAP_ACTOR].PaintAFrame(g,dc,dd,c4+(GLLibConfig.screenWidth-de)/2,DGUI.INTERFACE_LOAD_UNLOAD_WORLDICON_POS_Y,0)}var di=1;var c3=DEF.VIEW_W-20;var dh=0;var df=30;var db=DEF.VIEW_W_D2;var da=80;var dk=0;var c6=5;if(e._gameProgress>bb&&e._tempLevelId<DAI.LEVEL_ID_INTRO_NEW_GAME){e.DrawMultiLineText(g,Text_GetString(this.GetLevelTextByLevelId(e._tempLevelId)),db,DGUI.INTERFACE_LOAD_UNLOAD_WORLDICON_POS_Y-DGUI.LOAD_UNLOAD_TEXT_OFFSETY,di,dk,c3,dh,df,c6)}var c8=DGUI.LOADSTAR_X;var c7=DGUI.LOADSTAR_Y-DGUI.MENU_OFFSET_Y;this.DrawLevelStars(e._tempLevelId,c8,c7);if(e.loadingPhase!=DLoadState.LOAD_OVER){e.txtDraw(0,Text_GetString(TEXT.MENU_LOADING)+"...",GLLibConfig.screenWidth/2,GLLibConfig.screenHeight+DGUI.MENU_OFFSET_Y-10*DScreen.RATIO,VCENTER|HCENTER)}else{if((s_game_currentFrameNB%10)>5){e.DrawMultiLineText(g,Text_GetString(TEXT.MENU_PRESS_ANY_KEY_TOUCH),GLLibConfig.screenWidth/2,GLLibConfig.screenHeight+DGUI.MENU_OFFSET_Y-5*DScreen.RATIO,BOTTOM|HCENTER,0,GLLibConfig.screenWidth,0,10,5)}}var dg=(56+e.loadingPhase*17)*DScreen.RATIO;var dl=37*DScreen.RATIO;g.setClip(dg,DEF.VIEW_H-dl+DGUI.MENU_OFFSET_Y,DEF.VIEW_W-dg,dl);aH.PaintAFrame(g,1,0,DEF.SCR_W_D2-DGUI.SPLASH_OFFSET_X,DEF.SCR_H_D2+DGUI.MENU_OFFSET_Y,0);g.setClip(0,DGUI.MENU_OFFSET_Y,DEF.SCR_W,DEF.SCR_H+DGUI.MENU_OFFSET_Y);var c5=e._loadingSpriteMap[e._worldId<<1];var c9=e._loadingSpriteMap[(e._worldId<<1)+1];if(dc==0){}if(e._tempLevelId<DAI.LEVEL_ID_INTRO_NEW_GAME&&e.loadingPhase!=DLoadState.LOAD_OVER){if(e._gameProgress>bb){e.spriteArray[c5].PaintAFrame(g,c9,s_game_currentFrameNB%e.spriteArray[c5].GetAFrames(c9),dg,DEF.VIEW_H+DGUI.MENU_OFFSET_Y-DGUI.INTERFACE_STAR_BOTTOM_OFFSET_Y_LOADING+72*DScreen.RATIO,0)}}};e.DrawSpecialEffect_Load_Unload_MiniMap=function(c5){FillRect(0,0,GLLibConfig.screenWidth,GLLibConfig.screenHeightActual);if(aH==null){if(DEF.dbgEnable){Dbg("---------------------- splash..reload")}Pack_Open(DATA.PACK_SPLASH);aH=e.LoadSprite(DATA.SPLASH_SPLASH,-1,true,false);Pack_Close()}aH.PaintAFrame(g,1,0,DEF.SCR_W_D2-DGUI.SPLASH_OFFSET_X,DEF.SCR_H_D2+DGUI.MENU_OFFSET_Y,0);if(c5!=e.MINI_MAP_LOADING_STEP){e.txtDraw(0,Text_GetString(TEXT.MENU_LOADING)+"...",GLLibConfig.screenWidth/2,GLLibConfig.screenHeight+DGUI.MENU_OFFSET_Y-10*DScreen.RATIO,VCENTER|HCENTER)}else{if((s_game_currentFrameNB%10)>5){e.DrawMultiLineText(g,Text_GetString(TEXT.MENU_PRESS_ANY_KEY_TOUCH),GLLibConfig.screenWidth/2,GLLibConfig.screenHeight+DGUI.MENU_OFFSET_Y-10*DScreen.RATIO,BOTTOM|HCENTER,0,GLLibConfig.screenWidth,0,10,5)}}var c3=(56+c5*17)*DScreen.RATIO;var c4=37*DScreen.RATIO;g.setClip(c3,DEF.VIEW_H-c4+DGUI.MENU_OFFSET_Y,DEF.VIEW_W-c3,c4);aH.PaintAFrame(g,1,0,DEF.SCR_W_D2-DGUI.SPLASH_OFFSET_X,DEF.SCR_H_D2+DGUI.MENU_OFFSET_Y,0);g.setClip(0,DGUI.MENU_OFFSET_Y,DEF.SCR_W,DEF.SCR_H+DGUI.MENU_OFFSET_Y)};var bJ=0;e.levelStart="";e.prototype.UpdateGameState_LOAD_UNLOAD=function(){if(e.loadingPhase==0){e._sprites_load_mask=(1<<DSpriteID.BONUS)|(1<<DSpriteID.MAP_ACTOR);e._sprites_load_mask|=(1<<e._loadingSpriteMap[e._worldId<<1]);bJ=e._sprites_load_mask;e.LoadUnload(DLoadState.LOAD_SPRITE)}e.loadingPhase=e.LoadUnload(e.loadingPhase);if(e.loadingPhase>0){try{this.DrawSpecialEffect_Load_Unload(e._worldId)}catch(c6){if(DEF.dbgEnable){Dbg(" DrawSpecialEffect_Load_Unload  error : "+c6.message)}}}if(e.loadingPhase==DLoadState.LOAD_OVER){if(WasAnyKeyReleased()==GLKey.k_fire){if(bo){a9=STATE.SELECT_LANGUAGE_INIT}else{e.GotoInitLevel(false);var c4=e.MiniMapGetLevelByPoint(e._miniMapCursorAtPoint);if(c4>=0){var c3=Text_GetString(this.GetLevelMenuTextByLevelId(c4));c3=c3.substring(c3.length-3,c3.length);e.levelStart=c3;GGTracking.getInstance().push(POINTCUTID.LEVELSTART,c3,e._levelTotalScore[e._tempLevelId])}for(var c5=0;c5<64;c5++){if((bJ&(1<<c5))!=0){if((e._sprites_load_mask&(1<<c5))==0){if(DEF.dbgEnable){Dbg("spriteUnLoad : *******************  DLoadState.LOAD_OVER")}e.spriteUnLoad(c5)}}}bJ=0}if(Build.useCGMRC){e.s_next_state=a9;a9=STATE.K_MRC_INIT}e.redrawAll=true}e.loadingPhase--}else{if(e.loadingPhase==DLoadState.UNLOAD_OVER){if(e.s_next_game_state_after_unload!=-1){a9=e.s_next_game_state_after_unload;if(a9==STATE.MENU_MAP){a9=STATE.CONTINUE_GAME}e.s_next_game_state_after_unload=-1}else{a9=STATE.QUIT}}}};var ab=0;var b6=0;var H=false;var cJ=false;e.prototype.UpdateGameState_GAMEOVER=function(){if(e.redrawAll){if(e.bIsPaused){if(e.bIsMiniMap){this.DrawMiniMap()}else{this.gameDraw()}}}var c4=false;if(b6>=DEF.VIEW_H_D2){b6=DEF.VIEW_H_D2;c4=true}if(!c4){ab+=Math.floor(DGUI.SCREEN_CLOSED_STEP);b6=ab;e._lastFrameNB=s_game_currentFrameNB}if(ab>=DEF.VIEW_H_D2){ab=DEF.VIEW_H_D2}g.setColor(0);g.setClip(0,0,DEF.VIEW_W,b6);FillRect(0,0,GLLibConfig.screenWidth,GLLibConfig.screenHeight);g.setClip(0,DEF.VIEW_H-ab,DEF.VIEW_W,b6);FillRect(0,0,GLLibConfig.screenWidth,GLLibConfig.screenHeight);if(c4){if(e.ads_show){e.ads_show=false;e.showFullScreenAds();if(CEntity._HeroParams[DAI.HPI_LIVES]<=0){GGTracking.getInstance().push(POINTCUTID.LEVELPAIL,e.levelStart)}}else{if(CEntity._HeroParams[DAI.HPI_LIVES]<=0){g.setClip(0,0,GLLibConfig.screenWidth,GLLibConfig.screenHeightActual);FillRect(0,0,GLLibConfig.screenWidth,GLLibConfig.screenHeightActual);if(CEntity._HeroParams[DAI.HPI_LIVES]<=0){e.txtDraw(0,Text_GetString(TEXT.MENU_GAME_OVER),GLLibConfig.screenWidth/2,30*DScreen.RATIO+DGUI.MENU_OFFSET_Y,BOTTOM|HCENTER)}e.DrawAnimation(DSpriteID.HERO,DAnimID.HERO_GAME_OVER,DEF.VIEW_W_D2,100*DScreen.RATIO+DGUI.MENU_OFFSET_Y,4);this.DrawgameOverChoice()}else{var c3=10;if(s_game_currentFrameNB-e._lastFrameNB>=c3){e.GotoRestart(true);H=true;ab=DEF.VIEW_H_D2;b6=DEF.VIEW_H_D2}}}}};e.prototype.UpdateGameState_GAMEEND=function(){var c3=false;if(b6>=DEF.VIEW_H_D2){b6=DEF.VIEW_H_D2;c3=true}if(!c3){ab+=14;b6=ab;e._lastFrameNB=s_game_currentFrameNB}g.setColor(0);g.setClip(0,0,DEF.VIEW_W,b6);FillRect(0,0,GLLibConfig.screenWidth,GLLibConfig.screenHeight);g.setClip(0,DEF.VIEW_H-ab,DEF.VIEW_W,b6);FillRect(0,0,GLLibConfig.screenWidth,GLLibConfig.screenHeight);if(c3){g.setClip(0,0,GLLibConfig.screenWidth,GLLibConfig.screenHeightActual);FillRect(0,0,GLLibConfig.screenWidth,GLLibConfig.screenHeightActual);e.txtDraw(0,Text_GetString(TEXT.MENU_THE_END),DEF.SCR_W_D2,DEF.SCR_H_D2+DGUI.MENU_OFFSET_Y,VCENTER|HCENTER);if((s_game_currentFrameNB%10)>5){e.DrawMultiLineText(g,Text_GetString(TEXT.MENU_PRESS_ANY_KEY_TOUCH),GLLibConfig.screenWidth/2,GLLibConfig.screenHeight+DGUI.MENU_OFFSET_Y-DGUI.PRESS_5_OFFSET_POSY,BOTTOM|HCENTER,0,GLLibConfig.screenWidth,0,10,5)}bG=WasAnyKeyReleased();if(bG>=0){if(e._multiLineTextCurrentCursor>=0){e._multiLineTextCurrentCursor=-1}if(((bG==GLKey.k_menuOK)||(bG==GLKey.k_fire))&&bR<f.MAX_DEPTH){a9=STATE.LOAD_UNLOAD;e.loadingPhase=-DLoadState.LOAD_OVER;e.initMenus();e.s_next_game_state_after_unload=STATE.MENU_ABOUT;y[++bR]=bE;cJ=true;ab=0;b6=0}e.redrawAll=true;ResetKey()}}};var bC=0;e.prototype.DrawgameOverChoice=function(){if(e.s_isShowAd){return}var da=2;var c7=GLLibConfig.screenWidth/2;var c6=[200*DScreen.RATIO+DGUI.MENU_OFFSET_Y,230*DScreen.RATIO+DGUI.MENU_OFFSET_Y];var c3=null;g.setClip(0,DGUI.MENU_OFFSET_Y,DEF.VIEW_W,DEF.VIEW_H+DGUI.MENU_OFFSET_Y);e.txtDraw(da,Text_GetString(TEXT.MENU_RESTART_REQUIRE),c7,160*DScreen.RATIO+DGUI.MENU_OFFSET_Y,TOP|HCENTER);for(var c8=0;c8<2;c8++){if(e.isPointInRect(cj,c6[c8]-(W>>1)+5,GetScreenWidth()-(cj<<1),W)){if(bC==c8){this.keyPressed(GLLibConfig.keycodeFire);this.keyReleased(GLLibConfig.keycodeFire);e.UpdateKeyState()}else{bC=c8}}if(bC==c8){c3=this.txtDrawSpecialEffectWave(bC==c8?ct:bX,Text_GetString(TEXT.MENU_SK_YES+c8),c7,c6[c8],LEFT)}else{e.txtDraw(da,Text_GetString(TEXT.MENU_SK_YES+c8),c7,c6[c8],TOP|HCENTER)}}var c5=c3[0]-15*DScreen.RATIO;var c4=c3[1]+15*DScreen.RATIO;var dc=c6[bC]+5;e._interface.PaintAFrame(g,DAnimID.INTERFACE_MENU_CURSOR,s_game_currentFrameNB%e._interface.GetAFrames(DAnimID.INTERFACE_MENU_CURSOR),c5,dc,0);e._interface.PaintAFrame(g,DAnimID.INTERFACE_MENU_CURSOR,s_game_currentFrameNB%e._interface.GetAFrames(DAnimID.INTERFACE_MENU_CURSOR),c4,dc,0);bG=WasAnyKeyReleased();if(bG>=0){if(((bG==GLKey.k_menuOK)||(bG==GLKey.k_fire))&&bR<f.MAX_DEPTH){if(typeof gdsdk!=="undefined"&&gdsdk.showAd!=="undefined"){e.bIsPaused=!false;e.PauseSoundBGM();var c9=this;window.addEventListener("SDK_GAME_START",function(dd){if(e.s_showAdPlace!=2||c9==null){return}e.bIsPaused=false;e.s_isShowAd=false;e.s_showAdPlace=-1;try{e.RMS_Load()}catch(de){if(DEF.dbgEnable){Dbg("-------------------- error : "+de.message)}}if(bC==1){c9.GotoMainMenu()}else{if(e._playerInfo[DAI.HPI_LIVES]<3){e._playerInfo[DAI.HPI_LIVES]=3}a9=STATE.LOAD_UNLOAD;e.loadingPhase=-DLoadState.LOAD_OVER;e.s_next_game_state_after_unload=STATE.MENU_MAP;e.bIsPaused=false}cJ=true;ab=0;b6=0});e.s_isShowAd=!false;e.s_showAdPlace=2;console.log("azerion 2");gdsdk.showAd()}else{try{e.RMS_Load()}catch(db){if(DEF.dbgEnable){Dbg("-------------------- error : "+db.message)}}if(bC==1){this.GotoMainMenu()}else{if(e._playerInfo[DAI.HPI_LIVES]<3){e._playerInfo[DAI.HPI_LIVES]=3}a9=STATE.LOAD_UNLOAD;e.loadingPhase=-DLoadState.LOAD_OVER;e.s_next_game_state_after_unload=STATE.MENU_MAP;e.bIsPaused=false}cJ=true;ab=0;b6=0}}if(bG==GLKey.k_up){bC=(++bC)%2}else{if(bG==GLKey.k_down){bC=(++bC)%2}}e.redrawAll=true;ResetKey()}};e.drawTheCurtainOpen=function(){ab-=18;b6=ab;if(b6<=0){ab=0;b6=0;H=false}g.setColor(0);g.setClip(0,0,DEF.VIEW_W,b6);FillRect(0,0,GLLibConfig.screenWidth,GLLibConfig.screenHeight);g.setClip(0,DEF.VIEW_H-ab,DEF.VIEW_W,b6);FillRect(0,0,GLLibConfig.screenWidth,GLLibConfig.screenHeight)};var k=false;var r=false;var bm=0;var co=0;var s=1;var cX=2;e.prototype.UpdateGameState_GAME_STATISTIC=function(){if(e.s_isShowAd){return}this.gameDraw();var c5=GLLibConfig.screenWidth;var dd=GLLibConfig.screenHeight;var c4=DGUI.GAME_STATISTIC_STARTX,c3=DGUI.GAME_STATISTIC_STARTY;e.FillArgbRect(0,0,c5,dd,1744830464|aC);var dc=LowAPI.Gen_Array([3],0);var c7=1;var c6=4;var da=1;var c9=120;switch(bm){case co:b9.SetCurrentPalette(1);e._stopMove=true;k=false;r=false;var c8=DEF.VIEW_W;this.txtDarwSpecialEffecFlowIntoTheScreen(Text_GetString(TEXT.MENU_LEVEL_COMPLETE),b9,c5>>1,c3,aO,c8,c9,LEFT);if(e._stopAdd){bm++;e._stopMove=false;e._moveSpeed=0;e._firstEnterIntoThisFunction=true}break;case s:this.txtDrawSpecialEffectWave_New(1,Text_GetString(TEXT.MENU_LEVEL_COMPLETE),c5>>1,c3,c6,da,LEFT);var db=this.DrawAllTheItemsResults(c4,c3,c5,dc,c7);if(db){e._moveSpeed=0;e._stopMove=false;bm++}break;case cX:this.txtDrawSpecialEffectWave_New(1,Text_GetString(TEXT.MENU_LEVEL_COMPLETE),c5>>1,c3,c6,da,LEFT);this.DrawAllTheItemsResults(c4,c3,c5,dc,c7);this.DrawTheTotalSums(c4,c3+130*DScreen.RATIO,c5,dc,c7);break;default:}if(L){if((s_game_currentFrameNB%10)>5){e.DrawMultiLineText(g,Text_GetString(TEXT.MENU_PRESS_ANY_KEY_TOUCH),GLLibConfig.screenWidth/2,GLLibConfig.screenHeight-DGUI.PRESS_5_OFFSET_POSY,BOTTOM|HCENTER,0,GLLibConfig.screenWidth,0,10,5)}}if(WasKeyReleased(GLKey.k_fire)){if(!L){bm=cX;e._moveSpeed=0;e._stopMove=true}else{if(typeof gdsdk!=="undefined"&&gdsdk.showAd!=="undefined"){e.bIsPaused=!false;e.PauseSoundBGM();window.addEventListener("SDK_GAME_START",function(de){if(e.s_showAdPlace!=3){return}e.bIsPaused=false;e.s_isShowAd=false;e.s_showAdPlace=-1;e._moveSpeed=0;e._stopMove=false;k=false;bm=0;L=false;e._playerInfo[DAI.HPI_LIVES]=CEntity._HeroParams[DAI.HPI_LIVES];e._playerInfo[DAI.HPI_HP_MAX]=CEntity._hero._hp;e.GotoNextLevel(true);e._firstEnterIntoThisFunction=true;e._actionSpeed=0});e.s_isShowAd=!false;e.s_showAdPlace=3;console.log("azerion 3");gdsdk.showAd()}else{e._moveSpeed=0;e._stopMove=false;k=false;bm=0;L=false;e._playerInfo[DAI.HPI_LIVES]=CEntity._HeroParams[DAI.HPI_LIVES];e._playerInfo[DAI.HPI_HP_MAX]=CEntity._hero._hp;e.GotoNextLevel(true);e._firstEnterIntoThisFunction=true;e._actionSpeed=0}}}if(!e._stopMove){e._moveSpeed+=15}};var b=[30*DScreen.RATIO,73*DScreen.RATIO,83*DScreen.RATIO,138*DScreen.RATIO,148*DScreen.RATIO,218*DScreen.RATIO];e.prototype.DrawAllTheItemsResults=function(c4,c3,c5,df,c6){var de=0;var dc=c3;var dd=[DAnimID.BONUS_CRYSTAL,DAnimID.BONUS_1UP,DAnimID.BONUS_STAR];var c7=[CEntity._HeroParams[DAI.HPI_CRYSTAL_COUNT],CEntity._HeroParams[DAI.HPI_LIVES],(DAI.MAX_STAR_NUM-e._levelStarInfo[e._tempLevelId*DAI.STAR_INFO_SIZE])];var db=[1,100,200];c3+=20*DScreen.RATIO;var da=[DEF.VIEW_W,DEF.VIEW_W+50,DEF.VIEW_W+50*2,DEF.VIEW_W+50*3,DEF.VIEW_W+50*4,DEF.VIEW_W+50*5];var c8=LowAPI.Gen_Array([b.length],0);for(var c9=0;c9<b.length;c9++){c8[c9]=b[c9]}for(var c9=0;c9<3;c9++){dc=c3+40*(c9+1)*DScreen.RATIO;if(bm==s){de=da[c9]-e._moveSpeed;if(de<=c8[0]){de=c8[0];if(c9==2){e._stopMove=true}}}else{de=c8[0]}e.spriteArray[DSpriteID.BONUS].PaintAFrame(g,dd[c9],s_game_currentFrameNB%e.spriteArray[DSpriteID.BONUS].GetAFrames(dd[c9]),de,dc,0);if(bm==s){de=da[c9]-e._moveSpeed;if(de<=c8[1]){de=c8[1]}}else{de=c8[1]}dc-=15*DScreen.RATIO;e.txtDraw(c6,String(c7[c9]),de,dc,TOP|RIGHT);if(bm==s){de=da[c9]-e._moveSpeed;if(de<=c8[2]){de=c8[2]}}else{de=c8[2]}e.txtDraw(c6,"X",de,dc,TOP|LEFT);if(bm==s){de=da[c9]-e._moveSpeed;if(de<=c8[3]){de=c8[3]}}else{de=c8[3]}e.txtDraw(c6,String(db[c9]),de,dc,TOP|RIGHT);if(bm==s){de=da[c9]-e._moveSpeed;if(de<=c8[4]){de=c8[4]}}else{de=c8[4]}e.txtDraw(c6,"=",de,dc,TOP|LEFT);if(bm==s){de=da[c9]-e._moveSpeed;if(de<=c8[5]){de=c8[5]}}else{de=c8[5]}df[c9]=c7[c9]*db[c9];e.txtDraw(c6,String(df[c9]),de,dc,TOP|RIGHT)}return e._stopMove};var L=false;e.prototype.DrawTheTotalSums=function(c6,c3,c7,dd,c8){var c5=[DEF.VIEW_H,DEF.VIEW_H+30,DEF.VIEW_H+30+30,DEF.VIEW_H+30+30+30];var c9;var dc=c6;var db=c3;db+=30*DScreen.RATIO;g.setColor(16744448);c9=c5[0]-e._moveSpeed;if(c9<=db||e._stopMove){c9=db}g.drawLine(dc,c9,c7-(c6),c9);db+=2;c9=c5[0]-e._moveSpeed+10;if(c9<=db||e._stopMove){c9=db}g.drawLine(dc,c9,c7-(c6),c9);db+=1;c9=c5[0]-e._moveSpeed+20;if(c9<=db||e._stopMove){c9=db}g.drawLine(dc,c9,c7-(c6),c9);dc=b[3];db+=8*DScreen.RATIO;c9=c5[1]-e._moveSpeed;if(c9<=db||e._stopMove){c9=db}e.txtDraw(c8,Text_GetString(TEXT.MENU_TOTAL),dc,c9,TOP|RIGHT);dc=DGUI.GAME_STATISTIC_TOTAL_NUM_OFFSETX;c9=c5[2]-e._moveSpeed;if(c9<=db||e._stopMove){c9=db}e.txtDraw(c8,"=",dc,c9,TOP|LEFT);var da=dd[0]+dd[1]+dd[2];if(da>e._levelTotalScore[e._tempLevelId]){k=true;e._levelTotalScore[e._tempLevelId]=da}if(!r){r=true;var c4=e.MiniMapGetLevelByPoint(e._miniMapCursorAtPoint);var de=Text_GetString(this.GetLevelMenuTextByLevelId(c4));de=de.substring(de.length-3,de.length);GGTracking.getInstance().push(POINTCUTID.LEVELCOMPLETION,de,da);e.RMS_Save()}c9=c5[3]-e._moveSpeed;if(c9<=db||e._stopMove){c9=db;L=true}dc=c7-(c6<<1)+18*DScreen.RATIO;e.txtDraw(c8,String(da),dc,c9,TOP|RIGHT);if(k){c8=3;e.txtDraw(c8,Text_GetString(TEXT.MENU_NEW_RECORD),dc,c9+24*DScreen.RATIO,TOP|RIGHT)}};e.prototype.UpdateGameState_MENU_INIT=function(){e.initMenus();Text_LoadTextFromPack_INI(aX,DATA.TEXT_MENU);if(e.bIsPaused){y[bR]=bi;a9=STATE.MENU_INGAME}else{a9=STATE.MENU_MAIN}e.redrawAll=true};e.prototype.UpdateGameState_ASK_SOUND=function(){if(e._isInputEvent){e._isInputEvent=false;var c3=this._FakegetMousePos(e._eventCallback);a6=c3.x;a4=c3.y}switch(this.updateMenu()){case STATE.YES:bs=0;if(!e.isSoundEnabled){if(cK){GLLibPlayer.Snd_SetMasterVolume(aP)}this.startSound()}if(e.bSetSound){a9=STATE.SPLASH}else{bR-=1;a9=z[y[bR]][f.STATE]}e.bSetSound=false;e.RMS_Save();break;case STATE.NO:bs=1;if(e.isSoundEnabled){this.StopSound()}if(e.bSetSound){a9=STATE.SPLASH}else{bR-=1;a9=z[y[bR]][f.STATE]}e.bSetSound=false;e.RMS_Save();break}};e.prototype.UpdateGameState_ASK_SOUND_LEVEL=function(){R=80;bK=-20;switch(this.updateMenu()){case STATE.YES:this.startSound();bR-=2;a9=z[y[bR]][f.STATE];e.RMS_Save();break;case STATE.NO:if(e.isSoundEnabled){this.StopSound();e.isSoundEnabled=false}bR-=2;a9=z[y[bR]][f.STATE];e.RMS_Save();break;case STATE.SOUND_HIGH:if(GLLibPlayer.s_snd_masterVolume!=aP||!e.isSoundEnabled){GLLibPlayer.Snd_SetMasterVolume(aP);this.StopSound();this.startSound()}bR-=2;a9=z[y[bR]][f.STATE];e.RMS_Save();break;case STATE.SOUND_MEDIUM:if(GLLibPlayer.s_snd_masterVolume!=bT||!e.isSoundEnabled){GLLibPlayer.Snd_SetMasterVolume(bT);this.StopSound();this.startSound()}bR-=2;a9=z[y[bR]][f.STATE];e.RMS_Save();break;case STATE.SOUND_LOW:if(GLLibPlayer.s_snd_masterVolume!=by||!e.isSoundEnabled){GLLibPlayer.Snd_SetMasterVolume(by);this.StopSound();this.startSound()}bR-=2;a9=z[y[bR]][f.STATE];e.RMS_Save();break;case STATE.SOUND_OFF:if(e.isSoundEnabled){this.StopSound();e.isSoundEnabled=false}bR-=2;a9=z[y[bR]][f.STATE];e.RMS_Save();break}};e.prototype.UpdateGameState_MENU_EXIT=function(){switch(this.updateMenu()){case STATE.YES:a9=STATE.QUIT;break;case STATE.NO:bR-=2;a9=z[y[bR]][f.STATE];break}};var bP=0;var cu=[0,0,0];var b4=0;e.prototype.UpdateGameState_MENU_HELP=function(){if(!at){g.setColor(0);g.setClip(0,0,GLLibConfig.screenWidth,GLLibConfig.screenHeightActual);g.fillRect(0,0,GLLibConfig.screenWidth,GLLibConfig.screenHeightActual);aH.PaintAFrame(g,1,0,DEF.SCR_W_D2-DGUI.SPLASH_OFFSET_X,DEF.SCR_H_D2+DGUI.MENU_OFFSET_Y,0)}else{var dc=GLLibConfig.screenWidth/2;var df=GLLibConfig.screenHeightActual/2;var c4=0;var c5=0;var c9=0;var dq=LowAPI.Gen_Array([4],0);var dd,dn;J.GetAFrameRect(dq,DAnimID.MENU_INGAME_INGAMEMENU,0,0,0,0);dd=dq[DEF.BOX_RIGHT]-dq[DEF.BOX_LEFT];dn=dq[DEF.BOX_BOTTOM]-dq[DEF.BOX_TOP];var c7=dc-(dd>>1);var c6=df-(dn>>1);c4=dn-DGUI.INGAMEMENU_BACKGROUND_WH;c5=c6+DGUI.INGAMEMENU_BACKGROUND_XY;if(e.bIsMiniMap){this.DrawMiniMap()}else{this.gameDraw()}g.setClip(0,0,GLLibConfig.screenWidth,GLLibConfig.screenHeightActual);g.setColor(0);g.fillRect(c7,c6+DGUI.INGAMEMENU_BACKGROUND_XY-13,DEF.VIEW_W,dn-DGUI.BACKGROUND_OFFSET_H);J.PaintAFrame(g,DAnimID.MENU_INGAME_INGAMEMENU,0,c7-dq[DEF.BOX_LEFT],c6-dq[DEF.BOX_TOP],0)}var dl=z[y[bR]][f.TITLE_AS_PARENT];var dp=0;var dc=GLLibConfig.screenWidth/2;R=80*DScreen.RATIO;e.txtSetFont(cL);b9.SetCurrentPalette(0);if(dl>0||at){e.txtDraw(0,Text_GetString(dl),dc,(e.bIsPaused?ci-DGUI.HELP_TITLE_OFFSET_Y:aL-R),TOP|HCENTER);dp+=0}else{if(e.bIsPaused){dp-=20*DScreen.RATIO}}this.setSoftKeys(z[y[bR]][f.LSK_TEXT],z[y[bR]][f.RSK_TEXT]);this.drawSoftKeys();var dj=1;var c3=DEF.VIEW_W-130;var di=0;var dh=20;var c8=5;var db=dc;var da=100;var dg="";var dm;if(bP<2){dm=Text_GetString(TEXT.MENU_HELP_CONTROL_TOUCH+bP)}else{dm=Text_GetString(TEXT.MENU_HELP_CONTROL+1)}switch(bP){case 0:case 1:dj=1;c3=DEF.VIEW_W-40;db=dc;da=DGUI.HELP_POSY;break;case 2:dj=4;c8=15;c3=DEF.VIEW_W-40;db=dc+20*DScreen.RATIO;da=DGUI.HELP_POSY;break}for(var dk=0;dk<dm.length;dk++){if(dm.charAt(dk)=="^"){dg=dg+"\n"}else{dg=dg+dm.charAt(dk)}}dm=dg;e.txtSetFont(aS);b4=DGUI._ICONINHELP_POSX;e.DrawMultiLineText(g,dm,db,da,dj,2,c3,di,dh,c8);if(e.spriteArray[DSpriteID.BONUS]==null){Pack_Open(DATA.PACK_SPRITE);e.spriteLoad(DSpriteID.BONUS,DATA.SPRITE_BONUS,true,true);Pack_Close()}if(bP==2){e.spriteArray[DSpriteID.BONUS].PaintAFrame(g,DAnimID.BONUS_CRYSTAL,s_game_currentFrameNB%e.spriteArray[DSpriteID.BONUS].GetAFrames(DAnimID.BONUS_CRYSTAL),b4,cu[0]+DGUI.ICON_OFFSETY1,0);e.spriteArray[DSpriteID.BONUS].PaintAFrame(g,DAnimID.BONUS_CRYSTAL_FLOWER,s_game_currentFrameNB%e.spriteArray[DSpriteID.BONUS].GetAFrames(DAnimID.BONUS_CRYSTAL_FLOWER),b4,cu[1]+DGUI.ICON_OFFSETY2,0);e.spriteArray[DSpriteID.BONUS].PaintAFrame(g,DAnimID.BONUS_1UP,s_game_currentFrameNB%e.spriteArray[DSpriteID.BONUS].GetAFrames(DAnimID.BONUS_1UP),b4,cu[2]+DGUI.ICON_OFFSETY2,8)}var de=WasAnyKeyReleased();if(de>=0){switch(de){case GLKey.k_menuBack:if(bR>0&&z[y[bR]][f.RSK_TEXT]!=-1){bR--;a9=z[y[bR]][f.STATE];e.txtSetFont(cL);bP=0;e.PlaySound(DSound_Channel.SFX,DATA.SOUND_MENU_CONFIRM)}break;case GLKey.k_menuOK:bP=(++bP)%3;e.PlaySound(DSound_Channel.SFX,DATA.SOUND_MENU_CONFIRM);break}if(e.isAnyPointPressed()){e.UpdateKeyState();ResetKey()}}};var bt=0;var bQ=0;var bx;e.prototype.UpdateGameState_MENU_ABOUT=function(){g.setColor(0);g.setClip(0,0,GLLibConfig.screenWidth,GLLibConfig.screenHeightActual);g.fillRect(0,0,GLLibConfig.screenWidth,GLLibConfig.screenHeightActual);aH.PaintAFrame(g,1,0,DEF.SCR_W_D2-DGUI.SPLASH_OFFSET_X,DEF.SCR_H_D2+DGUI.MENU_OFFSET_Y,0);var c8=z[y[bR]][f.TITLE_AS_PARENT];var c4=0;var c5=GLLibConfig.screenWidth/2;if(c8>0&&!e.bIsPaused){e.txtSetFont(cL);b9.SetCurrentPalette(0);e.txtDraw(0,Text_GetString(c8),c5,(e.bIsPaused?ci:aL-R),TOP|HCENTER);c4+=30}else{if(e.bIsPaused){c4-=20}}this.setSoftKeys(z[y[bR]][f.LSK_TEXT],z[y[bR]][f.RSK_TEXT]);this.drawSoftKeys();var c7=DEF.VIEW_W-0;var c3=c5;g.setClip(0,(e.bIsPaused?ci:aL-R)+25*DScreen.RATIO,DEF.VIEW_W,DEF.VIEW_H+DGUI.MENU_OFFSET_Y-(e.bIsPaused?ci:aL-R)-45*DScreen.RATIO);if(bx==null){var db=Text_GetString(TEXT.MENU_ABOUT_1);var c9;if((c9=db.indexOf("X.X.X"))>=0){db=db.substring(0,c9)+GloftCAOF._midletInstance.getAppProperty("MIDlet-Version")+db.substring(c9+5)}bx=db}if(bx.indexOf("^")>-1){bx=bx.replace("^","\n")}e.txtSetFont(aS);var dc=5;var dd=(DEF.VIEW_H+DGUI.MENU_OFFSET_Y-(e.bIsPaused?ci:aL-R)-40);dd+=(dc+aS.GetLineHeight())*2;var df=dd/(dc+aS.GetLineHeight());var de=Math_FixedPointToInt(bt);var da=e.DrawMultiLineText(g,bx,c3,DEF.VIEW_H+DGUI.MENU_OFFSET_Y-de,GRPH.HCENTER,2,c7,bQ,df,dc);if(da&&bt>Math_IntToFixedPoint(dd)*2){bt=0;bQ=0;de=0}bt+=Math_IntToFixedPoint(DGUI.INTERFACE_ROLL_SPEED)*e._frameDT_Real/DEF.VELOCITY_FRAME_TICK;if(!da){if(bt>Math_IntToFixedPoint(dd)){bQ++;bt-=Math_IntToFixedPoint(dc+aS.GetLineHeight())}}var c6=WasAnyKeyReleased();if(c6>=0){switch(c6){case GLKey.k_menuBack:if(bR>0&&z[y[bR]][f.RSK_TEXT]!=-1){bx=null;bR--;a9=z[y[bR]][f.STATE];e.txtSetFont(cL);bt=0;bQ=0;e.PlaySoundBGM()}break;case GLKey.k_menuOK:break}}g.setClip(0,0,DEF.VIEW_W,DEF.VIEW_H)};e.prototype.UpdateGameState_IGP=function(){if(!D){if(DEF.dbgEnable){Dbg("-------------------------- launch IGP ...")}var c3="";if(window.getReferrer){console.log(window.getReferrer());window.open(window.getReferrer(),"_self")}D=true}};e.prototype.UpdateGameState_END_GAME_IGP=function(){g.setColor(0);g.fillRect(0,0,GLLibConfig.screenWidth,GLLibConfig.screenHeight);var c3=15;e.DrawMultiLineText(g,Text_GetString(TEXT.MENU_LIKEGAME),GLLibConfig.screenWidth/2,GLLibConfig.screenHeight/3,TOP|HCENTER,1,GLLibConfig.screenWidth,0,10,c3);this.setSoftKeys(TEXT.MENU_SK_YES,bL);this.drawSoftKeys();var c4=WasAnyKeyReleased();if(c4>=0){switch(c4){case GLKey.k_menuOK:a9=STATE.IGP;break}}};e.prototype.UpdateGameState_MENU_GET_MORE_GAMES_INIT=function(){a9=STATE.IGP};e.prototype.UpdateGameState_MENU_MAIN=function(){if(System.currentTimeMillis()-lastAudioSeen>1500&&lastAudioSeen>0&&!e._isInputEvent){lastAudioSeen=-1;GLLibPlayer.Snd_PauseNotify();if(!GLLibPlayer.Snd_IsPlaying(DSound_Channel.BGM)){e.PlaySoundBGM()}}e._miniMapCursorAtPoint=-1;aj=2;if(DEF.dbgEnableCheat){if((this.useCheatCode()==a9)||DEF.dbgUnlockLevel||DEF.dbgUnlockLevelButCastle){var c3=e._levelInfo.length;if(DEF.dbgUnlockLevelButCastle){c3=DAI.LEVEL_ID_CASTLE}for(var c4=0;c4<c3;c4++){e._levelInfo[c4]=1}}}switch(this.updateMenu()){case STATE.MENU_GET_MORE_GAMES:a9=STATE.MENU_GET_MORE_GAMES_INIT;break}};e.prototype.UpdateGameState_MENU_INGAME_MAIN_MENU=function(){switch(this.updateMenu()){case STATE.YES:e.RMS_Load();this.GotoMainMenu();break;case STATE.NO:bR-=2;a9=z[y[bR]][f.STATE];break}};e.prototype.UpdateGameState_BACK_TO_MINIMAP=function(){switch(this.updateMenu()){case STATE.YES:e.RMS_Load();e.bIsPaused=false;a9=STATE.LOAD_UNLOAD;e.loadingPhase=-DLoadState.LOAD_OVER;e.s_next_game_state_after_unload=STATE.MENU_MAP;break;case STATE.NO:bR-=2;a9=z[y[bR]][f.STATE];break}};e.GotoRestart=function(c9){e.bIsPaused=false;try{e.LoadUnload(DLoadState.UNLOAD_SEGMENT);e.LoadUnload(DLoadState.UNLOAD_ENTITY)}catch(c6){if(DEF.dbgEnable){Dbg("GotoRestart LoadUnload----------------------- error : "+c6.message)}}e.ReleaseLevel(c9);try{e.InitLevel();Pack_Open("/"+((DATA.PACK_LEVEL01_1.charAt(1)-"0")+e._tempLevelId));var c7=GLLibConfig.tileset_maxLayerCount-1;GLLibPlayer.Tileset_Destroy(c7);var da;var c4=null;var c5=null;var c8=e.level2Tiled(e._tempLevelId,c7);var c3=DATA.LEVEL01_1_TOP_SIZE;da=Pack_ReadData(c3++);c4=Pack_ReadData(c3++);c5=Pack_ReadData(c3++);GLLibPlayer.Tileset_LoadLayer(c7,da,c4,c5,e.spriteArray[c8+DSpriteID.TILESET_BASE],false,TOP,GLLibPlayer.WRAP_CLAMP,GLLibPlayer.WRAP_CLAMP);GLLibPlayer.Tileset_SetCamera(c7,0,0);e._topLayerData=c4;e._topLayerFlip=c5;e.LoadUnload(DLoadState.LOAD_ENTITY);e.LoadUnload(DLoadState.LOAD_SEGMENT);Pack_Close()}catch(c6){if(DEF.dbgEnable){Dbg("GotoRestart ----------------------- error : "+c6.message)}}e.GotoInitLevel(c9)};e.GotoInitLevel=function(c3){e.LoadCheckPoint();CEntity.CheckActive();CEntity.UpdateAll(-1);if(c3){CEntity._hero._hp=CEntity._heroHpBeforeDie}else{CEntity._hero._hp=e._playerInfo[DAI.HPI_HP_MAX];CEntity._HeroParams[DAI.HPI_LIVES]=e._playerInfo[DAI.HPI_LIVES];e.RMS_Load()}CEntity._HeroParams[DAI.HPI_CRYSTAL_COUNT]=CEntity._hero._hp;e.redrawAll=true;a9=STATE.GAMEPLAY_UPDATE;if(aH!=null){if(DEF.dbgEnable){Dbg("spriteUnLoad : ******************* -----_splash")}aH.FreeCacheData();aH.FreeCachedFrames();aH.FreeCachedModules();aH=null}cV=null;bV=null;e.PlaySoundBGM()};e.needTrans=false;e.GotoNextLevel=function(c4){e.bIsPaused=false;e._checkPointData=null;a9=STATE.LOAD_UNLOAD;e.loadingPhase=-DLoadState.LOAD_OVER;if(e.needTrans){e.s_next_game_state_after_unload=STATE.LOAD_UNLOAD;e.initMenus()}else{e.s_next_game_state_after_unload=STATE.MENU_MAP}if(e._tempLevelId==DAI.LEVEL_ID_INTRO_NEW_GAME){e._tempLevelId=0;e.s_next_game_state_after_unload=STATE.MENU_MAP}else{if(!e.needTrans&&e._tempLevelId==DAI.LEVEL_ID_CASTLE_FINAL_BOSS){e._tempLevelId=DAI.LEVEL_ID_INTRO_THE_END;e.s_next_game_state_after_unload=STATE.LOAD_UNLOAD;e.initMenus()}else{if(e._tempLevelId==DAI.LEVEL_ID_INTRO_THE_END){e.initMenus();e.s_next_game_state_after_unload=STATE.GAMEEND;y[++bR]=t}else{if(c4&&(e._tempLevelId+1<b5.LEVEL_INFO_NUM)){e._levelInfo[e._tempLevelId+1]=1}}}}if(e.needTrans){var c3=0;while(CEntity._miniGameTriger!=null&&true){if((CEntity._miniGameTriger._params[DParamIndex.TRIGGER_TRANSPORT_WORLD]>>c3)==1){break}c3++}if(CEntity._miniGameTriger!=null){e._worldId=c3-1;e._tempLevelId=e._worldId*DAI.LEVELS_NUM_PRE_WORLD+CEntity._miniGameTriger._params[DParamIndex.TRIGGER_TRANSPORT_LEVEL]}}e.needTrans=false;e.RMS_Save()};e.prototype.GotoMainMenu=function(){e.bIsMainMain=true;e.bIsPaused=false;a9=STATE.LOAD_UNLOAD;e.loadingPhase=-DLoadState.LOAD_OVER;e.s_next_game_state_after_unload=STATE.MENU_INIT;e.initMenus();e.PlaySound(DSound_Channel.BGM,DATA.SOUND_BGM_MENU)};e.GotoEndGameIGP=function(){e.bIsPaused=false;a9=STATE.LOAD_UNLOAD;e.loadingPhase=-DLoadState.LOAD_OVER;e.s_next_game_state_after_unload=STATE.END_GAME_IGP};e.prototype.UpdateGameState_GAMEPLAY_UPDATE=function(){if(bg){e.initIngameMenu(STATE.MENU_INGAME);return}DTimer.resetAll();DTimer.startTimer(DTimer.INDEX_AI);this.gameUpdate();if(a9==STATE.GAMEPLAY_UPDATE){DTimer.endTimer(DTimer.INDEX_AI);DTimer.startTimer(DTimer.INDEX_DRAW);this.gameDraw();if(!e.InCinemitic()){this.DrawInterface();if(this.GetLevelTextByLevelId(e._tempLevelId)!=TEXT.MENU_SELECT_WORLD){if(e._specialEffectStep<=e.EFFECT_OVER){var c4=DEF.VIEW_W_D2;var c3=120*DScreen.RATIO;this.DrawIntroAnimation(Text_GetString(this.GetLevelTextByLevelId(e._tempLevelId)),c4,c3,0)}}}else{cL.SetCurrentPalette(0);cL.DrawString(g,Text_GetString(TEXT.MENU_SK_SKIP),DEF.VIEW_W,DEF.VIEW_H,GRPH.RIGHT_BOTTOM)}if(!e.bIsPaused){e._interface.PaintAFrame(g,DAnimID.INTERFACE_IGM,s_game_currentFrameNB%e.spriteArray[DSpriteID.INTERFACE].GetAFrames(DAnimID.INTERFACE_IGM),DEF.useNewDesign?(DEF.VIEW_W-DGUI.INTERFACE_IGM_OFFSET_X*3):DGUI.INTERFACE_IGM_OFFSET_X,DEF.useNewDesign?DGUI.INTERFACE_LEFTSOFTKEY_OFFSET_Y>>2:(DEF.VIEW_H-DGUI.INTERFACE_LEFTSOFTKEY_OFFSET_Y),0)}this.DrawWeatherEffect();this.DrawFadeEffect();DTimer.endTimer(DTimer.INDEX_DRAW);DTimer.drawTimers(g);if(H){e.drawTheCurtainOpen()}}};e._firstEnterIntoThisFunction=true;e._specialEffectStep=0;e.EFFECT_DOWNING_INTO_SCREEN=0;e.EFFECT_FLOWING_OUTOF_SCREEN=1;e.EFFECT_OVER=2;e._explode_step=0;e._lastFrameNB=0;var aa=null;e._stringFrameLength=0;e.prototype.DrawIntroAnimation=function(c4,c8,c7,c5){e.textChars=c4.split("");var c3=0;switch(e._specialEffectStep){case e.EFFECT_DOWNING_INTO_SCREEN:var c6=e.txtDrawSpecialEffectFlowFromTheSky(c3,c4,c8,c7,c5);if(c6){e._lastFrameNB=s_game_currentFrameNB;e._specialEffectStep++}break;case e.EFFECT_FLOWING_OUTOF_SCREEN:if(s_game_currentFrameNB-e._lastFrameNB>20){e._currentPosX-=20}e.txtDrawSpecialEffectFlowFromTheSky(c3,c4,c8+e._currentPosX,c7,c5);if(e._currentPosX<-240){e._specialEffectStep++}break;case e.EFFECT_OVER:e._specialEffectStep++;e._explode_step=0;e._currentPosX=0;e._currentPosY=0;break;default:}};e.prototype.UpdateGameState_K_MRC_INIT=function(){if(Build.useCGMRC){s_License=new License(s_application);if(s_License.isLicenseValid()){a9=e.s_next_state;if(DEF.dbgEnable){Dbg("VALID")}}else{s_License.sendValidateLicense();a9=STATE.K_MRC_VALIDATING;if(DEF.dbgEnable){Dbg("go to VALIDATING")}}}};e.prototype.UpdateGameState_K_MRC_VALIDATING=function(){if(Build.useCGMRC){SetClip(0,0,GLLibConfig.screenWidth,GLLibConfig.screenHeight);SetColor(0);FillRect(0,0,GLLibConfig.screenWidth,GLLibConfig.screenHeight);var c4=b9.WraptextB(Text_GetString(TEXT.INIT_MRC_VALIDATING),GLLibConfig.screenWidth,GLLibConfig.screenHeight);b9.DrawPageB(g,Text_GetString(TEXT.INIT_MRC_VALIDATING),c4,GLLibConfig.screenWidth>>1,(GLLibConfig.screenHeight>>1),0,10,Graphics.HCENTER|Graphics.VCENTER);if(GLLibConfig.softkeyOKOnLeft){e.txtDraw(0,Text_GetString(TEXT.INIT_MRC_EXIT),1,GLLibConfig.screenHeight-1,Graphics.BOTTOM|Graphics.LEFT)}else{e.txtDraw(0,Text_GetString(TEXT.INIT_MRC_EXIT),GLLibConfig.screenWidth-1,GLLibConfig.screenHeight-1,Graphics.BOTTOM|Graphics.RIGHT)}if(WasKeyPressed(GLKey.k_menuBack)){if(DEF.dbgEnable){Dbg("k_mrc_validating MENU_CANCEL")}s_License.cleanup();s_License=null;a9=STATE.QUIT}else{if(s_License.handleValidateLicense()==true){if(DEF.dbgEnable){Dbg("k_mrc_validating handleValidateLicense")}var c3=s_License.getLastError();if(DEF.dbgEnable){Dbg(""+c3)}s_License.cleanup();switch(c3){case XPlayer.Error.ERROR_NONE:if(s_License.isLicenseValid()){a9=e.s_next_state}else{a9=STATE.K_MRC_EXPIRED}break;case XPlayer.Error.ERROR_CONNECTION:a9=STATE.K_MRC_NETWORK_FAILED;break;default:if(DEF.dbgEnable){Dbg("UNKNOWN MRC ERROR : "+c3)}a9=STATE.QUIT;break}}}}};e.prototype.UpdateGameState_K_MRC_EXPIRED=function(){if(Build.useCGMRC){SetClip(0,0,GLLibConfig.screenWidth,GLLibConfig.screenHeight);SetColor(0);FillRect(0,0,GLLibConfig.screenWidth,GLLibConfig.screenHeight);var c3=b9.WraptextB(Text_GetString(TEXT.INIT_MRC_EXPIRED),GLLibConfig.screenWidth,GLLibConfig.screenHeight);b9.DrawPageB(g,Text_GetString(TEXT.INIT_MRC_EXPIRED),c3,GLLibConfig.screenWidth>>1,(GLLibConfig.screenHeight>>1),0,10,Graphics.HCENTER|Graphics.VCENTER);if(GLLibConfig.softkeyOKOnLeft){e.txtDraw(0,Text_GetString(TEXT.INIT_MRC_EXIT),1,GLLibConfig.screenHeight-1,Graphics.BOTTOM|Graphics.LEFT)}else{e.txtDraw(0,Text_GetString(TEXT.INIT_MRC_EXIT),GLLibConfig.screenWidth,GLLibConfig.screenHeight-1,Graphics.BOTTOM|Graphics.RIGHT)}if(WasKeyPressed(GLKey.k_menuBack)){a9=STATE.QUIT}}};e.prototype.UpdateGameState_K_MRC_NETWORK_FAILED=function(){if(Build.useCGMRC){SetClip(0,0,GLLibConfig.screenWidth,GLLibConfig.screenHeight);SetColor(0);FillRect(0,0,GLLibConfig.screenWidth,GLLibConfig.screenHeight);var c3=b9.WraptextB(Text_GetString(TEXT.INIT_MRC_NETWORK_FAILED),GLLibConfig.screenWidth,GLLibConfig.screenHeight);b9.DrawPageB(g,Text_GetString(TEXT.INIT_MRC_NETWORK_FAILED),c3,(GLLibConfig.screenWidth>>1),(GLLibConfig.screenHeight>>1),0,10,Graphics.HCENTER|Graphics.VCENTER);if(GLLibConfig.softkeyOKOnLeft){e.txtDraw(0,Text_GetString(TEXT.INIT_MRC_RETRY),GLLibConfig.screenWidth,GLLibConfig.screenHeight-1,Graphics.BOTTOM|Graphics.RIGHT);e.txtDraw(0,Text_GetString(TEXT.INIT_MRC_EXIT),1,GLLibConfig.screenHeight-1,Graphics.BOTTOM|Graphics.LEFT)}else{e.txtDraw(0,Text_GetString(TEXT.INIT_MRC_RETRY),1,GLLibConfig.screenHeight-1,Graphics.BOTTOM|Graphics.LEFT);e.txtDraw(0,Text_GetString(TEXT.INIT_MRC_EXIT),GLLibConfig.screenWidth,GLLibConfig.screenHeight-1,Graphics.BOTTOM|Graphics.RIGHT)}if(WasKeyPressed(GLKey.k_menuBack)){a9=STATE.QUIT}else{if(WasKeyPressed(GLKey.k_menuOK)){a9=STATE.K_MRC_INIT}}}};var cS="SCOMSAV";e.RMS_Save=function(){if(DEF.dbgEnable){Dbg("Saving RMS...")}var c4=LowAPI.Gen_Array([b5.SIZE],0);c4[b5.LANGUAGE]=e.curLanguage;c4[b5.FIRST_DAY_PLAY]=e.mFristDayPlay;c4[b5.LAST_TIME_STAMP]=e.mLastTimeStamp;c4[b5.SOUND_ENABLED]=(e.isSoundEnabled?1:0);c4[b5.GAME_PROGRESS]=e._gameProgress;c4[b5.LEVEL_INDEX]=e._levelId;c4[b5.LEVEL_INFO_STRAT]=1;for(var c3=1;c3<b5.LEVEL_INFO_NUM;c3++){c4[b5.LEVEL_INFO_STRAT+c3]=e._levelInfo[c3]}c4[b5.LEVEL_FINAL_INFO1]=e._levelFinalInfo1;c4[b5.LEVEL_FINAL_INFO2]=e._levelFinalInfo2;for(var c3=0;c3<b5.PLAYER_INFO_NUM;c3++){c4[b5.PLAYER_INFO_STRAT+c3]=e._playerInfo[c3]}var c5=b5.LEVEL_STAR_INFO_START;for(var c3=0;c3<b5.LEVEL_STAR_INFO_NUM;c3++){Mem_SetShort(c4,c5,e._levelStarInfo[c3]);c5+=2}c5=b5.LEVEL_TOTAL_SCORE_START;for(var c3=0;c3<b5.LEVEL_TOTAL_SCORE_NUM;c3++){Mem_SetInt(c4,c5,e._levelTotalScore[c3]);c5+=4}Rms_Write(cS,c4)};e.RMS_Load=function(){if(DEF.dbgEnable){Dbg("Loading RMS...")}var c4=Rms_Read(cS);if(c4==null||c4.length==0){e.RMS_Init();e.isSoundEnabled=true;e.RMS_Save()}else{e.curLanguage=c4[b5.LANGUAGE];e.mFristDayPlay=c4[b5.FIRST_DAY_PLAY];e.mLastTimeStamp=c4[b5.LAST_TIME_STAMP];e.isSoundEnabled=c4[b5.SOUND_ENABLED]==1;e._gameProgress=c4[b5.GAME_PROGRESS];e._levelId=(c4[b5.LEVEL_INDEX]==255)?-1:c4[b5.LEVEL_INDEX];for(var c3=0;c3<b5.LEVEL_INFO_NUM;c3++){e._levelInfo[c3]=c4[b5.LEVEL_INFO_STRAT+c3]}e._levelFinalInfo1=c4[b5.LEVEL_FINAL_INFO1];e._levelFinalInfo2=c4[b5.LEVEL_FINAL_INFO2];for(var c3=0;c3<b5.PLAYER_INFO_NUM;c3++){e._playerInfo[c3]=c4[b5.PLAYER_INFO_STRAT+c3]}var c5=b5.LEVEL_STAR_INFO_START;for(var c3=0;c3<b5.LEVEL_STAR_INFO_NUM;c3++){e._levelStarInfo[c3]=Mem_GetShort(c4,c5);c5+=2}c5=b5.LEVEL_TOTAL_SCORE_START;for(var c3=0;c3<b5.LEVEL_TOTAL_SCORE_NUM;c3++){e._levelTotalScore[c3]=Mem_GetInt(c4,c5);c5+=4}}};e.RMS_Init=function(){if(DEF.dbgEnable){Dbg("Initializing RMS...")}e.bSetLanguage=(Language.count>1)?true:false;e.curLanguage=0;e._gameProgress=m;e._levelId=255;e._levelInfo[0]=1;GLLibPlayer.Snd_SetMasterVolume(aP);var c4=0;if(DEF.dbgUnlockLevel){c4=1}for(var c3=1;c3<b5.LEVEL_INFO_NUM;c3++){e._levelInfo[c3]=c4}e._levelFinalInfo1=0;e._levelFinalInfo2=0;for(var c3=0;c3<b5.PLAYER_INFO_NUM;c3++){e._playerInfo[c3]=0}e._playerInfo[DAI.HPI_LIVES]=3;e._playerInfo[DAI.HPI_HP_MAX]=0;for(var c3=0;c3<e._levelStarInfo.length;c3++){e._levelStarInfo[c3++]=DAI.MAX_STAR_NUM;e._levelStarInfo[c3++]=0;e._levelStarInfo[c3++]=0;e._levelStarInfo[c3++]=0;e._levelStarInfo[c3++]=0;e._levelStarInfo[c3++]=0;e._levelStarInfo[c3]=0}for(var c3=0;c3<e._levelTotalScore.length;c3++){e._levelTotalScore[c3]=0}e.RMS_Save();e._levelId=-1;e._worldId=0};e.prototype.RMS_Reset=function(){if(DEF.dbgEnable){Dbg("Resetting game-specific RMS...")}};var am=null;var cP=null;e.spriteArray=LowAPI.Gen_Array([128],null);e.blendSpriteArray;var aX=null;var bz=false;var b9;var bk;e.m_chtFont;var cL;var aS;var B=false;e.prototype.fontLoad=function(){var c6=am[e.curLanguage];bz=false;B=false;if(bz){bk=LowAPI.Gen_Array([2],0);bk[0]=16711680;bk[1]=65280}if(DEF.dbgEnable){Dbg("opening font pack")}if(B){cL=new CHT_ASprite();aS=new CHT_ASprite()}else{cL=new ASprite();aS=new ASprite()}if(DEF.dbgEnable){Dbg("reading font pack")}var c5,c4,c3,c7;if(c6==GLLang.RU){c5=DATA.PACK_FONT_EN;c4=DATA.FONT_EN_01;c3=DATA.FONT_EN_02;c7=DATA.FONT_EN_TABLE}else{if(c6==GLLang.CN){c5=DATA.PACK_FONT_CN;c4=DATA.FONT_CN_01;c3=DATA.FONT_CN_02;c7=DATA.FONT_CN_TABLE}else{c5=DATA.PACK_FONT_EN;c4=DATA.FONT_EN_01;c3=DATA.FONT_EN_02;c7=DATA.FONT_EN_TABLE}}Pack_Open(c5);cL=e.Load_TextFontSprite(c4,c7);aS=e.Load_TextFontSprite(c3,c7);Pack_Close();e.txtSetFont(cL)};e.Load_TextFontSprite=function(c8,c6){var c7=false;var c5=false;var da=new ASprite();da.Load(Pack_ReadData(c8),0);var c9=Pack_ReadArray(c6);da.SetCharMap(c9);var c4=da.GetNumPalettes();for(var c3=0;c3<c4;c3++){if(c7){da.BuildCacheImages(c3,0,-1,-1);da.BuildCacheFrames(c3,0,-1)}else{da.BuildCacheImages(c3,0,-1,-1)}}if(c7){da.PushCacheFramesToGL()}else{da.PushCacheImagesToGL()}if(c7){da.FreeCachedModules()}else{da.FreeCachedFrames()}if(c5){da.FreeCacheData()}return da};e.txtSetFont=function(c3){b9=c3};e.txtDraw=function(c3,c6,c7,c5,c4){e.txtDraw7(c3,c6,c7,c5,c4,-1,-1)};e.txtDraw7=function(c4,c7,c9,c6,c5,c8,c3){if(bz){SetColor(bk[c4]);DrawString(c7,c9,c6,c5)}else{b9.SetSubString(c8,c3);b9.SetCurrentPalette(c4);b9.DrawString(g,c7,c9,c6,c5)}};var ck=0;e.prototype.txtDrawSpecialEffectWave=function(c6,dd,c5,c4,c9){var de=(dd==null)?0:dd.length;var dc=c5;var db=c4;var c3=0;var c8=[c4,c4-1,c4-1,c4-2,c4-2,c4-1,c4-1,c4,c4,c4+1,c4+1,c4+2,c4+2,c4+1,c4+1,c4];b9.SetCurrentPalette(c6);for(var c7=0;c7<de;c7++){c3+=b9.getCharSize(dd.charAt(c7))}var da=LowAPI.Gen_Array([2],0);dc=(GLLibConfig.screenWidth-c3)/2;da[0]=dc;ck=(++ck)%c8.length;for(var c7=0;c7<de;c7++){db=c8[(ck+c7)%c8.length];b9.DrawString(g,dd.charAt(c7),dc,db,c9);dc+=b9.getCharSize(dd.charAt(c7))}da[1]=dc;return da};var cO;e.prototype.txtDrawSpecialEffectWave_New=function(c8,de,c5,c4,c7,db,da){var df=de.length;var dd=c5;var dc=c4;var c3=0;var c6=LowAPI.Gen_Array([c7*4],0);for(var c9=0;c9<c7*4;c9++){if(c9<c7*2){c6[c9]=c4-(c7-Math_Abs(c9-c7))-1}else{c6[c9]=c4+(c7-Math_Abs(c9-3*c7))+1}}b9.SetCurrentPalette(c8);for(var c9=0;c9<df;c9++){c3+=b9.getCharSize(de.charAt(c9))}dd=(GLLibConfig.screenWidth-c3)/2;ck=(++ck)%c6.length;for(var c9=0;c9<df;c9++){dc=c6[(ck+c9)%c6.length];b9.DrawString(g,(de.charAt(c9)),dd,dc,da);dd+=b9.getCharSize(de.charAt(c9))}cO=0};e._actionSpeed;e._xCurrent;e._yCurrent;e._stopAdd;e._stopAdd2;e.txtDrawSpecialEffectCongregate_NEW=function(c9,di,c5,c4,de){var dj=di.length;var c8=di.split("");var c7;var dh=0;var c3=0;var dd=0;var dg=0;var db=0;var c6=LowAPI.Gen_Array([dj],0);var df=0;var da=0;for(var dc=0;dc<dj;dc++){dh=b9.getCharSize(c8[dc]);c3+=dh;if(c8[dc]=="^"){db=dc+1;dd=c3}if(dc>0){c6[dc]=c6[dc-1]+dc*2+9}else{c6[dc]=c3+200}}dg=c3-dd;if(bz){SetColor(bk[c9]);DrawString(di,c5,c4,de)}else{for(var dc=0;dc<dj;dc++){if(db<=dc){da=c4+25;c3=dg;df=db}else{c3=dd;df=0;da=c4+10}c7=e.getTheFinalPosOfCurrentChar(c8,df,dc)+(GLLibConfig.screenWidth-c3)/2;e._xCurrent=c6[dc]-e._actionSpeed;if(e._xCurrent<=c7){e._xCurrent=c7;if(dc==dj-1){e._stopAdd2=true}}b9.SetCurrentPalette(0);b9.SetSubString(dc,dc+1);b9.DrawStringOrChars(g,null,c8,e._xCurrent,da,de,true);b9.SetSubString(-1,-1)}}if(!e._stopAdd2){e._actionSpeed+=40}};var aO=-1;var aq=1;var F=0;var ba=0;var cN=0;var cG=0;var aR;var bl;e.textChars=null;var aI;var aZ=null;var aU=null;var aT=null;var a2=null;e.prototype.txtDarwSpecialEffecFlowIntoTheScreen=function(db,df,c7,c6,ds,dl,dk,c5){var dn=0;var dc=0;var de=db.length;var c4;var c3=0;var c8=0;var dh=0;if(e._firstEnterIntoThisFunction){e._firstEnterIntoThisFunction=false;e._stopAdd=false;e._actionSpeed=0;e._stringFrameLength=0;aa=LowAPI.Gen_Array([de],0);aI=1;e.textChars=db.split("");for(var dj=0;dj<de;dj++){if(e.textChars[dj]=="^"){e.textChars[dj]=" "}}var dm=0;var c9=0;var dd=LowAPI.Gen_Array([3],0);var da=0;for(var dj=0;dj<de;dj++){c3=df.getCharSize(e.textChars[dj]);dm+=c3;if(dm>dl){if(e.textChars[c9]==" "){e.textChars[c9]="^"}else{if(e.textChars[c9]=="-"){if(da<3){dd[da]=c9;da++}}}dm=0;++aI;if(dj!=de-1){dj=c9}continue}if(e.textChars[dj]==" "||e.textChars[dj]=="-"){c9=dj}}dm=0;aZ=LowAPI.Gen_Array([aI],0);aU=LowAPI.Gen_Array([aI],0);aT=LowAPI.Gen_Array([aI],0);a2=LowAPI.Gen_Array([aI],false);aZ[0]=0;var dg=0;for(var dj=0;dj<de;dj++){c3=df.getCharSize(e.textChars[dj]);dm+=c3;if(e.textChars[dj]=="^"||e.textChars[dj]=="-"){var dq=false;if(e.textChars[dj]=="-"){for(var di=2;di>=0;di--){if(dd[di]==dj){dq=true}}}else{dq=true}if(dq){aZ[dg+1]=dj+1;aU[dg]=dj-1;a2[dg]=false;aT[dg]=dm-c3;dg++;dm=0}}if(dj==de-1){aT[dg]=dm;aU[dg]=dj}}if(ds==aq){dg=0;var dr=0;for(var dj=0;dj<de;dj++){c3=df.getCharSize(e.textChars[dj]);e._stringFrameLength+=c3;if(e.textChars[dj]=="^"){dr=aZ[dg]-1;dg++;e._stringFrameLength=0;aa[dj]=DEF.VIEW_W;continue}if(dj>0){aa[dj]=aa[dj-1]+(dj-aZ[dg])*c3+2}else{aa[dj]=e._stringFrameLength+DEF.VIEW_W}}}else{if(ds==aO){dg=aI-1;var dr=0;for(var dj=de-1;dj>=0;dj--){c3=df.getCharSize(e.textChars[dj]);e._stringFrameLength+=c3;if(e.textChars[dj]=="^"){dr=aZ[dg]-1;dg--;e._stringFrameLength=0;aa[dj]=0;continue}if(dj<de-1){aa[dj]=aa[dj+1]-(((dr)-dj)*c3+2)}else{aa[dj]=0-e._stringFrameLength;dr=dj}}}}}if(bz){SetColor(bk[dn]);DrawString(db,c7,c6,c5)}else{if(ds==aq){for(var dj=0;dj<de;dj++){for(var di=0;di<aI;di++){if(dj>=aZ[di]){c8=aZ[di];e._stringFrameLength=aT[di];dh=c6+15+(6+ASprite.GetCurrentStringHeight())*di}}c4=e.getTheFinalPosOfCurrentChar(e.textChars,c8,dj)+(GLLibConfig.screenWidth-e._stringFrameLength)/2;e._xCurrent=aa[dj]-e._actionSpeed;if(e._xCurrent<=c4){e._xCurrent=c4;dc=dj;var dp=true;for(var di=0;di<aI;di++){if(dj==aU[di]){a2[di]=true}dp=dp&a2[di]}if(dp){e._stopAdd=true}}df.SetSubString(dj,dj+1);df.DrawStringOrChars(g,null,e.textChars,e._xCurrent,dh,c5,true);df.SetSubString(-1,-1)}}else{if(ds==aO){for(var dj=de-1;dj>=0;dj--){for(var di=0;di<aI;di++){if(dj>=aZ[di]){c8=aZ[di];e._stringFrameLength=aT[di];dh=c6+15+(6+ASprite.GetCurrentStringHeight())*di}}c4=e.getTheFinalPosOfCurrentChar(e.textChars,c8,dj)+(GLLibConfig.screenWidth-e._stringFrameLength)/2;e._xCurrent=aa[dj]+e._actionSpeed;if(e._xCurrent>=c4){e._xCurrent=c4;dc=dj;var dp=true;for(var di=0;di<aI;di++){if(dj==aZ[di]){a2[di]=true}dp=dp&a2[di]}if(dp){e._stopAdd=true}}df.SetSubString(dj,dj+1);df.DrawStringOrChars(g,null,e.textChars,e._xCurrent,dh,c5,true);df.SetSubString(-1,-1)}}else{if(ds==F){for(var dj=de-1;dj>=0;dj--){for(var di=0;di<aI;di++){if(dj>=aZ[di]){c8=aZ[di];e._stringFrameLength=aT[di];dh=c6+15+(6+ASprite.GetCurrentStringHeight())*di}}c4=e.getTheFinalPosOfCurrentChar(e.textChars,c8,dj)+(GLLibConfig.screenWidth-e._stringFrameLength)/2;df.SetSubString(dj,dj+1);df.DrawStringOrChars(g,null,e.textChars,c4,dh,c5,true);df.SetSubString(-1,-1)}}}}}if(!e._stopAdd){e._actionSpeed+=dk}return dc};var b3=0;var cC=255;e._popUpEnded=false;e._initArrayForPalette=true;var c1=5;e.txtDrawSpecialEffectPopUp=function(c6,dc,c4,c3,c7,c5,da,c8){var db=c3-c7;var c9=da;if(c5<=0){c5=1}e.txtSetFont(cL);if(e._initArrayForPalette&&B){e.CreateAlphaPalette(b9,c6,4,255,false);e._initArrayForPalette=false}b9.SetCurrentPalette(4);b9.ModifyPaletteAlpha(4,cC);if(B){b9.CHT_ModifyPaletteAlpha(b9._nModules,4,cC)}if(!e._popUpEnded){if(!e.bIsPaused){b3-=c1}e.txtDraw(4,dc,c4,c3+b3,c8)}if(b3+c3<=db){cC-=15;c1=1}if(b3+c3<=c3-c9){e._initArrayForPalette=true;e._popUpEnded=true;b3=0;cC=255;c1=c5}};e._currentPosX=0;e._currentPosY=0;e.txtDrawSpecialEffectFlowFromTheSky=function(c5,da,c4,c3,c6){e._currentPosY+=20;if(e._currentPosY>=c3){e._currentPosY=c3}var c8=1;var db=0;var dc=10;var c9=5;var c7=DEF.VIEW_W-20;e.DrawMultiLineText(g,da,c4,e._currentPosY,c8,2,c7,db,dc,c9);if(e._currentPosY==c3){return true}else{return false}};e.txtDrawSpecialEffectFlowFromLeft=function(c9,di,c5,c4,de){var dj=di.length;var c8=di.split("");var c7;var dh=0;var c3=0;var dd=0;var dg=0;var db=0;var c6=LowAPI.Gen_Array([dj],0);var df=0;var da=0;for(var dc=0;dc<dj;dc++){dh=b9.getCharSize(c8[dc]);c3+=dh;if(c8[dc]=="^"){db=dc+1;dd=c3}if(dc>0){c6[dc]=c6[dc-1]+dc*2+9}else{c6[dc]=c3+200}}dg=c3-dd;if(bz){SetColor(bk[c9]);DrawString(di,c5,c4,de)}else{for(var dc=0;dc<dj;dc++){if(db<=dc){da=c4+25;c3=dg;df=db}else{c3=dd;df=0;da=c4+10}c7=e.getTheFinalPosOfCurrentChar(c8,df,dc)+(GLLibConfig.screenWidth-c3)/2;e._xCurrent=c6[dc]-e._actionSpeed;if(e._xCurrent<=c7){e._xCurrent=c7;if(dc==dj-1){e._stopAdd=true}}b9.SetCurrentPalette(0);fontSprite.SetSubString(dc,dc+1);b9.DrawStringOrChars(g,null,c8,e._xCurrent,da,de,true);fontSprite.SetSubString(-1,-1)}}if(!e._stopAdd){e._actionSpeed+=40}};e.getTheFinalPosOfCurrentChar=function(da,c8,c4){var c6=0;var c7;var c3=0;var c9=da;for(var c5=c8;c5<c4;c5++){c7=b9.getCharSize(c9[c5]);c3+=c7}c6=c3;return c6};e.LoadSprite=function(){if(arguments){switch(arguments.length){case 4:return e.LoadSprite4.apply(this,arguments);case 5:if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"&&typeof arguments[2]=="number"){e.LoadSprite5v.apply(this,arguments);break}else{return e.LoadSprite5.apply(this,arguments)}case 6:return e.LoadSprite6.apply(this,arguments);case 8:return e.LoadSprite8.apply(this,arguments)}}else{throw new Error("InvalidArguments")}};var cT=0;var bw=1;var ad=2;e.LoadSprite5v=function(c7,c6,c3,c5,c4){if(e.spriteArray[c7]==null){e.spriteArray[c7]=e.LoadSprite4(c6,c3,c5,c4)}};e.LoadSprite5=function(c3,c5,c7,c4,c6){return e.LoadSprite8(c3,c5,cT,0,c7,c4,c6,true)};e.LoadSprite6=function(c4,c6,c8,c5,c7,c3){return e.LoadSprite8(c4,c6,cT,0,c8,c5,c7,c3)};e.LoadSprite4=function(c3,c5,c6,c4){return e.LoadSprite8(c3,c5,cT,0,c6,c4,false,true)};e.LoadSprite8=function(dd,c7,de,dc,c3,c5,dg,da){var df=new ASprite();var db=null;db=Pack_ReadData(dd);if(db.length==0){return null}if(df.Load(db,0)===false){Err("load sprite error");return null}if(c7==-1){c7=0;for(var c9=0;c9<df._palettes;c9++){c7|=(1<<c9)}}var c8=false;if(dd==DATA.SPRITE_MOBS_CANNON||dd==DATA.SPRITE_OBJ_BALANCE){if(DEF.dbgEnable){Dbg("=================================== cache frame sprite mobs_cannon.")}c8=true}var c6=false;for(var c4=0;(c7>>c4)!=0;c4++){if(((c7>>c4)&1)!=0){if(de!=cT){if(de==bw){df.ModifyPaletteAlpha(c4,dc)}else{if(de==ad){df.ModifyPaletteAlphaUsingLastPalette(c4)}}}if(c6||c8){df.BuildCacheImages(c4,0,-1,-1);if(c8){switch(dd){case DATA.SPRITE_MOBS_CANNON:df.BuildCacheFrames(c4,20,25);df.BuildCacheFrames(c4,17,17);break;case DATA.SPRITE_OBJ_BALANCE:df.BuildCacheFrames(c4,0,1);break;default:break}}else{df.BuildCacheFrames(c4,0,-1)}}else{df.BuildCacheImages(c4,0,-1,-1)}}}if(c8){df.PushCacheFramesToGL()}if(c6){df.PushCacheFramesToGL()}else{df.PushCacheImagesToGL()}if(c3&&c5){df.FreeCacheData()}else{if(!c5&&da&&(df._data_format==ASprite.ENCODE_FORMAT_I256)){df.ConvertCompressedData_I256_I256RLE(true)}}db=null;return df};e.spriteLoad=function(c3,c4,c6,c5){e.LoadSprite(c3,c4,-1,c6,!c5)};e.spriteUnLoad=function(c3){if(c3==DATA.SPRITE_MOBS_WHITE||c3==DATA.SPRITE_BONUS){if(DEF.dbgEnable){Dbg("spriteUnLoad : ******************* IGNORE --- "+c3)}return}if(e.spriteArray[c3]!=null){if(DEF.dbgEnable){Dbg("spriteUnLoad : ******************* "+c3)}e.spriteArray[c3].FreeCacheData();e.spriteArray[c3].FreeCachedFrames();e.spriteArray[c3].FreeCachedModules();e.spriteArray[c3]=null}};e._loadingSpriteMap=[DSpriteID.MOBS_WHITE,DAnimID.MOBS_WHITE_WALK,DSpriteID.SEAGULL,DAnimID.SEAGULL_FLY,DSpriteID.HERO,DAnimID.HERO_FAT_WALK,DSpriteID.MOBS_UFO,DAnimID.MOBS_UFO_MOVE,DSpriteID.BOSS_WATCH,DAnimID.BOSS_WATCH_LAUGH];e.level2Tiled=function(c5,c4){var c3=e._tempLevelId;return e._level2tiled[(c3*(GLLibConfig.tileset_maxLayerCount))+c4]};e._optimizeSprite=[DATA.SPRITE_GAMELOFT_LOGO,DATA.SPRITE_LV1_ELEMENTS,DATA.SPRITE_MOBS_YETI,DATA.SPRITE_MOBS_PENGUIN,DATA.SPRITE_ACTOR_SNOWMAN];e.LoadUnload=function(dr){switch(dr){case 0:e._actionSpeed=0;e._firstEnterIntoThisFunction=true;e._stopMove=false;e._stopAdd=false;e._moveSpeed=0;if(e._tempLevelId>DAI.LEVEL_ID_CASTLE_FINAL_BOSS){e._specialEffectStep=e.EFFECT_OVER}else{e._specialEffectStep=e.EFFECT_DOWNING_INTO_SCREEN}dr=DLoadState.LOAD_TEXT;GLLibPlayer.Snd_Stop(DSound_Channel.BGM);case DLoadState.LOAD_TEXT:e.InitLevel();Text_LoadTextFromPack_INI(aX,DATA.TEXT_MENU);break;case DLoadState.UNLOAD_TEXT:e.ReleaseLevel(false);e._checkPointData=null;e._actionSpeed=0;e._firstEnterIntoThisFunction=true;e._stopMove=false;e._stopAdd=false;e._moveSpeed=0;break;case DLoadState.LOAD_TILESET:if(DEF.dbgEnable){Dbg("loading tilesets")}Pack_Open(DATA.PACK_TILESET);for(var dt=0;dt<GLLibConfig.tileset_maxLayerCount;dt++){var c5=e.level2Tiled(e._tempLevelId,dt);if(c5!=-1&&dt!=1){var dw=true;var dh=true;var dA=c5;dA-=Math.floor(c5/GLLibConfig.tileset_maxLayerCount);if(c5==DClassID.BG_6-DClassID.BTM){dA++}if(DEF.dbgEnable){Dbg("loading tilesets ------------------------------ i : "+dt)}e.spriteLoad(c5+DSpriteID.TILESET_BASE,dt>1?dA-1:dA,dw,dh)}}Pack_Close();GLLibPlayer.Tileset_Init(DGUI.SCREEN_WIDTH_FORTILE,DGUI.SCREEN_HEIGHT_FORTILE,DEF.TILE_W,DEF.TILE_H);var dC;var dc=null;var dp=null;var dk=10000;for(var dt=0;dt<GLLibConfig.tileset_maxLayerCount;dt++){if(dt==0){var dd=(DATA.PACK_LEVEL01_B.charAt(1)-"0")*10+(DATA.PACK_LEVEL01_B.charAt(2)-"0");if(e._tempLevelId>DAI.LEVEL_ID_CASTLE_FINAL_BOSS){dd+=DAI.WORLD_ID_PIRATE}else{if(e._tempLevelId>DAI.LEVELS_NUM_PRE_WORLD*DAI.WORLD_ID_CASTLE){dd+=e._tempLevelId-DAI.LEVELS_NUM_PRE_WORLD*DAI.WORLD_ID_CASTLE-1}else{dd+=Math.floor(e._tempLevelId/DAI.LEVELS_NUM_PRE_WORLD)}}Pack_Open("/"+dd)}else{if(dt==2){Pack_Close();var dd=(DATA.PACK_LEVEL01_1.charAt(1)-"0")+e._tempLevelId;if(e._tempLevelId>DAI.LEVEL_ID_CASTLE_FINAL_BOSS){dd=(DATA.PACK_INTRO_1.charAt(1)-"0")+e._tempLevelId-DAI.LEVEL_ID_INTRO_NEW_GAME}Pack_Open("/"+dd)}}var c5=e.level2Tiled(e._tempLevelId,dt);if(c5==-1||dt==1){continue}var c7=GLLibPlayer.WRAP_CLAMP;var dz=false;if(dt==0){dz=true}if(c5==DClassID.BG_6-DClassID.BTM){c7=GLLibPlayer.WRAP_REPEAT}var dg;if(dt>1){dg=(dt-2)*3}else{dg=dt*3}dC=Pack_ReadData(dg++);dc=Pack_ReadData(dg++);dp=Pack_ReadData(dg++);GLLibPlayer.Tileset_LoadLayer(dt,dC,dc,dp,e.spriteArray[c5+DSpriteID.TILESET_BASE],dz,TOP,c7,c7);GLLibPlayer.Tileset_SetCamera(dt,0,0);if(DClassID.BTM+dt==DClassID.BG){e._mapTileCountWidth=Mem_GetShort(dC,0);e._mapTileCountHeight=Mem_GetShort(dC,2)}}e._topLayerData=dc;e._topLayerFlip=dp;break;case DLoadState.UNLOAD_TILESET:for(var dt=0;dt<GLLibConfig.tileset_maxLayerCount;dt++){GLLibPlayer.Tileset_Destroy(dt)}e._topLayerData=null;e._topLayerFlip=null;break;case DLoadState.LOAD_ENTITY:if(DEF.dbgEnable){Dbg("loading entities")}e.LoadLevelData(DATA.LEVEL01_1_DESIGN);e.InitTraceAreas();e.InitCamera();CEntity.MonsterchestInitHP();e._entityMaxId=ak;for(var dt=0;dt<GLLibConfig.tileset_maxLayerCount;dt++){var dy=LowAPI.Gen_Array([DParamIndex.ANIMID+1],0);dy[DParamIndex.ID]=e._entityMaxId++;dy[DParamIndex.CLASS_ID]=(DClassID.BTM+dt);dy[DParamIndex.FLAGS]=DFlags.FIXED;e._entitiesRowTable.put(dy[DParamIndex.ID],dy);e._entitiesRowData[e._entityRowDataCount++]=dy}e.LoadCinematics(Pack_ReadData(DATA.LEVEL01_1_CINEMATICS));Pack_Close();break;case DLoadState.UNLOAD_ENTITY:CEntity.RemoveAll();e._entitiesRowTable.clear();e._entitiesRowData=null;break;case DLoadState.LOAD_SEGMENT:Pack_Open(DATA.PACK_SEGMENT);var dq=Pack_ReadData(e._tempLevelId);var c9=0;var da=Mem_GetShort(dq,c9);e._segmentCount=da;c9+=2;var c3=Mem_GetShort(dq,c9);c9+=2;e._segments=LowAPI.Gen_Array([da+500],null);e._segmentParams=LowAPI.Gen_Array([da+500],0);e._segmentAngles=LowAPI.Gen_Array([da+500],null);e._entityMaxId=U;for(var dt=0;dt<da;dt++){for(var ds=0;ds<c3;ds++){e._segmentParams[dt]=Mem_GetShort(dq,c9);c9+=2}var dv=Mem_GetShort(dq,c9);c9+=2;e._segmentAngles[dt]=LowAPI.Gen_Array([dv-1],0);dv<<=1;e._segments[dt]=LowAPI.Gen_Array([dv],0);var dn=0;var dl=0;var c4=Number.MAX_VALUE;var dx=Number.MIN_VALUE;var dj=Number.MAX_VALUE;var db=Number.MIN_VALUE;for(var ds=0;ds<dv;ds+=2){var df=Mem_GetShort(dq,c9);c9+=2;var de=Mem_GetShort(dq,c9);c9+=2;if(ds==0){dn=df;dl=de}c4=Math.min(df,c4);dx=Math.max(df,dx);e._segments[dt][ds]=(df-dn)<<DEF.SHIFT;dj=Math.min(de,dj);db=Math.max(de,db);e._segments[dt][ds+1]=(de-dl)<<DEF.SHIFT;var dm=(ds-2+ds)>>2;if(dm>=0){var du=Math_Atan(e._segments[dt][ds]-e._segments[dt][ds-2],e._segments[dt][ds+1]-e._segments[dt][ds-1]);e._segmentAngles[dt][dm]=du}}var dy=LowAPI.Gen_Array([DParamIndex.SEGMENT_HEIGHT+1],0);dy[DParamIndex.CLASS_ID]=DClassID.SEGMENT;dy[DParamIndex.ID]=e._entityMaxId++;dy[DParamIndex.POSX]=dn;dy[DParamIndex.POSY]=dl;dy[DParamIndex.FLAGS]=(DFlags.FIXED|DFlags.NO_UPDATE_AI);dy[DParamIndex.EX_FLAGS]=DFlags.EX_SEGMENT;dy[DParamIndex.SEGMENT_SEGMENT_ID]=dt;dy[DParamIndex.SEGMENT_LEFT]=(c4-dn-1);dy[DParamIndex.SEGMENT_TOP]=(dj-dl-1);dy[DParamIndex.SEGMENT_WIDTH]=(dx-c4+2);dy[DParamIndex.SEGMENT_HEIGHT]=(db-dj+2);dy[DParamIndex.SEGMENT_WIDTH]=Math.max(dy[DParamIndex.SEGMENT_WIDTH],1);dy[DParamIndex.SEGMENT_HEIGHT]=Math.max(dy[DParamIndex.SEGMENT_HEIGHT],1);e._entitiesRowTable.put(dy[DParamIndex.ID],dy);e._entitiesRowData[e._entityRowDataCount++]=dy}e._entityMaxId=u;Pack_Close();break;case DLoadState.UNLOAD_SEGMENT:e._segments=null;e._segmentAngles=null;e._segmentParams=null;e._segmentCount=0;break;case DLoadState.LOAD_SPRITE:if(DEF.dbgEnable){Dbg("loading sprites")}Pack_Open(DATA.PACK_SPRITE);for(var dt=0;dt<DATA.SPRITE_MAX;dt++){if((e._sprites_load_mask&(1<<dt))!=0&&e.spriteArray[dt]==null){if(e._optimizeSprite.indexOf(dt)>-1){continue}if(DEF.dbgEnable){Dbg("loading sprite id : ----------------------------- "+dt)}e.spriteLoad(dt,dt,true,true)}else{if((dt==DATA.SPRITE_HINT||dt==DATA.SPRITE_BONUS||dt==DATA.SPRITE_STONE)&&e.spriteArray[dt]==null){if(DEF.dbgEnable){Dbg("loading missing sprite id : ----------------------------- "+dt)}e.spriteLoad(dt,dt,true,true)}}}Pack_Close();if(e.spriteArray[DSpriteID.MOBS_WHITE]!=null){Pack_Open(DATA.PACK_MODULE_MAP);for(var dt=0;dt<DATA.MODULE_MAP_MAX;dt++){e.spriteArray[DSpriteID.MOBS_WHITE].SetModuleMapping(dt,Pack_ReadData(dt))}Pack_Close()}if(e.spriteArray[DSpriteID.MOBS_FLY]!=null){Pack_Open(DATA.PACK_MODULE_MAP_FLY);for(var dt=0;dt<DATA.MODULE_MAP_FLY_MAX;dt++){e.spriteArray[DSpriteID.MOBS_FLY].SetModuleMapping(dt,Pack_ReadData(dt))}Pack_Close()}if(e.spriteArray[DSpriteID.BOSS_OCTOPUS]!=null){Pack_Open(DATA.PACK_MODULE_MAP_BOSS_OCTOPUS);for(var dt=0;dt<DATA.MODULE_MAP_BOSS_OCTOPUS_MAX;dt++){e.spriteArray[DSpriteID.BOSS_OCTOPUS].SetModuleMapping(dt,Pack_ReadData(dt))}Pack_Close()}if(e.spriteArray[DSpriteID.HERO]!=null){Pack_Open(DATA.PACK_MODULE_MAP_HERO);for(var dt=0;dt<DATA.MODULE_MAP_HERO_MAX;dt++){e.spriteArray[DSpriteID.HERO].SetModuleMapping(dt,Pack_ReadData(dt))}Pack_Close()}if(e.spriteArray[DSpriteID.MAP_ACTOR]!=null){e.CreateAlphaPalette(e.spriteArray[DSpriteID.MAP_ACTOR],0,e.MINI_MAP_ALPHA_PAL,255,false)}break;case DLoadState.UNLOAD_SPRITE:if(DEF.dbgEnable){Dbg("UNLOAD_SPRITE *************")}for(var dt=0;dt<e.spriteArray.length;dt++){e.spriteUnLoad(dt)}break;case DLoadState.LOAD_EFFECT:e.CreateSpriteEffect();e.blendSpriteArray=LowAPI.Gen_Array([DATA.EFFECT_MAX],null);Pack_Open(DATA.PACK_EFFECT);for(var dt=0;dt<DATA.EFFECT_MAX;dt++){if(DEF.dbgEnable){Dbg("loading effect -------------------------------")}e.blendSpriteArray[dt]=e.LoadSprite4(dt,-1,true,false)}e.blendSpriteArray[DATA.EFFECT_SPAWN]._blend=CBlendSprite.BLEND_DISPLACEMENT;e.blendSpriteArray[DATA.EFFECT_SPAWN].ModifyPalette(1,5904216);e.blendSpriteArray[DATA.EFFECT_SPAWN].ModifyPalette(2,525720);e.ApplyModifyPalette(e.blendSpriteArray[DATA.EFFECT_SPAWN],[1,2]);e.blendSpriteArray[DATA.EFFECT_ATMOSPHERE].ModifyPalette(0,16728128);e.blendSpriteArray[DATA.EFFECT_ATMOSPHERE].ModifyPalette(1,3966191);e.ApplyModifyPalette(e.blendSpriteArray[DATA.EFFECT_ATMOSPHERE],[0,1]);for(var dt=0;dt<e.spriteArray.length;dt++){if(e.spriteArray[dt]!=null){e.spriteArray[dt].SetPool(1)}}break;case DLoadState.UNLOAD_EFFECT:if(e.blendSpriteArray!=null){for(var dt=0;dt<DATA.EFFECT_MAX;dt++){if(e.blendSpriteArray[dt]!=null){if(DEF.dbgEnable){Dbg("spriteUnLoad UNLOAD_EFFECT : ******************* "+dt)}e.blendSpriteArray[dt].FreeCacheData();e.blendSpriteArray[dt].FreeCachedFrames();e.blendSpriteArray[dt].FreeCachedModules();e.blendSpriteArray[dt]=null}}e.blendSpriteArray=null}break;case DLoadState.LOAD_SOUND:if(DEF.dbgEnable){Dbg("init sound engine")}if(DEF.dbgEnable){Dbg("load some sound")}for(var dt=0;dt<DATA.SOUND_MAX;dt++){if(GLLibConfiguration.sound_allowURLCreation){var dB=e.getSoundName(dt);var di=window.location.href.split("index")[0];var c6=di.split("?")[0]+"js\\sounds\\MP3\\"+dB;var c8="audio/mpeg";GLLibPlayer.Snd_LoadSound(c6,c8,dt,true)}else{GLLibPlayer.Snd_LoadSound(DATA.PACK_SOUND,dt)}}break;case DLoadState.UNLOAD_SOUND:if(DEF.dbgEnable){Dbg("unload some sound -------------------------")}for(var dt=0;dt<DATA.SOUND_MAX;dt++){GLLibPlayer.Snd_UnLoadSound(dt)}GLLibPlayer.Snd_Quit();break}dr++;return dr};e.getSoundName=function(c3){if(DEF.dbgEnable){Dbg(" getSoundName ----------------------- DATA.NAME[index] : "+DATA.NAME[c3])}if(c3>=0&&c3<DATA.SOUND_MAX){return DATA.NAME[c3][0]}throw new Error("Index out of bound.")};e.ApplyModifyPalette=function(c3,c4){for(var c5=0;c5<c4.length;c5++){c3.BuildCacheImages(c4[c5],0,-1,-1)}c3.PushCacheImagesToGL()};e.CreateAlphaPalette=function(c4,de,dj,c9,db){if(c4._pal_data!=null&&c4._pal_int==null){c4.AllocateExtraPalette(dj);var c3=c4.GetNumColors(0);var df=c3*3+4;var c5=c3+4;var da=df+c5;var dd=de*da;var c6=dj*da;System.arraycopy(c4._pal_data,dd,c4._pal_data,c6,da);var dh=c6;var c7=c6+df;for(var dc=0;dc<c3;dc++){if(db){c4._pal_data[dh+2]=((c4._pal_data[dh+2]&255)|c9);dh+=3}c4._pal_data[c7]=((c4._pal_data[c7]&255)*c9)>>8;c7++}dh=c6+c3*3;for(var dc=0;dc<4;dc++){if(db){c4._pal_data[dh++]=0}c4._pal_data[c7++]=0}var c8=false;if(c8){c4.BuildCacheImages(dj,0,-1,-1);c4.BuildCacheFrames(dj,0,-1);c4.PushCacheFramesToGL()}else{c4.BuildCacheImages(dj,0,-1,-1);c4.PushCacheImagesToGL()}return}if(GLLibConfig.sprite_useNokiaUI){var dg=c4._pal_short[0][de];var di=LowAPI.Gen_Array([dg.length],0);System.arraycopy(dg,0,di,0,di.length);c4._pal_short[0][dj]=di}else{var dg=c4._pal_int[0][de];var di=LowAPI.Gen_Array([dg.length],0);System.arraycopy(dg,0,di,0,di.length);c4._pal_int[0][dj]=di}c4._palettes++;if(db){if(GLLibConfig.sprite_useNokiaUI){c4._pal_short[0][dj]=LowAPI.Gen_Array([c4._pal_short[0][de].length],0);c9=(c9>>4)&255;for(var dc=0;dc<c4._pal_short[0][de].length;dc++){if((c4._pal_short[0][de][de]&4095)!=3855){c4._pal_short[0][dj][dc]=(((c9&15)<<12)|(c4._pal_short[0][de][dc]&4095)|c9)}}}else{c4._pal_int[0][dj]=LowAPI.Gen_Array([c4._pal_int[0][de].length],0);c9=c9&255;for(var dc=0;dc<c4._pal_int[0][de].length;dc++){if((c4._pal_int[0][de][dc]&4278190080)!=0&&(c4._pal_int[0][de][dc]&16777215)!=16711935){c4._pal_int[0][dj][dc]=(((c9)<<24)|(c4._pal_int[0][de][dc]&16777215)|c9)}}}}else{c4.ModifyPaletteAlpha(dj,c9)}var c8=false;if(c8){c4.BuildCacheImages(dj,0,-1,-1);c4.BuildCacheFrames(dj,0,-1);c4.PushCacheFramesToGL()}else{c4.BuildCacheImages(dj,0,-1,-1);c4.PushCacheImagesToGL()}};e.LoadLevelData=function(c5){var c3;c3=Pack_ReadData(c5);var c6=c3.length;var c9=0;while(c9<c6){var da=(c3[c9++]&255);var c8=LowAPI.Gen_Array([da],0);for(var c4=0;c4<da;c4++){c8[c4]=Mem_GetShort(c3,c9);c9+=2}e._entitiesRowTable.put(c8[DParamIndex.ID],c8);e._entitiesRowData[e._entityRowDataCount++]=c8;var c7=CEntity.InitSprite(c8);e._sprites_load_mask|=CEntity.GetSpriteLoadMask(c7)}};e.InitCamera=function(){for(var c3=0;c3<e._entityRowDataCount;c3++){var c4=e._entitiesRowData[c3];if(c4[DParamIndex.CLASS_ID]==DClassID.CAMERA){if(c4[DParamIndex.CAMERA_WIDTH]==DEF.DESIGN_SCR_W){c4[DParamIndex.POSX]-=(DEF.SCR_W-DEF.DESIGN_SCR_W)/2;c4[DParamIndex.POSX]=Math.max(0,c4[DParamIndex.POSX]);c4[DParamIndex.POSX]=Math.min(e._mapTileCountWidth*DEF.TILE_W-DEF.SCR_W,c4[DParamIndex.POSX]);c4[DParamIndex.CAMERA_WIDTH]=DEF.SCR_W}if(c4[DParamIndex.CAMERA_HEIGHT]==DEF.DESIGN_SCR_H){c4[DParamIndex.POSY]-=(DEF.SCR_H-DEF.DESIGN_SCR_H)/2;c4[DParamIndex.POSY]=Math.max(0,c4[DParamIndex.POSY]);c4[DParamIndex.POSY]=Math.min(e._mapTileCountHeight*DEF.TILE_H-DEF.SCR_H,c4[DParamIndex.POSY]);c4[DParamIndex.CAMERA_HEIGHT]=DEF.SCR_H}}}};e.InitTraceAreas=function(){for(var c7=0;c7<e._entityRowDataCount;c7++){var c6=e._entitiesRowData[c7];var c4=-1;var c8=-1;if(c6[DParamIndex.CLASS_ID]==DClassID.TRACE_RENDER){c4=c6[DParamIndex.TRACE_RENDER_FIRST_TRACE];c8=c6[DParamIndex.TRACE_RENDER_LAST_TRACE]}else{if(c6[DParamIndex.CLASS_ID]==DClassID.PLATFORM){c4=c6[DParamIndex.PLATFORM_TRACE]}else{if(c6[DParamIndex.CLASS_ID]==DClassID.ROLLING_PLATFORM){c4=c6[DParamIndex.ROLLING_PLATFORM_TRACE]}else{if(c6[DParamIndex.CLASS_ID]==DClassID.OBJ_DAMAGE_STONE){c4=c6[DParamIndex.OBJ_DAMAGE_STONE_TRACE]}else{if(c6[DParamIndex.CLASS_ID]==DClassID.MOBS_UFO){c4=c6[DParamIndex.MOBS_UFO_TRACE]}}}}}if(c4>0){var c9=c4;var db=null;var c5=Number.MAX_VALUE;var dc=Number.MIN_VALUE;var da=Number.MAX_VALUE;var c3=Number.MIN_VALUE;while(c9>0){db=CEntity.GetRowDataByID(c9);c5=Math.min(c5,db[DParamIndex.POSX]);da=Math.min(da,db[DParamIndex.POSY]);dc=Math.max(dc,db[DParamIndex.POSX]);c3=Math.max(c3,db[DParamIndex.POSY]);if(c9==c8){break}c9=db[DParamIndex.TRACE_NEXT_TRACE];if(c9==c4){break}}c6[DParamIndex.POSX]=c5;c6[DParamIndex.POSY]=da;if(c6[DParamIndex.CLASS_ID]==DClassID.TRACE_RENDER){c6[DParamIndex.TRACE_RENDER_WIDTH]=(dc-c5);c6[DParamIndex.TRACE_RENDER_HEIGHT]=(c3-da)}else{if(c6[DParamIndex.CLASS_ID]==DClassID.PLATFORM){c6[DParamIndex.PLATFORM_WIDTH]=(dc-c5);c6[DParamIndex.PLATFORM_HEIGHT]=(c3-da)}else{if(c6[DParamIndex.CLASS_ID]==DClassID.ROLLING_PLATFORM){c6[DParamIndex.ROLLING_PLATFORM_WIDTH]=(dc-c5);c6[DParamIndex.ROLLING_PLATFORM_HEIGHT]=(c3-da)}else{if(c6[DParamIndex.CLASS_ID]==DClassID.OBJ_DAMAGE_STONE){c6[DParamIndex.OBJ_DAMAGE_STONE_WIDTH]=(dc-c5);c6[DParamIndex.OBJ_DAMAGE_STONE_HEIGHT]=(c3-da)}else{if(c6[DParamIndex.CLASS_ID]==DClassID.MOBS_UFO){c6[DParamIndex.MOBS_UFO_WIDTH]=(dc-c5);c6[DParamIndex.MOBS_UFO_HEIGHT]=(c3-da)}}}}}}}};e.CreateSpriteEffect=function(){var da;var de;var dc;var db;de=e.spriteArray[DSpriteID.HERO];dc=DAI.HERO_PAL_SHADOW1;db=DAI.HERO_PAL_NORMAL;for(var c6=0;c6<2;c6++){if(c6==1){dc=DAI.HERO_PAL_POWERUP_SHADOW1;db=DAI.HERO_PAL_POWERUP}for(var c7=dc;c7<dc+3;c7++){var c5=170;if(c7==dc+1){c5=136}else{if(c7==dc+2){c5=102}}e.CreateAlphaPalette(de,db,c7,c5,true)}}if(e.spriteArray[DSpriteID.BOSS_WATCH]!=null){de=e.spriteArray[DSpriteID.BOSS_WATCH];dc=DAI.BOSS_WITCH_PAL_SHADOW1;db=DAI.BOSS_WITCH_PAL_NORMAL;for(var c6=0;c6<1;c6++){for(var c7=dc;c7<dc+DAI.BOSS_WITCH_PAL_SHADOWMAX;c7++){var c5=170;if(c7==dc+1){c5=136}else{if(c7==dc+2){c5=102}else{if(c7==dc+3){c5=68}else{if(c7==dc+4){c5=34}}}}e.CreateAlphaPalette(de,db,c7,c5,true)}}}if(e.spriteArray[DSpriteID.OBJ_WAVE]!=null){e.spriteArray[DSpriteID.OBJ_WAVE].ModifyPaletteAlpha(0,32);e.spriteArray[DSpriteID.OBJ_WAVE]._alpha=true;e.spriteArray[DSpriteID.OBJ_WAVE].BuildCacheImages(0,0,-1,-1);e.spriteArray[DSpriteID.OBJ_WAVE].BuildCacheImages(1,0,-1,-1);e.spriteArray[DSpriteID.OBJ_WAVE].PushCacheImagesToGL()}if(e.spriteArray[DSpriteID.OBJ_BALANCE]!=null){var c4=e.spriteArray[DSpriteID.OBJ_BALANCE].GetModuleCount();e._balanceImageData=LowAPI.Gen_Array([c4],null);e._balanceImageSize=LowAPI.Gen_Array([c4<<1],0);for(var c8=0;c8<e.spriteArray[DSpriteID.OBJ_BALANCE].GetModuleCount();c8++){var dd=e.spriteArray[DSpriteID.OBJ_BALANCE].GetModuleWidth(c8);var c9=e.spriteArray[DSpriteID.OBJ_BALANCE].GetModuleHeight(c8);e._balanceImageSize[c8<<1]=dd;e._balanceImageSize[(c8<<1)+1]=c9;e._balanceImageData[c8]=LowAPI.Gen_Array([dd*c9],0);var c3=e.spriteArray[DSpriteID.OBJ_BALANCE].DecodeImage(c8);System.arraycopy(c3,0,e._balanceImageData[c8],0,e._balanceImageData[c8].length)}}if(e.spriteArray[DSpriteID.FIELD]!=null){e.spriteArray[DSpriteID.FIELD].ModifyPaletteAlpha(0,136)}};var c2={};c2.ENDED=-1;c2.INIT=1;c2.MENU=2;c2.TEST_ARENA=3;c2.TEST_LOGIN=20;c2.TEST_SENDINGSCORE=21;c2.TEST_GETSTATES=22;c2.TEST_GETRANK=23;c2.TEST_GETRANK_AROUND_PLAYER=24;c2.TEST_RATEGAME=25;c2.TEST_RECOMMENDGAME=26;c2.TEST_REGISTER=30;c2.TEST_NICK_TAKEN=31;c2.TEST_DISPLAY_GAME_RATINGS=32;c2.TEST_CONNECTION_ERROR=40;c2.TEST_SERVER_ERROR=41;var bU={};bU.SINGLE_SCORE=0;bU.SINGLE_SCORE_SUPPLEMENTAL_DATA=1;bU.MULTIPLE_SCORE=2;bU.MULTIPLE_SCORE_SUPPLEMENTAL_DATA=3;e.currentScoreSendingPolicy=bU.SINGLE_SCORE;e.USE_CONDENSED_VERSION=false;var aQ={};aQ.SET=0;aQ.WAIT=1;aQ.PROCESS=2;aQ.DISPLAY=3;e.vareractiv=null;var bH=[TEXT.MENU_XPLAYER_GAMELOFT_LIVE,TEXT.MENU_XPLAYER_PLAY,];e.MENU_STATE_TEST_ARENA=0;e.MENU_STATE_EXIT=1;var bB=[TEXT.MENU_XPLAYER_SEND_SCORE,TEXT.MENU_XPLAYER_GET_TOP_PLAYERS,TEXT.MENU_XPLAYER_GET_RANKING,TEXT.MENU_XPLAYER_MY_STATS,TEXT.MENU_XPLAYER_RATE_GAME,TEXT.MENU_XPLAYER_RECOMMEND_GAME,TEXT.MENU_XPLAYER_VISIT_GAME_LOBBY,];var bq=bB.length;var cb=[TEXT.MENU_XPLAYER_ROOT_CANAL,TEXT.MENU_XPLAYER_GARBAGE,TEXT.MENU_XPLAYER_AWFUL,TEXT.MENU_XPLAYER_DISAPPOINTING,TEXT.MENU_XPLAYER_AVERAGE,TEXT.MENU_XPLAYER_GOOD,TEXT.MENU_XPLAYER_GREAT,TEXT.MENU_XPLAYER_EXCELLENT,TEXT.MENU_XPLAYER_OUTSTANDING,TEXT.MENU_XPLAYER_THE_BEST,];var aY=cb.length;var bj=true;var cn=0;var aD="";var au=0;var cw=0;var T=0;e.keymap=[["0"],["_","1"],["A","B","C","2"],["D","E","F","3"],["G","H","I","4"],["J","K","L","5"],["M","N","O","6"],["P","Q","R","S","7"],["T","U","V","8"],["W","X","Y","Z","9"]];var cB=0;var E=2;var ah=1;var X=0;var bF=0;var ca=0;var bG=-1;var N=-1;var a7=true;var a6=0;var a4=0;var bf=0;var bd=0;var cg=0;var ce=0;var af=-256;var aK=null;e.prototype.pointerPressed=function(c3,c4){a6=c3;a4=c4;bf=c3;bd=c4;cg=c3;ce=c4};e.prototype.pointerDragged=function(c3,c4){cg=c3;ce=c4};e.prototype.pointerReleased=function(c3,c4){a6=-1000;a4=-1000;bf=-1000;bd=-1000;cg=-1000;ce=-1000;ResetKey()};e.isPointInRect=function(c3,c6,c4,c5){return e.isPointInRectAbs(c3,c6,c3+c4,c6+c5)};e.isPointInRectAbs=function(c4,c6,c3,c5){if(DEF.dbgEnableTouchBox){g.setColor(16711680);g.drawRect(c4,c6,c3-c4,c5-c6)}return(a6>c4&&a4>c6&&a6<c3&&a4<c5)};e.isPointHoldInRect=function(c3,c6,c4,c5){return e.isPointHoldInRectAbs(c3,c6,c3+c4,c6+c5)};e.isPointHoldInRectAbs=function(c4,c6,c3,c5){return(bf>c4&&bd>c6&&bf<c3&&bd<c5)};e.isPointInRect_FixedPoint=function(c3,c6,c4,c5){return e.isPointInRect(Math_FixedPointToInt(c3-CEntity._camX),Math_FixedPointToInt(c6-CEntity._camY),Math_FixedPointToInt(c4),Math_FixedPointToInt(c5))};e.isPointInRectAbs_FixedPoint=function(c3,c6,c4,c5){return e.isPointInRectAbs(Math_FixedPointToInt(c3-CEntity._camX),Math_FixedPointToInt(c6-CEntity._camY),Math_FixedPointToInt(c4-CEntity._camX),Math_FixedPointToInt(c5-CEntity._camY))};e.prototype.detectSoftKeys=function(){if(a9==STATE.GAMEPLAY_UPDATE||a9==STATE.MENU_MAP){if((e.isPointInRect(0,DEF.SCR_H-P,A,P)&&!DEF.useNewDesign)||(e.isPointInRect(DEF.SCR_W-ag,0,ag,K)&&DEF.useNewDesign)){this.keyPressed(GLLibConfig.keycodeLeftSoftkey);this.keyReleased(GLLibConfig.keycodeLeftSoftkey)}if(e.isPointInRect(DEF.SCR_W-ag,DEF.SCR_H-K,ag,K)){this.keyPressed(GLLibConfig.keycodeRightSoftkey);this.keyReleased(GLLibConfig.keycodeRightSoftkey)}}else{if(DEF.useNewDesign){if((e.isPointInRect(DEF.SCR_W-ag,0,ag,K)&&(a9==STATE.GAMEPLAY_UPDATE||a9==STATE.MENU_MAP))||(e.isPointInRect(0,DEF.SCR_H+DGUI.MENU_OFFSET_Y-K,ag,K)&&a9==STATE.MENU_HELP)){this.keyPressed(GLLibConfig.keycodeLeftSoftkey);this.keyReleased(GLLibConfig.keycodeLeftSoftkey)}}else{if(e.isPointInRect(0,DEF.SCR_H-K,ag,K)){if(a9==STATE.GAMEPLAY_UPDATE||a9==STATE.MENU_HELP||a9==STATE.MENU_MAP){this.keyPressed(GLLibConfig.keycodeLeftSoftkey);this.keyReleased(GLLibConfig.keycodeLeftSoftkey)}}}if(e.isPointInRect(DEF.SCR_W-ag,DEF.SCR_H+DGUI.MENU_OFFSET_Y-K,ag,K)){this.keyPressed(GLLibConfig.keycodeRightSoftkey);this.keyReleased(GLLibConfig.keycodeRightSoftkey)}}};e.prototype.ClearPointer=function(){a6=-1000;a4=-1000;cg=-1000;ce=-1000};e.isAnyPointPressed=function(){return !(a6==-1000&&a4==-1000)};e.s_isEnemyPointed=false;e._keyAttack=false;e._keyUp=false;e._keyJump=false;e._keyDown=false;e._keyLeft=false;e._keyRight=false;e._keyCrouch=false;var Q=144;var ac=144;var cm=151;var cE=151;var ch=132;var cs=132;var cW=0;var cd=cW+1;var b0=cd+1;var d=b0+1;var ae=d+1;var O=[[DGUI.INTERFACE_DPAD_LEFT_X-Q/2,DGUI.INTERFACE_DPAD_LEFT_Y-ac/2,Q,ac],[DGUI.INTERFACE_DPAD_RIGHT_X-Q/2,DGUI.INTERFACE_DPAD_RIGHT_Y-ac/2,Q,ac],[DGUI.INTERFACE_DPAD_CROUCH_X,DGUI.INTERFACE_DPAD_CROUCH_Y,ch,cs],[DGUI.INTERFACE_DPAD_JUMP_X,DGUI.INTERFACE_DPAD_JUMP_Y,ch,cs],[DGUI.INTERFACE_DPAD_ATTACK_X,DGUI.INTERFACE_DPAD_ATTACK_Y,cm,cE]];e.Pointer_IsInCircle=function(c4,da,c6,c5){var c8=c6*Math.sqrt(2)/2;var c3=c4+c6;var c9=da+c6;if(DEF.dbgEnableTouchBox){g.setColor(16711680);g.drawArc(c4,da,2*c6,2*c6,0,360);g.drawLine(c3-c8,c9+c8,c3+c8,c9-c8);g.drawLine(c3+c8,c9+c8,c3-c8,c9-c8)}var c7=false;switch(c5){case cW:c7=e.Pointer_IsInTriangle(c3,c9,c3-c8,c9+c8,c3-c8,c9-c8);break;case cd:c7=e.Pointer_IsInTriangle(c3,c9,c3+c8,c9+c8,c3+c8,c9-c8);break;case b0:c7=e.Pointer_IsInTriangle(c3,c9,c3-c8,c9+c8,c3+c8,c9+c8);break;case d:c7=e.Pointer_IsInTriangle(c3,c9,c3-c8,c9-c8,c3+c8,c9-c8);break}return c7};e.prototype.UpdatePointerEvents=function(c4){if(c4){if(a9==STATE.GAMEPLAY_UPDATE&&cy==a9){if(DEF.useNewDesign){if(!e.InCinemitic()&&e.Pointer_IsInRect(O[ae])){this.keyPressed(GLLibConfig.keycodeFire);e._keyAttack=true}if(e.InCinemitic()){if(e.Pointer_IsInRect(0,K,DEF.SCR_W,DEF.SCR_H-2*K)){this.keyPressed(GLLibConfig.keycodeFire)}return}var c6=CEntity._hero.CheckFlag(DFlags.REVERSAL_GRAVITY);if(DEF.useDpadWithButtons){if(e.Pointer_IsInRect(O[cW])){this.keyPressed(GLLibConfig.keycodeLeft);e._keyLeft=true}if(e.Pointer_IsInRect(O[cd])){this.keyPressed(GLLibConfig.keycodeRight);e._keyRight=true}}else{if(e.s_pointInCircle){var c8=e.s_pointInCircle[0];if(c8){var db=System.to_clamped_radians(System.angleTo(e.s_dPadX,e.s_dPadY,c8.x,c8.y));var dd=System.distance(e.s_dPadX,e.s_dPadY,c8.x,c8.y);if(dd>10){if(Math.PI*3/8>db||db>Math.PI*13/8){this.keyPressed(GLLibConfig.keycodeRight);e._keyRight=true}if(Math.PI*7/8>db&&db>Math.PI*1/8){this.keyPressed(GLLibConfig.keycodeDown);e._keyDown=true}if(Math.PI*11/8>db&&db>Math.PI*5/8){this.keyPressed(GLLibConfig.keycodeLeft);e._keyLeft=true}if(Math.PI*15/8>db&&db>Math.PI*9/8){this.keyPressed(GLLibConfig.keycodeUp);e._keyUp=true}var c7=c8.x-e.s_dPadX;var c5=c8.y-e.s_dPadY;var c3=DGUI.INTERFACE_DPAD_ACTUAL_H/2;var da=System.distance(0,0,DGUI.INTERFACE_DPAD_ACTUAL_W/2-DGUI.INTERFACE_DPAD_ACTUAL_H/2,DGUI.INTERFACE_DPAD_ACTUAL_H/2);if(db>Math.PI*22/180&&db<Math.PI*158/180){if(c5>c3){c7=c7*c3/c5;c5=c3}}else{if(db>Math.PI*202/180&&db<Math.PI*338/180){if(c5<(-c3)){c7=c7*(-c3)/c5;c5=(-c3)}}else{if((db>Math.PI*158/180&&db<Math.PI*202/180)||(db>Math.PI*338/180||db<Math.PI*22/180)){if(dd>da){c7=c7*da/dd;c5=c5*da/dd}}}}e.s_dPadBallX=DGUI.INTERFACE_DPAD_X+c7;e.s_dPadBallY=DGUI.INTERFACE_DPAD_Y+c5}}}}if(e.Pointer_IsInRect(O[d])){this.keyPressed(GLLibConfig.keycodeUp);e._keyJump=true}if(e.Pointer_IsInRect(O[b0])){this.keyPressed(GLLibConfig.keycodeDown);e._keyCrouch=true}}else{var c9;if(!e.InCinemitic()&&e.isPointInRect((DEF.SCR_W-aN>>1),DEF.SCR_H-P,aN,cA)){this.keyPressed(GLLibConfig.keycodeFire);if(DEF.dbgEnableKey){Dbg("UpdatePointerEvents GAMEPLAY_UPDATE =============================================== ")}e._keyAttack=true}if(e.InCinemitic()||CEntity._hero._subState==DState.SS_HERO_IN_FLY_CANNON){if(e.isPointInRectAbs(0,DEF.useNewDesign?K:0,DEF.SCR_W,DEF.SCR_H-P)){this.keyPressed(GLLibConfig.keycodeFire);if(DEF.dbgEnableKey){Dbg("UpdatePointerEvents GAMEPLAY_UPDATE =============================================== 1")}}return}var c6=CEntity._hero.CheckFlag(DFlags.REVERSAL_GRAVITY);c9=CEntity._hero.GetAbsoluteBox(c6?i:cZ);if(e.s_isEnemyPointed||e.isPointInRectAbs_FixedPoint(c9[0],c9[1],c9[2],c9[3])){if(CEntity.show_hint_Press2){this.keyPressed(GLLibConfig.keycodeUp);CEntity.show_hint_Press2=false}this.keyPressed(GLLibConfig.keycodeFire);e.s_isEnemyPointed=false;if(DEF.dbgEnableKey){Dbg("UpdatePointerEvents GAMEPLAY_UPDATE =============================================== 2")}}else{if(!c6&&e.isPointInRectAbs_FixedPoint(c9[2],c9[1],Math_IntToFixedPoint(DEF.SCR_W)+CEntity._camX,Math_IntToFixedPoint(DEF.SCR_H-P)+CEntity._camY)||c6&&e.isPointInRectAbs_FixedPoint(c9[2],DEF.useNewDesign?(CEntity._camY+Math_IntToFixedPoint(K)):CEntity._camY,Math_IntToFixedPoint(DEF.SCR_W)+CEntity._camX,c9[3])){this.keyPressed(GLLibConfig.keycodeRight);if(DEF.dbgEnableKey){Dbg("UpdatePointerEvents GAMEPLAY_UPDATE =============================================== 3")}}else{if(!c6&&e.isPointInRectAbs_FixedPoint(CEntity._camX,c9[1],c9[0],Math_IntToFixedPoint(DEF.SCR_H-P)+CEntity._camY)||c6&&e.isPointInRectAbs_FixedPoint(CEntity._camX,DEF.useNewDesign?(CEntity._camY+Math_IntToFixedPoint(K)):CEntity._camY,c9[0],c9[3])){this.keyPressed(GLLibConfig.keycodeLeft);if(DEF.dbgEnableKey){Dbg("UpdatePointerEvents GAMEPLAY_UPDATE =============================================== 4")}}else{if(e.isPointInRectAbs_FixedPoint(c9[0],DEF.useNewDesign?(CEntity._camY+Math_IntToFixedPoint(K)):CEntity._camY,c9[2],c9[1])){this.keyPressed(GLLibConfig.keycodeUp);if(DEF.dbgEnableKey){Dbg("UpdatePointerEvents GAMEPLAY_UPDATE =============================================== 5")}}else{if(e.isPointInRectAbs_FixedPoint(c9[0],c9[3],c9[2],Math_IntToFixedPoint(DEF.SCR_H-P)+CEntity._camY)){this.keyPressed(GLLibConfig.keycodeDown);if(DEF.dbgEnableKey){Dbg("UpdatePointerEvents GAMEPLAY_UPDATE =============================================== 6")}}else{if(!c6&&e.isPointInRectAbs_FixedPoint(CEntity._camX,DEF.useNewDesign?(CEntity._camY+Math_IntToFixedPoint(K)):CEntity._camY,c9[0],c9[1])){this.keyPressed(GLKey.k_num1);if(DEF.dbgEnableKey){Dbg("UpdatePointerEvents GAMEPLAY_UPDATE =============================================== 7")}}else{if(!c6&&e.isPointInRectAbs_FixedPoint(c9[2],DEF.useNewDesign?(CEntity._camY+Math_IntToFixedPoint(K)):CEntity._camY,Math_IntToFixedPoint(DEF.SCR_W)+CEntity._camX,c9[1])){this.keyPressed(GLKey.k_num3);if(DEF.dbgEnableKey){Dbg("UpdatePointerEvents GAMEPLAY_UPDATE =============================================== 8")}}else{if(c6&&e.isPointInRectAbs_FixedPoint(CEntity._camX,c9[3],c9[0],Math_IntToFixedPoint(DEF.SCR_H-P)+CEntity._camY)){this.keyPressed(GLKey.k_num7);if(DEF.dbgEnableKey){Dbg("UpdatePointerEvents GAMEPLAY_UPDATE =============================================== 9")}}else{if(c6&&e.isPointInRectAbs_FixedPoint(c9[2],c9[3],Math_IntToFixedPoint(DEF.SCR_W)+CEntity._camX,Math_IntToFixedPoint(DEF.SCR_H-P)+CEntity._camY)){this.keyPressed(GLKey.k_num9);if(DEF.dbgEnableKey){Dbg("UpdatePointerEvents GAMEPLAY_UPDATE =============================================== 10")}}else{if(CEntity._hero._state==DState.STATE_INAIR&&cg-bf>0&&cg>Math_FixedPointToInt(c9[2]-CEntity._camX)){this.keyReleased(GLLibConfig.keycodeLeft);this.keyPressed(GLLibConfig.keycodeRight);if(DEF.dbgEnableKey){Dbg("UpdatePointerEvents GAMEPLAY_UPDATE =============================================== 11")}}else{if(CEntity._hero._state==DState.STATE_INAIR&&cg!=-1000&&cg-bf<0&&cg<Math_FixedPointToInt(c9[0]-CEntity._camX)){this.keyReleased(GLLibConfig.keycodeRight);this.keyPressed(GLLibConfig.keycodeLeft);if(DEF.dbgEnableKey){Dbg("UpdatePointerEvents GAMEPLAY_UPDATE =============================================== 12")}}}}}}}}}}}}}if(e.isAnyPointPressed()){e.UpdateKeyState()}}return}if(a9!=STATE.IGP){this.detectSoftKeys()}switch(a9){case STATE.GAMEPLAY_UPDATE:return;case STATE.ASK_SOUND:if(aK==null&&br!=null){aK=new GLLibPlayer(br,-1000,-1000)}break;case STATE.MENU_MAP:if(e.isPointInRectAbs(0,DEF.useNewDesign?K:0,DEF.SCR_W,DEF.useNewDesign?DEF.SCR_H-K:DEF.SCR_H)){if(e._miniMapState==e.MINI_MAP_STATE_IDLE){e._miniMapCursorX=a6+e._miniMapCameraX;e._miniMapCursorY=a4+e._miniMapCameraY-2*DEF.TILE_H}this.keyPressed(GLLibConfig.keycodeFire)}break;case STATE.GAMEOVER:if(e.isPointInRectAbs(0,0,DEF.SCR_W,DEF.SCR_H+DGUI.MENU_OFFSET_Y*2)){this.keyPressed(GLLibConfig.keycodeFire)}break;case STATE.SPLASH:case STATE.GAME_STATISTIC:case STATE.LOAD_UNLOAD:case STATE.GAMEEND:if(e._isInputEvent){if(aK==null&&br!=null){aK=new GLLibPlayer(br,-1000,-1000)}e._isInputEvent=false;var dc=this._FakegetMousePos(e._eventCallback);a6=dc.x;a4=dc.y;e.PlaySoundBGM()}if(e.isPointInRectAbs(0,0,DEF.SCR_W,DEF.SCR_H+DGUI.MENU_OFFSET_Y*2)){this.keyPressed(GLLibConfig.keycodeFire);this.keyReleased(GLLibConfig.keycodeFire)}break;default:break}if(e.isAnyPointPressed()){e.UpdateKeyState()}};var cy;e.isNeedPaintPointInCircle=false;e.s_pointInCircle=[];e.s_isDPadShowed=0;e.s_dPadTouchIdx=0;e.s_dPadX=DGUI.INTERFACE_DPAD_X;e.s_dPadY=DGUI.INTERFACE_DPAD_Y;e.s_dPadBallX=DGUI.INTERFACE_DPAD_X;e.s_dPadBallY=DGUI.INTERFACE_DPAD_Y;e.checkPaintIndicator=function(){if(a9==STATE.GAMEPLAY_UPDATE&&!e.InCinemitic()&&cy==a9&&CEntity._hero._subState!=DState.SS_HERO_IN_FLY_CANNON&&CEntity._hero._subState!=DState.SS_HERO_END_MINIGAME){return true}return false};e.prototype.RenderPointerEvent=function(){if(a9<0){return}g.setClip(0,0,GLLibConfig.screenWidth,GLLibConfig.screenHeightActual);if(a9==STATE.GAMEPLAY_UPDATE&&!e.InCinemitic()&&cy==a9){if(!DEF.useNewDesign){cL.SetCurrentPalette(1);if(e.isPointInRect((DEF.SCR_W-aN>>1),DEF.SCR_H-P,aN,cA)||(e.isPointHoldInRect((DEF.SCR_W-aN>>1),DEF.SCR_H-P,aN,cA))){br.PaintFrame(g,DAnimID.TOUCHINTERFACE_FRAME_BUTTON,DEF.SCR_W>>1,DEF.SCR_H-P,HCENTER|TOP)}else{br.PaintFrame(g,DAnimID.TOUCHINTERFACE_FRAME_BUTTON_DOWN,DEF.SCR_W>>1,DEF.SCR_H-P,HCENTER|TOP);cL.SetCurrentPalette(0)}cL.DrawString(g,Text_GetString(TEXT.MENU_ATTACK_TS),DEF.SCR_W>>1,DEF.SCR_H-(P)+(cA>>1)+cL.GetCurrentPalette(),GRPH.HCENTER_VCENTER)}else{if(CEntity._hero._subState!=DState.SS_HERO_IN_FLY_CANNON&&CEntity._hero._subState!=DState.SS_HERO_END_MINIGAME){if(e._keyJump){e._interface.PaintFrame(g,DAnimID.INTERFACE_FRAME_DPAD_JUMP_PRESSED,DGUI.INTERFACE_DPAD_JUMP_X,DGUI.INTERFACE_DPAD_JUMP_Y,0)}else{e._interface.PaintFrame(g,DAnimID.INTERFACE_FRAME_DPAD_JUMP,DGUI.INTERFACE_DPAD_JUMP_X,DGUI.INTERFACE_DPAD_JUMP_Y,0)}if(e._keyCrouch){e._interface.PaintFrame(g,DAnimID.INTERFACE_FRAME_DPAD_CROUCH_PRESSED,DGUI.INTERFACE_DPAD_CROUCH_X,DGUI.INTERFACE_DPAD_CROUCH_Y,0)}else{e._interface.PaintFrame(g,DAnimID.INTERFACE_FRAME_DPAD_CROUCH,DGUI.INTERFACE_DPAD_CROUCH_X,DGUI.INTERFACE_DPAD_CROUCH_Y,0)}if(e.s_isDPadShowed==0){e.s_isDPadShowed=1;Dbg("s_isDPadShowed = 1")}if(DEF.useDpadWithButtons){if(e._keyLeft){e._interface.PaintFrame(g,DAnimID.INTERFACE_FRAME_DPAD_LEFT_PRESSED,DGUI.INTERFACE_DPAD_LEFT_X,DGUI.INTERFACE_DPAD_LEFT_Y,0)}else{e._interface.PaintFrame(g,DAnimID.INTERFACE_FRAME_DPAD_LEFT,DGUI.INTERFACE_DPAD_LEFT_X,DGUI.INTERFACE_DPAD_LEFT_Y,0)}if(e._keyRight){e._interface.PaintFrame(g,DAnimID.INTERFACE_FRAME_DPAD_RIGHT_PRESSED,DGUI.INTERFACE_DPAD_RIGHT_X,DGUI.INTERFACE_DPAD_RIGHT_Y,0)}else{e._interface.PaintFrame(g,DAnimID.INTERFACE_FRAME_DPAD_RIGHT,DGUI.INTERFACE_DPAD_RIGHT_X,DGUI.INTERFACE_DPAD_RIGHT_Y,0)}}else{e._interface.PaintFrame(g,DAnimID.INTERFACE_FRAME_DPAD,DGUI.INTERFACE_DPAD_X,DGUI.INTERFACE_DPAD_Y,0);if(e._keyLeft||e._keyRight||e._keyDown||e._keyUp){e._interface.PaintFrame(g,DAnimID.INTERFACE_FRAME_DPAD_BALL,e.s_dPadBallX,e.s_dPadBallY,0)}else{e._interface.PaintFrame(g,DAnimID.INTERFACE_FRAME_DPAD_BALL,DGUI.INTERFACE_DPAD_X,DGUI.INTERFACE_DPAD_Y,0)}}}if(e._keyAttack){e._interface.PaintFrame(g,DAnimID.INTERFACE_FRAME_DPAD_ATTACK_PRESSED,DGUI.INTERFACE_DPAD_ATTACK_X,DGUI.INTERFACE_DPAD_ATTACK_Y,0)}else{e._interface.PaintFrame(g,DAnimID.INTERFACE_FRAME_DPAD_ATTACK,DGUI.INTERFACE_DPAD_ATTACK_X,DGUI.INTERFACE_DPAD_ATTACK_Y,0)}}}cy=a9;if(aK!=null){if(DEF.useNewDesign&&a9==STATE.GAMEPLAY_UPDATE){return}if(e.isAnyPointPressed()){aK.SetPos(a6,a4);aK.SetAnim(DAnimID.TOUCHINTERFACE_WAVE_TAP,1);aK.Render()}else{if(!aK.IsAnimOver()){aK.Update(s_game_frameDT);aK.Render()}}}};e.UpdateKeyState=function(){if(GLLibConfig.useKeyAccumulation){for(var c3=0;c3<s_nbKey;c3++){if(s_keyStateRT[c3]<0){s_keyState[c3]=s_keyStateRT[c3]}}}else{}};var ag=60*DScreen.RATIO;var K=23*DScreen.RATIO;var A=30*DScreen.RATIO;var P=K;var aN=120*DScreen.RATIO;var cA=20*DScreen.RATIO;var W=25*DScreen.RATIO;var bA=DEF.SCR_W-(aM<<1);var cl=-3*DScreen.RATIO;var cZ=[Math_IntToFixedPoint(-20*DScreen.RATIO),Math_IntToFixedPoint(-40*DScreen.RATIO),Math_IntToFixedPoint(20*DScreen.RATIO),Math_IntToFixedPoint(10*DScreen.RATIO)];var i=[cZ[0],cZ[3],cZ[2],-cZ[1]];e.TOUCH_ENEMY_BOUNDING_OFFSET=Math_IntToFixedPoint(20);e.prototype.setState=function(c3){ah=c3;X=aQ.SET;ResetKey()};e.prototype.setOnlineSubstate=function(c3){X=c3};e.prototype.OnlineTypeinData=function(c5,c4,da,c6,db,c9,c7){try{var c3=null;if(s_keyState[GLKey.k_menuOK]>0){if(0!=c6){setState(c6)}if(0!=db){setOnlineSubstate(db)}aD="";cn=0}if(bj){c7.setColor(0,0,0);c7.fillRect(0,0,c7.getClipWidth(),c7.getClipHeight())}c7.setColor(208,80,80);e.txtDraw(0,c5,3,10,Graphics.LEFT|Graphics.TOP);e.txtDraw(0,c4,3,20,Graphics.LEFT|Graphics.TOP);bj=false;bj=WasAnyKeyReleased()>=0;if((0!=cn)&&(c9>aD.length)){e.txtDraw(0,aD+cn,3,50,Graphics.LEFT|Graphics.TOP)}else{e.txtDraw(0,aD,3,50,Graphics.LEFT|Graphics.TOP)}if(((s_keyState[GLKey.k_menuBack]>0))&&(2<aD.length)){if((0!=cn)&&(c9>aD.length)){aD=aD+cn}c3=aD;bj=true;aD="";cn=0}if((bG=WasAnyKeyReleased())>=0){if((bG>=GLKey.k_num0)&&(bG<=GLKey.k_num9)){bG-=GLKey.k_num0;if((!da)||(bG==0)){if(bG!=au){if((0!=cn)&&(c9>aD.length)){aD=aD+cn}cw=0;cn=keymap[bG][cw];T=System.currentTimeMillis();au=bG}else{if((System.currentTimeMillis()-T)>1000){if((0!=cn)&&(c9>aD.length)){aD=aD+cn}cw=0;cn=keymap[bG][cw];T=System.currentTimeMillis();au=bG}else{cw=((cw+1)%keymap[bG].length);cn=keymap[bG][cw];T=System.currentTimeMillis();au=bG}}}else{if(bG!=au){if((0!=cn)&&(c9>aD.length)){aD=aD+cn}}cw=(keymap[bG].length-1);cn=keymap[bG][cw];T=System.currentTimeMillis();au=bG;if((0!=cn)&&(c9>aD.length)){aD=aD+cn}cn=0;cw=0}}else{if((s_keyState[GLKey.k_star]>0)){if(aD.length>0){cn=aD.charAt(aD.length-1);aD=aD.substring(0,aD.length-1)}else{if(cn!=0){cn=0}else{c3=""}}}}bG=0}return c3}catch(c8){if(DEF.dbgEnable){Dbg("-------------------- error : "+c8.message)}return null}};e.prototype.drawOnline=function(c4){try{var c3=null;var c6="";c4.setColor(0,0,0);c4.fillRect(0,0,c4.getClipWidth(),c4.getClipHeight());c4.setColor(208,80,80);if(ah>=c2.TEST_LOGIN&&ah<=c2.TEST_RECOMMENDGAME&&X!=aQ.DISPLAY){c3=Text_GetString(TEXT.MENU_XPLAYER_PLEASE_WAIT);e.txtDraw(0,c3,c4.getClipWidth()/2,c4.getClipHeight()/2,Graphics.TOP|Graphics.HCENTER);e.txtDraw(0,Text_GetString(TEXT.MENU_XPLAYER_CANCEL),1,c4.getClipHeight()-1,Graphics.BOTTOM|Graphics.LEFT);return}switch(ah){case c2.INIT:DrawOnlineState_INIT(c4);break;case c2.MENU:DrawOnlineState_MENU(c4);break;case c2.TEST_ARENA:DrawOnlineState_TEST_ARENA(c4);break;case c2.TEST_REGISTER:DrawOnlineState_TEST_REGISTER(c4);break;case c2.TEST_NICK_TAKEN:DrawOnlineState_TEST_NICK_TAKEN(c4);break;case c2.TEST_LOGIN:DrawOnlineState_TEST_LOGIN(c4);break;case c2.TEST_SENDINGSCORE:DrawOnlineState_TEST_SENDINGSCORE(c4);break;case c2.TEST_GETRANK:DrawOnlineState_TEST_GETRANK(c4);break;case c2.TEST_GETRANK_AROUND_PLAYER:DrawOnlineState_TEST_GETRANK_AROUND_PLAYER(c4);break;case c2.TEST_DISPLAY_GAME_RATINGS:DrawOnlineState_TEST_DISPLAY_GAME_RATINGS(c4);break;case c2.TEST_RATEGAME:DrawOnlineState_TEST_RATEGAME(c4);break;case c2.TEST_RECOMMENDGAME:DrawOnlineState_TEST_RECOMMENDGAME(c4);break;case c2.TEST_CONNECTION_ERROR:DrawOnlineState_TEST_CONNECTION_ERROR(c4);break;case c2.TEST_SERVER_ERROR:DrawOnlineState_TEST_SERVER_ERROR(c4);break;case c2.ENDED:break}}catch(c5){if(DEF.dbgEnable){Dbg("-------------------- error : "+c5.message)}}};e.prototype.DrawOnlineState_INIT=function(c3){setState(c2.TEST_LOGIN);a7=true};e.prototype.DrawOnlineState_MENU=function(c4){var c3=null;e.txtDraw(0,Text_GetString(TEXT.MENU_XPLAYER_MAIN_MENU),c4.getClipWidth()/2,c4.getClipHeight()/4,Graphics.TOP|Graphics.HCENTER);c4.setColor(192,176,0);c3=Text_GetString(bH[bF]);if(bF>0){c3="<- "+c3}if(bF<E-1){c3=c3+" ->"}e.txtDraw(0,c3,c4.getClipWidth()/2,c4.getClipHeight()/2,Graphics.TOP|Graphics.HCENTER);e.txtDraw(0,Text_GetString(TEXT.MENU_XPLAYER_PRESS_5),c4.getClipWidth()/2,c4.getClipHeight()-1,Graphics.BOTTOM|Graphics.HCENTER)};e.prototype.DrawOnlineState_TEST_ARENA=function(c5){var c3=null;e.txtDraw(0,Text_GetString(TEXT.MENU_XPLAYER_ONLINE_MENU),c5.getClipWidth()/2,10,Graphics.TOP|Graphics.HCENTER);if(!(GLLibConfig.xplayer_CARRIER_USSPRINT|GLLibConfig.xplayer_CARRIER_USCINGULAR_ORANGE|GLLibConfig.xplayer_CARRIER_USCINGULAR_BLUE|GLLibConfig.xplayer_CARRIER_USNEXTEL|GLLibConfig.xplayer_CARRIER_USVIRGIN)){bq=3}for(var c4=0;c4<bq;c4++){c3=Text_GetString(bB[c4]);if(cB==c4){c3+="*"}e.txtDraw(0,c3,c5.getClipWidth()/2,30+c4*15,Graphics.TOP|Graphics.HCENTER)}e.txtDraw(0,Text_GetString(TEXT.MENU_XPLAYER_CANCEL),1,c5.getClipHeight()-1,Graphics.BOTTOM|Graphics.LEFT)};e.prototype.DrawOnlineState_TEST_REGISTER=function(c4){var c5=interactiv.getUsername();if(c5.length==0){c5=OnlineTypeinData(Text_GetString(TEXT.MENU_XPLAYER_ENTER_YOUR_USERNAME),Text_GetString(TEXT.MENU_XPLAYER_MAX_15_CHARACTERS),false,c2.MENU,0,15,c4);if((c5!=null)&&(c5.length>0)){T=0;au=0;cw=0;cn=0;interactiv.setUsername(c5)}}else{var c3=OnlineTypeinData(Text_GetString(TEXT.MENU_XPLAYER_ENTER_YOUR_PHONE_NUMBER),Text_GetString(TEXT.MENU_XPLAYER_10_CHARS),true,c2.MENU,0,10,c4);if((c3!=null)&&(c3.length>0)){T=0;au=0;cw=0;cn=0;interactiv.setPhoneNumber(c3);this.setState(c2.TEST_LOGIN)}}e.txtDraw(0,Text_GetString(TEXT.MENU_XPLAYER_PRESS_STAR_TO_DELETE),c4.getClipWidth()/2,c4.getClipHeight()*2/3,Graphics.HCENTER|Graphics.HCENTER);e.txtDraw(0,Text_GetString(TEXT.MENU_XPLAYER_CANCEL),1,c4.getClipHeight()-1,Graphics.BOTTOM|Graphics.LEFT);e.txtDraw(0,Text_GetString(TEXT.MENU_XPLAYER_OK),c4.getClipWidth()-1,c4.getClipHeight()-1,Graphics.BOTTOM|Graphics.RIGHT)};e.prototype.DrawOnlineState_TEST_NICK_TAKEN=function(c3){var c4=interactiv.getUsername();if(c4.length==0){c4=OnlineTypeinData(Text_GetString(TEXT.MENU_XPLAYER_NICK_TAKEN),Text_GetString(TEXT.MENU_XPLAYER_MAX_15_CHARACTERS),false,c2.MENU,0,15,c3);if((c4!=null)&&(c4.length>0)){T=0;au=0;cw=0;cn=0;interactiv.setUsername(c4);this.setState(c2.TEST_LOGIN)}}e.txtDraw(0,Text_GetString(TEXT.MENU_XPLAYER_CANCEL),1,c3.getClipHeight()-1,Graphics.BOTTOM|Graphics.LEFT);e.txtDraw(0,Text_GetString(TEXT.MENU_XPLAYER_OK),c3.getClipWidth()-1,c3.getClipHeight()-1,Graphics.BOTTOM|Graphics.RIGHT)};e.prototype.DrawOnlineState_TEST_LOGIN=function(c3){if(interactiv.isLoggedIn()){e.txtDraw(0,Text_GetString(TEXT.MENU_XPLAYER_WELCOME)+" "+interactiv.getUsername(),c3.getClipWidth()/2,c3.getClipHeight()/2,Graphics.TOP|Graphics.HCENTER);e.txtDraw(0,Text_GetString(TEXT.MENU_XPLAYER_PRESS_5),c3.getClipWidth()/2,c3.getClipHeight()/2+10,Graphics.TOP|Graphics.HCENTER);e.txtDraw(0,Text_GetString(TEXT.MENU_XPLAYER_CANCEL),1,c3.getClipHeight()-1,Graphics.BOTTOM|Graphics.LEFT)}};e.prototype.DrawOnlineState_TEST_SENDINGSCORE=function(c3){var c4="";e.txtDraw(0,Text_GetString(TEXT.MENU_XPLAYER_PRESS_5),c3.getClipWidth()/2,c3.getClipHeight()-1,Graphics.BOTTOM|Graphics.HCENTER);c4=Text_GetString(TEXT.MENU_XPLAYER_NEW_RANK)+": "+interactiv.getNewRankAfterScoreSending();e.txtDraw(0,c4,10,c3.getClipHeight()>>1,0)};e.prototype.DrawOnlineState_TEST_GETRANK=function(db){var da="";e.txtDraw(0,Text_GetString(TEXT.MENU_XPLAYER_PRESS_5),db.getClipWidth()/2,db.getClipHeight()-1,Graphics.BOTTOM|Graphics.HCENTER);var c8;if(USE_CONDENSED_VERSION){var dd=interactiv.getLeaderboardSize();var dc=LowAPI.Gen_Array([dd],null);var c9=LowAPI.Gen_Array([dd],0);var c6=LowAPI.Gen_Array([dd],0);var c5=LowAPI.Gen_Array([dd],0);if(interactiv.getLeaderboardData(dc,c9,c6,c5)==false){return}for(var c3=0;c3<dd;c3++){c8=""+c9[c3]+": "+dc[c3]+" "+c6[c3];if(c5!=null){var c4=c5[c3];if(c4!=null){for(var c7=0;c7<c4.length;c7++){c8+=" "+c4[c7]}}}da=c8;e.txtDraw(0,da,30,30+c3*14,0)}}else{for(var c3=0;c3<interactiv.getLeaderboardSize();c3++){c8=""+interactiv.getLeaderboardEntryPlayerPosition(c3)+": "+interactiv.getLeaderboardEntryPlayerName(c3)+" "+interactiv.getLeaderboardEntryPlayerScore(c3);var c4=interactiv.getLeaderboardEntryPlayerScoreData(c3);if(c4!=null){for(var c7=0;c7<c4.length;c7++){c8+=" "+c4[c7]}}da=c8;e.txtDraw(0,da,30,30+c3*14,0)}}if(interactiv.getCurrentPlayerLeaderboardPosition()>0){c8=Text_GetString(TEXT.MENU_XPLAYER_YOU)+":"+interactiv.getCurrentPlayerLeaderboardPosition()+" "+interactiv.getCurrentPlayerLeaderboardScore();var c4=interactiv.getCurrentPlayerLeaderboardScoreData();if(c4!=null){for(var c7=0;c7<c4.length;c7++){c8+=" "+c4[c7]}}e.txtDraw(0,c8,0,20,0)}};e.prototype.DrawOnlineState_TEST_GETRANK_AROUND_PLAYER=function(db){var da="";e.txtDraw(0,Text_GetString(TEXT.MENU_XPLAYER_PRESS_5),db.getClipWidth()/2,db.getClipHeight()-1,Graphics.BOTTOM|Graphics.HCENTER);var c8;if(interactiv.getLeaderboardSize()<=0){c8=Text_GetString(TEXT.MENU_XPLAYER_NO_SCORE_SENT);da=c8;e.txtDraw(0,da,30,50,0);return}if(USE_CONDENSED_VERSION){var dd=interactiv.getLeaderboardSize();var dc=LowAPI.Gen_Array([dd],null);var c9=LowAPI.Gen_Array([dd],0);var c6=LowAPI.Gen_Array([dd],0);var c5=LowAPI.Gen_Array([dd],null);if(interactiv.getLeaderboardData(dc,c9,c6,c5)==false){return}for(var c3=0;c3<dd;c3++){c8=""+c9[c3]+": "+dc[c3]+" "+c6[c3];if(c5!=null){var c4=c5[c3];if(c4!=null){for(var c7=0;c7<c4.length;c7++){c8+=" "+c4[c7]}}}if(dc[c3].compareTo(interactiv.getUsername())==0){db.setColor(192,176,0)}else{db.setColor(208,80,80)}da=c8;e.txtDraw(0,da,30,30+c3*14,0)}}else{for(var c3=0;c3<interactiv.getLeaderboardSize();c3++){c8=""+interactiv.getLeaderboardEntryPlayerPosition(c3)+": "+interactiv.getLeaderboardEntryPlayerName(c3)+" "+interactiv.getLeaderboardEntryPlayerScore(c3);var c4=interactiv.getLeaderboardEntryPlayerScoreData(c3);if(c4!=null){for(var c7=0;c7<c4.length;c7++){c8+=" "+c4[c7]}}if((interactiv.getLeaderboardEntryPlayerName(c3)).compareTo(interactiv.getUsername())==0){db.setColor(192,176,0)}else{db.setColor(208,80,80)}da=c8;e.txtDraw(0,da,30,30+c3*14,0)}}};e.prototype.DrawOnlineState_TEST_DISPLAY_GAME_RATINGS=function(c4){for(var c3=aY;c3>0;c3--){if(aY-ca==c3){c4.setColor(13696768)}else{c4.setColor(13652048)}e.txtDraw(0,""+c3+" - "+cb[c3-1],c4.getClipWidth()/2,20+(aY-c3)*10,Graphics.TOP|Graphics.HCENTER)}c4.setColor(13652048);e.txtDraw(0,Text_GetString(TEXT.MENU_XPLAYER_CANCEL),1,c4.getClipHeight()-1,Graphics.BOTTOM|Graphics.LEFT);e.txtDraw(0,Text_GetString(TEXT.MENU_XPLAYER_OK),c4.getClipWidth()-1,c4.getClipHeight()-1,Graphics.BOTTOM|Graphics.RIGHT)};e.prototype.DrawOnlineState_TEST_RATEGAME=function(c3){var c4="";e.txtDraw(0,Text_GetString(TEXT.MENU_XPLAYER_PRESS_5),c3.getClipWidth()/2,c3.getClipHeight()-1,Graphics.BOTTOM|Graphics.HCENTER);c4=Text_GetString(TEXT.MENU_XPLAYER_RATING_SENT);e.txtDraw(0,c4,5,c3.getClipHeight()>>1,0)};e.prototype.DrawOnlineState_TEST_RECOMMENDGAME=function(c3){var c4="";e.txtDraw(0,Text_GetString(TEXT.MENU_XPLAYER_PRESS_5),c3.getClipWidth()/2,c3.getClipHeight()-1,Graphics.BOTTOM|Graphics.HCENTER);c4=Text_GetString(TEXT.MENU_XPLAYER_RECOMMENDATION_SENT);e.txtDraw(0,c4,5,c3.getClipHeight()>>1,0)};e.prototype.DrawOnlineState_TEST_CONNECTION_ERROR=function(c3){var c4="";c3.setColor(0);c3.fillRect(0,0,c3.getClipWidth(),c3.getClipHeight());c3.setColor(13652048);c4=Text_GetString(TEXT.MENU_XPLAYER_CONNECTION_ERROR);e.txtDraw(0,c4,10,c3.getClipHeight()>>1,0);e.txtDraw(0,Text_GetString(TEXT.MENU_XPLAYER_OK),c3.getClipWidth()-1,c3.getClipHeight()-1,Graphics.BOTTOM|Graphics.RIGHT)};e.prototype.DrawOnlineState_TEST_SERVER_ERROR=function(c3){var c4="";c3.setColor(0);c3.fillRect(0,0,c3.getClipWidth(),c3.getClipHeight());c3.setColor(13652048);c4=Text_GetString(TEXT.MENU_XPLAYER_SERVER_ERROR_NR)+":"+interactiv.getLastError();e.txtDraw(0,c4,10,c3.getClipHeight()>>1,0);e.txtDraw(0,Text_GetString(TEXT.MENU_XPLAYER_OK),c3.getClipWidth()-1,c3.getClipHeight()-1,Graphics.BOTTOM|Graphics.RIGHT)};e.prototype.updateOnline=function(){switch(ah){case c2.INIT:break;case c2.MENU:UpdateOnlineState_MENU();break;case c2.TEST_LOGIN:UpdateOnlineState_TEST_LOGIN();break;case c2.TEST_ARENA:UpdateOnlineState_TEST_ARENA();break;case c2.TEST_SENDINGSCORE:UpdateOnlineState_TEST_SENDINGSCORE();break;case c2.TEST_GETRANK:UpdateOnlineState_TEST_GETRANK();break;case c2.TEST_GETRANK_AROUND_PLAYER:UpdateOnlineState_TEST_GETRANK_AROUND_PLAYER();break;case c2.TEST_DISPLAY_GAME_RATINGS:UpdateOnlineState_TEST_DISPLAY_GAME_RATINGS();break;case c2.TEST_RATEGAME:UpdateOnlineState_TEST_RATEGAME();break;case c2.TEST_RECOMMENDGAME:UpdateOnlineState_TEST_RECOMMENDGAME();break;case c2.TEST_CONNECTION_ERROR:UpdateOnlineState_TEST_CONNECTION_ERROR();break;case c2.TEST_SERVER_ERROR:UpdateOnlineState_TEST_SERVER_ERROR();break;case c2.ENDED:UpdateOnlineState_ENDED();break}};e.prototype.UpdateOnlineState_MENU=function(){if((s_keyState[GLKey.k_left]>0)){if(bF>0){bF--}}else{if((s_keyState[GLKey.k_right]>0)){if(bF<E-1){bF++}}else{if(s_keyState[GLKey.k_fire]>0){switch(bF){case MENU_STATE_TEST_ARENA:if(interactiv==null){if(DEF.dbgEnable){Dbg("make sure xplayer is here")}interactiv=new XPlayer(s_application)}if(interactiv.isLoggedIn()){this.setState(c2.TEST_ARENA);break}a7=false;setState(c2.TEST_LOGIN);break;case MENU_STATE_EXIT:ah=c2.ENDED;break}}else{if((s_keyState[GLKey.k_menuOK]>0)||(s_keyState[GLKey.k_num3]>0)){interactiv.cancel();ah=c2.ENDED}}}}};e.prototype.UpdateOnlineState_TEST_LOGIN=function(){switch(X){case aQ.SET:if(DEF.dbgEnable){Dbg("Xplayer is "+interactiv)}interactiv.sendLogin(null);this.setOnlineSubstate(aQ.WAIT);break;case aQ.WAIT:if(s_keyState[GLKey.k_menuOK]>0){interactiv.cancel();interactiv.setUsername("");interactiv.setPhoneNumber("");this.setState(c2.MENU)}interactiv.handleLogin();N=interactiv.getLastError();if(N!=XPlayer.Error.ERROR_PENDING){interactiv.cleanup();this.setOnlineSubstate(aQ.PROCESS)}break;case aQ.PROCESS:switch(N){case XPlayer.Error.ERROR_NONE:this.setOnlineSubstate(aQ.DISPLAY);break;case XPlayer.Error.ERROR_NICK_TAKEN:aD=interactiv.getUsername();interactiv.setUsername("");this.setState(c2.TEST_NICK_TAKEN);bG=0;break;case XPlayer.Error.ERROR_REGISTER_FAILED:case XPlayer.Error.ERROR_NO_NICKNAME:case XPlayer.Error.ERROR_NO_PHONE_NUMBER:interactiv.setUsername("");interactiv.setPhoneNumber("");this.setState(c2.TEST_REGISTER);bG=-1;break;case XPlayer.Error.ERROR_CONNECTION:this.setState(c2.TEST_CONNECTION_ERROR);break;default:this.setState(c2.TEST_SERVER_ERROR);break}break;case aQ.DISPLAY:if(s_keyState[GLKey.k_fire]>0){this.setState(c2.TEST_ARENA)}else{if(s_keyState[GLKey.k_menuOK]>0){this.setState(c2.MENU)}}break}};e.prototype.UpdateOnlineState_TEST_ARENA=function(){if(s_keyState[GLKey.k_menuOK]>0){interactiv.cancel();ah=c2.MENU}else{if(s_keyState[GLKey.k_up]>0){if(cB>0){cB--}}else{if(s_keyState[GLKey.k_down]>0){if(cB<bq-1){cB++}}else{if(s_keyState[GLKey.k_fire]>0){switch(cB){case 0:this.setState(c2.TEST_SENDINGSCORE);break;case 1:this.setState(c2.TEST_GETRANK);break;case 2:this.setState(c2.TEST_GETRANK_AROUND_PLAYER);break;case 3:this.setState(c2.TEST_DISPLAY_GAME_RATINGS);break;case 4:this.setState(c2.TEST_RECOMMENDGAME);break;case 5:ah=c2.ENDED;break;default:break}}}}}};e.prototype.UpdateOnlineState_TEST_SENDINGSCORE=function(){switch(X){case aQ.SET:switch(currentScoreSendingPolicy){case bU.SINGLE_SCORE:interactiv.sendHighscore(500,0,XPlayer.SCORE_TYPE_POINTS);this.setOnlineSubstate(aQ.WAIT);break;case bU.SINGLE_SCORE_SUPPLEMENTAL_DATA:var c3=LowAPI.Gen_Array([1],0);c3[0]=56;interactiv.sendHighscoreWithSupplementalData(600,0,XPlayer.SCORE_TYPE_POINTS,c3);this.setOnlineSubstate(aQ.WAIT);break;case bU.MULTIPLE_SCORE:interactiv.initMultipleScores();interactiv.addMultipleScoreEntry(600,0,XPlayer.SCORE_TYPE_POINTS);interactiv.addMultipleScoreEntry(700,1,XPlayer.SCORE_TYPE_POINTS);interactiv.sendMultipleHighscores();this.setOnlineSubstate(aQ.WAIT);break;case bU.MULTIPLE_SCORE_SUPPLEMENTAL_DATA:interactiv.initMultipleScores();var c3=LowAPI.Gen_Array([1],0);c3[0]=1000;interactiv.addMultipleScoreEntryWithSupplementalData(600,0,XPlayer.SCORE_TYPE_POINTS,c3);c3[0]=1100;interactiv.addMultipleScoreEntryWithSupplementalData(700,1,XPlayer.SCORE_TYPE_POINTS,c3);interactiv.sendMultipleHighscores();this.setOnlineSubstate(aQ.WAIT);break}case aQ.WAIT:if(s_keyState[GLKey.k_fire]>0){interactiv.cancel();this.setState(c2.TEST_ARENA)}interactiv.handleHighscore();N=interactiv.getLastError();if(N!=XPlayer.Error.ERROR_PENDING){interactiv.cleanup();this.setOnlineSubstate(aQ.PROCESS)}break;case aQ.PROCESS:switch(N){case XPlayer.Error.ERROR_NONE:this.setOnlineSubstate(aQ.DISPLAY);break;case XPlayer.Error.ERROR_CONNECTION:this.setState(c2.TEST_CONNECTION_ERROR);break;default:this.setState(c2.TEST_SERVER_ERROR);break}break;case aQ.DISPLAY:if(s_keyState[GLKey.k_fire]>0){this.setState(c2.TEST_ARENA)}break}};e.prototype.UpdateOnlineState_TEST_GETRANK=function(){switch(X){case aQ.SET:interactiv.sendRankGet(0,10,1,2);this.setOnlineSubstate(aQ.WAIT);break;case aQ.WAIT:if(s_keyState[GLKey.k_menuOK]>0){interactiv.cancel();this.setState(c2.TEST_ARENA)}interactiv.handleRankGet();N=interactiv.getLastError();if(N!=XPlayer.Error.ERROR_PENDING){interactiv.cleanup();this.setOnlineSubstate(aQ.PROCESS)}break;case aQ.PROCESS:switch(N){case XPlayer.Error.ERROR_NONE:this.setOnlineSubstate(aQ.DISPLAY);break;case XPlayer.Error.ERROR_CONNECTION:this.setState(c2.TEST_CONNECTION_ERROR);break;default:this.setState(c2.TEST_SERVER_ERROR);break}break;case aQ.DISPLAY:if(s_keyState[GLKey.k_fire]>0){this.setState(c2.TEST_ARENA)}break}};e.prototype.UpdateOnlineState_TEST_GETRANK_AROUND_PLAYER=function(){switch(X){case aQ.SET:interactiv.sendRankGetAroundPlayer(0,3,1,2);this.setOnlineSubstate(aQ.WAIT);break;case aQ.WAIT:if(s_keyState[GLKey.k_menuOK]>0){interactiv.cancel();this.setState(c2.TEST_ARENA)}interactiv.handleRankGetAroundPlayer();N=interactiv.getLastError();if(N!=XPlayer.Error.ERROR_PENDING){interactiv.cleanup();this.setOnlineSubstate(aQ.PROCESS)}break;case aQ.PROCESS:switch(N){case XPlayer.Error.ERROR_NONE:this.setOnlineSubstate(aQ.DISPLAY);break;case XPlayer.Error.ERROR_CONNECTION:this.setState(c2.TEST_CONNECTION_ERROR);break;default:this.setState(c2.TEST_SERVER_ERROR);break}break;case aQ.DISPLAY:if((s_keyState[GLKey.k_fire]>0)){this.setState(c2.TEST_ARENA)}break}};e.prototype.UpdateOnlineState_TEST_DISPLAY_GAME_RATINGS=function(){if(s_keyState[GLKey.k_up]>0){if(ca>0){ca--}}else{if(s_keyState[GLKey.k_down]>0){if(ca<aY-1){ca++}}else{if(s_keyState[GLKey.k_fire]>0){this.setState(c2.TEST_RATEGAME)}else{if(s_keyState[GLKey.k_fire]>0){this.setState(c2.TEST_ARENA)}}}}};e.prototype.UpdateOnlineState_TEST_RATEGAME=function(){switch(X){case aQ.SET:interactiv.sendRateGame(aY-ca);this.setOnlineSubstate(aQ.WAIT);break;case aQ.WAIT:if(s_keyState[GLKey.k_menuOK]>0){interactiv.cancel();this.setState(c2.TEST_ARENA)}interactiv.handleRateGame();N=interactiv.getLastError();if(N!=XPlayer.Error.ERROR_PENDING){interactiv.cleanup();this.setOnlineSubstate(aQ.PROCESS)}break;case aQ.PROCESS:switch(N){case XPlayer.Error.ERROR_NONE:this.setOnlineSubstate(aQ.DISPLAY);break;case XPlayer.Error.ERROR_CONNECTION:this.setState(c2.TEST_CONNECTION_ERROR);break;default:this.setState(c2.TEST_SERVER_ERROR);break}break;case aQ.DISPLAY:if(s_keyState[GLKey.k_fire]>0){this.setState(c2.TEST_ARENA)}break}};e.prototype.UpdateOnlineState_TEST_RECOMMENDGAME=function(){switch(X){case aQ.SET:interactiv.sendRecommendGame();this.setOnlineSubstate(aQ.WAIT);break;case aQ.WAIT:if(s_keyState[GLKey.k_menuOK]>0){interactiv.cancel();this.setState(c2.TEST_ARENA)}interactiv.handleRecommendGame();N=interactiv.getLastError();if(N!=XPlayer.Error.ERROR_PENDING){interactiv.cleanup();this.setOnlineSubstate(aQ.PROCESS)}break;case aQ.PROCESS:switch(N){case XPlayer.Error.ERROR_NONE:this.setOnlineSubstate(aQ.DISPLAY);break;case XPlayer.Error.ERROR_CONNECTION:this.setState(c2.TEST_CONNECTION_ERROR);break;default:this.setState(c2.TEST_SERVER_ERROR);break}break;case aQ.DISPLAY:if(s_keyState[GLKey.k_fire]>0){this.setState(c2.TEST_ARENA)}break}};e.prototype.UpdateOnlineState_TEST_CONNECTION_ERROR=function(){UpdateOnlineState_TEST_SERVER_ERROR()};e.prototype.UpdateOnlineState_TEST_SERVER_ERROR=function(){if(s_keyState[GLKey.k_fire]>0){if(interactiv.isLoggedIn()){ah=c2.TEST_ARENA}else{ah=c2.MENU}}};e.prototype.UpdateOnlineState_ENDED=function(){a9=STATE.GAMEPLAY_UPDATE};e.prototype.gameDraw=function(){SetClip(0,0,GLLibConfig.screenWidth,GLLibConfig.screenHeight);if(e._inCinematicBlackScreen){FillRect(0,0,GLLibConfig.screenWidth,GLLibConfig.screenHeight)}else{CEntity.DrawAll(-1);CEntity.DrawRender(-1);this.DrawTextBubble()}if(GLLibConfig.screenHeightActual>GLLibConfig.screenHeight){SetClip(0,0,GLLibConfig.screenWidth,GLLibConfig.screenHeightActual);br.PaintFrame(g,DAnimID.TOUCHINTERFACE_FRAME_DPAD_BACKGROUND,DEF.SCR_W>>1,DEF.SCR_H,0)}};e.TEXT_BUBBLE_OVER=0;e.TEXT_BUBBLE_OPEN=1;e.TEXT_BUBBLE_TEXT=2;e.TEXT_BUBBLE_CLOSE=3;e._textBubbleState=e.TEXT_BUBBLE_OVER;e._textBubbleTime=0;e._textBubbleCurrentLine=0;e._textBubbleX=0;e._textBubbleY=0;e._textBubbleText=0;e._textBubbleCinematicID=0;e._textBubbleBigOne=false;e._textBubbleCurrentCursor=-1;e.StartTextBubble=function(c4,c3,c6,c5){e._textBubbleState=e.TEXT_BUBBLE_OPEN;e._textBubbleX=c3;e._textBubbleY=c6;e._textBubbleText=c5;e._textBubbleCinematicID=c4;e._textBubbleTime=0;e._textBubbleCurrentLine=0;e._textBubbleCurrentCursor=0};e.TEXT_BUBBLE_TEXT_LINE_COUNT=2;e.TEXT_BUBBLE_TEXT_ENTITY_HEIGHT=60*DScreen.RATIO;e.TEXT_BUBBLE_TEXT_ENTITY_OFFSET_X=20;e.prototype.DrawTextBubble=function(){if(e._textBubbleState==e.TEXT_BUBBLE_OVER){return true}var c9=CEntity._camX;var c8=CEntity._camY;var dj=false;if(e._textBubbleCinematicID<0){dj=true}if(dj){c9=Math_IntToFixedPoint(e._miniMapCameraX);c8=Math_IntToFixedPoint(e._miniMapCameraY+e.MINI_MAP_OFFSET_Y)}var dg=DEF.VIEW_W_D2;var de=Math_FixedPointToInt(e._textBubbleY-c8);var c6=0;var di=e.TEXT_BUBBLE_TEXT_LINE_COUNT;if(e._textBubbleBigOne){de=DEF.VIEW_H_D2;di+=1}else{c6=e._textBubbleX<c9+DEF.VIEW_W_D2_FLOAT?0:DFlags.FLIP_X;dg+=(c6&DFlags.FLIP_X)!=0?e.TEXT_BUBBLE_TEXT_ENTITY_OFFSET_X:-e.TEXT_BUBBLE_TEXT_ENTITY_OFFSET_X;if(!dj){c6|=e._textBubbleY<c8+DEF.VIEW_H_D2_FLOAT?DFlags.FLIP_Y:0}de+=(c6&DFlags.FLIP_Y)!=0?e.TEXT_BUBBLE_TEXT_ENTITY_HEIGHT>>2:-e.TEXT_BUBBLE_TEXT_ENTITY_HEIGHT}var dh=Text_GetString(e._textBubbleText);var c4=e.spriteArray[DSpriteID.HINT];var c7=e._textBubbleTime++;var db=DAnimID.HINT_DIALOG_POP_OUT;var c3=DAnimID.HINT_DIALOG_DISPLAY;var dd=DAnimID.HINT_DIALOG_POP_IN;if(e._textBubbleX>c9+DEF.VIEW_W_D2_FLOAT/2&&e._textBubbleX<c9+DEF.VIEW_W_D2_FLOAT+DEF.VIEW_W_D2_FLOAT/2){db=DAnimID.HINT_DIALOG_POP_OUT_3;c3=DAnimID.HINT_DIALOG_DISPLAY_3;dd=DAnimID.HINT_DIALOG_POP_IN_3;if(dj){db=DAnimID.HINT_DIALOG_POP_OUT_2;c3=DAnimID.HINT_DIALOG_DISPLAY_2;dd=DAnimID.HINT_DIALOG_POP_IN_2}}if(e._textBubbleBigOne){if(e._textBubbleState<e.TEXT_BUBBLE_TEXT){e._textBubbleState=e.TEXT_BUBBLE_TEXT}else{if(e._textBubbleState==e.TEXT_BUBBLE_CLOSE){e.CloseTextBubble();return true}}c3=DAnimID.HINT_DIALOG_POP}switch(e._textBubbleState){case e.TEXT_BUBBLE_OPEN:c4.PaintAFrame(g,db,c7,dg,de,c6);if(c4.GetAFrames(db)==c7){e._textBubbleState=e.TEXT_BUBBLE_TEXT}break;case e.TEXT_BUBBLE_TEXT:c4.PaintAFrame(g,c3,0,dg,de,c6);var dc=LowAPI.Gen_Array([4],0);c4.GetAFrameRect(c3,0,0,dc,c6);e.txtSetFont(aS);var df=0;var c5=e._multiLineTextCurrentCursor;e._multiLineTextCurrentCursor=e._textBubbleCurrentCursor;var da=e.DrawMultiLineText(g,dh,dg+dc[DEF.BOX_LEFT],de+dc[DEF.BOX_TOP],GRPH.LEFT_TOP,1,dc[2],e._textBubbleCurrentLine,di,df);e._textBubbleCurrentCursor=e._multiLineTextCurrentCursor;e._multiLineTextCurrentCursor=c5;e.txtSetFont(cL);br.PaintAFrame(g,DAnimID.TOUCHINTERFACE_PRESS_5_PEN,Math.floor(s_game_currentFrameNB/3)%br.GetAFrames(DAnimID.TOUCHINTERFACE_PRESS_5_PEN),dg+dc[DEF.BOX_LEFT]+dc[2],de+dc[DEF.BOX_TOP]+dc[3],0);if(!e.bIsPaused&&WasKeyPressed(GLKey.k_fire)){if(e._textBubbleCurrentCursor!=-1){e._textBubbleCurrentCursor=-1}else{if(da){e._textBubbleState=e.TEXT_BUBBLE_CLOSE;e._textBubbleTime=0}else{e._textBubbleCurrentLine+=di;e._textBubbleCurrentCursor=0}}}break;case e.TEXT_BUBBLE_CLOSE:c4.PaintAFrame(g,dd,c7,dg,de,c6);if(c4.GetAFrames(dd)-1==c7){e.CloseTextBubble();return true}break}return false};e.CloseTextBubble=function(){if(DEF.dbgEnable){Dbg("CloseTextBubble -----------------------------")}if(e._textBubbleState==e.TEXT_BUBBLE_OVER){return}e._textBubbleState=e.TEXT_BUBBLE_OVER;e._textBubbleTime=0;e._textBubbleBigOne=false;if(e._textBubbleCinematicID>=0){e._cinematicsFrameTime[e._textBubbleCinematicID]=-e._cinematicsFrameTime[e._textBubbleCinematicID]}e._textBubbleCurrentCursor=-1};e._multiLineTextIndex=LowAPI.Gen_Array([400],0);e._multiLineTextIndexCount=0;e._multiLineCurrentStr=null;e._multiLineLineOff=null;e._multiLineWordOff=LowAPI.Gen_Array([100],0);e._multiLineTextCurrentCursor=-1;e._needSpecialProcess=false;e.DrawMultiLineText=function(dr,dl,di,dh,dn,ds,c4,dm,dk,db){if(dl==null){return true}var c7=ds;e.InitMultiLineText(dl,c4,b9);if(e._multiLineTextIndexCount<=0){return true}var c9=b9.GetLineHeight()+b9.GetLineSpacing();if((dn&Graphics.VCENTER)!=0){var dq=(c9)*e._multiLineTextIndexCount/2;dh-=dq/2}else{if((dn&Graphics.BOTTOM)!=0){var dq=(c9)*e._multiLineTextIndexCount/2;dh-=dq}}var dj=e._multiLineTextIndex[dm<<1];var df=Math.min((dm+dk-1)<<1,e._multiLineTextIndexCount-2);var dg=false;var dt=0;for(var dd=dm<<1;dd<=df;dd+=2){var c8=e._multiLineTextIndex[dd+1];if(e._multiLineTextCurrentCursor>=0&&c8-dj>e._multiLineTextCurrentCursor){c8=dj+e._multiLineTextCurrentCursor;dg=true}var da=e._multiLineTextIndex[dd];if(da<=c8){var de=LowAPI.Gen_Array([2],0);var dw=LowAPI.Gen_Array([2],0);var dv=0;var du=dl.substring(da,c8);var c6=du.split("");var c3=false;for(var dp=0;dp<c6.length;dp++){if(c6[dp]=="<"||c6[dp]=="("){de[de[0]==0?0:1]=dp+1;c6[dp]="^";if(du.charAt(dp)=="<"){c3=true}else{cu[dt++%3]=dh-7}}else{if(du.charAt(dp)==">"||c6[dp]==")"){dw[dw[0]==0?0:1]=dp-1;c6[dp]="^"}else{if(c6[dp]!="\n"){dv+=b9.getCharSize(du.charAt(dp))}}}if(dv>c4&&c6[dp]==" "){c6[dp]="\n"}}var c5=0;var dc=0;if(bP==2){dc=b4+DGUI.INTERACE_TEXT_START_OFFSET_X}else{if(dk<=3){dc=di}else{dc=di-DEF.VIEW_W_D2+(DEF.VIEW_W-dv)/2}}for(var dp=0;dp<c6.length;dp++){if(c3){if((dp>=de[0]&&dp<=dw[0]||dp>=de[1]&&dp<=dw[1])&&dp>0){b9.SetCurrentPalette(c5)}else{b9.SetCurrentPalette(ds)}}else{b9.SetCurrentPalette(ds)}if(c6[dp]=="^"){continue}b9.SetSubString(dp,dp+1);b9.DrawStringOrChars(dr,null,c6,dc,dh,2,true);b9.SetSubString(-1,-1);dc+=b9.getCharSize(c6[dp])}}else{e.txtDraw(ds,dl,di,dh,dn,da,c8)}if(dg){break}dh+=c9+db}if(!e.bIsPaused&&e._multiLineTextCurrentCursor>=0){if(dg){e._multiLineTextCurrentCursor++}else{e._multiLineTextCurrentCursor=-1}}b9.SetSubString(-1,-1);return(dm+dk)>=(e._multiLineTextIndexCount/2)};e.prototype.StringTokenize=function(da,c8,c7,c3,c9){var db=0;c9[0]=c8-1;var c4=c3.length;for(var c6=c8;c6<c7;c6++){for(var c5=c4-1;c5>=0;c5--){if(da.charAt(c6)==c3[c5]){c9[++db]=c6;break}}}c9[++db]=c7;return db};e.InitMultiLineText=function(c7,c4,c6){if(e._multiLineCurrentStr==c7||c7==null){return}e._multiLineCurrentStr=c7;c7=c7.trim().toUpperCase();e._multiLineLineOff=c6.WraptextB(c7,c4,GLLibConfig.screenHeight);var c3=e._multiLineLineOff.length;e._multiLineTextIndex[0]=0;e._multiLineTextIndex[1]=e._multiLineLineOff[1];for(var c5=3;c5<c3;c5+=2){e._multiLineTextIndex[c5-1]=e._multiLineLineOff[c5-2];e._multiLineTextIndex[c5]=e._multiLineLineOff[c5]}e._multiLineTextIndexCount=e._multiLineLineOff[0]<<1};e.prototype.GetStringWidth=function(c5,c4,c3){b9.SetSubString(c4,c3);b9.UpdateStringOrCharsSize(c5,null);return ASprite._text_w};e.INTERFACE_DRAW_CRYSTAL=0;e.INTERFACE_DRAW_1UP=1;e.INTERFACE_DRAW_GOLDEN_COIN=2;e.INTERFACE_DRAW_STAR=3;e._drawInterface=0;e.interfaceShowTime=LowAPI.Gen_Array([8],0);e.interfaceOffset=LowAPI.Gen_Array([8],0);e.OFFSET_MAX=30;e.ShowInterfaceElement=function(c3){if(c3<e.interfaceShowTime.length){e.interfaceOffset[c3]=0;e.interfaceShowTime[c3]=GLLibConfig.FPSLimiter*2;if(c3==DValueList.BONUS_TYPE_CAKE){e.interfaceShowTime[c3]=e.spriteArray[DSpriteID.EFFECT].GetAFrames(DAnimID.EFFECT_RANDOM_MAGIC)}else{if(c3==DValueList.BONUS_TYPE_STAR){e.interfaceShowTime[c3]=GLLibConfig.FPSLimiter<<2}else{if(c3==DValueList.BONUS_TYPE_GOLD_COIN){e.interfaceShowTime[c3]=GLLibConfig.FPSLimiter<<2}}}}};e.prototype.DrawInterface=function(){var c4=CEntity.AI_Hero_CheckMorph(DAI.HERO_MORPH_FAT);var c6=!CEntity.AI_Hero_CheckMorph(DAI.HERO_MORPH_NONE);var c5=!c4;if(c6){c5=!c4;var c7=CEntity.AI_Hero_GetMorph()-DAI.HERO_MORPH_FAT;if(CEntity.AI_Hero_GetMorph()==DAI.HERO_MORPH_SWORD_FISH_ATTACK){c7--}e._interface.PaintFrame(g,DAnimID.INTERFACE_FRAME_PORTRAIT_FAT+c7,DGUI.INTERFACE_MARGIN_HORIZONTAL,DGUI.INTERFACE_MARGIN_VERTICAL,0)}else{e._interface.PaintFrame(g,DAnimID.INTERFACE_FRAME_PORTRAIT,DGUI.INTERFACE_MARGIN_HORIZONTAL,DGUI.INTERFACE_MARGIN_VERTICAL,0)}e._interface.PaintFrame(g,DAnimID.INTERFACE_FRAME_X,DGUI.INTERFACE_LIFE_OFFSET_X,DGUI.INTERFACE_MARGIN_VERTICAL_FORK,0);e.DrawInterfaceNumber(CEntity._HeroParams[DAI.HPI_LIVES],DGUI.INTERFACE_LIFE_NUM_OFFSET_X,DGUI.INTERFACE_MARGIN_VERTICAL_NUM,1,0);if(c4){var c8=e._interface.GetFrameWidth(DAnimID.INTERFACE_FRAME_FAT_FRAME);e._interface.PaintFrame(g,DAnimID.INTERFACE_FRAME_FAT_FRAME,DEF.useNewDesign?DEF.SCR_W-c8-DGUI.INTERFACE_MARGIN_ENERGY_HORIZONTAL:DGUI.INTERFACE_MARGIN_ENERGY_HORIZONTAL,DGUI.INTERFACE_MARGIN_ENERGY_HEIGHT,0);g.setClip((DEF.useNewDesign?DEF.SCR_W-c8-DGUI.INTERFACE_MARGIN_ENERGY_HORIZONTAL:DGUI.INTERFACE_MARGIN_ENERGY_HORIZONTAL)+DGUI.INTERFACE_FAT_FILL_OFFSET_X,DGUI.INTERFACE_MARGIN_ENERGY_HEIGHT,CEntity._HeroMorphEnergy*DGUI.INTERFACE_FAT_FILL_WIDTH/100,DGUI.INTERFACE_BOTTOM_HEIGHT);e._interface.PaintFrame(g,DAnimID.INTERFACE_FRAME_FAT_FILL,DEF.useNewDesign?DEF.SCR_W-c8-DGUI.INTERFACE_MARGIN_ENERGY_HORIZONTAL:DGUI.INTERFACE_MARGIN_ENERGY_HORIZONTAL,DGUI.INTERFACE_MARGIN_ENERGY_HEIGHT,0);g.setClip(0,0,DEF.SCR_W,DEF.SCR_H)}e._interface.PaintAFrame(g,DAnimID.INTERFACE_DIAMOND,s_game_currentFrameNB%e.spriteArray[DSpriteID.BONUS].GetAFrames(DAnimID.INTERFACE_DIAMOND),DEF.useNewDesign?DGUI.INTERFACE_MARGIN_HORIZONTAL:DGUI.INTERFACE_CRYSTAL_OFFSET_X,DEF.useNewDesign?(DGUI.INTERFACE_CRYSTAL_Y+DGUI.INTERFACE_CRYSTAL_OFFSET_Y):DGUI.INTERFACE_CRYSTAL_OFFSET_Y,0);e._interface.PaintFrame(g,DAnimID.INTERFACE_FRAME_X,DEF.useNewDesign?DGUI.INTERFACE_LIFE_OFFSET_X:DGUI.INTERFACE_CRYSTAL_NUM_OFFSET_X,DEF.useNewDesign?(DGUI.INTERFACE_CRYSTAL_Y+DGUI.INTERFACE_MARGIN_VERTICAL_FORK):DGUI.INTERFACE_MARGIN_VERTICAL_FORK,0);e.DrawInterfaceNumber(CEntity._hero._hp,(DEF.useNewDesign?DGUI.INTERFACE_LIFE_OFFSET_X:DGUI.INTERFACE_CRYSTAL_NUM_OFFSET_X)+DGUI.INTERFACE_X_WIDTH+DGUI.INTERFACE_X_WIDTH_MARGIN,DEF.useNewDesign?(DGUI.INTERFACE_CRYSTAL_Y+DGUI.INTERFACE_MARGIN_VERTICAL_NUM):DGUI.INTERFACE_MARGIN_VERTICAL_NUM,1,0);if(e.interfaceShowTime[DValueList.BONUS_TYPE_1UP]>0){e.interfaceShowTime[DValueList.BONUS_TYPE_1UP]--}if(e.interfaceShowTime[DValueList.BONUS_TYPE_GOLD_COIN]>0){e.interfaceShowTime[DValueList.BONUS_TYPE_GOLD_COIN]--;var c9=s_game_currentFrameNB%e.spriteArray[DSpriteID.BONUS].GetAFrames(DAnimID.BONUS_GOLDEN_COIN);var c3,da;c3=DGUI.INTERFACE_STAR_OFFSET_X;da=DGUI.INTERFACE_STAR_OFFSET_Y-18*DScreen.RATIO;e.spriteArray[DSpriteID.BONUS].PaintAFrame(g,DAnimID.BONUS_GOLDEN_COIN,c9,c3,da,0);c3+=20*DScreen.RATIO;da+=-14*DScreen.RATIO;e._interface.PaintFrame(g,DAnimID.INTERFACE_FRAME_X,c3,da,0);c3+=20*DScreen.RATIO;da+=-5*DScreen.RATIO;if(CEntity._HeroParams[DAI.HPI_GOLDCOIN_COUNT]<=0){e._interface.SetCurrentPalette(1)}e.DrawInterfaceNumber(CEntity._HeroParams[DAI.HPI_GOLDCOIN_COUNT],c3,da,1,0);e._interface.SetCurrentPalette(0)}if(e.interfaceShowTime[DValueList.BONUS_TYPE_STAR]>0){e.interfaceShowTime[DValueList.BONUS_TYPE_STAR]--;var c9=s_game_currentFrameNB%e.spriteArray[DSpriteID.BONUS].GetAFrames(DAnimID.BONUS_STAR);var c3,da;c3=DGUI.INTERFACE_STAR_OFFSET_X;da=DGUI.INTERFACE_STAR_OFFSET_Y-18*DScreen.RATIO;e.spriteArray[DSpriteID.BONUS].PaintAFrame(g,DAnimID.BONUS_STAR,c9,c3,da,0);c3+=20*DScreen.RATIO;da+=-DGUI.BONUS_STAR_OFFSETY;e._interface.PaintFrame(g,DAnimID.INTERFACE_FRAME_X,c3,da,0);c3+=20*DScreen.RATIO;da+=-4*DScreen.RATIO;e.DrawInterfaceNumber(DAI.MAX_STAR_NUM-e._levelStarInfo[e._tempLevelId*DAI.STAR_INFO_SIZE],c3,da,1,0)}if(e.interfaceShowTime[DValueList.BONUS_TYPE_CAKE]>0){var c9=e.spriteArray[DSpriteID.EFFECT].GetAnimFrame(DAnimID.EFFECT_RANDOM_MAGIC,e.spriteArray[DSpriteID.EFFECT].GetAFrames(DAnimID.EFFECT_RANDOM_MAGIC)-e.interfaceShowTime[DValueList.BONUS_TYPE_CAKE]);e.spriteArray[DSpriteID.EFFECT].PaintFrame(g,c9,DGUI.INTERFACE_MORPH_EFFECT_OFFSET_X,DGUI.INTERAFCE_HERO_CHANGE_EFFECT_Y,0);e.spriteArray[DSpriteID.EFFECT].PaintFrame(g,c9,DGUI.INTERFACE_MORPH_EFFECT_OFFSET_X_2,DGUI.INTERAFCE_HERO_CHANGE_EFFECT_Y,0);e.spriteArray[DSpriteID.EFFECT].PaintFrame(g,c9,DGUI.INTERFACE_MORPH_EFFECT_OFFSET_X_3,DGUI.INTERAFCE_HERO_CHANGE_EFFECT_Y,0);e.interfaceShowTime[DValueList.BONUS_TYPE_CAKE]--}};e._itoa_buffer=LowAPI.Gen_Array([16],0);e.DrawInterfaceNumber=function(c6,da,c8,c7,c4){var dc=c6;var c9=-1;while(dc>0){c9++;dc=Math.floor(dc/10)}if(c9<c7){c9=c7-1}else{c7=c9+1}for(var c5=0;c5<c7;c5++){e._itoa_buffer[c5]=0}dc=c6;if(c6<0){dc=0}do{e._itoa_buffer[c9--]=dc%10;dc=Math.floor(dc/10)}while(dc>0&&c9>=0);if((c4&GRPH.VCENTER)!=0){c8-=e._interface.GetFrameModuleHeight(DAnimID.INTERFACE_FRAME_0,0)>>1}if((c4&GRPH.HCENTER)!=0){var db=0;for(var c5=0;c5<c7;c5++){var c3=DAnimID.INTERFACE_FRAME_0+e._itoa_buffer[c5];db+=e._interface.GetFrameModuleWidth(c3,0)}da-=db>>1}for(var c5=0;c5<c7;c5++){var c3=DAnimID.INTERFACE_FRAME_0+e._itoa_buffer[c5];e._interface.PaintFrame(g,c3,da,c8,0);da+=e._interface.GetFrameModuleWidth(c3,0)}};e.prototype.gameUpdate=function(){if(cI!=DPauseType.NONE){if(this.PauseUpdate()){return}}CEntity.UpdateAll(-1);if(CEntity._checkDropToGound){CEntity._hero._vY=DAI.GRAVITY;CEntity.UpdateAll(-1);CEntity._checkDropToGound=false;e.SetPause(DPauseType.FADE_IN,DPauseType.FADE_EFFECT_CIRCLE);CEntity._hero.StateMachineChangeState(DState.STATE_ONGROUND,DState.SS_GO_OUTDOOR,0)}e.UpdateCinematic();bG=WasAnyKeyReleased();if(bG>=0){if(bG==GLKey.k_menuOK||(bg&&!e.bIsPaused)){e.initIngameMenu(STATE.MENU_INGAME)}if(bG==GLKey.k_menuBack){if(e.InCinemitic()){e.SkipCinemitic();CEntity.CheckActive();CEntity.UpdateAll(-1)}}}};e.initIngameMenu=function(c3){e.bIsPaused=true;e.bIsMiniMap=a9==STATE.MENU_MAP;a9=c3;cx=LowAPI.Gen_Array([f.MAX_DEPTH],0);y=LowAPI.Gen_Array([f.MAX_DEPTH],0);bR=0;y[bR]=bi;e.redrawAll=true;if(c3==STATE.MENU_INGAME){e.PauseSoundBGM()}};e.prototype.PauseUpdate=function(){var c3=false;if(cI==DPauseType.FADE_OUT||cI==DPauseType.FADE_IN){switch(cY){case DPauseType.FADE_EFFECT_BLACK:if(cI==DPauseType.FADE_OUT){bI+=Math_FixedPointToInt(Math_FixedPoint_Multiply(DAI.EFFECT_FADE_VELOCITY,e._velocityRate));if(bI>=255){bI=255;c3=true}}else{if(cI==DPauseType.FADE_IN){bI-=Math_FixedPointToInt(Math_FixedPoint_Multiply(DAI.EFFECT_FADE_VELOCITY,e._velocityRate));if(bI<=0){bI=0;c3=true}}}break;case DPauseType.FADE_EFFECT_CIRCLE:if(cI==DPauseType.FADE_OUT){if(x>-DEF.TILE_W<<1){x-=DEF.TILE_W<<1}else{c3=true}}else{if(cI==DPauseType.FADE_IN){if(x<DEF.SCR_H_D2+(DEF.SCR_H_D2>>1)){x+=DEF.TILE_W<<1}else{c3=true}}}break;case DPauseType.FADE_EFFECT_SCANLINE:if(cI==DPauseType.FADE_OUT){if(x>0){x-=10*DScreen.RATIO;if(x<0){x=0}}else{c3=true}}else{if(cI==DPauseType.FADE_IN){if(x<DEF.SCR_W){x+=10*DScreen.RATIO;if(x>DEF.SCR_W){x=DEF.SCR_W}}else{c3=true}}}}}if(c3){e.SetPause(DPauseType.NONE,0);return false}return true};e.SetPause=function(c3,c4){cI=c3;cY=c4;x=0;if(c3==DPauseType.FADE_OUT){if(c4==DPauseType.FADE_EFFECT_CIRCLE){x=DEF.SCR_H_D2+(DEF.SCR_H_D2>>1)}}};e.prototype.DrawFadeEffect=function(){if(cI==DPauseType.FADE_IN||cI==DPauseType.FADE_OUT){switch(cY){case DPauseType.FADE_EFFECT_BLACK:if(bI>0){e.FillArgbRect(0,0,DEF.SCR_W,DEF.SCR_H,(bI<<24)|c0)}break;case DPauseType.FADE_EFFECT_CIRCLE:var c3,c5;var c4=CEntity._hero;if(c4!=null){c3=Math_FixedPointToInt(c4._posX-CEntity._camX);c5=Math_FixedPointToInt(c4._posY+c4._boundingBox[DEF.BOX_TOP]-CEntity._camY)}else{c3=ao;c5=an}e.DrawFadeCircle(g,c3,c5,x);break;case DPauseType.FADE_EFFECT_SCANLINE:this.DrawFadeScanLine(g,1*DScreen.RATIO,x);break}}};e.prototype.DrawWeatherEffect=function(){};e.prototype.DrawFadeScanLine=function(c6,c3,c5){if(c3<=0){return}c6.setClip(0,0,DEF.SCR_W,DEF.SCR_H);c6.setColor(0);for(var c4=0;c4<Math.floor(DEF.SCR_H/c3)+1;c4++){if(c4%2==0){c6.fillRect(x-DEF.SCR_W,c4*c3,DEF.SCR_W,c3)}else{c6.fillRect(DEF.SCR_W-x,c4*c3,DEF.SCR_W,c3)}}};e.DrawFadeCircle=function(c5,c3,c7,c4){c4=Math.max(c4,0);var c6=((512-362)*c4)>>8;SetColor(4278190080);c5.fillTriangle(c3+c4-c6,c7-c4,c3+c4,c7-c4,c3+c4,c7-c4+c6);c5.fillTriangle(c3+c4-c6,c7+c4,c3+c4,c7+c4,c3+c4,c7+c4-c6);c5.fillTriangle(c3-c4+c6,c7+c4,c3-c4,c7+c4,c3-c4,c7+c4-c6);c5.fillTriangle(c3-c4+c6,c7-c4,c3-c4,c7-c4,c3-c4,c7-c4+c6);if(c7-c4>0){c5.fillRect(0,0,DEF.SCR_W,c7-c4)}if(c3-c4>0){c5.fillRect(0,0,c3-c4,DEF.SCR_H)}if(DEF.SCR_W-c3+c4>0){c5.fillRect(c3+c4,0,DEF.SCR_W-c3+c4,DEF.SCR_H)}if(DEF.SCR_H-c7+c4>0){c5.fillRect(0,c7+c4,DEF.SCR_W,DEF.SCR_H-c7+c4)}};e.InitLevel=function(){e._entitiesRowData=LowAPI.Gen_Array([4000],null);e._entitiesRowTable.clear();e._entityMap.clear();e._entityRowDataCount=0;e._sprites_load_mask=DSpriteID.DEFAULT_SPRITES_LOAD_MASK};e.ReleaseLevel=function(c4){CEntity._camFocus=null;CEntity._camFocusA=null;CEntity._camFocusB=null;if(!c4&&(CEntity._hero!=null)){CEntity._HeroParams[DAI.HPI_LIVES]=e._playerInfo[DAI.HPI_LIVES];CEntity._hero._hp=e._playerInfo[DAI.HPI_HP_MAX]}CEntity._hero=null;CEntity._boss=null;CEntity._camera=null;CEntity._cameraDefault=null;CEntity._camOffsetY=0;CEntity._bullet=null;CEntity._HeroIce=null;CEntity._ThiefSoundBubbleLeft=null;CEntity._ThiefSoundBubbleRight=null;CEntity._TentacleSide=-1;CEntity._HurtByTentacle=false;CEntity._HeroKickableEntity=null;CEntity._HeroRelateEntity=null;CEntity._HeroMorphEnergy=0;CEntity._arrowShakeNum=0;e._entitiesRowTable.clear();e._entityMap.clear();e._entitiesRowData=null;e._entityRowDataCount=0;CEntity.s_levelRenderCount=0;CEntity._HeroInElectric=0;CEntity._HeroBeAttackByInkbomb=false;CEntity._HeroShowInkTime=0;CEntity._BossOctopusHurt=false;CEntity._BossOctopusHurtBySit=false;CEntity._inMiniGame=false;e._textBubbleState=e.TEXT_BUBBLE_OVER;e._textBubbleTime=0;aa=null;e._firstEnterIntoThisFunction=true;e._inCinematicBlackScreen=false;CEntity._monsterchestHP=null;e._popUpEnded=false;CEntity._camCircularScroll=false;CEntity._miniGameTriger=null;for(var c3=0;c3<e.interfaceShowTime.length;c3++){e.interfaceShowTime[c3]=0}};e.prototype.UnInit=function(){e.__superproto__.UnInit.call(this)};e._cinematics=null;e._cinematicsId=null;e._cinematicsFrameTime=null;e._cinematicsFrameTotal=null;e._cinematicsStatus=null;e._cinematicsSkipping=false;e.DEFAULT_SPRITES_LOAD_MASK=(1<<DSpriteID.HERO);e._sprites_load_mask=e.DEFAULT_SPRITES_LOAD_MASK;e.LoadCinematics=function(dm){var c4=0;var c5=dm[c4++];e._cinematics=LowAPI.Gen_Array([c5],null);e._cinematicsId=LowAPI.Gen_Array([c5],0);e._cinematicsFrameTotal=LowAPI.Gen_Array([c5],0);e._cinematicsFrameTime=LowAPI.Gen_Array([c5],0);e._cinematicsStatus=LowAPI.Gen_Array([c5],0);var di=e._cinematicsFrameTime.length;for(var dh=0;dh<di;++dh){e._cinematicsFrameTime[dh]=-1}for(var dh=0;dh<c5;++dh){var dk=0;var dj=Mem_GetShort(dm,c4);c4+=2;e._cinematicsId[dh]=dj;var c9=dm[c4++];c4+=2;e._cinematics[dh]=LowAPI.Gen_Array([c9],null);for(var df=0;df<c9;++df){var c6=c4;var c3=dm[c4++];++c4;switch(c3){case DCinematic.CTRACK_OBJ_LAYER:var db=Mem_GetShort(dm,c4);c4+=2;break;case DCinematic.CTRACK_SI:var dd=Mem_GetShort(dm,c4);c4+=2;e._sprites_load_mask|=CEntity.GetSpriteLoadMask(dd);break}var dg=Mem_GetShort(dm,c4);c4+=2;for(var de=0;de<dg;++de){var dl=Mem_GetShort(dm,c4);c4+=2;if(dl>dk){dk=dl}var da=dm[c4++];for(var dc=0;dc<da;++dc){var c7=dm[c4++]&255;switch(c7){case DCinematic.CCMD_CAMERA_SET_POS:case DCinematic.CCMD_CAMERA_CENTER_TO:case DCinematic.CCMD_OBJ_LAYER_SET_POS:case DCinematic.CCMD_BASIC_SET_POS:case DCinematic.CCMD_SI_SET_POS:c4+=2;c4+=2;break;case DCinematic.CCMD_OBJ_LAYER_SET_ANIM:case DCinematic.CCMD_SI_SET_ANIM:++c4;break;case DCinematic.CCMD_BASIC_SET_ACTION:c4+=2;break;case DCinematic.CCMD_OBJ_LAYER_ADD_FLAGS:case DCinematic.CCMD_OBJ_LAYER_REMOVE_FLAGS:case DCinematic.CCMD_SI_ADD_FLAGS:case DCinematic.CCMD_SI_REMOVE_FLAGS:c4+=4;break;case DCinematic.CCMD_BASIC_SEND_EVENT_3:c4+=2;case DCinematic.CCMD_BASIC_SEND_EVENT_2:case DCinematic.CCMD_NEW_OBJECT_SETPOSREF:c4+=2;c4+=2;break;case DCinematic.CCMD_NEW_BASIC_ACTIVE_OBJECT:case DCinematic.CCMD_NEW_BASIC_INACTIVE_OBJECT:case DCinematic.CCMD_NEW_BASIC_PLAY_SOUND:case DCinematic.CCMD_NEW_BASIC_TEXT_BUBBLE:case DCinematic.CCMD_NEW_OBJECT_TEXT_BUBBLE:case DCinematic.CCMD_NEW_SI_SET_PALETTE:case DCinematic.CCMD_NEW_OBJECT_SET_PALETTE:case DCinematic.CCMD_NEW_BASIC_CAMERA_QUAKE:case DCinematic.CCMD_NEW_OBJECT_SET_ZORDER:case DCinematic.CCMD_NEW_OBJECT_DIE:c4+=2;break;case DCinematic.CCMD_NEW_BASIC_STOP_SOUND:case DCinematic.CCMD_NEW_OBJECT_INACTIVE:case DCinematic.CCMD_NEW_OBJECT_ACTIVE:case DCinematic.CCMD_NEW_OBJECT_KEEP_CURRENT_POS:case DCinematic.CCMD_NEW_OBJECT_ESCAPE_FROM_CINEMATIC:case DCinematic.CCMD_NEW_BASIC_LEVEL_PASSED:case DCinematic.CCMD_NEW_BASIC_OPEN_BLACK_SCREEN:case DCinematic.CCMD_NEW_BASIC_BLACK_SCREEN:break;case DCinematic.CCMD_BASIC_SEND_OBJ_EVENT_3:case DCinematic.CCMD_BASIC_SEND_OBJ_EVENT_2:case DCinematic.CCMD_BASIC_SEND_OBJ_EVENT_1:case DCinematic.CCMD_BASIC_SEND_EVENT_1:default:if(DEF.dbgErr){Dbg("not code this type in cenimatic now.")}break}}}var c8=c4-c6;e._cinematics[dh][df]=LowAPI.Gen_Array([c8+2],0);System.arraycopy(dm,c6,e._cinematics[dh][df],0,c8)}e._cinematicsFrameTotal[dh]=dk}};e.GetCinematicIndex=function(c5){var c3=e._cinematicsId.length;for(var c4=0;c4<c3;++c4){if(e._cinematicsId[c4]==c5){return c4}}return -1};e.InCinemitic=function(){var c3=e._cinematicsId.length;for(var c4=0;c4<c3;++c4){if((e._cinematicsStatus[c4]&DCinematic.STATUS_PLAYING)!=0&&(e._cinematicsStatus[c4]&DCinematic.STATUS_CIRCLE)==0){return true}}return false};e.StartCinemitic=function(da){if(CEntity._hero._hp<0){return}var dc=e._cinematics[da];e._cinematicsFrameTime[da]=0;e._cinematicsStatus[da]|=DCinematic.STATUS_PLAYING;var db=dc.length;for(var c5=0;c5<db;++c5){var c7=dc[c5];var c8=c7[0];var c6=null;var c9=4;switch(c8){case DCinematic.CTRACK_BASIC:break;case DCinematic.CTRACK_CAMERA:CEntity._camera.SetFlag(DFlags.CENIMATIC);break;case DCinematic.CTRACK_OBJ_LAYER:var dd=Mem_GetShort(c7,2);c9+=2;if(CEntity._hero!=null&&dd==CEntity._hero._id){CEntity._hero.SetFlag(DFlags.CENIMATIC);CEntity._hero.StateMachineChangeState(DState.STATE_ONGROUND,DState.SS_IDLE,0)}break;case DCinematic.CTRACK_SI:var c3=Mem_GetShort(c7,2);if((e._cinematicsStatus[da]&DCinematic.STATUS_CIRCLE)==0){var c4=LowAPI.Gen_Array([DParamIndex.DECOR_PALETTE+1],0);c4[DParamIndex.DECOR_SPRITE]=Mem_GetShort(c7,2);c4[DParamIndex.DECOR_Z_ORDER]=Z.DEFAULT;c6=CEntity.CreateDynamicEntity(c4,DClassID.DECOR,0,0,0,0);Mem_SetShort(c7,2,c6._id);c6.SetFlag(DFlags.CENIMATIC)}c9+=2;break}Mem_SetShort(c7,c7.length-2,c9)}};e.SkipCinemitic=function(){if(DEF.dbgEnable){Dbg("SkipCinemitic -------------------")}e._cinematicsSkipping=true;e.CloseTextBubble();var c3=e._cinematicsId.length;while(e.InCinemitic()){e.UpdateCinematic()}e._cinematicsSkipping=false};e.EndCinemitic=function(c5){if(DEF.dbgEnable){Dbg("EndCinemitic -------------------")}if(e._cinematicsFrameTime[c5]<0){return}if(M){e.PlaySoundBGM()}var c7=e._cinematics[c5];e._cinematicsFrameTime[c5]=-2;e._cinematicsStatus[c5]|=DCinematic.STATUS_PLAYED;e._cinematicsStatus[c5]&=~DCinematic.STATUS_PLAYING;var c3=c7.length;for(var c4=0;c4<c3;++c4){var c8=c7[c4];var c6=c8[0];var c9=null;switch(c6){case DCinematic.CTRACK_CAMERA:if(CEntity._camera!=null){CEntity._camera.ClearFlag(DFlags.CENIMATIC)}break;case DCinematic.CTRACK_OBJ_LAYER:var da=Mem_GetShort(c8,2);c9=CEntity.GetEntityByID(da,false);if(c9!=null){c9.ClearFlag(DFlags.CENIMATIC)}break;case DCinematic.CTRACK_SI:var da=Mem_GetShort(c8,2);if((e._cinematicsStatus[c5]&DCinematic.STATUS_CIRCLE)==0){c9=CEntity.GetEntityByID(da,true);if(c9!=null){Mem_SetShort(c8,2,c9._params[DParamIndex.DECOR_SPRITE]);c9.SetInactived(true)}}break}}};e.UpdateCinematic=function(){var dy=0;var dj=e._cinematicsId.length;for(var dF=0;dF<dj;++dF){if(e._cinematicsFrameTime[dF]>=0){if((e._cinematicsStatus[dF]&DCinematic.STATUS_CIRCLE)==0){++dy}var dq=true;var dr=e._cinematics[dF];var dd=e._cinematicsFrameTime[dF]++;var dJ=dr.length;if((e._tempLevelId==e._finalLevelIndex)&&(e._levelFinalInfo1==1)){e._cinematicsFrameTime[dF]=-2;e._cinematicsStatus[dF]|=DCinematic.STATUS_PLAYED;e._cinematicsStatus[dF]&=~DCinematic.STATUS_PLAYING;if(CEntity._camera!=null){CEntity._camera.ClearFlag(DFlags.CENIMATIC)}if(CEntity._hero!=null&&CEntity._hero.CheckFlag(DFlags.CENIMATIC)){CEntity._hero.ClearFlag(DFlags.CENIMATIC)}break}for(var dD=0;dD<dJ;++dD){var dI=dr[dD];var dw=0;var ds=dI[dw];++dw;++dw;var c4=null;var dK=-1;switch(ds){case DCinematic.CTRACK_SI:case DCinematic.CTRACK_OBJ_LAYER:dK=Mem_GetShort(dI,dw);dw+=2;c4=CEntity.GetEntityByID(dK,true);c4.SetFlag(DFlags.CENIMATIC);if(c4==null){continue}break}dw=Mem_GetShort(dI,dI.length-2);var di=dI.length-2;var dm=0,dl=0,c5=-1;var c7;var dH;var dk=0;var dE=0;for(;dw<di;){var c6=Mem_GetShort(dI,dw);if(dd<c6){dq=false;if(dd+1==c6){Mem_SetShort(dI,dI.length-2,dw)}if(c4!=null){c4.SetFlag(DFlags.CENIMATIC)}}dw+=2;var du=dI[dw++];var dG=false;for(var dC=0;dC<du;++dC){var c8=dI[dw++]&255;var c9=c6==dd;var c3=c6>=dd;switch(c8){case DCinematic.CCMD_CAMERA_SET_POS:case DCinematic.CCMD_CAMERA_CENTER_TO:case DCinematic.CCMD_OBJ_LAYER_SET_POS:case DCinematic.CCMD_BASIC_SET_POS:case DCinematic.CCMD_SI_SET_POS:var dh=Mem_GetShort(dI,dw);dw+=2;var dg=Mem_GetShort(dI,dw);dw+=2;if(c3){dm=dh;dl=dg;if(c8==DCinematic.CCMD_CAMERA_CENTER_TO){dm-=DEF.VIEW_W_D2;dl-=DEF.VIEW_H_D2}c5=c6;dG=true}break;case DCinematic.CCMD_NEW_OBJECT_ESCAPE_FROM_CINEMATIC:if(c3){c4.ClearFlag(DFlags.CENIMATIC);dG=true}break;case DCinematic.CCMD_NEW_OBJECT_SETPOSREF:var dc=Mem_GetShort(dI,dw);dw+=2;var db=Mem_GetShort(dI,dw);dw+=2;if(c3){dm=(c4._posX>>DEF.SHIFT)+dc;dl=(c4._posY>>DEF.SHIFT)+db;c5=c6;dG=true}break;case DCinematic.CCMD_OBJ_LAYER_SET_ANIM:case DCinematic.CCMD_SI_SET_ANIM:var dv=dI[dw++]&255;if(c9){if(c4!=null){c4.SetAnim(dv,CEntity.SETANIM_FORCE)}}break;case DCinematic.CCMD_BASIC_SET_ACTION:dw+=2;break;case DCinematic.CCMD_BASIC_SEND_EVENT_2:var dB=Mem_GetShort(dI,dw);dw+=2;var dA=Mem_GetShort(dI,dw);dw+=2;break;case DCinematic.CCMD_BASIC_SEND_EVENT_3:var dB=Mem_GetShort(dI,dw);dw+=2;var dA=Mem_GetShort(dI,dw);dw+=2;var dz=Mem_GetShort(dI,dw);dw+=2;break;case DCinematic.CCMD_OBJ_LAYER_ADD_FLAGS:case DCinematic.CCMD_SI_ADD_FLAGS:c7=Mem_GetInt(dI,dw);dw+=4;if(c9){if((c7&8388608)!=0){c7&=~8388608;c7|=DFlags.INVISIBLE}if(c4!=null){c4._flags|=c7}}break;case DCinematic.CCMD_OBJ_LAYER_REMOVE_FLAGS:case DCinematic.CCMD_SI_REMOVE_FLAGS:c7=Mem_GetInt(dI,dw);dw+=4;if(c9){if((c7&8388608)!=0){c7&=~8388608;c7|=DFlags.INVISIBLE}c4._flags&=~c7}break;case DCinematic.CCMD_NEW_BASIC_CAMERA_QUAKE:dH=Mem_GetShort(dI,dw);dw+=2;if(c9){CEntity.AI_CameraQuake(Math_IntToFixedPoint(dH))}if(dd>c6){CEntity.AI_CameraQuakeUpdate()}break;case DCinematic.CCMD_NEW_BASIC_BLACK_SCREEN:if(c9){e._inCinematicBlackScreen=true}break;case DCinematic.CCMD_NEW_BASIC_OPEN_BLACK_SCREEN:if(c9){e._inCinematicBlackScreen=false}break;case DCinematic.CCMD_NEW_BASIC_INACTIVE_OBJECT:dH=Mem_GetShort(dI,dw);dw+=2;if(c9){InactiveEntityOrCinematic(dH,true)}break;case DCinematic.CCMD_NEW_OBJECT_INACTIVE:if(c9){if(c4!=null){c4._params[DParamIndex.FLAGS]|=DFlags.CENIMATIC;c4.SetInactived(true)}}break;case DCinematic.CCMD_NEW_OBJECT_NOTIFY:dH=Mem_GetShort(dI,dw);dw+=2;if(c9){c4.NotifyEvent(null,DEvent.BE_TRIGGERED_BY_CINEMATIC,dH,0,0)}break;case DCinematic.CCMD_NEW_OBJECT_KEEP_CURRENT_POS:if(c3){if(ds==DCinematic.CTRACK_CAMERA){dm=Math_FixedPointToInt(CEntity._camX);dl=Math_FixedPointToInt(CEntity._camY)}else{dm=Math_FixedPointToInt(c4._posX);dl=Math_FixedPointToInt(c4._posY)}c5=c6;dG=true}break;case DCinematic.CCMD_NEW_BASIC_TEXT_BUBBLE:dH=Mem_GetShort(dI,dw);dw+=2;if(c9&&!e._cinematicsSkipping){e._textBubbleBigOne=true;e.StartTextBubble(dF,-1,-1,dH);e._cinematicsFrameTime[dF]=-e._cinematicsFrameTime[dF]}break;case DCinematic.CCMD_NEW_OBJECT_TEXT_BUBBLE:dH=Mem_GetShort(dI,dw);dw+=2;if(c9&&!e._cinematicsSkipping){e.StartTextBubble(dF,c4._posX,c4._posY,dH);e._cinematicsFrameTime[dF]=-e._cinematicsFrameTime[dF]}break;case DCinematic.CCMD_NEW_BASIC_PLAY_SOUND:dH=Mem_GetShort(dI,dw);dw+=2;if(c9){e.PlaySound(DSound_Channel.SFX,dH)}break;case DCinematic.CCMD_NEW_BASIC_STOP_SOUND:dH=Mem_GetShort(dI,dw);dw+=2;if(c9){e.StopSound(dH)}break;case DCinematic.CCMD_NEW_OBJECT_SET_PALETTE:dH=Mem_GetShort(dI,dw);dw+=2;if(c9){c4._tempParams[DTempParamIndex.CINEMATIC_PALETTE]=dH}break;case DCinematic.CCMD_NEW_OBJECT_SET_ZORDER:dH=Mem_GetShort(dI,dw);dw+=2;if(c9){c4._zOrder=dH;CEntity.UpdateDrawList(c4)}break;case DCinematic.CCMD_NEW_SI_SET_PALETTE:dH=Mem_GetShort(dI,dw);dw+=2;if(c9){if(c4!=null&&c4._classID==DClassID.DECOR){c4._params[DParamIndex.DECOR_PALETTE]=dH}}break;case DCinematic.CCMD_NEW_OBJECT_DIE:dH=Mem_GetShort(dI,dw);dw+=2;if(c9){if(c4!=null){c4._tempParams[DTempParamIndex.BOSS_DEAD_EFFECT_FADE_DIRECTION]=dH;c4.StateMachineChangeState(DState.STATE_SIMPLE,DState.SS_DISAPPEAR,0)}}break;case DCinematic.CCMD_NEW_BASIC_LEVEL_PASSED:if(c9){e.GotoNextLevel(true)}break}}if(dG){if(dd==c6&&dw<di){dq=false;c6=Mem_GetShort(dI,dw);if(dd+1==c6){Mem_SetShort(dI,dI.length-2,dw)}dw+=2}break}}var dx=null;if(ds!=DCinematic.CTRACK_CAMERA&&c4==null){dx=CEntity.GetRowDataByID(dK)}if(c5<0){continue}if(ds!=DCinematic.CTRACK_CAMERA&&c4==null&&dx==null){continue}var dp=0;var dn=0;if(ds==DCinematic.CTRACK_CAMERA){CEntity._camera.SetFlag(DFlags.CENIMATIC);dp=CEntity._camera._posX;dn=CEntity._camera._posY}else{if(c4!=null){dp=c4._posX;dn=c4._posY}else{dp=Math_IntToFixedPoint(dx[DParamIndex.POSX]);dn=Math_IntToFixedPoint(dx[DParamIndex.POSY])}}if(c5>=0){var df;var de;dm<<=DEF.SHIFT;dl<<=DEF.SHIFT;if(c5==dd){df=dm-dp;de=dl-dn;dp=dm;dn=dl}else{var da=c5-dd+1;da*=DEF.ANIMATION_FRAME_TICK;df=(dm-dp)*1000/(da);de=(dl-dn)*1000/(da);df=Math_FixedPoint_Multiply(df,e._velocityRate);de=Math_FixedPoint_Multiply(de,e._velocityRate);dp+=df;dn+=de}if(ds==DCinematic.CTRACK_CAMERA){CEntity._camera._posX=dp;CEntity._camera._posY=dn;CEntity.SetCameraPos(dp+CEntity._camOffsetX,dn+CEntity._camOffsetY)}else{if(c4!=null){c4._posX=dp;c4._posY=dn}else{if(dx!=null){dx[DParamIndex.POSX]=Math_FixedPointToInt(dp);dx[DParamIndex.POSY]=Math_FixedPointToInt(dn)}}}}}if(dq){e.EndCinemitic(dF);if((e._cinematicsStatus[dF]&DCinematic.STATUS_CIRCLE)!=0){e.StartCinemitic(dF)}if((e._tempLevelId==e._finalLevelIndex)&&(e._levelFinalInfo1!=1)){e._levelFinalInfo1=1;e.RMS_Save()}}}}return dy};e.ActiveEntityOrCinematic=function(c6){if(c6>0){var c4=CEntity.GetRowDataByID(c6);if(c4!=null){var c3=CEntity.GetEntityByID(c6,true);if(c3!=null&&!c3.CheckFlag(DFlags.DYNAMIC_CREATE)){return c3}}else{var c5=e.GetCinematicIndex(c6);if(c5>=0){if(e._cinematicsFrameTime[c5]<0){e.StartCinemitic(c5)}else{e._cinematicsStatus[c5]|=DCinematic.STATUS_CIRCLE}}else{if(DEF.dbgErr){Dbg("Could not find object: id = "+c6)}}}}return null};e.InactiveEntityOrCinematic=function(c7,c3){if(c7>0){var c5=CEntity.GetRowDataByID(c7);if(c5!=null){var c4=CEntity.GetEntityByID(c7,false);if(c4!=null&&!c4.CheckFlag(DFlags.DYNAMIC_CREATE)){c4.SetInactived(true);return c4}}else{var c6=e.GetCinematicIndex(c7);if(c6>=0){e._cinematicsStatus[c6]&=~DCinematic.STATUS_CIRCLE}else{if(DEF.dbgErr){System.out.print("error id: "+c7)}}}}return null};e._checkPointData=null;e.CHECK_POINT_MAX_SIZE=20;e.SaveCheckPoint=function(c4,c5,c3,c8){if(e._checkPointData==null){e._checkPointData=LowAPI.Gen_Array([e.CHECK_POINT_MAX_SIZE],0)}var c6=0;if(c4==e._checkPointData[0]){return}e._checkPointData[c6++]=c4;if(CEntity._hero==null){e._checkPointData[c6++]=-1}else{e._checkPointData[c6++]=CEntity._hero._id;if(CEntity._hero.CheckFlag(DFlags.FLIP_Y)){e._checkPointData[c6++]=Math_FixedPointToInt(CEntity._hero._posX);e._checkPointData[c6++]=Math_FixedPointToInt(c8+CEntity._hero._boundingBox[DEF.BOX_BOTTOM])}else{e._checkPointData[c6++]=Math_FixedPointToInt(CEntity._hero._posX);e._checkPointData[c6++]=Math_FixedPointToInt(c8)}e._checkPointData[c6++]=CEntity._HeroInElectric}if(CEntity._camera==null){e._checkPointData[c6++]=-1}else{e._checkPointData[c6++]=CEntity._camera._id;e._checkPointData[c6++]=CEntity._camera._curTrace;if(CEntity._camera._curTrace>0){e._checkPointData[c6++]=Math_FixedPointToInt(CEntity._hero._posX-DEF.VIEW_W_D2_FLOAT)}else{e._checkPointData[c6++]=Math_FixedPointToInt(CEntity._camera._posX)}e._checkPointData[c6++]=Math_FixedPointToInt(CEntity._camera._posY)}if(CEntity._boss==null){e._checkPointData[c6++]=-1}else{e._checkPointData[c6++]=CEntity._boss._id;e._checkPointData[c6++]=-1;e._checkPointData[c6++]=0}var c7=CEntity.GetEntityByID(c5,false);if(c7==null){e._checkPointData[c6++]=-1}else{e._checkPointData[c6++]=c5;e._checkPointData[c6++]=c7._curTrace;e._checkPointData[c6++]=Math_FixedPointToInt(c7._posX);e._checkPointData[c6++]=Math_FixedPointToInt(c7._posY)}};e.LoadCheckPoint=function(){if(e._checkPointData!=null){var da=0;var db=e._checkPointData[da++];var c9=CEntity.GetRowDataByID(e._checkPointData[da++]);if(c9!=null){c9[DParamIndex.POSX]=e._checkPointData[da++];c9[DParamIndex.POSY]=e._checkPointData[da++];CEntity._HeroInElectric=e._checkPointData[da++];CEntity._hero=CEntity.GetEntityByID(c9[DParamIndex.ID],true);if(CEntity._hero!=null){CEntity._hero.SetPos(Math_IntToFixedPoint(c9[DParamIndex.POSX]),Math_IntToFixedPoint(c9[DParamIndex.POSY]));CEntity.SetCameraFocus(CEntity._hero,true)}}var c4=e._checkPointData[da++];var c6=CEntity.GetRowDataByID(c4);if(c4!=-1){var df=e._checkPointData[da++];var c5=Math_IntToFixedPoint(e._checkPointData[da++]);var c3=Math_IntToFixedPoint(e._checkPointData[da++]);if(CEntity._camera==null){CEntity._camera=CEntity.GetDefaultCamera()}if(CEntity._camera!=null){if(df!=-1){c6[DParamIndex.CAMERA_TRACE]=df;c6[DParamIndex.POSX]=Math_FixedPointToInt(c5);c6[DParamIndex.POSY]=Math_FixedPointToInt(c3);CEntity._camera=CEntity.GetEntityByID(c6[DParamIndex.ID],true)}CEntity._camera._curTrace=df;CEntity.SetCameraFocus(CEntity._hero,true);CEntity._camera.SetPos(c5,c3);CEntity._camera.AI_CameraDest()}}var dd=e._checkPointData[da++];var c8=CEntity.GetRowDataByID(dd);if(dd!=-1){var de=e._checkPointData[da++]}var dg=e._checkPointData[da++];var c7=CEntity.GetRowDataByID(dg);if(dg!=-1){var df=e._checkPointData[da++];var c5=Math_IntToFixedPoint(e._checkPointData[da++]);var c3=Math_IntToFixedPoint(e._checkPointData[da++]);var dc=CEntity.GetEntityByID(dg,true);if(dc!=null){dc._curTrace=df;dc.SetPos(c5,c3)}}}};e.DrawLine_FixedPoint=function(c4,c6,c3,c5){DrawLine(Math_FixedPointToInt(c4-CEntity._camX),Math_FixedPointToInt(c6-CEntity._camY),Math_FixedPointToInt(c3-CEntity._camX),Math_FixedPointToInt(c5-CEntity._camY))};e.DrawRect_FixedPoint=function(c3,c6,c4,c5){DrawRect(Math_FixedPointToInt(c3-CEntity._camX),Math_FixedPointToInt(c6-CEntity._camY),Math_FixedPointToInt(c4),Math_FixedPointToInt(c5))};e.DrawString_FixedPoint=function(c5,c3,c6,c4){DrawString(c5,Math_FixedPointToInt(c3-CEntity._camX),Math_FixedPointToInt(c6-CEntity._camY),c4)};e.DrawAFrame_FixedPoint=function(c6,c5,c7,c3,c8,c4){e.spriteArray[c6].PaintAFrame(g,c5,c7,Math_FixedPointToInt(c3-CEntity._camX),Math_FixedPointToInt(c8-CEntity._camY),c4&DFlags.SPRITE_FLAG_MASK)};e.DrawAnimation=function(c8,c6,c3,c9,c4){var c7=e.spriteArray[c8].GetAFrameTime(c6,0);var c5=Math.floor(s_game_currentFrameNB/c7)%e.spriteArray[c8].GetAFrames(c6);e.spriteArray[c8].PaintAFrame(g,c6,c5,c3,c9,c4&DFlags.SPRITE_FLAG_MASK)};e.prototype.BuildCacheImages=function(c4,c3){if(c4._module_image_imageAA==null){c4._module_image_imageAA=LowAPI.Gen_Array([c4._palettes],null)}if(c4._module_image_imageAA[c3]==null){c4._module_image_imageAA[c3]=LowAPI.Gen_Array([c4._nModules],null)}for(var c5=0;c5<c4._nModules;c5++){if(c4._module_types[c5]==ASprite.MD_IMAGE){var c6=0;if(GLLibConfig.sprite_useModuleDataOffAsShort){c6=c4._modules_data_off_short[c5]&65535}else{c6=c4._modules_data_off_int[c5]}c4._module_image_imageAA[c3][c5]=createRGBImageCache(c4,c4._modules_data,c3,c6,c4.GetModuleWidth(c5),c4.GetModuleHeight(c5))}}};e.prototype.createRGBImageCache=function(c4,c9,dg,dc,c7,c6){var de=0;var c8=c7*c6;var c5=0;var dd=false;var c3=c4._pal_short[0][dg];var db=LowAPI.Gen_Array([c7*c6],0);if(c4._data_format==ASprite.ENCODE_FORMAT_I256){while(de<c8){c5=c3[c9[dc++]&255];if((c5&61440)!=61440){dd=true}db[de++]=converColorShortToInt(c5)}}else{if(c4._data_format==ASprite.ENCODE_FORMAT_I127RLE){while(de<c8){var df=c9[dc++]&255;if(df>127){var da=c9[dc++]&255;c5=c3[da];df-=128;while(df-->0){db[de++]=converColorShortToInt(c5)}}else{db[de++]=converColorShortToInt(c3[df])}}}}return Image.createRGBImage(db,c7,c6,true)};e.prototype.converColorShortToInt=function(c3){return(((c3&61440)<<16)|((c3&61440)<<12)|((c3&3840)<<12)|((c3&3840)<<8)|((c3&240)<<8)|((c3&240)<<4)|((c3&15)<<4)|((c3&15)))};e.s_rewindEffectFrame=0;e.k_gradientYellow=0;e.k_gradientRed=1;e.k_gradientWhite=2;e.k_gradientLBlur=3;e.k_gradientRBlur=4;e.k_gradientLRewind=5;e.k_gradientRRewind=6;e.paintVideoRewindEffect=function(c3){e.s_rewindEffectFrame++;var c4=(e.s_rewindEffectFrame&1)==0;paintVerticalGradientEffect(c3,0,60,DEF.VIEW_W,24,c4?60:110,e.k_gradientLRewind);paintVerticalGradientEffect(c3,0,80,DEF.VIEW_W,15,c4?110:80,e.k_gradientLRewind);paintVerticalGradientEffect(c3,0,120,DEF.VIEW_W,20,c4?60:110,e.k_gradientRRewind);paintVerticalGradientEffect(c3,0,125,DEF.VIEW_W,27,c4?110:80,e.k_gradientLRewind);paintVerticalGradientEffect(c3,0,210,DEF.VIEW_W,15,c4?60:110,e.k_gradientRRewind);paintVerticalGradientEffect(c3,0,245,DEF.VIEW_W,18,c4?80:120,e.k_gradientLRewind);paintVerticalGradientEffect(c3,0,260,DEF.VIEW_W,10,c4?60:90,e.k_gradientRRewind);paintVerticalGradientEffect(c3,0,263,DEF.VIEW_W,15,c4?110:80,e.k_gradientLRewind)};e.desaturateBlock=function(df,c4,c5){for(var c8=0;c8<df;c8++){var db=c4[c8];var c9=(db)&16711680;var dc=(db)&65280;var da=(db)&255;var c3=((c9>>16)+(dc>>8)+da+16)>>2;var c6=(c3<<16);var dd=(c3<<8);var de=(c3);c6=c9+((c6-c9)*c5>>7);dd=dc+((dd-dc)*c5>>7);de=da+((de-da)*c5>>7);var c7=(c6&16711680)|(dd&65280)|de;c4[c8]=c7}};e.paintDesaturatedEffect=function(c9,dd,dc,c4,de,c6){try{var c5=ASprite.transform_int;var c3=GLLibConfig.TMP_BUFFER_SIZE/c4;var c7=80;var db=0;var c8=false;while(!c8){c7=de-db;if(c7>c3){c7=c3-1}else{c8=true}var df=c4*c7;desaturateBlock(df,c5,c6);c9.drawRGB(c5,0,c4,dd,dc+db,c4,c7,false);db+=c7}}catch(da){if(DEF.dbgEnable){Dbg("-------------------- error : "+da.message)}}};e.blurDesaturateBlock=function(dc,dj,di,c8){var dh=0;var c7=0;var da=0;var c3=0;for(var de=dc-1;de>=0;de--){var dd=dj[de];var dk=(dd)&16711935;var dl=(dd)&65280;da=(dk+((da-dk)*di>>7))&16711935;c3=(dl+((c3-dl)*di>>7))&65280;var df=da|c3;dj[de]=df}for(var de=0;de<dc;de++){var dd=dj[de];var dg=(dd)&16711680;var dl=(dd)&65280;var c6=(dd)&255;dh=dg+((dh-dg)*di>>7);c3=dl+((c3-dl)*di>>7);c7=c6+((c7-c6)*di>>7);var c5=((dh>>16)+(c3>>8)+c7+16)>>2;var c4=(c5<<16);var c9=(c5<<8);var db=(c5);c4=dh+((c4-dh)*c8>>7);c9=c3+((c9-c3)*c8>>7);db=c7+((db-c7)*c8>>7);var df=(c4&16711680)|(c9&65280)|db;dj[de]=df}};e.paintIGMBlurEffect=function(c9,df,de,c4,dg,da,c6){try{var c5=ASprite.transform_int;var dd=da%128;var c3=GLLibConfig.TMP_BUFFER_SIZE/c4;var c7=80;var dc=0;var c8=false;while(!c8){c7=dg-dc;if(c7>c3){c7=c3-1}else{c8=true}var dh=c4*c7;blurDesaturateBlock(dh,c5,dd,c6);c9.drawRGB(c5,0,c4,df,de+dc,c4,c7,false);dc+=c7}}catch(db){if(DEF.dbgEnable){Dbg("-------------------- error : "+db.message)}}};e.blurRBlock=function(dc,c4,c8){var c9=0;var c3=0;for(var c6=dc-1;c6>=0;c6--){var c7=c4[c6];var da=(c7)&16711935;var db=(c7)&65280;c9=(da+((c9-da)*(c8)>>7))&16711935;c3=(db+((c3-db)*(c8)>>7))&65280;var c5=c9|c3;c4[c6]=c5}};e.blurLBlock=function(dc,c4,c8){var c9=0;var c3=0;for(var c6=0;c6<dc;c6++){var c7=c4[c6];var da=(c7)&16711935;var db=(c7)&65280;c9=(da+((c9-da)*(c8)>>7))&16711935;c3=(db+((c3-db)*(c8)>>7))&65280;var c5=c9|c3;c4[c6]=c5}};e.paintBlurEffect=function(c9,df,de,c4,dg,dd,c8){try{var c5=ASprite.transform_int;var dc=c8%128;var c3=GLLibConfig.TMP_BUFFER_SIZE/c4;var c6=80;var db=0;var c7=false;while(!c7){c6=dg-db;if(c6>c3){c6=c3-1}else{c7=true}var dh=c4*c6;if(dd==0){blurRBlock(dh,c5,dc)}else{blurLBlock(dh,c5,dc)}c9.drawRGB(c5,0,c4,df,de+db,c4,c6,false);db+=c6}}catch(da){if(DEF.dbgEnable){Dbg("-------------------- error : "+da.message)}}};e.paintBlurEffectCurved=function(dp,dd,dc,dl,dh,c7,c9){try{if(dd+dl>DEF.SCR_W){dl=DEF.SCR_W-dd}if(dc+dh>DEF.SCR_H){dh=DEF.SCR_H-dc}if(dd<0){dl+=dd;dd=0}if(dc<0){dh+=dc;dc=0}if(dl<=0||dh<=0){return}var ds=ASprite.transform_int;var dr=c9;if(dr>127){dr=127}if(dr<0){dr=0}var df=GLLibConfig.TMP_BUFFER_SIZE/dl;var da=80;var db=0;var c3=0;var de=0;var c5=0;var dj=0;var di=false;var c8=0;var c6=0;var c4=0;while(!di){da=dh-dj;if(da>df){da=df-1}else{di=true}var dg=dl*da;if(c7==0){for(var dn=dg-1;dn>=0;dn--){var dk=ds[dn];var dt=(dk)&16711935;var du=(dk)&65280;db=(dt+((db-dt)*(dr)>>7))&16711935;c3=(du+((c3-du)*(dr)>>7))&65280;var dm=db|c3;ds[dn]=dm}}else{if(c7==1){for(var dn=0;dn<dg;dn++){var dk=ds[dn];var dt=(dk)&16711935;var du=(dk)&65280;c6++;if(c6>dl){c6=1;if(c4==0){c8++;if(c8>dh>>1){c4=1}}else{c8--}db=dt;c3=du;de=(dr*c8)/(dh>>1);if(de>100){de=100}}db=(dt+((db-dt)*(de)>>7))&16711935;c3=(du+((c3-du)*(de)>>7))&65280;var dm=db|c3;ds[dn]=dm}}else{if(c7==2){for(var dn=dg-1;dn>=0;dn--){var dk=ds[dn];var dt=(dk)&16711935;var du=(dk)&65280;c6++;if(c6>dl){c6=1;if(c4==0){c8++;if(c8>dh>>1){c4=1}}else{c8--}db=dt;c3=du;de=(dr*c8)/(dh>>1);if(de>100){de=100}}db=(dt+((db-dt)*(de)>>7))&16711935;c3=(du+((c3-du)*(de)>>7))&65280;var dm=db|c3;ds[dn]=dm}}}}dp.drawRGB(ds,0,dl,dd,dc+dj,dl,da,false);dj+=da}}catch(dq){Dbg("ERROR: ----------------- "+dq.message)}};e.CLAMP_R=function(c3){return(((c3<<7)>>31)|c3)&16711680};e.CLAMP_G=function(c3){return(((c3<<15)>>31)|c3)&65280};e.CLAMP_B=function(c3){return(((c3<<23)>>31)|c3)&255};e.gradientRedLine=function(c3,de,c4,da){var df=da<<16;da+=128;for(var c9=c3-1;c9>=0;c9--){var c8=c4[de];var c5=(c8)&16711680;var dg=(c8)&65280;var dd=(c8)&255;var c7=c5+df;c7=CLAMP_R(c7);var dc=dg*da>>7;dc=CLAMP_G(dc);var db=dd*da>>7;db=CLAMP_B(db);var c6=c7|dc|db;c4[de]=c6;de++}return de};e.gradientYellowLine=function(c3,de,c5,da){var df=da<<16;var dh=da<<8;da+=128;for(var c9=c3-1;c9>=0;c9--){var c8=c5[de];var c4=(c8)&16711680;var dg=(c8)&65280;var dd=(c8)&255;var c7=c4+df;c7=CLAMP_R(c7);var dc=dg+dh;dc=CLAMP_G(dc);var db=(dd*da)>>7;db=CLAMP_B(db);var c6=c7|dc|db;c5[de]=c6;de++}return de};e.gradientWhiteLine=function(c3,de,c4,da){da+=128;for(var c9=c3-1;c9>=0;c9--){var c8=c4[de];var c5=(c8)&16711680;var df=(c8)&65280;var dd=(c8)&255;var c7=c5*da>>7;c7=CLAMP_R(c7);var dc=df*da>>7;dc=CLAMP_G(dc);var db=dd*da>>7;db=CLAMP_B(db);var c6=c7|dc|db;c4[de]=c6;de++}return de};e.gradientRBlurLine=function(c4,db,c5,c9){var da=0;var c3=0;for(var c8=c4-1;c8>=0;c8--){var c7=c5[db];var dc=(c7)&16711935;var dd=(c7)&65280;da=(dc+((da-dc)*(c9)>>7))&16711935;c3=(dd+((c3-dd)*(c9)>>7))&65280;var c6=da|c3;c5[db]=c6;db++}return db};e.gradientLBlurLine=function(c4,db,c5,c9){var da=0;var c3=0;db+=c4-1;for(var c8=c4-1;c8>=0;c8--){var c7=c5[db];var dc=(c7)&16711935;var dd=(c7)&65280;da=(dc+((da-dc)*(c9)>>7))&16711935;c3=(dd+((c3-dd)*(c9)>>7))&65280;var c6=da|c3;c5[db]=c6;db--}db+=c4;return db};e.gradientRRewindLine=function(c4,de,c6,da){var dc=0;var c3=0;var db=da+128;for(var c9=c4-1;c9>=0;c9--){var c8=c6[de];var c5=(c8)&16711680;var dg=(c8)&65280;var dd=(c8)&255;c5=c5*db>>7;c5=CLAMP_R(c5);dg=dg*db>>7;dg=CLAMP_G(dg);dd=dd*db>>7;dd=CLAMP_B(dd);var df=c5|dd;dc=(df+((dc-df)*(da)>>7))&16711935;c3=(dg+((c3-dg)*(da)>>7))&65280;var c7=dc|c3;c6[de]=c7;de++}return de};e.gradientLRewindLine=function(c4,de,c6,da){var dc=0;var c3=0;var db=da+128;de+=c4-1;for(var c9=c4-1;c9>=0;c9--){var c8=c6[de];var c5=(c8)&16711680;var dg=(c8)&65280;var dd=(c8)&255;c5=c5*db>>7;c5=CLAMP_R(c5);dg=dg*db>>7;dg=CLAMP_G(dg);dd=dd*db>>7;dd=CLAMP_B(dd);var df=c5|dd;dc=(df+((dc-df)*(da)>>7))&16711935;c3=(dg+((c3-dg)*(da)>>7))&65280;var c7=dc|c3;c6[de]=c7;de--}de+=c4;return de};e.paintVerticalGradientEffect=function(c8,c4,c9,c7,c3,c5,c6){this.paintVerticalGradientEffect(c8,c4,c9,c7,c3,c5,c6,0,c3)};e.paintVerticalGradientEffect=function(dm,dc,db,dj,dh,c8,c4,de,dp){try{var dr=ASprite.transform_int;var dd=((GLLibConfig.TMP_BUFFER_SIZE/dj)&(~1));var da=80;var dl=0;var c3=0;var c7=0;var c5=2;if(c4==e.k_gradientLBlur||c4==e.k_gradientRBlur){c5=1}var di=0;var dg=false;while(!dg){da=dh-di;if(da>dd){da=dd}else{dg=true}var c6=0;var c9=-1;var df=0;for(var dk=0;dk<da;dk+=c5){var dq=Math_FixedPoint_Multiply(c8,Math_Sin((di+dk+de)*Math_Angle180/dp));dq=Math.abs(dq);dq=dq&(~7);if((dq>>4)==0){c6+=dj*c5;continue}else{if(c9<0){c9=dk}df=dk}if(c4==e.k_gradientRed){c6=gradientRedLine(dj,c6,dr,dq)}else{if(c4==e.k_gradientYellow){c6=gradientYellowLine(dj,c6,dr,dq)}else{if(c4==e.k_gradientWhite){c6=gradientWhiteLine(dj,c6,dr,dq)}else{if(c4==e.k_gradientRBlur){c6=gradientRBlurLine(dj,c6,dr,dq)}else{if(c4==e.k_gradientLBlur){c6=gradientLBlurLine(dj,c6,dr,dq)}else{if(c4==e.k_gradientRRewind){c6=gradientRRewindLine(dj,c6,dr,dq)}else{if(c4==e.k_gradientLRewind){c6=gradientLRewindLine(dj,c6,dr,dq)}}}}}}}if(c5>1){c6+=dj}}if(c9>=0){dm.drawRGB(dr,c9*dj,dj,dc,db+di+c9,dj,df-c9+1,false)}di+=da}}catch(dn){if(DEF.dbgEnable){Dbg("-------------------- error : "+dn.message)}}};e.s_swarmSprite=null;e.s_splashSprite=null;e.s_bloodSprite=null;e.s_rainSprite=null;e.s_swarmFrame=0;e.s_swarmDir=0;e.s_swarmStrength=0;e.s_swarmBoxer=0;e.s_useBlood=false;e.s_bloodAnim=0;e.s_bloodScreenX=0;e.s_bloodScreenY=0;e.s_dustFrame=0;e.s_dustDummyId=0;e.s_dustSprite=null;e.s_dustBoxer=0;e.k_dust1=0;e.s_flashType=0;e.s_flashFrame=0;e.s_flashDummyId=0;e.s_flashBoxer=0;e.s_flashInForeground=false;e.k_effectShockwave=0;e.k_effectColorShockwave=1;e.s_effectSprite=null;e.s_effectAnim=0;e.s_effectType=0;e.s_effectFrame=0;e.s_effectDummyId=0;e.s_effectBoxer=0;e.s_effectInForeground=false;e.s_hitMarks=null;e.s_hitMarkPalette=0;e.s_hitMarkX=0;e.s_hitMarkY=0;e.s_hitMarkZ=0;e.s_hitMarkAnim=0;e.s_hitMarkFrame=0;e.k_fadeIn=0;e.k_fadeOut=1;e.s_fadeType=0;e.s_fadeDuration=0;e.s_fadeTime=0;e.k_cinematicBarsHeight=45;e.initDustEffect=function(c4,c3){s_dustFrame=0;s_dustDummyId=c3;s_dustBoxer=c4};e.initSwarmEffect=function(c3,c5,c4){s_swarmFrame=0;s_swarmDir=c3;s_swarmStrength=c5;s_swarmBoxer=c4;e.s_useBlood=false;if(false){s_swarmSprite.SetCurrentPalette(1);e.s_useBlood=true}else{s_swarmSprite.SetCurrentPalette(0)}s_bloodAnim=Math_Rand(0,s_bloodSprite._anims_naf.length);s_bloodScreenX=Math_Rand(0,0+DEF.VIEW_W);s_bloodScreenY=Math_Rand(0,DEF.VIEW_H)};e.initFlashEffect=function(c5,c6,c4,c3){s_flashFrame=0;s_flashType=c5;s_flashBoxer=c4;s_flashDummyId=c3;e.s_flashInForeground=c6};e.initEffect=function(c5,c7,c6,c4,c3){s_effectFrame=0;s_effectAnim=c7;s_effectType=c5;s_effectBoxer=c4;s_effectDummyId=c3;e.s_effectInForeground=c6};e.updateEffects=function(){};e.s_cinematicFrame=0;e.k_directionLeft=0;e.k_directionRight=1;e.k_directionFwd=2;e.k_strengthStrong=3;e.paintSwarmEffect=function(c6,c8,c3,da){var c7=0;var c5=0;if(s_swarmFrame>=0&&s_swarmFrame<100&&c8==true){c6.setClip(0,0,DEF.VIEW_W,DEF.VIEW_H);if(s_swarmDir==e.k_directionLeft){c7=0}else{if(s_swarmDir==e.k_directionRight){c7=1}else{if(s_swarmDir==e.k_directionFwd){c7=2}}}if(s_swarmStrength==e.k_strengthStrong){c7+=3}var c4=s_swarmSprite.GetAFrames(c7);if(s_swarmFrame<c4){s_swarmSprite.PaintAFrame(c6,c7,s_swarmFrame,c3,da,0)}else{if(true){if(e.s_useBlood){var c9=s_swarmFrame-c4;if(c9>=0&&c9<s_bloodSprite.GetAFrames(s_bloodAnim)){s_bloodSprite.PaintAFrame(c6,s_bloodAnim,c9,s_bloodScreenX,s_bloodScreenY,0)}else{s_swarmFrame=100}}else{var c9=s_swarmFrame-c4;if(c9>=0&&c9<s_splashSprite.GetAFrames(0)){s_splashSprite.PaintAFrame(c6,0,c9,0,0,0)}else{s_swarmFrame=100}}}else{s_swarmFrame=100}}s_swarmFrame++;resetClip(c6)}};e.paintDustEffect=function(c5,c6,c3,c7){if(s_dustFrame>=0&&s_dustFrame<100&&c6==true){c5.setClip(0,0,DEF.VIEW_W,DEF.VIEW_H);var c4=s_dustSprite.GetAFrames(e.k_dust1);if(s_dustFrame<c4){s_dustSprite.PaintAFrame(c5,e.k_dust1,s_dustFrame,c3,c7,0)}else{s_dustFrame=100}resetClip(c5);s_dustFrame++}};e.paintFlashEffect=function(c5,c6,c4,c8){if(false){s_flashFrame=100;return}if(e.s_flashInForeground==c6){if(s_flashFrame>=0&&s_flashFrame<7){c5.setClip(0,0,DEF.VIEW_W,DEF.VIEW_H);var c3=DEF.SCR_H/3;var c7=c8-c3/2;paintVerticalGradientEffect(c5,0,c7,DEF.VIEW_W,c3,(15-s_flashFrame*2)<<3,s_flashType);s_flashFrame++;resetClip(c5)}}};e.paintShockwaveEffect=function(c6,c7,c3,c8){var c5=0;if(e.s_effectInForeground==c7){if(s_effectType==e.k_effectShockwave){c5=CBlendSprite.BLEND_DISPLACEMENT}else{if(s_effectType==e.k_effectColorShockwave){c5=CBlendSprite.BLEND_COLOR_DISPLACEMENT}}var c4=s_effectSprite.GetAFrames(s_effectAnim);if(s_effectFrame>=0&&s_effectFrame<c4){c6.setClip(0,0,DEF.VIEW_W,DEF.VIEW_H);s_effectSprite._blend=c5;s_effectSprite.PaintAFrame(c6,s_effectAnim,s_effectFrame,c3,c8,0);s_effectFrame++;resetClip(c6)}else{s_effectFrame=100}}};e.paintHitMarkEffect=function(c4,c5,c3,c6){if(c5==true&&e.s_hitMarkAnim>=0){c4.setClip(0,0,DEF.VIEW_W,DEF.VIEW_H);s_hitMarks.SetCurrentPalette(e.s_hitMarkPalette);s_hitMarks.PaintAFrame(c4,e.s_hitMarkAnim,e.s_hitMarkFrame,c3,c6,0);e.s_hitMarkFrame+=2;if(e.s_hitMarkFrame>=s_hitMarks.GetAFrames(e.s_hitMarkAnim)){e.s_hitMarkAnim=-1}resetClip(c4)}};e.paintCinematicEffects=function(c3,c4){if(c4==true){if(false){e.s_cinematicFrame+=5}else{e.s_cinematicFrame-=5}if(e.s_cinematicFrame>e.k_cinematicBarsHeight){e.s_cinematicFrame=e.k_cinematicBarsHeight}if(e.s_cinematicFrame<0){e.s_cinematicFrame=0}if(e.s_cinematicFrame>0){resetClip(c3);c3.setColor(0);c3.fillRect(0,0,DEF.VIEW_W,e.s_cinematicFrame);c3.fillRect(0,DEF.SCR_H-e.s_cinematicFrame,DEF.VIEW_W,e.s_cinematicFrame)}}};e.paintEffects=function(c3,c4){if((s_game_currentFrameNB%60)==0){initDustEffect(0,0)}if((s_game_currentFrameNB%20)==0){initFlashEffect(1,true,0,0)}if((s_game_currentFrameNB%80)==0){initEffect(e.k_effectShockwave,0,true,0,0)}if((s_game_currentFrameNB%20)==0){e.s_hitMarkAnim=Math_Rand(0,4);e.s_hitMarkFrame=0}paintCinematicEffects(c3,c4)};e.speed1=1;e.s1=24;e.speed2=3;e.s2=42;e.speed3=1;e.s3=90;e.speed4=4;e.s4=50;e._shine_pos=[[e.s1+0*e.speed1,e.s1+1*e.speed1,-1,e.s1+3*e.speed1,e.s1+4*e.speed1,e.s1+5*e.speed1,-1,e.s1+7*e.speed1,-1,e.s1+7*e.speed1,e.s1+6*e.speed1,e.s1+5*e.speed1,-1,e.s1+3*e.speed1,e.s1+2*e.speed1,-1],[e.s2-0*e.speed2,e.s2-1*e.speed2,e.s2-2*e.speed2,e.s2-3*e.speed2,e.s2-4*e.speed2,e.s2-5*e.speed2,e.s2-6*e.speed2,e.s2-7*e.speed2,e.s2-8*e.speed2,e.s2-7*e.speed2,e.s2-6*e.speed2,e.s2-5*e.speed2,e.s2-4*e.speed2,e.s2-3*e.speed2,e.s2-2*e.speed2,e.s2-1*e.speed2,e.s2-0*e.speed2,e.s2+1*e.speed2,e.s2+2*e.speed2,e.s2+1*e.speed2],[e.s3-0*e.speed3,e.s3-1*e.speed3,e.s3-2*e.speed3,e.s3-3*e.speed3,e.s3-4*e.speed3,e.s3-5*e.speed3,e.s3-6*e.speed3,e.s3-7*e.speed3,e.s3-8*e.speed3,e.s3-7*e.speed3,e.s3-6*e.speed3,e.s3-5*e.speed3,e.s3-4*e.speed3,e.s3-3*e.speed3,e.s3-2*e.speed3,e.s3-1*e.speed3,e.s3-0*e.speed3,e.s3+1*e.speed3],[e.s4+0*e.speed4,e.s4+1*e.speed4,e.s4+2*e.speed4,e.s4+3*e.speed4,e.s4+4*e.speed4,e.s4+5*e.speed4,e.s4+4*e.speed4,e.s4+3*e.speed4,e.s4+3*e.speed4,e.s4+1*e.speed4,e.s4+0*e.speed4,e.s4-1*e.speed4,e.s4-2*e.speed4,e.s4-3*e.speed4,e.s4-4*e.speed4,e.s4-5*e.speed4,e.s4-6*e.speed4,e.s4-7*e.speed4,e.s4-8*e.speed4,e.s4-7*e.speed4,e.s4-6*e.speed4,e.s4-5*e.speed4,e.s4-4*e.speed4,e.s4-3*e.speed4,e.s4-2*e.speed4,e.s4-1*e.speed4]];e._shineImgs=null;e.USE_EFFECT_IMAGE=true;e._shine_4444=null;e._shine_area=[[44,107,68,107,26],[34,93,52,93,26]];e.DrawShine=function(c4,c3){for(var c6=0;c6<_shine_pos.length;++c6){var c5=s_game_currentFrameNB%(_shine_pos[c6].length);var c7=_shine_pos[c6][c5];if(c7>=0){if(e.USE_EFFECT_IMAGE){g.drawImage(_shineImgs[c6],c4,c7+c3,0)}else{}}}_shine_pos[3][0]+=1;if(_shine_pos[3][0]>90){_shine_pos[3][0]=-50}};e.InitShineEffect=function(){_shine_4444=LowAPI.Gen_Array([4],null);if(e.USE_EFFECT_IMAGE){_shineImgs=new Image[6];var c3;c3=LowAPI.Gen_Array([44*34],0);Bresenham_Line_8888(0,0,44,24,180,0,10,c3,44);_shineImgs[0]=Image.createRGBImage(c3,44,34,true);c3=LowAPI.Gen_Array([107*93],0);Bresenham_Line_8888(0,0,107,53,85,0,40,c3,107);_shineImgs[1]=Image.createRGBImage(c3,107,93,true);c3=LowAPI.Gen_Array([68*52],0);Bresenham_Line_8888(0,0,68,32,120,0,20,c3,68);_shineImgs[2]=Image.createRGBImage(c3,68,52,true);_shineImgs[3]=_shineImgs[1];c3=LowAPI.Gen_Array([26*26],0);Bresenham_Line_8888(0,0,26,26,0,250,1,c3,26);_shineImgs[4]=Image.createRGBImage(c3,26,26,true);c3=LowAPI.Gen_Array([24*72],0);Bresenham_Line_8888(0,0,0,71,0,250,24,c3,24);_shineImgs[5]=Image.createRGBImage(c3,24,72,true);c3=null}else{_shine_4444[0]=LowAPI.Gen_Array([44*34],0);Bresenham_Line_4444(0,0,44,24,180,0,10,_shine_4444[0],44);_shine_4444[1]=LowAPI.Gen_Array([107*93],0);Bresenham_Line_4444(0,0,107,53,85,0,40,_shine_4444[1],107);_shine_4444[2]=LowAPI.Gen_Array([68*52],0);Bresenham_Line_4444(0,0,68,32,120,0,20,_shine_4444[2],68);_shine_4444[3]=_shine_4444[1]}};e.Bresenham_Line_4444=function(dk,c5,dj,c4,dg,de,df,da,c3){var dd=dj-dk;var dc=c4-c5;var dl=dd>0?-dd:dd;var c7=dd>0?1:-1;var db=dk;var c9=c5;var c8=c5*c3+dk;dg<<=8;de<<=8;var dn=(de-dg)/dd;for(var di=0;di<dd;di++){var c6=c8;var dm=((dg)|4090);var dh=0;for(;dh<df;++dh){da[c6]=dm;c6+=c3}dg+=dn;db+=c7;c8+=c7;dl+=dc<<1;if(dl>=0){c9++;c8+=c3;dl-=dd<<1}}};e.Bresenham_Line_8888=function(dk,c5,dj,c4,dg,de,df,db,c3){var dd=dj-dk;var dc=c4-c5;if(dd==0){var c8=c5*c3+dk;dg<<=8;de<<=8;var dn=(de-dg)/dc;for(var di=0;di<dc;di++){var c7=c8;var dh=0;var dm;for(;dh<4;++dh){dm=((((dg/5*(dh+1))&65280)<<16)|16776268);db[c7]=dm;++c7}dm=(((dg&65280)<<16)|16776268);for(;dh<df-4;++dh){db[c7]=dm;++c7}for(;dh<df;++dh){dm=(((((dg/5*(df-dh)))&65280)<<16)|16776268);db[c7]=dm;++c7}dg+=dn;c8+=c3}}else{var dl=dd>0?-dd:dd;var c6=dd>0?1:-1;var da=dk;var c9=c5;var c8=c5*c3+dk;dg<<=8;de<<=8;var dn=(de-dg)/dd;for(var di=0;di<dd;di++){var c7=c8;var dm=((dg<<16)|14408370);var dh=0;for(;dh<df;++dh){db[c7]=dm;c7+=c3}dg+=dn;da+=c6;c8+=c6;dl+=dc<<1;if(dl>=0){c9++;c8+=c3;dl-=dd<<1}}}};e.resetClip=function(c3){c3.setClip(0,0,DEF.SCR_W,DEF.SCR_H)};e._rbg_buffer_data=null;e._rgb_buffer_last_color=0;e.RGB_BUFFER_SIZE=64;e._rgb_buffer_img=null;e.FillArgbRect=function(c4,c7,c6,c3,c5){FillArgbRect(c4,c7,c6,c3,c5)};e.DrawArgbLine=function(c5,c8,c4,c6,c3){var c7=LowAPI.Gen_Array([4],0);c7[0]=g.getClipX();c7[1]=g.getClipY();c7[2]=g.getClipWidth();c7[3]=g.getClipHeight();g.setColor(c3);g.drawLine(c5,c8,c4,c6);SetClip(c7[0],c7[1],c7[2],c7[3])};e.DrawBresenhamLine=function(c9,de,dd,dj,c4,di,c3,dg){var dc=di-dj;var db=c3-c4;var dk=-Math.abs(dc);var c6=dc>0?1:-1;var da=dj;var c8=c4;var c7=c4*de+dj;for(var dh=0;dh<dc;dh++){var c5=c7;var df=0;for(;df<de;++df){c9[c5]=dg;c5+=de}da+=c6;c7+=c6;dk+=db<<1;if(dk>=0){c8++;c7+=de;dk-=dc<<1}}};e.RotateImage=function(dn,c3,dj,da,c8,c5,dA){var c9=c3+dj;var dq=c9;var du=c9/2;var dy=LowAPI.Gen_Array([c9*dq],0);var df,dB;df=Math_Sin(c5);dB=Math_Cos(c5);var c4=dB<<8;var db=df<<8;var dv=-df<<8;var dx=dB<<8;var dz=da;var dc=c8;var c7=dj/2;var dp=du;var dg=((-(dz+c7)*dB+(dc+dp)*df)<<8)+(dz<<16);var dm=((-(dz+c7)*df-(dc+dp)*dB)<<8)+(dc<<16);var dC=(dg);var ds=(dm);var c6=0;for(var dk=0;dk<dq;++dk){var dt=dC;var dw=ds;for(var dl=0;dl<c9;++dl){var di=(dt>>16);var dh=(dw>>16);var de=(di>=0)&&(di<c3)&&(dh>=0)&&(dh<dj);if(de){dy[c6]=dn[dh*c3+di]}c6++;dt+=c4;dw+=db}dC+=dv;ds+=dx}dA[0]=da-du;dA[1]=c8-du;dA[2]=c9;dA[3]=dq;return dy};e.MINI_MAP_STATE_OUT_LEVEL=0;e.MINI_MAP_STATE_NEW_LEVEL_OPEN=1;e.MINI_MAP_STATE_NEW_GAME=2;e.MINI_MAP_STATE_NEW_WORLD=3;e.MINI_MAP_STATE_CURSOR_MOVE_AUTO=4;e.MINI_MAP_STATE_IDLE=5;e.MINI_MAP_STATE_HERO_MOVE_TO=6;e.MINI_MAP_STATE_SWITCH_TO_LEVEL_ROOM=7;e.MINI_MAP_STATE_SWITCH_TO_WORLD_ROOM=8;e.MINI_MAP_STATE_ARE_YOU_SURE=9;e.MINI_MAP_STATE_ENTER_LEVEL=10;e.MINI_MAP_STATE_OVER=11;e.MINI_MAP_ALPHA_PAL=7;e.MINI_MAP_BOSS_ENABLE_PAL=6;e._miniMapState=e.MINI_MAP_STATE_IDLE;e._miniMapTick=0;e._miniMapLimit=null;e._miniMapLimitWorldRoom=[0,0,20*DEF.TILE_W,DEF.SCR_H];e._miniMapLimitLevelRoom=[22*DEF.TILE_W,0,38*DEF.TILE_W,DEF.SCR_H];e._miniMapRoomPoint=[DEF.TILE_W*5,DEF.TILE_H*12,DEF.TILE_W*3,DEF.TILE_H*9,DEF.TILE_W*17,DEF.TILE_H*9,DEF.TILE_W*15,DEF.TILE_H*12,DEF.TILE_W*10,DEF.TILE_H*7+DEF.TILE_H_D2,DEF.TILE_W*30,DEF.TILE_H*13,DEF.TILE_W*30,DEF.TILE_H*7+DEF.TILE_H_D2,DEF.TILE_W*25,DEF.TILE_H*9,DEF.TILE_W*35,DEF.TILE_H*9,DEF.TILE_W*30,DEF.TILE_H*10+DEF.TILE_H_D2,];e.MINI_MAP_WORLD_ROOM_POINTS_INDEX=0;e.MINI_MAP_LEVEL_ROOM_POINTS_INDEX=10;e.MINI_MAP_BOSS_LEVEL_ROOM_INDEX=18;e.MINI_MAP_BOSS_WORLD_ROOM_INDEX=8;e._miniMapCameraX=0;e._miniMapCameraY=0;e._miniMapHeroX=0;e._miniMapHeroY=0;e._miniMapHeroAnim=0;e._miniMapHeroFlags=0;e._miniMapHeroAtPoint=-1;e._miniMapCursorX=0;e._miniMapCursorY=0;e._miniMapCursorAtPoint=-1;e._miniMapNewLevelOpened=1;e._miniMapWorldIconAlpha=255;e._miniMapWorldIconAlphaStep=8;e._previousLevelID=-1;e.MINI_MAP_OFFSET_Y=2*DEF.TILE_H;e.MINI_MAP_CURSOR_VELOCITY=8*DScreen.RATIO;e.MINI_MAP_HERO_MOVE_VELOCITY=8*DScreen.RATIO;e.MINI_MAP_WATCH_SPEAK_TICK=15;e.MINI_MAP_WATCH_DISAPPEAR_TICK=20;e.MINI_MAP_WATCH_OVER_TICK=25;e.MINI_MAP_DOOR_LOCKED=0;e.MINI_MAP_DOOR_OPENED=1;e.MINI_MAP_DOOR_UNLOCKED=2;e.CheckMiniMapLimit=function(){e._miniMapCameraX=Math.max(e._miniMapCameraX,e._miniMapLimit[DEF.BOX_LEFT]);e._miniMapCameraY=Math.max(e._miniMapCameraY,e._miniMapLimit[DEF.BOX_TOP]);e._miniMapCameraX=Math.min(e._miniMapCameraX,e._miniMapLimit[DEF.BOX_RIGHT]-DEF.VIEW_W);e._miniMapCameraY=Math.min(e._miniMapCameraY,e._miniMapLimit[DEF.BOX_BOTTOM]-DEF.VIEW_H);e._miniMapCursorX=Math.max(e._miniMapCursorX,e._miniMapLimit[DEF.BOX_LEFT]);e._miniMapCursorY=Math.max(e._miniMapCursorY,e._miniMapLimit[DEF.BOX_TOP]);e._miniMapCursorX=Math.min(e._miniMapCursorX,e._miniMapLimit[DEF.BOX_RIGHT]);e._miniMapCursorY=Math.min(e._miniMapCursorY,e._miniMapLimit[DEF.BOX_BOTTOM]-e.MINI_MAP_OFFSET_Y)};e.LevelId2PointId=function(c4){var c3=(c4)%DAI.LEVELS_NUM_PRE_WORLD;c3=c3*2+e.MINI_MAP_LEVEL_ROOM_POINTS_INDEX+2;return c3};e.IsUnlockedWorld=function(c3){if(c3>=DAI.WORLD_ID_CASTLE*DAI.LEVELS_NUM_PRE_WORLD){return true}if(e._gameProgress==bb){return true}if(c3>=DAI.WORLD_ID_CASTLE*DAI.LEVELS_NUM_PRE_WORLD){return true}if(c3<0){return true}if(c3==0){return false}return c3%DAI.LEVELS_NUM_PRE_WORLD==0};e.GetLevelUnlocked=function(){for(var c3=0;c3<e._levelInfo.length;c3++){if(e._levelInfo[c3]==0){return c3-1}}return -1};e._miniMapLoadStep=0;e.MINI_MAP_LOADING_STEP=10;e.GotoMiniMap=function(){e.StopSound(DSound_Channel.BGM);M=false;if(e._miniMapLoadStep<e.MINI_MAP_LOADING_STEP){e.DrawSpecialEffect_Load_Unload_MiniMap(e._miniMapLoadStep);e.LoadMiniMap();e._miniMapLoadStep++;return}e._miniMapLoadStep=0;GLLibPlayer.Tileset_SetCamera(0,e._miniMapCameraX,e._miniMapCameraY);e._levelUnlocked=e.GetLevelUnlocked();e._worldId=Math.floor((e._levelUnlocked-1)/DAI.LEVELS_NUM_PRE_WORLD);e._worldId=e._worldId<0?0:e._worldId;if(e._gameProgress==bb){e._worldId=-1}if(e.IsUnlockedWorld(e._levelUnlocked)){e._miniMapLimit=e._miniMapLimitWorldRoom;var c3=e._worldId<<1;c3=Math.min(c3,e.MINI_MAP_BOSS_WORLD_ROOM_INDEX);var c4=0;if(e._gameProgress==bb){c3=DAI.WORLD_ID_SPACE<<1;c4=-2*DEF.TILE_W}e._miniMapHeroX=e._miniMapRoomPoint[c3]+c4;e._miniMapHeroY=e._miniMapRoomPoint[c3+1];e._miniMapHeroAtPoint=c3}else{e._miniMapLimit=e._miniMapLimitLevelRoom;var c3=e.LevelId2PointId(e._tempLevelId);e._miniMapHeroX=e._miniMapRoomPoint[c3];e._miniMapHeroY=e._miniMapRoomPoint[c3+1];e._miniMapHeroAtPoint=c3}e._miniMapCursorX=e._miniMapHeroX;e._miniMapCursorY=e._miniMapHeroY-DEF.TILE_H;e._miniMapCameraX=e._miniMapCursorX-DEF.VIEW_W_D2;e._miniMapCameraY=e._miniMapCursorY-DEF.VIEW_H_D2;e._miniMapCursorAtPoint=-1;e._miniMapState=e.MINI_MAP_STATE_OUT_LEVEL;e._miniMapTick=0;e.SetPause(DPauseType.FADE_IN,DPauseType.FADE_EFFECT_CIRCLE);a9=STATE.MENU_MAP;e.loadingPhase=0;e._miniMapHeroAnim=0;e._miniMapHeroFlags=0;e.PlaySoundBGM();e.bIsPaused=false};e.prototype.SetVelocityByDest=function(c5,c4,c3){var c6=Math_Atan(c4,c3);CEntity._TempIntArray[DParamIndex.POSX]=Math_FixedPoint_Multiply(c5,Math_Cos(c6));CEntity._TempIntArray[DParamIndex.POSY]=Math_FixedPoint_Multiply(c5,Math_Sin(c6));if(!Math_SameSign(CEntity._TempIntArray[DParamIndex.POSX],c4)||Math.abs(CEntity._TempIntArray[DParamIndex.POSX])>Math.abs(c4)){CEntity._TempIntArray[DParamIndex.POSX]=c4}if(!Math_SameSign(CEntity._TempIntArray[DParamIndex.POSY],c3)||Math.abs(CEntity._TempIntArray[DParamIndex.POSY])>Math.abs(c3)){CEntity._TempIntArray[DParamIndex.POSY]=c3}};e.s_isShowAd=false;e.s_showAdPlace=-1;e.prototype.UpdateMiniMap=function(){if(bg){e.initIngameMenu(STATE.MENU_INGAME);return}switch(e._miniMapState){case e.MINI_MAP_STATE_OUT_LEVEL:ao=e._miniMapHeroX-e._miniMapCameraX;an=e._miniMapHeroY-e._miniMapCameraY;this.PauseUpdate();if(cI==DPauseType.NONE){if(e._gameProgress==bb){e._miniMapState=e.MINI_MAP_STATE_NEW_GAME}else{if(e._levelUnlocked>=0){e._miniMapState=e.MINI_MAP_STATE_NEW_LEVEL_OPEN}else{e._miniMapState=e.MINI_MAP_STATE_IDLE}}}break;case e.MINI_MAP_STATE_NEW_LEVEL_OPEN:var dg=e.spriteArray[DSpriteID.EFFECT].GetAFrames(DAnimID.EFFECT_RANDOM_MAGIC);if(e._miniMapTick<dg&&e._levelUnlocked>=0){e._miniMapTick++}else{e._miniMapState=e.MINI_MAP_STATE_CURSOR_MOVE_AUTO;e._miniMapTick=0}break;case e.MINI_MAP_STATE_NEW_GAME:switch(e._miniMapTick){case 0:e.StartTextBubble(-1,Math_IntToFixedPoint(e._miniMapHeroX),Math_IntToFixedPoint(e._miniMapHeroY+DEF.TILE_H*2),TEXT.MENU_MINI_BOY_1);e._miniMapTick++;break;case 1:if(e._textBubbleState==e.TEXT_BUBBLE_OVER){e._miniMapTick=0;e._miniMapState=e.MINI_MAP_STATE_CURSOR_MOVE_AUTO}break}if(WasKeyReleased(GLKey.k_menuBack)){e.CloseTextBubble();e._miniMapTick=0;e._miniMapState=e.MINI_MAP_STATE_CURSOR_MOVE_AUTO}break;case e.MINI_MAP_STATE_NEW_WORLD:if(e._miniMapTick==e.MINI_MAP_WATCH_SPEAK_TICK){e.StartTextBubble(-1,Math_IntToFixedPoint(e._miniMapRoomPoint[(e._worldId+1)<<1]),Math_IntToFixedPoint(e._miniMapRoomPoint[((e._worldId+1)<<1)+1]+DEF.TILE_H*2),this.GetLevelWizardTextByWorldId(e._worldId));e._miniMapTick++}else{if(e._miniMapTick>e.MINI_MAP_WATCH_OVER_TICK){e._miniMapState=e.MINI_MAP_STATE_HERO_MOVE_TO;e._miniMapTick=0}else{if(e._miniMapTick>e.MINI_MAP_WATCH_SPEAK_TICK){if(e._textBubbleState==e.TEXT_BUBBLE_OVER){e._miniMapTick++}}else{e._miniMapTick++}}}if(WasKeyReleased(GLKey.k_menuBack)){e.CloseTextBubble();e._miniMapTick=0;e._miniMapState=e.MINI_MAP_STATE_HERO_MOVE_TO}break;case e.MINI_MAP_STATE_CURSOR_MOVE_AUTO:var dd;var dc;var df;if(e._miniMapLimit==e._miniMapLimitLevelRoom&&e._gameProgress==bb){df=e.LevelId2PointId(0)}else{if(e.IsUnlockedWorld(e._levelUnlocked)){df=(e._worldId+1)*2;df=Math.min(df,e.MINI_MAP_BOSS_WORLD_ROOM_INDEX)}else{df=e.LevelId2PointId(e._levelUnlocked)}}dd=e._miniMapRoomPoint[df];dc=e._miniMapRoomPoint[df+1]-DEF.TILE_H;if(e._miniMapHeroAtPoint==df){e._miniMapCursorX=dd;e._miniMapCursorY=dc;e._miniMapCursorAtPoint=df;e._miniMapState=e.MINI_MAP_STATE_IDLE}else{this.SetVelocityByDest(e.MINI_MAP_CURSOR_VELOCITY,dd-e._miniMapCursorX,dc-e._miniMapCursorY);e._miniMapCursorX+=CEntity._TempIntArray[DParamIndex.POSX];e._miniMapCursorY+=CEntity._TempIntArray[DParamIndex.POSY];if(e._miniMapCursorX==dd&&e._miniMapCursorY==dc){e._miniMapCursorX=dd;e._miniMapCursorY=dc;e._miniMapState=e.MINI_MAP_STATE_HERO_MOVE_TO;e._miniMapCursorAtPoint=df;if(e._miniMapLimit==e._miniMapLimitWorldRoom&&e.IsUnlockedWorld(e._levelUnlocked)){e._miniMapState=e.MINI_MAP_STATE_NEW_WORLD}}}break;case e.MINI_MAP_STATE_IDLE:var c5=0;var c4=0;if(IsKeyDown(GLKey.k_left)||IsKeyDown(GLKey.k_num1)||IsKeyDown(GLKey.k_num7)){c5-=e.MINI_MAP_CURSOR_VELOCITY}if(IsKeyDown(GLKey.k_right)||IsKeyDown(GLKey.k_num3)||IsKeyDown(GLKey.k_num9)){c5+=e.MINI_MAP_CURSOR_VELOCITY}if(IsKeyDown(GLKey.k_up)||IsKeyDown(GLKey.k_num1)||IsKeyDown(GLKey.k_num3)){c4-=e.MINI_MAP_CURSOR_VELOCITY}if(IsKeyDown(GLKey.k_down)||IsKeyDown(GLKey.k_num7)||IsKeyDown(GLKey.k_num9)){c4+=e.MINI_MAP_CURSOR_VELOCITY}e._miniMapCursorX+=c5;e._miniMapCursorY+=c4;e._miniMapCursorAtPoint=-1;var c9=e._miniMapRoomPoint.length;for(var c7=0;c7<c9;c7+=2){CEntity._tempBox[DEF.BOX_LEFT]=e._miniMapRoomPoint[c7]-DEF.TILE_W*2;CEntity._tempBox[DEF.BOX_RIGHT]=e._miniMapRoomPoint[c7]+DEF.TILE_W*2;CEntity._tempBox[DEF.BOX_TOP]=e._miniMapRoomPoint[c7+1]-(DEF.TILE_H*3);CEntity._tempBox[DEF.BOX_BOTTOM]=e._miniMapRoomPoint[c7+1]+DEF.TILE_H;if(c7==e.MINI_MAP_LEVEL_ROOM_POINTS_INDEX){CEntity._tempBox[DEF.BOX_BOTTOM]+=DEF.TILE_H*2}if(CEntity.InBox(e._miniMapCursorX,e._miniMapCursorY,CEntity._tempBox)){e._miniMapCursorAtPoint=c7}}var c3=this.MiniMapGetDoorState(e._miniMapCursorAtPoint)==e.MINI_MAP_DOOR_LOCKED;if(e._miniMapCursorAtPoint>=0&&!c3&&WasKeyPressed(GLKey.k_fire)){if(e._miniMapHeroAtPoint==e._miniMapCursorAtPoint){if(e._miniMapHeroAtPoint==e.MINI_MAP_LEVEL_ROOM_POINTS_INDEX){e._miniMapState=e.MINI_MAP_STATE_SWITCH_TO_WORLD_ROOM;e.SetPause(DPauseType.FADE_OUT,DPauseType.FADE_EFFECT_BLACK)}else{if(e._miniMapCursorAtPoint<e.MINI_MAP_BOSS_WORLD_ROOM_INDEX){e._miniMapState=e.MINI_MAP_STATE_SWITCH_TO_LEVEL_ROOM;e.SetPause(DPauseType.FADE_OUT,DPauseType.FADE_EFFECT_BLACK)}else{e._miniMapState=e.MINI_MAP_STATE_ENTER_LEVEL;e.SetPause(DPauseType.FADE_OUT,DPauseType.FADE_EFFECT_CIRCLE)}}}else{e._miniMapState=e.MINI_MAP_STATE_HERO_MOVE_TO}}break;case e.MINI_MAP_STATE_HERO_MOVE_TO:dd=e._miniMapRoomPoint[e._miniMapCursorAtPoint];dc=e._miniMapRoomPoint[e._miniMapCursorAtPoint+1];this.SetVelocityByDest(e.MINI_MAP_HERO_MOVE_VELOCITY,dd-e._miniMapHeroX,dc-e._miniMapHeroY);var db=CEntity._TempIntArray[DParamIndex.POSX];var da=CEntity._TempIntArray[DParamIndex.POSY];e._miniMapHeroX+=db;e._miniMapHeroY+=da;if(e._miniMapHeroX==dd&&e._miniMapHeroY==dc){e._miniMapHeroX=dd;e._miniMapHeroY=dc;e._miniMapHeroAnim=DAnimID.HERO_WAIT;e._miniMapHeroAtPoint=e._miniMapCursorAtPoint;e._miniMapState=e.MINI_MAP_STATE_IDLE}else{e._miniMapHeroAnim=DAnimID.HERO_WAIT;if(db!=0||da!=0){if(db!=0){e._miniMapHeroAnim=DAnimID.HERO_WALK;if(db>0){e._miniMapHeroFlags=0}else{if(db<0){e._miniMapHeroFlags=DFlags.FLIP_X}}}else{if(da<0){e._miniMapHeroAnim=DAnimID.HERO_IN_DOOR}else{e._miniMapHeroAnim=DAnimID.HERO_OUT_DOOR}}}}break;case e.MINI_MAP_STATE_SWITCH_TO_LEVEL_ROOM:var c8=e._miniMapCursorAtPoint>>1;var c6=c8;if(c6==0){c6=4}else{if(c6==4){c6=0}}switch(c6){case 0:e._miniMapHeroAnim=DAnimID.HERO_IN_DOOR;break;case 1:e._miniMapHeroAnim=DAnimID.HERO_WALK;e._miniMapHeroFlags|=DFlags.FLIP_X;break;case 2:e._miniMapHeroAnim=DAnimID.HERO_WALK;e._miniMapHeroFlags&=~DFlags.FLIP_X;break;case 3:case 4:e._miniMapHeroAnim=DAnimID.HERO_OUT_DOOR;break}this.PauseUpdate();if(e._miniMapLimit!=e._miniMapLimitLevelRoom){if(cI==DPauseType.NONE){e._miniMapHeroAnim=DAnimID.HERO_IN_DOOR;e._worldId=c8;e._miniMapLimit=e._miniMapLimitLevelRoom;e._miniMapHeroAtPoint=e.MINI_MAP_LEVEL_ROOM_POINTS_INDEX;e._miniMapCursorAtPoint=e._miniMapHeroAtPoint;e._miniMapHeroX=e._miniMapRoomPoint[e.MINI_MAP_LEVEL_ROOM_POINTS_INDEX];e._miniMapHeroY=e._miniMapRoomPoint[e.MINI_MAP_LEVEL_ROOM_POINTS_INDEX+1]+16*DScreen.RATIO;e._miniMapCursorX=e._miniMapHeroX;e._miniMapCursorY=e._miniMapHeroY-DEF.TILE_H;e.SetPause(DPauseType.FADE_IN,DPauseType.FADE_EFFECT_BLACK)}}else{e._miniMapHeroY-=1;if(cI==DPauseType.NONE){if(e._gameProgress==bb){e._miniMapState=e.MINI_MAP_STATE_CURSOR_MOVE_AUTO}else{e._miniMapState=e.MINI_MAP_STATE_IDLE}e._miniMapHeroAnim=DAnimID.HERO_WAIT}}break;case e.MINI_MAP_STATE_SWITCH_TO_WORLD_ROOM:e._miniMapHeroAnim=DAnimID.HERO_OUT_DOOR;this.PauseUpdate();if(e._miniMapLimit!=e._miniMapLimitWorldRoom){e._miniMapHeroY+=1;if(cI==DPauseType.NONE){e._miniMapHeroAtPoint=e._worldId<<1;e._miniMapCursorAtPoint=e._miniMapHeroAtPoint;e._miniMapLimit=e._miniMapLimitWorldRoom;e._miniMapHeroX=e._miniMapRoomPoint[e._miniMapHeroAtPoint];e._miniMapHeroY=e._miniMapRoomPoint[e._miniMapHeroAtPoint+1];e._miniMapCursorX=e._miniMapHeroX;e._miniMapCursorY=e._miniMapHeroY-DEF.TILE_H;e.SetPause(DPauseType.FADE_IN,DPauseType.FADE_EFFECT_BLACK)}}else{e._miniMapHeroAnim=DAnimID.HERO_WAIT;if(cI==DPauseType.NONE){e._miniMapState=e.MINI_MAP_STATE_IDLE}}break;case e.MINI_MAP_STATE_ENTER_LEVEL:var de=(e._miniMapCursorAtPoint-e.MINI_MAP_LEVEL_ROOM_POINTS_INDEX)>>1;switch(de){case 1:e._miniMapHeroAnim=DAnimID.HERO_IN_DOOR;break;case 2:e._miniMapHeroAnim=DAnimID.HERO_WALK;e._miniMapHeroFlags|=DFlags.FLIP_X;break;case 3:e._miniMapHeroAnim=DAnimID.HERO_WALK;e._miniMapHeroFlags&=~DFlags.FLIP_X;break}ao=e._miniMapHeroX-e._miniMapCameraX;an=e._miniMapHeroY-e._miniMapCameraY;this.PauseUpdate();if(cI==DPauseType.NONE){if(typeof gdsdk!=="undefined"&&gdsdk.showAd!=="undefined"){e.PauseSoundBGM();window.addEventListener("SDK_GAME_START",function(dh){if(e.s_showAdPlace!=1){return}e.redrawAll=true;e.s_isShowAd=false;e.s_showAdPlace=-1;e._miniMapState=e.MINI_MAP_STATE_OVER});e.s_isShowAd=!false;e.s_showAdPlace=1;console.log("azerion 1");e.showFullScreenAds();gdsdk.showAd()}else{e._miniMapState=e.MINI_MAP_STATE_OVER;e.showFullScreenAds()}}break}e._miniMapCameraX=e._miniMapCursorX-DEF.VIEW_W_D2;e._miniMapCameraY=e._miniMapCursorY-DEF.VIEW_H_D2;e.CheckMiniMapLimit();e._miniMapWorldIconAlpha+=e._miniMapWorldIconAlphaStep;if(e._miniMapWorldIconAlpha<63){e._miniMapWorldIconAlphaStep=-e._miniMapWorldIconAlphaStep;e._miniMapWorldIconAlpha=63}else{if(e._miniMapWorldIconAlpha>255){e._miniMapWorldIconAlphaStep=-e._miniMapWorldIconAlphaStep;e._miniMapWorldIconAlpha=255}}if(e.spriteArray[DSpriteID.MAP_ACTOR]!=null){e.spriteArray[DSpriteID.MAP_ACTOR].ModifyPaletteAlpha(e.MINI_MAP_ALPHA_PAL,e._miniMapWorldIconAlpha)}};e.prototype._gotoGamplay=function(){e._gameProgress++;var c3=e.MiniMapGetLevelByPoint(e._miniMapCursorAtPoint);this.UnloadMiniMap();e.initMenus();e._tempLevelId=c3;e._worldId=Math.floor(c3/DAI.LEVELS_NUM_PRE_WORLD);a9=STATE.LOAD_UNLOAD;e.bIsPaused=false;e.RMS_Save()};e.prototype.DrawMiniMapScene=function(c4,di,dh){for(var db=0;db<e._entityRowDataCount;db++){var c9=e._entitiesRowData[db];if(c9[DParamIndex.CLASS_ID]==DClassID.MINI_MAP_ACTOR){var df=c9[DParamIndex.MINI_MAP_ACTOR_Z_ORDER]==DValueList.MINI_MAP_ACTOR_ORDER_BACKGROUND;var dj=c9[DParamIndex.MINI_MAP_ACTOR_Z_ORDER]==DValueList.MINI_MAP_ACTOR_ORDER_FOREGROUND;var dc=c4?df:dj;if(dc){var c3=this.MiniMapGetDoorState(c9[DParamIndex.MINI_MAP_ACTOR_POINTID]<<1);var de=c9[DParamIndex.MINI_MAP_ACTOR_POINTID]<0||c3==c9[DParamIndex.MINI_MAP_ACTOR_TYPE]||c9[DParamIndex.ANIMID]>=DAnimID.MAP_ACTOR_BOSS_1;var c6=false;if(e._levelUnlocked>=0&&c3==e.MINI_MAP_DOOR_UNLOCKED){if(e._miniMapState<e.MINI_MAP_STATE_NEW_LEVEL_OPEN&&e._gameProgress!=bb){de=c9[DParamIndex.MINI_MAP_ACTOR_TYPE]==DValueList.MINI_MAP_ACTOR_TYPE_CLOSED}else{if(c9[DParamIndex.MINI_MAP_ACTOR_POINTID]<e.MINI_MAP_LEVEL_ROOM_POINTS_INDEX>>1){de=c9[DParamIndex.MINI_MAP_ACTOR_TYPE]==DValueList.MINI_MAP_ACTOR_TYPE_OPENED}else{if(c9[DParamIndex.MINI_MAP_ACTOR_POINTID]==e.MINI_MAP_BOSS_LEVEL_ROOM_INDEX>>1){de=true}else{if(c9[DParamIndex.MINI_MAP_ACTOR_TYPE]==DValueList.MINI_MAP_ACTOR_TYPE_CLOSED){c6=true}}}}}if(de){if(c9[DParamIndex.ANIMID]>=DAnimID.MAP_ACTOR_ICON_LABYRINTH&&c9[DParamIndex.ANIMID]<=DAnimID.MAP_ACTOR_ICON_SPACE){e.spriteArray[DSpriteID.MAP_ACTOR].SetCurrentPalette(e.MINI_MAP_ALPHA_PAL)}else{if(c9[DParamIndex.ANIMID]>=DAnimID.MAP_ACTOR_DOOR_LEFT_UP_PASS&&c9[DParamIndex.ANIMID]<=DAnimID.MAP_ACTOR_DOOR_RIGHT_UP_PASS){e.spriteArray[DSpriteID.MAP_ACTOR].SetCurrentPalette(this.GetLevelPaletteIdByWorldId(e._worldId))}else{e.spriteArray[DSpriteID.MAP_ACTOR].SetCurrentPalette(0)}}var c8=c9[DParamIndex.ANIMID];if(c9[DParamIndex.ANIMID]>=DAnimID.MAP_ACTOR_BOSS_1){c8=Math.min(this.GetLevelMapActorBossByWorldId(e._worldId),DAnimID.MAP_ACTOR_BOSS_5);e.spriteArray[DSpriteID.MAP_ACTOR].SetCurrentPalette(this.GetLevelPaletteIdByWorldId(e._worldId));if(c3!=e.MINI_MAP_DOOR_LOCKED){e.spriteArray[DSpriteID.MAP_ACTOR].SetCurrentPalette(e.MINI_MAP_BOSS_ENABLE_PAL)}}var c7=true;var c5=true;if(c7){e.DrawAnimation(DSpriteID.MAP_ACTOR,c8,di+c9[DParamIndex.POSX]-e._miniMapCameraX,dh+c9[DParamIndex.POSY]-e._miniMapCameraY,c9[DParamIndex.FLAGS])}if(c9[DParamIndex.ANIMID]==DAnimID.MAP_ACTOR_DOOR_LEFT_UP_PASS||c9[DParamIndex.ANIMID]==DAnimID.MAP_ACTOR_DOOR_RIGHT_UP_PASS||c9[DParamIndex.ANIMID]==DAnimID.MAP_ACTOR_DOOR_UP_PASS){e.DrawAnimation(DSpriteID.EFFECT,DAnimID.EFFECT_EFFECT_FEATHER,di+c9[DParamIndex.POSX]-e._miniMapCameraX,dh+c9[DParamIndex.POSY]-e._miniMapCameraY,c9[DParamIndex.FLAGS])}var dd=c9[DParamIndex.MINI_MAP_ACTOR_POINTID]==(e.MINI_MAP_BOSS_LEVEL_ROOM_INDEX>>1)||c9[DParamIndex.MINI_MAP_ACTOR_POINTID]==(e.MINI_MAP_BOSS_WORLD_ROOM_INDEX>>1);if(c3!=e.MINI_MAP_DOOR_LOCKED){if(c5&&dd&&c9[DParamIndex.ANIMID]!=DAnimID.MAP_ACTOR_WORLD_DOT){c6=true}}}if(c6&&GLLibConfig.useSoftwareDoubleBuffer){var dg=s_game_currentFrameNB%e.blendSpriteArray[DATA.EFFECT_SPAWN].GetAFrames(DEffectAnimID.SPAWN_OBJ_SPAWN);var c8;var da=10+DEF.TILE_H*2;da+=e.spriteArray[DSpriteID.MAP_ACTOR].GetFrameHeight(e.spriteArray[DSpriteID.MAP_ACTOR].GetAnimFrame(c9[DParamIndex.ANIMID],0))/2;if(c9[DParamIndex.MINI_MAP_ACTOR_POINTID]==e.MINI_MAP_BOSS_LEVEL_ROOM_INDEX>>1){da+=-10;c8=DEffectAnimID.SPAWN_HOLE_CLOCKWISE}else{if(c9[DParamIndex.MINI_MAP_ACTOR_POINTID]==e.MINI_MAP_BOSS_WORLD_ROOM_INDEX>>1){da-=-12;c8=DEffectAnimID.SPAWN_HOLE_CLOCKWISE}else{da-=35;c8=DEffectAnimID.SPAWN_OBJ_SPAWN}}da-=e.MINI_MAP_OFFSET_Y;e.blendSpriteArray[DATA.EFFECT_SPAWN].PaintAFrame(g,c8,dg,di+c9[DParamIndex.POSX]-e._miniMapCameraX,dh+c9[DParamIndex.POSY]-e._miniMapCameraY+da,0)}}}}e.spriteArray[DSpriteID.MAP_ACTOR].SetCurrentPalette(0)};e.prototype.DrawMiniMap=function(){g.setColor(0);g.setClip(0,0,DEF.SCR_W,DEF.SCR_H+DGUI.MENU_OFFSET_Y*2);g.fillRect(0,0,DEF.SCR_W,DEF.SCR_H+DGUI.MENU_OFFSET_Y*2);var dm=0;var dh=e._miniMapLimit[DEF.BOX_RIGHT]-e._miniMapLimit[DEF.BOX_LEFT];if(DEF.SCR_W>dh){dm=-Math.floor((DEF.SCR_W-dh)/2)}if(e._miniMapState==e.MINI_MAP_STATE_OVER){return}if(e._miniMapLimit==e._miniMapLimitLevelRoom){e.spriteArray[DSpriteID.TILESET_BASE+DATA.MINI_MAP_TILESET].SetCurrentPalette(this.GetLevelPaletteIdByWorldId(e._worldId))}else{e.spriteArray[DSpriteID.TILESET_BASE+DATA.MINI_MAP_TILESET].SetCurrentPalette(0)}GLLibPlayer.Tileset_SetCamera(0,e._miniMapCameraX,e._miniMapCameraY);e._miniMapCameraY-=2*DEF.TILE_H;if(e._miniMapCameraX<0){GLLibPlayer.Tileset_Draw(g,-dm,2*DEF.TILE_H,0)}else{GLLibPlayer.Tileset_Draw(g,dm,2*DEF.TILE_H,0)}g.setColor(0);g.setClip(0,0,DEF.SCR_W,DEF.SCR_H);g.fillRect(0,0,DEF.SCR_W,2*DEF.TILE_H+1);var da=!e.bIsPaused;if(e._miniMapState==e.MINI_MAP_STATE_NEW_WORLD&&e._miniMapTick<e.MINI_MAP_WATCH_OVER_TICK){var dr;var dp;dr=e._miniMapRoomPoint[(e._worldId+1)*2];dp=e._miniMapRoomPoint[(e._worldId+1)*2+1];var dj=dp>e._miniMapHeroY;var de=Math.min(e._miniMapHeroY,dp);var di=Math.max(e._miniMapHeroY,dp);this.DrawMiniMapScene(true,dm,0);if(dj){e.DrawAnimation(DSpriteID.HERO,e._miniMapHeroAnim,dm+e._miniMapHeroX-e._miniMapCameraX,e._miniMapHeroY-e._miniMapCameraY,e._miniMapHeroFlags)}else{this.DrawMiniMapWitch(dr,dp)}if(!dj){e.DrawAnimation(DSpriteID.HERO,e._miniMapHeroAnim,dm+e._miniMapHeroX-e._miniMapCameraX,e._miniMapHeroY-e._miniMapCameraY,e._miniMapHeroFlags)}else{this.DrawMiniMapWitch(dr,dp)}this.DrawMiniMapScene(false,dm,0)}else{this.DrawMiniMapScene(true,dm,0);e.DrawAnimation(DSpriteID.HERO,e._miniMapHeroAnim,dm+e._miniMapHeroX-e._miniMapCameraX,e._miniMapHeroY-e._miniMapCameraY,e._miniMapHeroFlags);this.DrawMiniMapScene(false,dm,0)}if(dm<0){g.setColor(0);g.fillRect(0,0,-dm,DEF.SCR_H);g.fillRect(-dm+dh,0,Math.floor((DEF.SCR_W-dh)/2),DEF.SCR_H)}if(e._textBubbleState!=e.TEXT_BUBBLE_OVER){da=false;this.DrawTextBubble()}if(e._miniMapState==e.MINI_MAP_STATE_NEW_LEVEL_OPEN){var dc=e.spriteArray[DSpriteID.EFFECT].GetAFrames(DAnimID.EFFECT_RANDOM_MAGIC);var c8;var c7;if(e.IsUnlockedWorld(e._levelUnlocked)){c8=e._miniMapRoomPoint[(e._worldId+1)*2];c7=e._miniMapRoomPoint[(e._worldId+1)*2+1]}else{var dd=e.LevelId2PointId(e._levelUnlocked);c8=e._miniMapRoomPoint[dd];c7=e._miniMapRoomPoint[dd+1]}if(e._miniMapTick<dc&&e._levelUnlocked>=0){e.spriteArray[DSpriteID.EFFECT].PaintAFrame(g,DAnimID.EFFECT_RANDOM_MAGIC,e._miniMapTick,dm+c8-e._miniMapCameraX,c7-e._miniMapCameraY,0)}var dl=e._levelUnlocked==0&&e._levelInfo[1]==0;if(dl){e.txtDrawSpecialEffectPopUp(0,Text_GetString(TEXT.MENU_STAGE_UNLOCKED),dm+c8-e._miniMapCameraX,c7-e._miniMapCameraY-50*DScreen.RATIO,10,1,26,GRPH.HCENTER_TOP)}}var c3=DAnimID.MAP_ACTOR_HAND;var dq=e.MiniMapGetLevelByPoint(e._miniMapCursorAtPoint);if(e._miniMapCursorAtPoint>=0){c3=DAnimID.MAP_ACTOR_HAND_SELECTED;var c9=TEXT.MENU_LOCKED;if(da){if(this.MiniMapGetDoorState(e._miniMapCursorAtPoint)!=e.MINI_MAP_DOOR_LOCKED){if(e._miniMapCursorAtPoint==e.MINI_MAP_LEVEL_ROOM_POINTS_INDEX){c9=TEXT.MENU_SELECT_WORLD}else{dq=e.MiniMapGetLevelByPoint(e._miniMapCursorAtPoint);if(e._miniMapCursorAtPoint>e.MINI_MAP_LEVEL_ROOM_POINTS_INDEX){c9=this.GetLevelTextByLevelId(dq);var c6=DGUI.INTERFACE_STAR_POS_X_MINIMAP;var c5=DGUI.INTERFACE_STAR_BOTTOM_OFFSET_Y_MINIMAP;this.DrawLevelStars(dq,c6,c5)}else{c9=TEXT.MENU_LABYRINTH_WORLD+(e._miniMapCursorAtPoint>=6?(e._miniMapCursorAtPoint>>1)+1:(e._miniMapCursorAtPoint>>1))}}}if(e._previousLevelID!=dq){e._actionSpeed=0;e._stopAdd=false;e._stopMove=false;e._moveSpeed=0;e._currentPosY=0;e._firstEnterIntoThisFunction=true;e._previousLevelID=dq}var dn=0;if(c9>TEXT.MENU_GHOST_TOWN&&c9!=TEXT.MENU_LOCKED||c9>=TEXT.MENU_LEVEL1&&c9<=TEXT.MENU_LEVEL24){e.txtDraw(0,Text_GetString(this.GetLevelMenuTextByLevelId(dq)),DEF.VIEW_W_D2,DEF.useNewDesign?(DGUI.INTERFACE_TOP_TEXT_LEVEL_Y):DGUI.CURLEVELID_Y,1);dn=25*DScreen.RATIO}else{dn=14*DScreen.RATIO}dn=DEF.useNewDesign?(DGUI.INTERFACE_TOP_TEXT_LEVEL_Y+dn):dn;var dk=DEF.VIEW_W-20;var dg=1;var df=0;var db=10;var c4=5;e.DrawMultiLineText(g,Text_GetString(c9),DEF.SCR_W_D2,dn,dg,2,dk,df,db,c4)}}if(da){e._interface.PaintFrame(g,DAnimID.INTERFACE_FRAME_PORTRAIT_MINIMAP,DGUI.INTERFACE_HEADICON_POS_MINIMAP_X,DEF.useNewDesign?DGUI.INTERFACE_TOP_HEIGHT_MINIMAP_HEAD:(DEF.VIEW_H-DGUI.INTERFACE_BOTTOM_HEIGHT_MINIMAP_HEAD+e.MINI_MAP_OFFSET_Y),0);e._interface.PaintFrame(g,DAnimID.INTERFACE_FRAME_X,DGUI.INTERFACE_FORK_POS_MINIMAP_X+0,DEF.useNewDesign?DGUI.INTERFACE_TOP_HEIGHT_FORK_OFFSET_Y_MINIMAP:(DEF.VIEW_H-DGUI.INTERFACE_BOTTOM_HEIGHT_FORK_OFFSET_Y_MINIMAP+e.MINI_MAP_OFFSET_Y),0);e.DrawInterfaceNumber(e._playerInfo[DAI.HPI_LIVES],DGUI.INTERFACE_FORK_POS_MINIMAP_X+DGUI.INTERFACE_NUM_MARGIN_BEHINDFORK_MINIMAP_X,DEF.useNewDesign?DGUI.INTERFACE_TOP_HEIGHT_MINIMAP_NUM:(DEF.VIEW_H-DGUI.INTERFACE_BOTTOM_HEIGHT_MINIMAP_NUM+e.MINI_MAP_OFFSET_Y),2,0);if((e._miniMapCursorAtPoint>e.MINI_MAP_LEVEL_ROOM_POINTS_INDEX)&&(e._miniMapCursorAtPoint!=e.MINI_MAP_BOSS_LEVEL_ROOM_INDEX)){e.txtDraw(0,Text_GetString(TEXT.MENU_SCORE),DEF.VIEW_W-5*DScreen.RATIO,DEF.VIEW_H-DGUI.INTERFACE_SCORE_OFFSET_Y_MINIMAP+e.MINI_MAP_OFFSET_Y,TOP|RIGHT);if(dq>=0){e.txtDraw(0,String(e._levelTotalScore[dq]),DEF.VIEW_W-5*DScreen.RATIO,DEF.VIEW_H-DGUI.INTERFACE_SCORE_NUM_OFFSET_Y_MINIMAP+e.MINI_MAP_OFFSET_Y,TOP|RIGHT)}}}if(e._miniMapState>=e.MINI_MAP_STATE_CURSOR_MOVE_AUTO){e.DrawAnimation(DSpriteID.MAP_ACTOR,c3,dm+e._miniMapCursorX-e._miniMapCameraX,e._miniMapCursorY-e._miniMapCameraY,0)}if(e._textBubbleState!=e.TEXT_BUBBLE_OVER){if(!e.bIsPaused){cL.SetCurrentPalette(0);cL.DrawString(g,Text_GetString(TEXT.MENU_SK_SKIP),DEF.VIEW_W,DEF.VIEW_H,GRPH.RIGHT_BOTTOM)}}if(!e.bIsPaused){e._interface.PaintAFrame(g,DAnimID.INTERFACE_IGM,s_game_currentFrameNB%e.spriteArray[DSpriteID.INTERFACE].GetAFrames(DAnimID.INTERFACE_IGM),DEF.useNewDesign?(DEF.VIEW_W-DGUI.INTERFACE_IGM_OFFSET_X*3):DGUI.INTERFACE_IGM_OFFSET_X,DEF.useNewDesign?DGUI.INTERFACE_LEFTSOFTKEY_OFFSET_Y>>2:(DEF.VIEW_H-DGUI.INTERFACE_LEFTSOFTKEY_OFFSET_Y),0)}ao+=dm;this.DrawFadeEffect();ao-=dm;e._miniMapCameraY+=e.MINI_MAP_OFFSET_Y};e.prototype.DrawMiniMapWitch=function(de,dd){var c4=DAnimID.BOSS_WATCH_IDLE_GROUND;var dg=0;var da=e.spriteArray[DSpriteID.BOSS_WATCH].GetAFrames(DAnimID.BOSS_WATCH_IDLE_GROUND);var c9=e.spriteArray[DSpriteID.BOSS_WATCH].GetAFrameTime(DAnimID.BOSS_WATCH_IDLE_GROUND,0);var c6=e.spriteArray[DSpriteID.BOSS_WATCH].GetAFrames(DAnimID.BOSS_WATCH_IDLE_GROUND);var c5=e.spriteArray[DSpriteID.BOSS_WATCH].GetAFrameTime(DAnimID.BOSS_WATCH_IDLE_GROUND,0);var df=e.spriteArray[DSpriteID.BOSS_WATCH].GetAFrames(DAnimID.BOSS_WATCH_IDLE_GROUND);var db=e.spriteArray[DSpriteID.BOSS_WATCH].GetAFrameTime(DAnimID.BOSS_WATCH_IDLE_GROUND,0);var c8=e._miniMapTick;if(e._miniMapTick<c6*c5){c4=DAnimID.BOSS_WATCH_APPEAR;dg=e._miniMapTick/c5%c6}else{c8-=c6*c5;c4=DAnimID.BOSS_WATCH_IDLE_GROUND;dg=c8/c9%da}if(e._miniMapTick>=e.MINI_MAP_WATCH_DISAPPEAR_TICK){c8=e._miniMapTick-e.MINI_MAP_WATCH_DISAPPEAR_TICK;c4=DAnimID.BOSS_WATCH_DISAPPEAR;dg=c8/db%df}var c3=0;if(de-e._miniMapHeroX>0){c3|=DFlags.FLIP_X}if(e._miniMapHeroX-de>0){e._miniMapHeroFlags|=DFlags.FLIP_X}var c7=de-e._miniMapCameraX;if(e._gameProgress==bb){c7=de-e._miniMapCameraX+DEF.TILE_H*2}if(e._gameProgress==bb){var dc=DAnimID.GIRL_IMPRISON_MAGIC;if(c4==DAnimID.BOSS_WATCH_APPEAR){dc=DAnimID.GIRL_APPEAR}else{if(c4==DAnimID.BOSS_WATCH_DISAPPEAR){dc=DAnimID.GIRL_DISAPPEAR}}e.spriteArray[DSpriteID.GIRL].PaintAFrame(g,dc,dg,c7+DEF.TILE_H*2,dd-e._miniMapCameraY,c3)}e.spriteArray[DSpriteID.BOSS_WATCH].PaintAFrame(g,c4,dg,c7,dd-e._miniMapCameraY,c3)};e.MiniMapGetLevelByPoint=function(c5){if(c5<0){return -1}if(c5<e.MINI_MAP_LEVEL_ROOM_POINTS_INDEX){var c4=(c5>>1)*DAI.LEVELS_NUM_PRE_WORLD;return c4}var c3=((c5-(e.MINI_MAP_LEVEL_ROOM_POINTS_INDEX+1))>>1);var c4=c3+e._worldId*DAI.LEVELS_NUM_PRE_WORLD;return c4};e.prototype.MiniMapGetDoorState=function(c4){if(c4==e.MINI_MAP_LEVEL_ROOM_POINTS_INDEX){return e.MINI_MAP_DOOR_OPENED}else{var c3=e.MiniMapGetLevelByPoint(c4);if(c3<0){return e.MINI_MAP_DOOR_LOCKED}if(e._levelInfo[c3]==1){if(e._levelInfo[c3+1]==0){return e.MINI_MAP_DOOR_UNLOCKED}else{return e.MINI_MAP_DOOR_OPENED}}}return e.MINI_MAP_DOOR_LOCKED};e._starsCurrentPos_X=0;e._moveSpeed=0;e._stopMove=false;e.prototype.DrawLevelStars=function(c8,c9,c6){var c5=[-200*DScreen.RATIO,-90*DScreen.RATIO,-10*DScreen.RATIO];if(c8<0||(c8+1)%4==0||c8==DAI.LEVEL_ID_CASTLE||c8>=DAI.LEVEL_ID_CASTLE_FINAL_BOSS){return}var c3=c8*DAI.STAR_INFO_SIZE;var c7,c4;for(c7=e._levelStarInfo[c3],c4=0;c7<DAI.MAX_STAR_NUM;c7++,c4++){e._starsCurrentPos_X=c5[c7]+e._moveSpeed;if(e._starsCurrentPos_X>=c9+45*c4*DScreen.RATIO){e._starsCurrentPos_X=c9+45*c4*DScreen.RATIO}e.spriteArray[DSpriteID.BONUS].PaintAFrame(g,DAnimID.BONUS_STAR,s_game_currentFrameNB%e.spriteArray[DSpriteID.BONUS].GetAFrames(DAnimID.BONUS_STAR),e._starsCurrentPos_X,DEF.VIEW_H-c6,0)}e.spriteArray[DSpriteID.BONUS].SetCurrentPalette(1);for(c7=0;c7<e._levelStarInfo[c3];c7++,c4++){e._starsCurrentPos_X=c5[c7]+e._moveSpeed;if(e._starsCurrentPos_X>=c9+45*c4*DScreen.RATIO){e._starsCurrentPos_X=c9+45*c4*DScreen.RATIO;if(c7==0){e._stopMove=true}}e.spriteArray[DSpriteID.BONUS].PaintAFrame(g,DAnimID.BONUS_STAR_1,s_game_currentFrameNB%e.spriteArray[DSpriteID.BONUS].GetAFrames(DAnimID.BONUS_STAR_1),e._starsCurrentPos_X,DEF.VIEW_H-c6,0)}if(!e._stopMove){e._moveSpeed+=32}e.spriteArray[DSpriteID.BONUS].SetCurrentPalette(0)};e.DrawLevelStars=function(c3,db,c4){if(c3==-1){c3=e._tempLevelId}if(db){var c9=DGUI.INTERFACE_STAR_POS_X_MINIMAP;var c8=DGUI.INTERFACE_STAR_BOTTOM_OFFSET_Y_MINIMAP;var c7=[-200,-90,-10];var da=c3*DAI.STAR_INFO_SIZE;var c6,c5;for(c6=e._levelStarInfo[da],c5=0;c6<DAI.MAX_STAR_NUM;c6++,c5++){e._starsCurrentPos_X=c7[c6]+e._moveSpeed;if(e._starsCurrentPos_X>=c9+45*c5){e._starsCurrentPos_X=c9+45*c5}e.spriteArray[DSpriteID.BONUS].PaintAFrame(g,DAnimID.BONUS_STAR,s_game_currentFrameNB%e.spriteArray[DSpriteID.BONUS].GetAFrames(DAnimID.BONUS_STAR),e._starsCurrentPos_X,DEF.VIEW_H-c8,0)}e.spriteArray[DSpriteID.BONUS].SetCurrentPalette(1);for(c6=0;c6<e._levelStarInfo[da];c6++,c5++){e._starsCurrentPos_X=c7[c6]+e._moveSpeed;if(e._starsCurrentPos_X>=c9+45*c5){e._starsCurrentPos_X=c9+45*c5;if(c6==0){e._stopMove=true}}e.spriteArray[DSpriteID.BONUS].PaintAFrame(g,DAnimID.BONUS_STAR_1,s_game_currentFrameNB%e.spriteArray[DSpriteID.BONUS].GetAFrames(DAnimID.BONUS_STAR_1),e._starsCurrentPos_X,DEF.VIEW_H-c8,0)}if(!e._stopMove){e._moveSpeed+=32}e.spriteArray[DSpriteID.BONUS].SetCurrentPalette(0)}if(c4){e.txtDraw(0,Text_GetString(TEXT.MENU_SCORE),DGUI.INTERFACE_GOLDCOIN_POS_X_MINIMAP+6,DEF.VIEW_H-DGUI.INTERFACE_SCORE_OFFSET_Y_MINIMAP+e.MINI_MAP_OFFSET_Y,GRPH.HCENTER_TOP);if(e._tempLevelId>=0){e.txtDraw(0,String(e._levelTotalScore[c3]),DGUI.INTERFACE_GOLDCOIN_POS_X_MINIMAP+6,DEF.VIEW_H-DGUI.INTERFACE_SCORE_NUM_OFFSET_Y_MINIMAP+e.MINI_MAP_OFFSET_Y,GRPH.HCENTER_TOP)}}};e._fireworks_timer=0;e._timer=0;e._fireworks=null;e.RenderFireworks=function(c5){var c4;if(e._fireworks==null){e._fireworks=LowAPI.Gen_Array([FIREWORKS.MAX_NO_FIREWORKS],null);for(c4=0;c4<FIREWORKS.MAX_NO_FIREWORKS;c4++){e._fireworks[c4]=new CFirework(c4%4)}}var c6=(CFirework.Rnd(FIREWORKS.MAX_ENERGY*3)>>2)+(FIREWORKS.MAX_ENERGY>>2)+1;var c3=(CFirework.Rnd(FIREWORKS.PATCH_LENGHT)>>1)+(FIREWORKS.PATCH_LENGHT>>1)+1;e._fireworks_timer++;for(c4=0;c4<FIREWORKS.MAX_NO_FIREWORKS;c4++){if(e._fireworks[c4]._sleep&&e._fireworks_timer>8){e._fireworks[c4].Init(c6,c3,CFirework.Rnd(3)==0);e._fireworks_timer=0}e._fireworks[c4].Update()}for(c4=0;c4<FIREWORKS.MAX_NO_FIREWORKS;c4++){e._fireworks[c4].Paint(c5)}};e.PaintFireworkSprite=function(c3){w.PaintAFrame(c3,DAnimID.FIRE_WORK_1+CFirework.Rnd(6),s_game_currentFrameNB%w.GetAFrames(DAnimID.FIRE_WORK_1),CFirework._posX,CFirework._posY,0)};e.prototype.UnloadMiniMap=function(){e.LoadUnload(DLoadState.UNLOAD_SPRITE);CEntity.RemoveAll();e.ReleaseLevel(false)};e.LoadMiniMap=function(){if(e._miniMapLoadStep==1){e._entitiesRowData=LowAPI.Gen_Array([4000],null);e._entityRowDataCount=0;e._sprites_load_mask=DSpriteID.DEFAULT_SPRITES_LOAD_MASK|(1<<DSpriteID.BOSS_WATCH)|(1<<DSpriteID.GIRL);Pack_Open(DATA.PACK_MINI_MAP);if(DEF.dbgEnable){Dbg("loading MINI_MAP_TILESET ------------------------------")}e.spriteLoad(DATA.MINI_MAP_TILESET+DSpriteID.TILESET_BASE,DATA.MINI_MAP_TILESET,true,true);GLLibPlayer.Tileset_Init(GLLibConfig.screenWidth,GLLibConfig.screenHeight,DEF.TILE_W,DEF.TILE_H)}else{if(e._miniMapLoadStep==2){var c8;var c4=null;var c5=null;var c7=GLLibPlayer.WRAP_CLAMP;var c3=DATA.MINI_MAP_MAP_SIZE;c8=Pack_ReadData(c3++);c4=Pack_ReadData(c3++);c5=Pack_ReadData(c3++);GLLibPlayer.Tileset_LoadLayer(0,c8,c4,c5,e.spriteArray[DATA.MINI_MAP_TILESET+DSpriteID.TILESET_BASE],true,TOP,c7,c7);GLLibPlayer.Tileset_SetCamera(0,0,0);e._mapTileCountWidth=Mem_GetShort(c8,0);e._mapTileCountHeight=Mem_GetShort(c8,2)}else{if(e._miniMapLoadStep==4){e.LoadLevelData(DATA.MINI_MAP_DESIGN);Pack_Close()}else{if(e._miniMapLoadStep==5){e.LoadUnload(DLoadState.LOAD_SPRITE)}else{if(e._miniMapLoadStep==6){e.blendSpriteArray=LowAPI.Gen_Array([DATA.EFFECT_MAX],null);Pack_Open(DATA.PACK_EFFECT);if(DEF.dbgEnable){Dbg("loading effect ------------------------------- LoadMiniMap")}e.blendSpriteArray[DATA.EFFECT_SPAWN]=e.LoadSprite4(DATA.EFFECT_SPAWN,-1,true,false);e.blendSpriteArray[DATA.EFFECT_SPAWN]._blend=CBlendSprite.BLEND_DISPLACEMENT;e.blendSpriteArray[DATA.EFFECT_SPAWN].ModifyPalette(1,5904216);e.blendSpriteArray[DATA.EFFECT_SPAWN].ModifyPalette(2,525720);e.ApplyModifyPalette(e.blendSpriteArray[DATA.EFFECT_SPAWN],[1,2]);for(var c6=0;c6<e.spriteArray.length;c6++){if(e.spriteArray[c6]!=null){e.spriteArray[c6].SetPool(1)}}}else{if(e._miniMapLoadStep==7){}else{if(e._miniMapLoadStep==8){}}}}}}}};var cR=-1;e.ads_show=false;e.isShowAds=function(){return e.s_isShowAd};e.showFullScreenAds=function(){cR=a9;a9=STATE.LOADING_ADS};e.prototype.sizeChanged=function(c3,c4){};LowAPI.extendObject(aF,{CGame:e,},true)})(window);DLoadState={};DLoadState.LOAD_TEXT=1;DLoadState.UNLOAD_TEXT=-DLoadState.LOAD_TEXT;DLoadState.LOAD_TILESET=DLoadState.LOAD_TEXT+1;DLoadState.UNLOAD_TILESET=-DLoadState.LOAD_TILESET;DLoadState.LOAD_ENTITY=DLoadState.LOAD_TILESET+1;DLoadState.UNLOAD_ENTITY=-DLoadState.LOAD_ENTITY;DLoadState.LOAD_SEGMENT=DLoadState.LOAD_ENTITY+1;DLoadState.UNLOAD_SEGMENT=-DLoadState.LOAD_SEGMENT;DLoadState.LOAD_SPRITE=DLoadState.LOAD_SEGMENT+1;DLoadState.UNLOAD_SPRITE=-DLoadState.LOAD_SPRITE;DLoadState.LOAD_EFFECT=DLoadState.LOAD_SPRITE+1;DLoadState.UNLOAD_EFFECT=-DLoadState.LOAD_EFFECT;DLoadState.LOAD_TEXTURE=DLoadState.LOAD_EFFECT+1;DLoadState.UNLOAD_TEXTURE=-DLoadState.LOAD_TEXTURE;DLoadState.LOAD_MESH=DLoadState.LOAD_TEXTURE+1;DLoadState.UNLOAD_MESH=-DLoadState.LOAD_MESH;DLoadState.LOAD_3D_ANIMATION=DLoadState.LOAD_MESH+1;DLoadState.UNLOAD_3D_ANIMATION=-DLoadState.LOAD_3D_ANIMATION;DLoadState.LOAD_OVER=DLoadState.LOAD_3D_ANIMATION+1;DLoadState.UNLOAD_OVER=0;DLoadState.LOAD_SOUND=DLoadState.LOAD_OVER+1;DLoadState.UNLOAD_SOUND=-DLoadState.LOAD_SOUND;DLoadState.LOAD_STARTSOUND=DLoadState.LOAD_SOUND+1;DLoadState.UNLOAD_STARTSOUND=-DLoadState.LOAD_STARTSOUND;DPauseType={};DPauseType.NONE=0;DPauseType.FADE_IN=1;DPauseType.FADE_OUT=2;DPauseType.FADE_EFFECT_BLACK=0;DPauseType.FADE_EFFECT_CIRCLE=1;DPauseType.FADE_EFFECT_SCANLINE=2;DSound_Channel={};DSound_Channel.BGM=0;DSound_Channel.SFX=DSound_Channel.BGM+1;DSound_Channel.ATTACK=DSound_Channel.SFX+1;DSound_Channel.TOTAL=DSound_Channel.ATTACK+1;