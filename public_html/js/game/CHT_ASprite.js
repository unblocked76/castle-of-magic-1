(function(b,c){function a(){a.__superclass__.call(this)}LowAPI.extendClass(a,ASprite);a.prototype.GetLineSpacing=function(){return 0};a.prototype.GetFontHeight=function(){return CGame.m_chtFont.GetFontHeight()};a.prototype.GetSpaceWidth=function(){return 2};a.prototype.GetCharSpacing=function(){return 0};a.prototype.GetLineHeight=function(){return this.GetFontHeight()};a.prototype.WraptextB=function(q,e,o){if(ASprite._warpTextInfo==null){ASprite._warpTextInfo=LowAPI.Gen_Array([GLLibConfig.MAX_WRAP_TEXT_INFO],0)}var p=q.length;var n=0;var m=0;var h=1;var g=0;var d=false;var f=0;for(var j=0;j<p;j++){var k=q.charAt(j);if(k>"\u2024"){m=this.getCharSize(k);n+=m;if((k!="\uFF0C")&&(k!="\u3002")&&(k!="\u3001")&&(k!="\uFF01")&&(k!="\uFF1F")&&(k!="\u300D")&&(k!="\u2027")&&(k!="\uFF1A")){g=j;f=m}else{f+=m}if(k=="\u300C"){j++;m=this.getCharSize(q.charAt(j));n+=m;f+=m}d=true;if(n>e){d=false;var l=g;while(l>=0&&q.charAt(l)==" "){l--;n-=this.GetSpaceWidth()}ASprite._warpTextInfo[h++]=(g);ASprite._warpTextInfo[h++]=(n-f);n=f;f=0}continue}if(k==32){n+=this.GetSpaceWidth();g=j;d=true;f=0;if(n<=e){continue}d=false;for(var l=g;l>=0&&q.charAt(l)==" ";){l--;n-=this.GetSpaceWidth()}for(;g<p&&q.charAt(g)==" ";g++){}g--;j=g;ASprite._warpTextInfo[h++]=(g+1);ASprite._warpTextInfo[h++]=(n-f);n=0;continue}if(GLLibConfig.sprite_fontBackslashChangePalette&&k==92){j++;continue}if(k==10||k=="^"){ASprite._warpTextInfo[h++]=j;ASprite._warpTextInfo[h++]=n;n=0;f=0;continue}if(k<32){if(k==1){j++;continue}if(k!=2){continue}j++;k=q.charAt(j)}m=this.getCharSize(k);f+=m;n+=m;if(n<=e||!d){continue}d=false;for(var l=g;l>=0&&q.charAt(l)==" ";){l--;n-=this.GetSpaceWidth()}ASprite._warpTextInfo[h++]=(g+1);ASprite._warpTextInfo[h++]=(n-f);n=0;j=g}if(n!=0){ASprite._warpTextInfo[h++]=p;ASprite._warpTextInfo[h++]=n}ASprite._warpTextInfo[0]=(h/2);return ASprite._warpTextInfo};a.prototype.TextFitToFixedWidth=function(e,d){if(typeof e=="string"){this.TextFitToFixedWidthStr(e,d)}else{this.TextFitToFixedWidthByte(e,d)}};a.prototype.TextFitToFixedWidthByte=function(f,d){var e=this.TextFitToFixedWidthStr(f,d);return e.getBytes()};a.prototype.TextFitToFixedWidthStr=function(j,e){var d="";var h=0;var f=WraptextB(j,e,0);for(var g=0;g<f[0];g++){if(h!=0&&j.charAt(h)!="\n"){d=d+"\n"}d=d+j.substring(h,f[(g<<1)+1]);h=f[(g<<1)+1]}return d};a.prototype.DrawPageB=function(m,v,f,r,p,t,q,l){var u=f[0];var n=this.GetLineHeight();if(q==-1){q=u}if(t+q>u){q=u-t}var e=this.GetLineSpacing()+n;if((l&32)!=0){p-=e*(q-1)}else{if((l&2)!=0){p-=e*(q-1)>>1}}ASprite._old_pal=this.GetCurrentPalette();var h=0;for(var i=t;i<u&&h<=q-1;h++){ASprite._index1=i<=0?0:(f[(i-1)*2+1]);ASprite._index2=f[i*2+1];if(ASprite._index1<v.length&&v.charAt(ASprite._index1)=="\n"){ASprite._index1++}var d=r;var o=p+h*e;if((l&43)!=0){if((l&8)!=0){d-=f[(i+1)*2]}else{if((l&1)!=0){d-=f[(i+1)*2]>>1}}if((l&32)!=0){if(GLLibConfig.sprite_newTextRendering){o-=this.GetLineHeight()}else{o-=this.GetModuleHeight(1)}}else{if((l&2)!=0){if(GLLibConfig.sprite_newTextRendering){o-=this.GetLineHeight()>>1}else{o-=GetModuleHeight(1)>>1}}}}this.DrawString(m,v,d,o,0,false);i++}ASprite._index1=-1;ASprite._index2=-1;this.SetCurrentPalette(ASprite._old_pal)};a.prototype.UpdateStringSize=function(d){if(typeof d=="string"){this.UpdateStringSizeStr(d)}else{this.UpdateStringSizeByte(d)}};a.prototype.UpdateStringSizeByte=function(d){this.UpdateStringSizeStr(d)};a.prototype.UpdateStringSizeStr=function(d){this.UpdateStringOrCharsSize(d,null)};a.prototype.UpdateStringOrCharsSize=function(h,g){if(h==null&&g==null){return}ASprite._text_w=0;ASprite._text_h=this.GetLineHeight();var d=0;var f=h!=null;var l=ASprite._index1<0?0:ASprite._index1;var j;if(f){j=ASprite._index2<0?h.length:ASprite._index2}else{j=ASprite._index2<0?g.length:ASprite._index2}for(var e=l;e<j;e++){Dbg("-------------------------------- s.charAt(i) : "+h.charAt(e));var k=f?(h.charAt(e)).charCodeAt():(g[e]).charCodeAt();if(k=="^".charCodeAt()){continue}if(GLLibConfig.sprite_fontBackslashChangePalette&&k==92){e++;continue}if(k<=32){if(k==32){d+=this.GetSpaceWidth();continue}if(k==10){if(d>ASprite._text_w){ASprite._text_w=d}d=0;ASprite._text_h+=this.GetLineSpacing()+this.GetLineHeight();continue}if(k==1){e++;continue}if(k!=2){continue}e++;k=f?(h.charAt(e)).charCodeAt():(g[e]).charCodeAt()}d+=this.getCharSize(k)}if(d>ASprite._text_w){ASprite._text_w=d}};a.prototype.DrawString=function(h,f,d,i,e){if(typeof f=="string"){this.DrawStringStr(h,f,d,i,e)}else{this.DrawStringByte(h,f,d,i,e)}};a.prototype.DrawStringByte=function(h,f,d,i,e){this.DrawStringByte6(h,f,d,i,e,true)};a.prototype.DrawStringStr=function(h,f,d,i,e){this.DrawStringStr6(h,f,d,i,e,true)};a.prototype.DrawStringByte6=function(i,h,d,j,f,e){this.DrawStringStr6(i,h,d,j,f,e)};a.prototype.DrawStringStr6=function(i,h,d,j,f,e){this.DrawStringOrChars(i,h,null,d,j,f,e)};a.prototype.DrawStringOrChars=function(j,u,p,q,o,h,t){if(u==null&&p==null){return}var r=u!=null;this.UpdateStringOrCharsSize(u,p);if((h&43)!=0){if((h&8)!=0){q-=ASprite._text_w}else{if((h&1)!=0){q-=ASprite._text_w>>1}}if((h&32)!=0){o-=ASprite._text_h}else{if((h&2)!=0){o-=ASprite._text_h>>1}}}var d=q;var m=o;if(t){ASprite._old_pal=this.GetCurrentPalette()}var l=ASprite._index1<0?0:ASprite._index1;var k;if(r){k=ASprite._index2<0?u.length:ASprite._index2}else{k=ASprite._index2<0?p.length:ASprite._index2}this.SetStringColor(this._nModules-1);for(var f=l;f<k;f++){var n=r?(u.charAt(f)).charCodeAt():(p[f]).charCodeAt();if(n=="^".charCodeAt()){continue}if(GLLibConfig.sprite_fontBackslashChangePalette&&n==92){f++;var e=r?(u.charAt(f)).charCodeAt():(p[f]).charCodeAt();if((e!=95)||(e!=94)){n=e&255;this.SetCurrentPalette(n-48);this.SetStringColor(this._nModules-1)}continue}if(n<=32){if(n==32){d+=this.GetSpaceWidth();continue}if(n==10){d=q;m+=this.GetLineSpacing()+this.GetLineHeight();continue}if(n==1){f++;var e=r?(u.charAt(f)).charCodeAt():(p[f]).charCodeAt();this.SetCurrentPalette(e);if(e==255){this.SetCurrentPalette(ASprite._old_pal)}this.SetStringColor(this._nModules-1);continue}if(n!=2){continue}f++;n=r?(u.charAt(f)).charCodeAt():(p[f]).charCodeAt()}d+=CGame.m_chtFont.DrawChar(j,n,d,m)}if(t){this.SetCurrentPalette(ASprite._old_pal)}};a.StringTokenize=function(g,k,j,f,h){var d=0;h[0]=k-1;for(var e=k;e<j;e++){if(g.charAt(e)==f){h[++d]=e}}h[++d]=j;return d};a.prototype.DrawPage=function(h,f,d,i,e){if(typeof f=="string"){this.DrawPageStr(h,f,d,i,e)}else{this.DrawPageByte(h,f,d,i,e)}};a.prototype.DrawPageByte=function(h,f,d,i,e){this.DrawPage7(h,f,d,i,e,0,f.length)};a.prototype.DrawPageStr=function(h,f,d,i,e){this.DrawPage7(h,f,d,i,e,0,f.length)};a.prototype.DrawPage7=function(l,p,n,m,k,e,h){var f=LowAPI.Gen_Array([100],0);var o=this.StringTokenize(p,e,h,"\n",f);var d=this.GetLineSpacing()+this.GetLineHeight();if((k&32)!=0){m-=d*(o-1)}else{if((k&2)!=0){m-=d*(o-1)>>1}}for(var i=0;i<o;i++){ASprite._index1=f[i]+1;ASprite._index2=f[i+1];this.DrawString(l,p,n,m+i*d,k,false)}ASprite._index1=-1;ASprite._index2=-1};a.prototype.getCharSize=function(d){if(d==" "){return this.GetSpaceWidth()}return CGame.m_chtFont.GetCharWidth(d)};a.prototype.DrawNumber=function(h,f,j,d,i,e){this.DrawNumber8(h,f,10,j,d,i,e,true)};a.prototype.DrawNumber8=function(h,f,m,k,n,l,e,o){var d=GetChars(_itoa_buffer,f,m,k);var j=ASprite._index1;var i=ASprite._index2;this.SetSubString(d,33);this.DrawStringOrChars(h,null,_itoa_buffer,n,l,e,o);this.SetSubString(j,i)};a.GetChars=function(k,f,g,j){if(k==null){_itoa_buffer=LowAPI.Gen_Array([33],0);k=_itoa_buffer}var d=k.length;var h=d-1;var e=f<0;if(!e){f=-f}for(;f<=-g;f/=g){k[h--]=(48-f%g)}for(k[h]=(48-f);d-h<j;k[--h]="0"){}if(e){k[--h]="-"}return h};a.prototype.UpdateNumberSize=function(d,e,i){var f=GetChars(_itoa_buffer,d,e,i);var h=ASprite._index1;var g=ASprite._index2;this.SetSubString(f,33);this.UpdateStringOrCharsSize(null,_itoa_buffer);this.SetSubString(h,g)};a.s_aiChtColor=[[4289745915,4294967295,4294925618,4294901557,4294545142,4294967295,4289593344,4294967295,4289745915,4294967295],[4282442733,4278190080,4290511009,4294967295,4294967295,4278190080]];a.prototype.SetStringColor=function(d){Dbg("________________________ number of module - 1: "+d);if(d<0){return}CGame.m_chtFont.SetColor(a.s_aiChtColor[d][2*this.GetCurrentPalette()]);CGame.m_chtFont.SetBorderColor(a.s_aiChtColor[d][(this.GetCurrentPalette()*2)+1])};a.prototype.CHT_ModifyPaletteAlpha=function(e,d,f){a.s_aiChtColor[e-1][2*d]=((f&255)<<24)|a.s_aiChtColor[e-1][2*d]&16777215;a.s_aiChtColor[e-1][2*d+1]=((f&255)<<24)|a.s_aiChtColor[e-1][2*d+1]&16777215};LowAPI.extendObject(b,{CHT_ASprite:a},true)})(window);