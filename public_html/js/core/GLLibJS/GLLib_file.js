(function(M,aj){var ap=0,g=1,au=2;var i=0;var E=1,e=2,ae=3;var Z=0;var aL=null;var bf=false;var b=null;var l=0;var af=0;var ag=null;var L=null;var X=null;var aC=null;var aG=null;var aK=0;var Q=0;var aM=0;var bj=0;var A=false;var w=null;var ai=null;var C=null;var bw=0;var q=null;var t=0;function m(bG){if(aL!=null){if(bG!=null&&bG==b){return}}Z=E;aT(bG,0)}function aT(bM,bP,bI,bO){var bI=!LowAPI.isUndefined(bI)?bI:null;var bO=!LowAPI.isUndefined(bO)?bO:0;X=bM;aG=bI;aK=bO;if(aL!=null){if(bM!=null&&bM==b){if(l==bP){return aL}else{aO()}}else{bu()}}if(aL==null){if(bP>0){bM+="."+bP}var bK=s(bM);l=bP;bf=bK.markSupported();if(bP==0){b=bM;af=bK.available();var bL=bK.read()|(bK.read()<<8);aM=bL;var bG=bL<<2,bJ=2+bG,bN=bK.available()-bG;ag=[];for(var bH=0;bH<bL;bH++){bG=(bK.read())|(bK.read()<<8)|(bK.read()<<16)|(bK.read()<<24);ag[bH]=bG}Q=ag[0]}else{Q=0}aL=bK}return aL}function aO(){if(aL!=null){aL.close();aL=null;aC=null}}function bu(){aO();b=null;ag=null;L=null}function be(bL){if(!(b!=null)){Assert(false,"Pack_PositionAtData_CORE: m_streamId is null!")}var bK=ag[bL],bG=ag[bL+1]-bK-1,bJ=0;while(bK>af){bK-=af;bJ++}var bH=aT(b,bJ);var bI=bH.available();if(Q>bK){if(GLLibConfig.pack_CORE_UseStreamReset==true&&bf==true){bH.reset();Q=0}else{aO();bH=aT(b,bJ)}}bH.skip(bK-Q);bl(bH.read());A=false;Q=bK+1;return bG}function I(){if(arguments){switch(arguments.length){case 1:return ad.apply(this,arguments);case 3:if(typeof arguments[0]=="number"){return aA.apply(this,arguments)}else{return az.apply(this,arguments)}}}throw new Error("InvalidArguments")}function ad(bG){if(!(b!=null)){Assert(false,"Pack_ReadData_CORE: m_streamId is null!")}return I(b,bG,false)}function aA(bG,bJ,bI){var bH=null;if(m_basepath!=null&&m_resource!=null){bH=I(m_basepath+m_resource[bG],bJ,bI)}return bH}function az(bM,bK,bN){var bI=null;m(bM);var bO=be(bK);var bJ=aL;var bH=bJ.available(),bG=0,bL=0;bI=[];while(bO>0){bG=bd(bJ,bI,bL,Math.min(bO,bH));bL+=bG;Q+=bG;bO-=bG;if(bO==0){break}else{if(bG==-1){break}}bJ=aT(bM,l+1);bH=bJ.available()}if(bN==true){aO()}return bI}function bd(bI,bJ,bG,bH){return bI.read(bJ,bG,bH)}function ac(bG){if(GLLibConfig.pack_use_CORE_ResourceManager){m(bG)}else{y(bG)}}function s(bH){var bG=null;if(Z==ae){bG=new ByteArrayInputStream(aG,aK,aG.length-aK)}else{if(Z==e){throw new Error("Not supported")}else{if(Z==E){bG=s_gllib_instance.GetResourceAsStream(bH)}}}return bG}function a5(){aE();if(Z==ae){aG=null}else{if(Z==e){throw new Error("Not supported")}}}function aE(){if(GLLibConfig.pack_use_CORE_ResourceManager){bu()}else{aZ()}}function aS(bH){if(GLLibConfig.pack_use_CORE_ResourceManager){var bJ=be(bH),bK=0;aC=aL;bK=aL.available();if(bJ>bK){bJ=bK}return bJ}if(!(bH>=0)){Assert(false,"Pack_PositionAtData.idx is invalid")}if(!(bH<aM)){Assert(false,"Pack_PositionAtData.idx is invalid")}if(GLLibConfig.pack_dbgDataAccess){Dbg("Pack_PositionAtData("+bH+")  current sub : "+t)}var bG;for(bG=bw-1;bG>=0;bG--){if(q[bG]<=bH){break}}if(GLLibConfig.pack_dbgDataAccess){Dbg("   data "+bH+" is in subpack : "+bG)}if(t!=bG){if(GLLibConfig.pack_dbgDataAccess){Dbg("   opening subpack : "+bG)}t=bG;a5();if(t==0){var bI=X;X=null;ac(bI)}else{aC=s(X+"."+t);a9()}}else{if(aC==null){if(GLLibConfig.pack_dbgDataAccess){Dbg("   reopening subpack : "+bG)}if(t==0){var bI=X;X=null;ac(bI)}else{aC=s(X+"."+t)}}}bH=bH-q[t];var bL=C[bH];var bJ=C[bH+1]-C[bH];if(GLLibConfig.pack_dbgDataAccess){Dbg("   data is at index "+bH+" in this subpack @ offset "+bL+" ("+bJ+" byte)")}bq(bL);A=false;if(bJ>0){bl((d()&255));bJ--}if(GLLibConfig.pack_dbgDataAccess){if(ai!=null){Dbg("   data mime type is "+bj+" ("+a2(bj)+")")}}return bJ}function bl(bG){bj=bG;if(GLLibConfig.pack_supportLZMADecompression&&(bj>=127)){bj-=127;A=true}}function bF(bG){if(GLLibConfig.pack_use_CORE_ResourceManager){return I(bG)}else{return bD(bG)}}function al(bG){if(bG>0){Q+=aC.skip(bG)}}function d(bH){if(bH==aj){bH=false}var bG=aC.read();if(bG>=0){Q++}else{if(bH){throw new Error("Pack_Read.EOF")}else{Assert(false,"Pack_Read.EOF")}}return bG}function G(){var bG=aC.readByte();Q++;return bG}function aQ(){var bG=((d(true))|((d(true))<<8));return bG}function bh(){var bG=aC.readShort();Q+=2;return bG}function aw(){return(((d(true))|((d(true))<<8))|(((d(true))<<16)|((d(true))<<24)))|0}function r(bL,bK,bH){if(!(bL!=null)){Assert(false,"Pack_ReadFully.array is null")}if(!(bK>=0)){Assert(false,"Pack_ReadFully.offset is negative")}if(!(bH>=0)){Assert(false,"Pack_ReadFully.length is negative")}var bJ=bK;var bG=bH;var bI=0;if(bG>0){bI=aC.read(bL,bJ,bG);if(!(bI>=0)){Assert(false,"Pack_ReadFully.EOF")}bG-=bI;bJ+=bI}Q+=bH;return bH}function aP(bG){if(GLLibConfig.pack_use_CORE_ResourceManager){if(!(bG>=0)){Assert(false,"Pack_ReadArray.idx is invalid")}var bH=new ByteArrayInputStream(bF(bG));return x(bH)}else{return an(bG)}}function J(bH){if(!(bH!=null)){Assert(false,"Pack_LoadMIME.filename is null")}if(ai==null){var bK=aC;aC=s(bH);var bI=d();if(GLLibConfig.pack_dbgDataAccess){Dbg("nb Of MIME type : "+bI)}ai=[];for(var bJ=0;bJ<bI;bJ++){var bG=d();ai[bJ]=[];r(ai[bJ],0,bG)}try{aC.close()}catch(bL){Assert(false,"Pack_LoadMIME.IO Error");Err(bL)}aC=bK}}function H(){return bj}function a2(bG){if(!(ai!=null)){Assert(false,"GetMIME. MIME type not loaded yet, use Pack_LoadMIME first")}if(bG>=ai.length){return""}else{try{return String.byteArray2Text(ai[bG],"UTF-8")}catch(bH){return""}}}function x(bJ){if(!(bJ!=null)){Assert(false,"Mem_ReadArray.is is null")}var bL=null;try{var bM=aW(bJ);var bH;var bO=bM>>4;var bN=bM&7;if((bM&8)!=0){bH=a(bJ)}else{bH=aW(bJ)}switch(bN){case ap:var bP=[];for(var bI=0;bI<bH;bI++){bP[bI]=bJ.readByte()}bL=bP;break;case g:var bP=[];if(bO==ap){for(var bI=0;bI<bH;bI++){bP[bI]=bJ.readByte()}}else{for(var bI=0;bI<bH;bI++){bP[bI]=bJ.readShort()}}bL=bP;break;case au:var bP=[];if(bO==ap){for(var bI=0;bI<bH;bI++){bP[bI]=bJ.readByte()}}else{if(bO==g){for(var bI=0;bI<bH;bI++){bP[bI]=bJ.readShort()}}else{for(var bI=0;bI<bH;bI++){bP[bI]=a8(bJ)}}}bL=bP;break;default:var bG=[];for(var bI=0;bI<bH;bI++){bG[bI]=x(bJ)}bL=bG;break}}catch(bK){throw bK}return bL}function v(bH,bG){return((bH[bG++]&255)|((bH[bG++]&255)<<8)).castToShort()}function aW(bG){var bH=bG.read();if(bH>=0){i++}return bH}function a(bG){return bG.readUShort()}function a8(bG){return bG.readInt()}function bi(bH,bJ,bI,bG){if(!(bJ!=null)){Assert(false,"Stream_ReadFully.array is null")}if(!(bI>=0)){Assert(false,"Stream_ReadFully.offset is negative")}if(!(bG>=0)){Assert(false,"Stream_ReadFully.length is negative")}bH.read(bJ,bI,bG);i+=bG;return bG}GLLib.prototype.GetResourceAsStream=function(bG){return new ByteArrayInputStream(gllib_runtime.getAsset(bG.substring(1)))};function y(bG){if(!(bG!=null)){Assert(false,"Pack_Open.filename is null")}if(GLLibConfig.pack_dbgDataAccess){Dbg("Pack_Open("+bG+")")}Z=E;a1(bG,null,0)}function bD(bG){if(!(bG>=0)){Assert(false,"Pack_ReadData.idx is invalid")}if(!(bG<aM)){Assert(false,"Pack_ReadData.idx is invalid")}if(GLLibConfig.pack_dbgDataAccess){Dbg("Pack_ReadData("+bG+")")}var bH=aS(bG);var bI=null;if(GLLibConfig.pack_supportLZMADecompression&&A){try{aV(aC,bH);Q+=bH;bI=ab;ab=null}catch(bJ){if(!(false)){Assert(false,"LZMA decompression failed : "+bJ.toString())}}}else{bI=LowAPI.Gen_Array([bH],0);r(bI,0,bI.length)}if(GLLibConfig.pack_dbgDataAccess){Dbg("     Pack_ReadData("+bG+")  DONE")}return bI}function an(bG){if(!(bG>=0)){Assert(false,"Pack_ReadArray.idx is invalid")}if(!(bG<aM)){Assert(false,"Pack_ReadArray.idx is invalid")}if(GLLibConfig.pack_dbgDataAccess){Dbg("Pack_ReadArray("+bG+")")}var bH=aS(bG);if(GLLibConfig.pack_dbgDataAccess){Dbg("size of data is "+bH)}i=0;var bK;if(GLLibConfig.pack_supportLZMADecompression&&A){var bI=bF(bG);var bJ=new ByteArrayInputStream(bI);bK=x(bJ);bJ=null;bI=null}else{bK=x(aC);Q+=bH}return bK}function aZ(){if(aC!=null){aC.close();aC=null}Q=0}function a9(){var bG;if(t==bw-1){bG=aM-q[t]}else{bG=q[t+1]-q[t]}if(GLLibConfig.pack_dbgDataAccess){Dbg("   nb of data in this subpack : "+bG)}C=[];for(var bH=0;bH<bG+1;bH++){C[bH]=aw();if(GLLibConfig.pack_dbgDataAccess){Dbg("   data "+bH+" is @ offset : "+C[bH])}}}function a1(bG,bJ,bI){if((X!=null)&&(bG!=null)&&(bG==X)){if(GLLibConfig.pack_dbgDataAccess){Dbg("Pack_OpenEx("+bG+").file already open")}return}a5();X=bG;aG=bJ;aK=bI;aC=s(X);if(!(aC!=null)){Assert(false,"Pack_Open.unable to find file")}aM=aQ().castToShort();if(GLLibConfig.pack_dbgDataAccess){Dbg("   nb of data in pack : "+aM)}bw=aQ().castToShort();if(GLLibConfig.pack_dbgDataAccess){Dbg("   nb of subpack for this pack : "+bw)}q=[];for(var bH=0;bH<bw;bH++){q[bH]=aQ().castToShort();if(GLLibConfig.pack_dbgDataAccess){Dbg("   subpack "+bH+" start with data : "+q[bH])}}t=0;a9()}function bq(bG){if(Q==bG){return}if(Q>bG){if(GLLibConfig.pack_dbgDataAccess){Dbg("Pack Close BAD READING ORDER")}aE();if(t==0){aC=s(X)}else{aC=s(X+"."+t)}if(!(aC!=null)){Assert(false,"Pack_Seek.internal error")}}else{bG-=Q}al(bG)}function aa(bL,bJ){if(!(ai!=null)){Assert(false,"GetMIMEIndex: MIME type not loaded yet, use Pack_LoadMIME first")}for(var bH=0;bH<ai.length;bH++){if(a2(bH)==bL){return bH}}throw new Error("GetMIMEIndex: MIME type "+bL+" not found");if(bJ){Dbg("GetMIMEIndex: Adding new MIME type to list!");var bG=ai.length;var bI=[];for(var bH=0;bH<bG-2;bH++){bI[bH]=ai[bH]}try{bI[bG-1]=bL.getBytes("UTF-8")}catch(bK){Dbg("GetMIMEType: UTF-8 not supported!")}ai=bI;return bG-1}return -1}var R=null;var c=0;var K=0;var bx=0;var bt=0;var ab=null;var f=0;var ah=null;var ar=11;var U=(1<<ar);var aH=5;var aD=1846;var aB=768;var Y=0;var aJ=1;var n=2;var bz=12;var aN=4;var am=4;var aI=6;var P=4;var j=14;var h=(1<<(j>>1));var S=4;var V=(1<<S);var bB=0;var o=bB+(bz<<aN);var bc=o+bz;var bb=bc+bz;var ba=bb+bz;var z=ba+bz;var k=z+(bz<<aN);var bC=k+(am<<aI);var bE=bC+h-j;var aR=bE+V;var bv=(1<<aN);var a4=3;var u=(1<<a4);var aF=3;var at=(1<<aF);var bg=8;var T=(1<<bg);var F=2;var bn=0;var av=bn+1;var bo=av+1;var by=bo+(bv<<a4);var a3=by+(bv<<aF);var bA=a3+T;var ax=aR+bA;var N=ax+bA;var O=5;var B=24;var ak=(1<<B);var a7=13;function a6(bH,bI){R=bH;c=bI;f=a7;bt=0;bx=0;K=4294967295;bH[c-1]=(255).castToByte();for(var bG=0;bG<5;bG++){bx=(bx<<8)|(R[f++]&255)}}function bs(bG){var bH=((K>>>ar)*ah[bG]);if(bx<bH){K=bH;ah[bG]+=(U-ah[bG])>>O;if(K<ak){bx=((bx<<8)|(R[f++]&255)).castToLong();K=(K<<8).castToLong()}return 0}else{K-=bH;bx-=bH;ah[bG]-=(ah[bG])>>O;if(K<ak){bx=((bx<<8)|(R[f++]&255)).castToLong();K=(K<<8).castToLong()}return 1}}function ay(bH,bI){var bJ=1;do{var bK;var bG=(bI>>7)&1;bI<<=1;bK=bs(bH+((1+bG)<<8)+bJ);bJ=(bJ<<1)|bK;if(bG!=bK){while(bJ<256){bJ=(bJ<<1)|bs(bH+bJ)}break}}while(bJ<256);return bJ}function bm(bH){var bG=1;do{bG=(bG<<1)|bs(bH+bG)}while(bG<256);return bG}function bp(bJ,bI){var bG=1;for(var bH=bI;bH>0;bH--){bG=(bG<<1)+bs(bJ+bG)}return bG-(1<<bI)}function W(bH,bG){if(bs(bH+bn)==0){return bp(bH+bo+(bG<<a4),a4)}if(bs(bH+av)==0){return u+bp(bH+by+(bG<<aF),aF)}return u+at+bp(bH+a3,bg)}function p(bL,bJ){var bG=1;var bI=0;var bK;for(var bH=0;bH<bJ;bH++){bK=bs(bL+bG);bG=(bG<<1)+bK;bI|=(bK<<bH)}return bI}function D(bH){var bI=K;var bK=bx;var bG=0;for(var bJ=bH;bJ>0;bJ--){bI=(bI>>>1);bG<<=1;if(bK>=bI){bK-=bI;bG|=1}if(bI<ak){bI=(bI<<8).castToLong();bK=((bK<<8)|(R[f++]&255)).castToLong()}}K=bI;bx=bK;return bG}function br(bN,bU,bR,bH,bG,bT){var bQ=N+(aB<<(bU+bR));var bV=ah;var bM=0;var bL=false;var b0=0;var b5=1;var b4=1;var b3=1;var b2=1;var bO=0;var bJ=(1<<bH)-1;var bZ=(1<<bR)-1;var bY=0;if(bN<(bQ<<1)){return}for(var bW=0;bW<bQ;bW++){bV[bW]=1024}a6(bG,bG.length);while(bO<bT){var b1=bO&bJ;if(bs(bB+(bM<<aN)+b1)==0){var bS=N+(aB*(((bO&bZ)<<bU)+((b0&255)>>(8-bU))));if(bM<4){bM=0}else{if(bM<10){bM-=3}else{bM-=6}}if(bL){var bK;bK=ab[bO-b5];b0=ay(bS,bK)&255;bL=false}else{b0=bm(bS)&255}ab[bO++]=b0.castToByte()}else{bL=true;if(bs(o+bM)==1){if(bs(bc+bM)==0){if(bs(z+(bM<<aN)+b1)==0){bM=bM<7?9:11;b0=ab[bO-b5]&255;ab[bO++]=b0.castToByte();continue}}else{var bI;if(bs(bb+bM)==0){bI=b4}else{if(bs(ba+bM)==0){bI=b3}else{bI=b2;b2=b3}b3=b4}b4=b5;b5=bI}bY=W(ax,b1);bM=bM<7?8:11}else{var bX;b2=b3;b3=b4;b4=b5;bM=bM<7?7:10;bY=W(aR,b1);bX=bp(k+((bY<am?bY:am-1)<<aI),aI);if(bX>=P){var bP=((bX>>1)-1);b5=((2|(bX.castToInt()&1))<<bP);if(bX<j){b5+=p(bC+b5-bX-1,bP)}else{b5+=D(bP-S)<<S;b5+=p(bE,S)}}else{b5=bX}b5++}bY+=F;do{b0=ab[bO-b5]&255;ab[bO++]=b0.castToByte();bY--}while(bY>0&&bO<bT)}}}function aV(bK,bQ){if(GLLibConfig.pack_supportLZMADecompression){var bH;bH=LowAPI.Gen_Array([bQ+1],0);bi(bK,bH,0,bQ);var bI=0;var bO;for(var bJ=0;bJ<4;bJ++){bI+=((bH[bJ+5]&255))<<(bJ<<3)}var bM=bH[0]&255;var bG;var bL;var bP;bP=LowAPI.Float2Int(bM/45);bM%=45;bL=LowAPI.Float2Int(bM/9);bG=bM%9;var bN=(aD+(aB<<(bG+bL)));ab=LowAPI.Gen_Array([bI],0);ah=LowAPI.Gen_Array([bN],0);br(bN*2,bG,bL,bP,bH,bI);ah=null;R=null;bH=null}}function aq(bI,bG,bH){bI[bG++]=bH;return bG}function a0(bI,bG,bH){bI[bG++]=((bH)&255);bI[bG++]=((bH>>>8)&255);return bG}function bk(bI,bG,bH){bI[bG++]=((bH)&255);bI[bG++]=((bH>>>8)&255);bI[bG++]=((bH>>>16)&255);bI[bG++]=((bH>>>24)&255);return bG}function aY(bH,bG){return bH[bG]}function aU(bH,bG){return(((bH[bG++]&255))|((bH[bG++]&255)<<8)|((bH[bG++]&255)<<16)|((bH[bG++]&255)<<24))}function aX(bH,bK,bJ,bI,bG){System.arraycopy(bH,bK,bJ,bI,bG)}(function ao(){Object.defineProperty(M,"s_pack_lastDataIsCompress",{get:function(){return A},set:function(bG){throw new Error("Not allow!")}});Object.defineProperty(M,"s_pack_is",{get:function(){return aC},set:function(bG){throw new Error("Not allow!")}})})();LowAPI.extendObject(M,{Pack_Open:ac,Pack_PositionAtData:aS,Pack_Close:a5,Pack_ReadData:bF,Pack_Skip:al,Pack_Read:d,Pack_readU8:d,Pack_readS8:G,Pack_Read16:aQ,Pack_readS16:bh,Pack_Read32:aw,Pack_readS32:aw,Pack_ReadArray:aP,Pack_ReadFully:r,Pack_LoadMIME:J,Stream_Read:aW,Stream_Read16:a,Stream_Read32:a8,Stream_ReadFully:bi,Mem_ArrayCopy:aX,Mem_GetByte:aY,Mem_GetShort:v,Mem_GetInt:aU,Mem_SetShort:a0,Mem_SetInt:bk,Mem_SetByte:aq,Mem_ReadArray:x,GetMIME:a2,GetMIMEIndex:aa,Pack_GetLastDataReadMimeType:H,},true)})(window);