if(!String.prototype.endsWith){String.prototype.endsWith=function(c,b){var a=this.toString();if(typeof b!=="number"||!isFinite(b)||Math.floor(b)!==b||b>a.length){b=a.length}b-=c.length;var d=a.lastIndexOf(c,b);return d!==-1&&d===b}}var initedGTM=!false;var str_GTMTrackingKey="GTM-PLZ2PKZ";var str_productKey="castleOfMagicFree";var productKey=str_productKey;function initGTM(){}var gllib_runtime={running:true,reload_sig:0,listScripts:["/ex/jquery/jquery-3.2.1.min.js","/ex/webgl-2d.js","/ex/numeric-1.2.6.js","/social/SocialNetwork.js","/utils/Device.js","/utils/LowAPI.js","/midp2/Display.js","/midp2/Sprite.js","/midp2/Font.js","/midp2/Image.js","/midp2/Graphics.js","/midp2/GraphicsEX.js","/midp2/MIDlet.js","/midp2/Displayable.js","/midp2/Canvas.js","/midp2/Player.js","/midp2/Manager.js","/javawrapper/InputStream.js","/javawrapper/String.js","/javawrapper/ByteArrayInputStream.js","/javawrapper/System.js","/javawrapper/Integer.js","/javawrapper/Random.js","/javawrapper/StringBuffer.js","/GLLibJS/GLLibInterface.js","/GLLibJS/GLLibConfig.js","/GLLibJS/GameState.js","/GLLibJS/Image.js","/GLLibJS/ASprite.js","/GLLibJS/GLLibPlayer.js","/GLLibJS/GLLibPlayer_sound.js","/GLLibJS/GLLib.js","/GLLibJS/GLLib_text.js","/GLLibJS/GLLib_file.js","/GLLibJS/GLLib_math.js","/GLLibJS/GLLib_wrapper_midp2.js","/GLLibJS/GLLib_rms.js","/GLLibJS/Hashtable.js","/GLLibJS/GLLib_keypad.js",],};(function(a,f){(function(){if(console.clear){console.clear()}window.initDebugUI=function(){var l=document.getElementById("gameloft-root-div");var g=document.createElement("div");g.id="gameloft-debug-div";g.addLog=function(m,n){var o=document.createElement("pre");o.className="console";switch(m){case"D":o.className+=" console-log";break;case"W":o.className+=" console-warning";break;case"E":o.className+=" console-error";break}o.innerHTML=n;g.appendChild(o);if(l.style["display"]=="block"){g.scrollTop=g.scrollHeight}};var i=document.createElement("div");i.id="gameloft-actions-div";var k=document.createElement("button");k.id="btn-toogle-debug";k.innerHTML="Toggle Debug";k.setAttribute("data-current-mode",0);k.setMode=function(m){k.setAttribute("data-current-mode",m);switch(m){case 0:l.style["display"]=g.style["display"]="block";l.style["opacity"]="0.7";j.style["display"]="none";break;case 1:l.style["display"]="none";j.style["display"]="block";g.style["display"]="block";break;case 2:l.style["display"]="block";l.style["opacity"]="1";j.style["display"]="none";g.style["display"]="none";break}};k.onclick=function(){var m=(k.getAttribute("data-current-mode")+1)%3;k.setMode(m)};i.appendChild(k);var h=document.createElement("label");h.innerHTML='<input type="checkbox" checked onclick="gllib_runtime.running=!gllib_runtime.running;">Loop</label>';i.appendChild(h);window.updateFilterConsole=function(){var m="";if(!document.getElementById("filter-console-log")["checked"]){m+="hide-log "}if(!document.getElementById("filter-console-warning")["checked"]){m+="hide-warning "}if(!document.getElementById("filter-console-error")["checked"]){m+="hide-error "}g.setAttribute("class",m)};var j=document.createElement("div");j.setAttribute("id","filter-console");j.innerHTML='<label><input id="filter-console-log" type="checkbox" checked onclick="updateFilterConsole()">Log</label><label><input id="filter-console-warning" type="checkbox" checked onclick="updateFilterConsole()">Warning</label><label><input id="filter-console-error" type="checkbox" checked onclick="updateFilterConsole()">Error</label>';i.appendChild(j);document.getElementsByTagName("body")[0].insertBefore(g,l);document.getElementsByTagName("body")[0].insertBefore(i,g);document.getElementsByTagName("body")[0].className+=" debug";document.getElementById("btn-toogle-debug").setMode(0)};window.Assert=function(g,h){console.assert(g,h)};window.Err=function(g){console.error(g)};window.Dbg=function(g){console.log(g)};window.Warn=function(g){console.warn(g)}})();(function(){function g(){Dbg("* DOMContent Loaded");c();b()}function h(){setTimeout(function(){},3000)}if(document.readyState==="complete"){return setTimeout(function(){g();h()},1)}else{if(document.addEventListener){document.addEventListener("DOMContentLoaded",g,false);window.addEventListener("load",h,false)}else{if(document.attachEvent){document.attachEvent("onreadystatechange",g);window.attachEvent("onload",h)}}}})();function e(){var h=a.m_config["Accelerated-AnimationFrame"]?null:(window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame);(function g(){if(h){h(g)}if(a.running){var m=a.AnimationFrame||[];for(var l=0,j=m.length;l<j;l++){try{if(typeof m[l]=="function"){m[l]()}}catch(k){if(k.stack){Err("[AnimationFrame]["+l+"]\n"+k.stack)}else{Err("[AnimationFrame]["+l+"]\n"+k)}a.removeAnimationFrame(l)}}}if(!h){window.setTimeout(g,1)}})()}function c(){var i=document.getElementById("gameloft-root-div");if(i=="undefined"||i==null){throw new Error("Can not found element id gameloft-root-div")}var h=document.createElement("div");h.id="gameloft-loading-div";i.appendChild(h);var g=document.createElement("canvas");g.width=h.getBoundingClientRect().width;g.height=h.getBoundingClientRect().height;g.style["position"]="relative",g.style["left"]="0px",g.style["top"]="0px",g.style["width"]=g.style["min-width"]=g.width+"px",g.style["height"]=g.style["min-height"]=g.height+"px";h.appendChild(g);h.style["display"]="none";if(a.m_config["fnLoadingInit"]){a.m_config["fnLoadingInit"](g)}a.addAnimationFrame(function(){var k=a.getLoadingScreenState();var j=k.isShow?"block":"none";if(h.style["display"]!=j){h.style["display"]=j}if(j=="none"){return}if(typeof ads_isShowing!="undefined"&&ads_isShowing()||true){return}a.m_config["fnLoadingPaint"](g,k.sMessage,k.iProgess)})}function b(){var i=document.getElementById("gameloft-root-div");if(i=="undefined"||i==null){throw new Error("Can not found element id gameloft-root-div")}var h=document.createElement("div");h.id="gameloft-user-input-div";i.appendChild(h);var g=document.createElement("canvas");g.width=h.getBoundingClientRect().width;g.height=h.getBoundingClientRect().height;g.style["position"]="relative",g.style["left"]="0px",g.style["top"]="0px",g.style["width"]=g.style["min-width"]=g.width+"px",g.style["height"]=g.style["min-height"]=g.height+"px";h.appendChild(g);h.style["display"]="none"}function d(){var o=0;var s=0;var k=0;var p=0;var j=document.getElementsByTagName("body")[0];var n=a.m_config.dataLocation;function q(i){s++;var z=a.getLoadingScreenState();z.iProgess=(s*100/o)|0;if(p==k&&k!=0){k=0;t()}if(s==o){a.setLoadingScreenState(false);try{var A=new window[a.m_config["MidletName"]]();A.startApp()}catch(y){if(y.stack){Err("ERROR #"+y.stack)}else{Err("ERROR # "+y)}throw y}}}function g(A,z,B,i){var y=document.createElement("script");y.async=false;y.charset="utf-8";y.type="text/javascript";y.src=z+"?sig="+B;y.onload=y.onreadystatechange=function(C){if(C.type==="load"||(/^(complete|loaded)$/.test((C.currentTarget||C.srcElement).readyState))){q((C.currentTarget||C.srcElement)["src"]);if(i){i()}}};A.appendChild(y)}a.loadAssets=function(A,B){o+=A.length;k=A.length;function z(i,F){var G=this;switch(G.readyState){case 0:break;case 1:break;case 2:break;case 3:break;case 4:if(G.status===200){if(G.cbSuccess){G.cbSuccess.call(G,G.responseURL||i,F)}}else{if(G.cbError){G.cbError.call(G,G.responseURL||i,F)}}break}}function D(i,G){try{var H=new XMLHttpRequest();H.open("GET",i,true);H.cbSuccess=function(I,J){var K=this;if(!(K.response instanceof ArrayBuffer)){throw new Error("Response invalid!")}a.putAsset(J,K.response);p++;q(I)};H.onreadystatechange=z.bind(H,i,G);H.ontimeout=function(I){var J=this;Err("loadAsset # The request for "+I+" timed out.")};H.responseType="arraybuffer";H.send(null)}catch(F){Err("loadAsset #"+F)}}for(var C=0,y=A.length;C<y;C++){var E=A[C];if(E.endsWith(".js")){k--;g(j,n+"/"+E,B||"cached")}else{D(n+"/"+E+"?built="+B||"cached",E)}}};var r="gllib.main.js";var l=document.getElementsByTagName("script");for(var m=l.length-1;m>=0;m--){if(l[m]["src"]){var x=l[m]["src"].split("?")[0];if(x.endsWith("/"+r)||x.endsWith("\\"+r)){a.Path=x.substring(0,x.length-r.length);if(a.Path.endsWith("/")){a.Path=a.Path.substring(0,a.Path.length-1)}break}}}if(!a.Path){throw new Error("Can not detect the GLLIB ROOT PATH")}var w=a.listScripts;var h=a.m_config["listScripts"];var v=a.m_config["reload_sig"]==f?a.reload_sig:a.m_config["reload_sig"];o+=w.length+h.length;function t(){for(var z=0,y=w.length;z<y;z++){g(j,a.Path+w[z],v)}for(var z=0,y=h.length;z<y;z++){g(j,h[z],v)}}function u(){if(n!=""){o+=1;g(j,n+"/Loader.js",v)}else{t()}}if(a.m_config.AdsID!=""){initGTM();o+=1;g(j,a.Path+"/ads/freePlugin.js",v,u)}else{u()}}a.config=function(i){a.m_config=i;if(i.ConsoleMode=="Browser"){}else{if(i.ConsoleMode=="Screen"){window.initDebugUI();var g=document.getElementById("gameloft-debug-div");console.log=function(j){g.addLog("D",j)};console.warn=function(j){g.addLog("W",j)};console.error=function(j){g.addLog("E",j)};console.assert=function(){}}else{console.log=console.warn=console.error=console.assert=function(){}}}(function h(l){for(var k=0,j=l.length;k<j;k++){if(a.m_config[l[k]]==f){throw new Error(l[k]+" is not defined!")}}})(["fnLoadingPaint","MidletName"]);e();a.setLoadingScreenState(true,"Downloading Game....",0);d()};a.getAsset=function(g){var h=a.CachedAssets=a.CachedAssets||[];if(!h[g]){throw new Error("The asset is not found("+g+")")}return h[g]||null};a.putAsset=function(h,g){var i=a.CachedAssets=a.CachedAssets||[];i[h]=g};a.getLoadingScreenState=function(){return a.LoadingScreenState=a.LoadingScreenState||{isShow:false,sMessage:"",iProgess:0}};a.setLoadingScreenState=function(g,h,j){var i=a.getLoadingScreenState();i.isShow=g;i.sMessage=h||"";i.iProgess=Math.max(0,Math.min(100,(j||i.iProgess)|0))};a.removeAnimationFrame=function(g){var h=a.AnimationFrame=a.AnimationFrame||[];h[g]=null};a.addAnimationFrame=function(k,h){var i=a.AnimationFrame=a.AnimationFrame||[];var j=Array.prototype.slice.call(arguments,2);var g=function(){var l=j.concat(Array.prototype.slice.call(arguments,0));return k.apply(h,l)};i.push(g);return i.length-1};a.requireUserInputEvent=function(i,j){var k=document.getElementById("gameloft-user-input-div");k.style["display"]="block";var h=k.getElementsByTagName("canvas")[0];var i=i;var g=a.addAnimationFrame(a.m_config["fnRequireUserInputPaint"],null,h,j);function l(m){h.removeEventListener("touchend",l,false);h.removeEventListener("mouseup",l,false);if(i){i(m)}i=false;k.style["display"]="none";a.removeAnimationFrame(g)}h.addEventListener("touchend",l,false);h.addEventListener("mouseup",l,false)}}(gllib_runtime));