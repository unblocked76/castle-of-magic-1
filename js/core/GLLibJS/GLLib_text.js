(function(I,q){var ae="GLLib_text.js";var l="EN",V="US",E="DE",b="FR",P="IT",j="ES",ac="BR",C="PT",B="JP",Q="CN",n="KR",d="RU",af="TR",F="PL",K="CZ",ah="NL",al="TH",L="VI",am="AR";var h=11,ap=(1<<h)-1,k=1000,ag="@",Z="%",at=167,M=String.fromCharCode(11904),z=" ",D=String.fromCharCode(160),A=1;var t;var u="UTF-8";var W=0;var N=null;var U=null;var m=null;var Y=null;var H=null;var w=[];var av=null;var o=[];function S(aw){switch(aw){case GLLang.EN:return l;case GLLang.US:return V;case GLLang.DE:return E;case GLLang.FR:return b;case GLLang.IT:return P;case GLLang.ES:return j;case GLLang.BR:return ac;case GLLang.PT:return C;case GLLang.JP:return B;case GLLang.CN:return Q;case GLLang.KR:return n;case GLLang.RU:return d;case GLLang.PL:return F;case GLLang.TR:return af;case GLLang.CZ:return K;case GLLang.NL:return ah;case GLLang.TH:return al;case GLLang.VI:return L;case GLLang.AR:return am}return null}function R(ax){var aw=false;if(ax==GLLang.EN){aw=true}if(ax==GLLang.US){aw=false}if(ax==GLLang.BR){aw=true}if(ax==GLLang.DE){aw=true}if(ax==GLLang.ES){aw=true}if(ax==GLLang.FR){aw=true}if(ax==GLLang.IT){aw=true}if(ax==GLLang.PL){aw=false}if(ax==GLLang.RU){aw=true}if(ax==GLLang.TR){aw=true}if(ax==GLLang.VI){aw=true}if(ax==GLLang.TH){aw=true}if(ax==GLLang.PT){aw=false}if(ax==GLLang.JP){aw=true}if(ax==GLLang.KR){aw=true}if(ax==GLLang.CN){aw=false}if(ax==GLLang.AR){aw=false}if(ax==GLLang.CN){aw=false}return aw}function aa(aw){return DATA["TEXT_"+S(aw)+"_MAX"]||DATA.TEXT_MAX}function r(aw){if(aw==q){aw=t}return DATA["PACK_TEXT_"+S(aw)]}function O(aw){t=aw}function X(aw){u=aw}function y(az){if(az==q){az=t}var aw=r(az);Dbg(ae+"# loadText "+S(az));var ay=aa(az);for(var ax=0;ax<ay;ax++){ar(aw,ax)}}function x(aw){if(o){o[aw]=[]}if(w){w[aw]=0}}function ai(aw,ay,ax){if(GLLibConfig.pack_use_CORE_ResourceManager){ar(aw,ay,ax)}else{p(aw,ay,ax)}}function ar(aw,ay,ax){if(ax==q){return v(aw,ay)}else{return f(aw,ay,ax)}}function v(aw,ax){if(GLLibConfig.text_useMultipleTextPacks){x(ax)}else{aq()}if(GLLibConfig.text_useMultipleTextPacks){if(Y==null){H=[];av=[];w=[];Y=[];for(var ay=0;ay<GLLibConfig.text_maxPacks;ay++){Y[ay]=-1;H[ay]=[];av[ay]=[];w[ay]=0}if(GLLibConfig.text_useStringCache){o=LowAPI.Gen_Array([GLLibConfig.text_maxPacks],null)}}}Pack_Open(aw);var az=aj(new ByteArrayInputStream(Pack_ReadData(ax)));if(GLLibConfig.text_useMultipleTextPacks){Y[ax]=az;if(GLLibConfig.text_useStringCache){G(Y[ax])}}else{if(GLLibConfig.text_useStringCache){G()}else{if(GLLibConfig.text_useStringCachePool){Text_StrPoolInit()}}}Pack_Close()}function f(aw,ay,ax){throw new Error("Not supported yet.")}function aj(ay){if(GLLibConfig.text_useMultipleTextPacks){var aw=0;try{if(!(w!=null)){Dbg("Text_LoadTextFromStream: text_multiple_nbStrings is null")}aw=Stream_Read(ay);if(!(aw<GLLibConfig.text_maxPacks)){Dbg("Text_LoadTextFromStream: Trying to load a tab higher than GLLibConfig.text_maxPacks!")}w[aw]=Stream_Read32(ay);if(w[aw]>(1<<GLLibConfig.text_maxStringsLog2)){if(!(false)){Dbg("WARNING! You are loading a text pack with more than "+(1<<GLLibConfig.text_maxStringsLog2)+" strings! All extras will be ignored")}w[aw]=(1<<GLLibConfig.text_maxStringsLog2)}av[aw]=[];av[aw][0]=0;for(var ax=1;ax<w[aw]+1;ax++){av[aw][ax]=Stream_Read32(ay)}H[aw]=LowAPI.Gen_Array([av[aw][w[aw]]],0);Stream_ReadFully(ay,H[aw],0,H[aw].length)}catch(az){Err("exception during loading "+az)}return aw}else{try{W=Stream_Read32(ay);U=LowAPI.Gen_Array([W+1],0);for(var ax=1;ax<W+1;ax++){U[ax]=Stream_Read32(ay)}N=LowAPI.Gen_Array([U[W]],0);Stream_ReadFully(ay,N,0,N.length)}catch(az){Err("exception during loading "+az)}return N.length+((W+1)<<2)}}function p(aw,ay,ax){if(ax==q){return a(aw,ay)}else{return ao(aw,ay,ax)}}function a(aw,ax){if(GLLibConfig.text_useMultipleTextPacks){x(ax)}else{aq()}Pack_Open(aw);Pack_PositionAtData(ax);if(GLLibConfig.text_useMultipleTextPacks){if(Y==null){Y=[];H=[];av=[];w=[];for(var ay=0;ay<GLLibConfig.text_maxPacks;ay++){Y[ay]=-1;H[ay]=null;av[ay]=null;w[ay]=0}if(GLLibConfig.text_useStringCache){o=LowAPI.Gen_Array([GLLibConfig.text_maxPacks],null)}}if(GLLibConfig.pack_supportLZMADecompression&&s_pack_lastDataIsCompress){var az=Pack_ReadData(ax);var aA=new ByteArrayInputStream(az);Y[ax]=aj(aA);aA=null;az=null}else{Y[ax]=aj(s_pack_is)}Pack_Close();if(GLLibConfig.text_useStringCache){G(Y[ax])}}else{if(GLLibConfig.pack_supportLZMADecompression&&s_pack_lastDataIsCompress){var az=Pack_ReadData(ax);var aA=new ByteArrayInputStream(az);aj(aA);aA=null;az=null}else{aj(s_pack_is)}Pack_Close();if(GLLibConfig.text_useStringCache){G()}else{if(GLLibConfig.text_useStringCachePool){Text_StrPoolInit()}}}}function ao(aw,aD,aC){if(GLLibConfig.text_useMultipleTextPacks){ai(aw,aD);Text_LoadAdditionalTextPack_INI(aw,aC)}else{aq();Pack_Open(aw);Pack_PositionAtData(aD);if(GLLibConfig.pack_supportLZMADecompression&&s_pack_lastDataIsCompress){var aF=new ByteArrayInputStream(Pack_ReadData(aD));aj(aF)}else{s_pack_curOffset+=aj(s_pack_is)}var ay=W;var aG=U;var aB=N;aq();Pack_PositionAtData(aC);if(GLLibConfig.pack_supportLZMADecompression&&s_pack_lastDataIsCompress){var aF=new ByteArrayInputStream(Pack_ReadData(aC));aj(aF)}else{s_pack_curOffset+=aj(s_pack_is)}var ax=W;var aE=U;var az=N;for(var aA=1;aA<ax+1;aA++){aE[aA]+=aG[ay]}aq();Pack_Close();W=ay+ax;U=LowAPI.Gen_Array([W+1],0);System.arraycopy(aG,0,U,0,aG.length);System.arraycopy(aE,1,U,aG.length,aE.length-1);N=LowAPI.Gen_Array([U[W]],0);System.arraycopy(aB,0,N,0,aB.length);System.arraycopy(az,0,N,aB.length,az.length);if(GLLibConfig.text_useStringCache){G()}else{if(GLLibConfig.text_useStringCachePool){Text_StrPoolInit()}}}}function G(aw){if(aw==q){return an()}else{return c(aw)}}function an(){if(GLLibConfig.text_useMultipleTextPacks){for(var aw=0;aw<GLLibConfig.text_maxPacks;aw++){G(aw)}}else{var ay=0;var az=[];for(var ax=0;ax<W;ax++){az[ax]=ad(ax)}m=az;U=null;N=null}}function c(aw){if(!GLLibConfig.text_useMultipleTextPacks){if(!(false)){GLLib.Assert(false,"WARNING! Trying to call buildStringCache with an index! You can only do that when text_useMultipleTextPacks is true")}}else{if(w[aw]==0){return}var ay=0;var az=[];for(var ax=0;ax<w[aw];ax++){az[ax]=ad(ax+(aw<<GLLibConfig.text_maxStringsLog2))}o[aw]=az;av[aw]=null;H[aw]=null}}function aq(){if(GLLibConfig.text_useMultipleTextPacks){for(var aw=0;aw<GLLibConfig.text_maxPacks;aw++){x(aw)}}else{if(m!=null){for(var ax=0;ax<W;ax++){m[ax]=null}m=null}U=null;N=null;W=0}}function e(aw,ax){var ax=!LowAPI.isUndefined(ax)?ax:0;return ad(aw+(ax<<h))}function T(aB,ay,az){if(ay==q){ay=t}if(az==q){az=D}if(aB<1000){return""+aB}else{var aw="";switch(ay){case GLLang.EN:case GLLang.US:case GLLang.JP:case GLLang.KR:case GLLang.CN:case GLLang.TH:case GLLang.AR:aw=",";break;case GLLang.DE:case GLLang.BR:case GLLang.IT:case GLLang.VI:aw=".";break;case GLLang.PL:case GLLang.CZ:aw=az;break;case GLLang.FR:case GLLang.ES:case GLLang.PT:case GLLang.RU:if(aB>=10000){aw=az}break;case GLLang.TR:case GLLang.NL:if(aB>=10000){aw="."}break;default:return""+aB}if(true){return aB.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1"+aw)}else{var aA="";var ax=((aB%1000)<0?-(aB%1000):(aB%1000));aB=LowAPI.Float2Int(aB/1000);while(ax!=0||aB!=0){if(ax<10){aA="00"+((ax)<0?-(ax):(ax))+aA}else{if(ax<100){aA="0"+((ax)<0?-(ax):(ax))+aA}else{aA=((ax)<0?-(ax):(ax))+aA}}ax=aB%1000;aB=LowAPI.Float2Int(aB/1000);if(aB!=0){aA=aw+aA}else{if(ax!=0){aA=ax+aw+aA;ax=0}}}return aA}}}function g(aB,aA,ax){var az="";var ay=aA;var aw=aA+ax;while(ay<aw){if((aB[ay]&128)==0){az+=String.fromCharCode(aB[ay++])}else{if((aB[ay]&224)==224&&ay+2<aw&&(aB[ay+1]&192)==128&&(aB[ay+2]&192)==128){az+=String.fromCharCode(((aB[ay]&15)<<12)|((aB[ay+1]&63)<<6)|(aB[ay+2]&63));ay+=3}else{if((aB[ay]&192)==192&&ay+1<aw&&(aB[ay+1]&192)==128){az+=String.fromCharCode(((aB[ay]&31)<<6)|(aB[ay+1]&63));ay+=2}else{throw new Error("wrong encoding")}}}}return az}function s(ax){var aD=new Uint8Array(ax);var ay,aA,aw,aC;var aB,az;ay="";aw=aD.length;aA=0;while(aA<aw){aC=aD[aA++];switch(aC>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:ay+=String.fromCharCode(aC);break;case 12:case 13:aB=aD[aA++];ay+=String.fromCharCode(((aC&31)<<6)|(aB&63));break;case 14:aB=aD[aA++];az=aD[aA++];ay+=String.fromCharCode(((aC&15)<<12)|((aB&63)<<6)|((az&63)<<0));break}}return ay}function ad(ay){if(GLLibConfig.text_useMultipleTextPacks){var aA=ay>>GLLibConfig.text_maxStringsLog2;var az=ay&((1<<GLLibConfig.text_maxStringsLog2)-1);if(GLLibConfig.text_useStringCache&&(o!=null&&o[aA]!=null)){return o[aA][az]}else{try{var aw=av[aA][az+1]-av[aA][az];if(aw==0){return null}if(true){return g(H[aA],av[aA][az],aw)}else{if(GLLibConfig.text_useInternalUTF8Converter){if(!u.equals("UTF-8")){return new String(H[aA],av[aA][az],aw,u)}else{return g(H[aA],av[aA][az],aw)}}else{return new String(H[aA],av[aA][az],aw,u)}}}catch(aB){Dbg("Text_GetString.unable to create string, might try another encoding."+aB.message)}return null}}else{if(GLLibConfig.text_useStringCache&&(m!=null)){return m[ay]}else{if(GLLibConfig.text_useStringCachePool){if(s_text_strPool_stringPoolPos[ay]!=-1){return s_text_strPool_strings[(s_text_strPool_stringPoolPos[ay]&255)]}}try{var aw=U[ay+1]-U[ay];if(aw==0){return null}var ax=null;if(true){ax=g(N,U[ay],aw)}else{if(GLLibConfig.text_useInternalUTF8Converter){if(!u.equals("UTF-8")){ax=new String(N,U[ay],aw,u)}else{ax=g(N,U[ay],aw)}}else{ax=new String(N,U[ay],aw,u)}}if(GLLibConfig.text_useStringCachePool){s_text_strPool_strings[s_text_strPool_pointer]=ax;if(s_text_strPool_stringIds[s_text_strPool_pointer]!=-1){s_text_strPool_stringPoolPos[s_text_strPool_stringIds[s_text_strPool_pointer]]=-1}s_text_strPool_stringPoolPos[ay]=s_text_strPool_pointer.castToByte();s_text_strPool_stringIds[s_text_strPool_pointer]=ay;s_text_strPool_pointer++;if(s_text_strPool_pointer>=GLLibConfig.text_stringCachePoolSize){s_text_strPool_pointer=0}}return ax}catch(aB){GLLib.Assert(false,"Text_GetString.unable to create string, might try another encoding."+aB)}return null}}}function ab(aA,ax,ay){var az=0;var aB="";for(var aw=0;aw<aA.length;aw++){if(aA.charAt(aw)==ay){aB+=ax[az];az++}else{aB+=aA.charAt(aw)}}return aB}function au(ax,az){var ay="";for(var aw=0;aw<ax.length;aw++){var aB=ax.charAt(aw);if(aB=="#"){aB=ax.charAt(++aw);if(aB.castToInt()>="1".castToInt()&&aB<="9".castToInt()){var aA=(aB.castToInt()-"1".castToInt());ay+=az[aA]}else{ay+="#";ay+=aB}}else{ay+=aB}}return ay}function J(aw){var ay;var az=false;if(aw==null){return false}for(var ax=0;ax<aw.length;ax++){ay=aw.charAt(ax);if((ay!=z)&&(s_sprFontMid.GetCharFrame(ay.castToInt())==1)){Warn("GLLib_text.js: text_stringUsesExoticChars() - _zString:"+aw+" - Char["+ax+"] : "+ay+" value:"+(ay.castToInt()));az=true;break}}return az}(function ak(){Object.defineProperty(I,"s_iCurrentLanguage",{get:function(){return t},set:function(aw){throw new Error("Not allow!")}})})();(function i(){LowAPI.extendObject(I,{Text_GetLanguageAsString:S,Text_SetEncoding:X,Text_FormatNumber:T,text_GetFormatNumber:T,text_GetFormatNumber_Long:T,getString:e,setCurrentLanguage:O,isLanguageSupported:R,text_loadTexts:y,getFormattedString:ab,getFormattedStringEx:au,getPackNameFromLanguage:r,text_stringUsesExoticChars:J,Text_LoadTextFromPack_INI:p,Text_GetString:ad,},true)})()})(window);