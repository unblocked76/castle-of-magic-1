(function(ac,E){function G(){this.__GLLibPlayer_ASprite__initialization__();this.__GLLibPlayer_ASprite_FrameMapping__initialization__();if(arguments){switch(arguments.length){case 0:return this.constructor_0.apply(this,arguments);case 3:return this.constructor_3.apply(this,arguments)}}throw new Error("InvalidArguments")}G.k_animBaseFrameTime=LowAPI.Float2Int(1000/GLLibConfig.sprite_animFPS);G.k_AnimNone=-1;G.prototype.constructor_0=function(){this.Reset()};G.prototype.constructor_3=function(a5,a4,a6){if(!((GLLibConfig.sprite_animFPS<=1000))){Assert(false,"GLLibPlayer : Invalid value of GLLibConfig.sprite_animFPS > 1000")}this.Reset();this.posX=a4;this.posY=a6;this.SetSprite(a5)};G.prototype.__GLLibPlayer_ASprite__initialization__=function(){this.posX=0;this.posY=0;this.curFlags=0;this.sprite=null;this.curAnim=0;this.curFrame=0;this.curTime=0;this.curAnimFrameDuration=0;this.nbLoop=0;this.animIsOver=false;this.curBlend=0;this.curScale=0;this.palette=0};G.prototype.Reset=function(){this.posX=0;this.posY=0;this.curAnim=G.k_AnimNone;this.curFrame=0;this.sprite=null;this.curFlags=0;this.curTime=0;this.nbLoop=1;this.palette=-1;this.animIsOver=true};G.prototype.SetPos=function(a4,a5){this.posX=a4;this.posY=a5};G.prototype.GetSprite=function(){return this.sprite};G.prototype.SetSprite=function(a4){this.sprite=a4;if(this.sprite!=null){this.SetAnim(G.k_AnimNone,-1)}else{this.curAnim=G.k_AnimNone}};G.prototype.SetAnim=function(){if(arguments){switch(arguments.length){case 1:return this._SetAnim_I.apply(this,arguments);case 2:return this._SetAnim_II.apply(this,arguments);case 3:var a4=typeof arguments[2];if(a4=="number"){return this._SetAnim_III.apply(this,arguments)}else{return this._SetAnim_IIZ.apply(this,arguments)}}}throw new Error("InvalidArguments")};G.prototype._SetAnim_I=function(a4){Warning("GLLibPlayer.SetAnim(int anim) . this function is deprecated, use GLLibPlayer.SetAnim(int anim, int nbLoop) instead");this.SetAnim(a4,-1)};G.prototype._SetAnim_IIZ=function(a6,a5,a4){if(a4){this.SetAnim(G.k_AnimNone,1)}this.SetAnim(a6,a5)};G.prototype._SetAnim_II=function(a5,a4){this.SetAnim(a5,a4,-1)};G.prototype._SetAnim_III=function(a6,a5,a4){if(!(this.sprite!=null)){Assert(false,"GLLibPlayer.SetAnim().sprite is not set")}if(!((a6<this.GetNbanim()))){Assert(false,"GLLibPlayer.SetAnim().anim out of range")}if(!((a5!=0))){Assert(false,"GLLibPlayer.SetAnim().nbLoop is invalid")}if(this.animIsOver||(a6!=this.curAnim)){this.curAnim=a6;this.curAnimFrameDuration=a4==-1?G.k_animBaseFrameTime:LowAPI.Float2Int(a4/this.GetNbFrame(false));this.SetFrame(0);this.nbLoop=a5-1;this.animIsOver=false}};G.prototype.GetAnim=function(){return this.curAnim};G.prototype.SetFrame=function(a5){if(!(this.sprite!=null)){Assert(false,"GLLibPlayer.SetFrame().sprite is not set")}if(!(a5>=0)){Assert(false,"GLLibPlayer.SetFrame().frame is negative")}if(this.curAnim<0){return -1}var a4=this.GetNbFrame();a5%=a4;this.curFrame=a5;this.curTime=0;return a5};G.prototype.RandomizeAnim=function(){this.curFrame=Math_Rand(0,this.GetNbFrame());this.curTime=0};G.prototype.GetFrame=function(){return this.curFrame};G.prototype.GetAnimFrame=function(){if(this.sprite==null||this.curAnim==G.k_AnimNone){return -1}return this.sprite.GetAnimFrame(this.curAnim,this.curFrame)};G.prototype.SetPalette=function(a4){this.palette=a4};G.prototype.GetNbanim=function(){if(!(this.sprite!=null)){Assert(false,"GLLibPlayer.GetNbanim().sprite is not set")}return this.sprite.GetAnimationCount()};G.prototype.GetNbFrame=function(a6){var a6=a6;if(arguments.length<1){a6=true}if(!(this.sprite!=null)){Assert(false,"GLLibPlayer.GetNbFrame().sprite is not set")}if(this.curAnim>=0){if(a6){return this.sprite.GetAFrames(this.curAnim)}else{var a5=0;for(var a4=0;a4<this.sprite.GetAFrames(this.curAnim);a4++){a5+=this.sprite.GetAFrameTime(this.curAnim,a4)}return a5}}else{return -1}};G.prototype.GetDuration=function(){if(!(this.sprite!=null)){Assert(false,"GLLibPlayer.GetDuration().sprite is not set")}if(this.curAnim>=0){return this.sprite.GetAFrameTime(this.curAnim,this.curFrame)*this.curAnimFrameDuration}else{return 0}};G.prototype.IsAnimOver=function(){if(!(this.sprite!=null)){Assert(false,"GLLibPlayer.isAnimOver().sprite is not set")}if(this.curAnim<0){return true}if(this.nbLoop<0){return false}return this.animIsOver};G.prototype.Render=function(){if(!(this.sprite!=null)){Assert(false,"GLLibPlayer.render().sprite is not set")}if(this.curAnim<0){return}if(!GLLibConfig.sprite_animStillDrawWhenOver){if(this.animIsOver){return}}var a5=false;if(GLLibConfig.sprite_useFrameMapping){ApplyFrameMapping()}if(this.palette!=-1){var a4=this.sprite.GetCurrentPalette();this.sprite.SetCurrentPalette(this.palette);this.sprite.PaintAFrame(g,this.curAnim,this.curFrame,this.posX,this.posY,this.curFlags);this.sprite.SetCurrentPalette(a4)}else{this.sprite.PaintAFrame(g,this.curAnim,this.curFrame,this.posX,this.posY,this.curFlags)}};G.prototype.Update=function(a4){var a4=a4;if(arguments.length<1){if(GLLibConfig.sprite_animFPS==1000){a4=1}else{a4=s_game_frameDT}}if(!(a4>=0)){Assert(false,"GLLibPlayer.Update.DT is negative")}if(true){if(GLLibConfig.sprite_animFPS==1000){if(a4>1){Warning("GLLibPlayer.Update was called with DT larger than 1, the player is currently working as Frame Based Player")}}else{if(a4==1){Warning("GLLibPlayer.Update was called with DT equal 1, the player is currently working as a Time Based Player, it should be more than 1 ms ?")}}}if(this.animIsOver||(this.curAnim<0)){return}var a5=this.GetDuration();if(GLLibConfig.sprite_animDurationZeroAsInfinite){if(a5==0){return}}else{if(!(a5!=0)){Assert(false,"GLLibPlayer.Update.frame "+this.curFrame+" of animation "+this.curAnim+" has a duration of 0")}}if(GLLibConfig.sprite_noFrameSkip){if(this.curTime>=a5){this.curTime-=a5;if(this.curFrame<this.sprite.GetAFrames(this.curAnim)-1){this.curFrame++}else{if(this.nbLoop==0){this.animIsOver=true}else{if(this.nbLoop>0){this.nbLoop--}this.curFrame=0}}}}else{while(this.curTime>=a5){this.curTime-=a5;if(this.curFrame<this.sprite.GetAFrames(this.curAnim)-1){this.curFrame++}else{if(this.nbLoop==0){this.animIsOver=true;break}else{if(this.nbLoop>0){this.nbLoop--}this.curFrame=0}}a5=this.GetDuration();if(GLLibConfig.sprite_animDurationZeroAsInfinite){if(a5==0){break}}}}this.curTime+=a4};G.prototype.__GLLibPlayer_ASprite_FrameMapping__initialization__=function(){if(GLLibConfig.sprite_useFrameMapping){this.m_frameMapping_config_sprite=null;this.m_frameMapping_config_palId=null;this.m_frameMapping_config_frameOff=null}};G.WRAP_CLAMP=0;G.WRAP_REPEAT=1;G.WRAP_NONE=2;G.TILESET_EFFECT_NONE=0;G.TILESET_EFFECT_NORMAL=1;G.TILESET_EFFECT_ADDITIVE=2;G.TILESET_EFFECT_MULTIPLICATIVE=3;G.TILESET_EFFECT_OVERLAY=4;G.TILESET_EFFECT_COLORDODGE=5;G.TILESET_BACKBUFFER_PAINT_FRAME=0;G.TILESET_BACKBUFFER_PAINT_DRAW_RECT=1;G.TILESET_BACKBUFFER_PAINT_FILL_RECT=2;G.TILESET_BACKBUFFER_PAINT_ALPHA_RECT=3;G.TILESET_BACKBUFFER_PAINT_DRAW_IMAGE=4;G.TILESET_BACKBUFFER_PAINT_DRAW_RGB=5;var l=false;var aX=GLLibConfig.tileset_maxLayerCount;var am=-1;var J=-1;var z=0;var I=0;var ad=I+1;var aq=ad+1;var aC=aq+1;var aQ=aC+1;var q=aQ+1;var ak=q+1;var aT=ak+1;var a1=aT+1;var F=0;var a3=F+1;var aU=a3+1;var aK=aU+1;var o=aK+1;var aJ=o+1;var az=aJ+1;var Q=az+1;var Z=Q+1;var j=Z+1;var i=j+1;var h=i+1;var f=h+1;var ay=f+1;var ax=ay+1;var M=ax+1;var aw=M+1;var av=aw+1;var aR=av+1;var a0=aR+1;var e=a0+1;var aG=e+1;var aF=aG+1;var ah=aF+1;var r=ah+1;var Y=r+1;var ag=Y+1;var aE=ag+1;var aB=aE+1;var an=GLLibConfig.tileset_useRuntimeRleCompressedMapData?aB+1:a0+1;var aW=0;var R=aW+1;var p=R+1;var aj=p+1;var c=aj+1;var aa=c+1;var aZ=aU;var X=aK;var a2=o;var aP=aJ;var aO=az;var O=j;var aL=i;var aN=0;var ap=aN+2;var al=ap+2;var n=0;var ae=n+1;var aV=0;var K=aV+1;var b=0;var au=b+1;var x=au+1;var u=0;var t=u+1;var w=t+1;var H=w+1;var m=H+1;var aS=GLLibConfig.tileset_maxUpdatedAreas;var W;var aA;var aM;var aI;var P;var aD;var ab;var aY;var at;var ar;var d;var D;var ai;var y;var v;var ao;var V;var S=100;var C;var s;var N=1;var L=2;var a=4;var k=8;var U=16;var T=32;var B=64;var af=128;var A=256;var aH=512;G.Tileset_SetCamera=function(a5,a4,a6){if(GLLibConfig.sprite_debugLoading){if(!l){Dbg("Tileset_SetCamera: Tileset player is not initialized");return}if((a5<0)||(a5>=aX)){Dbg(("Tileset_SetCamera: nLayer invalid : "+a5));return}if((aA[a5][F]!=1)||(aA[a5][a3]!=1)){Dbg("Tileset_SetCamera: nLayer in not initialized or not enabled.");return}}aA[a5][ay]=a4;aA[a5][ax]=G.Tileset_GetTranslatedOriginY(a5,a6);if(G.isFlag(a5,U)){if(aA[a5][ay]<0){aA[a5][ay]=0}else{if((aA[a5][ay]+W[I])>=aA[a5][aJ]){aA[a5][ay]=aA[a5][aJ]-W[I]-1}}}if(G.isFlag(a5,T)){if(aA[a5][ax]<0){aA[a5][ax]=0}else{if((aA[a5][ax]+W[ad])>=aA[a5][az]){aA[a5][ax]=aA[a5][az]-W[ad]-1}}}G.Tileset_UpdateRleBuffer(a5,false)};G.Tileset_UpdateRleBuffer=function(a4,be){if(GLLibConfig.tileset_useRuntimeRleCompressedMapData&&aA[a4][e]!=0){var ba=(aA[a4][ay]/W[aq]).castToInt();var a9=(aA[a4][ax]/W[q]).castToInt();var a7=ba-aA[a4][ah];var bc=aA[a4][aF];var bd=aA[a4][ag];var a5=aA[a4][Y];if(a7<0){a7=0}if(a7+a5>aA[a4][aU]){a7=aA[a4][aU]-a5}if(be||aA[a4][aG]==-1){bc=a9-aA[a4][r];if(bc<0){bc=0}if(bc+bd>aA[a4][aK]){bc=aA[a4][aK]-bd}aA[a4][aG]=a7;aA[a4][aF]=bc;aA[a4][aE]=0;aA[a4][aB]=0;RebuildRleCompressedCatchBuffer(a4,a7,bc)}else{if(a7<aA[a4][aG]){var a6=aA[a4][aG]-a7;while(a6>0){aA[a4][aE]--;if(aA[a4][aE]<0){aA[a4][aE]=a5-1}G.Tileset_DecodeRleCompressedDataLeftColumn(a4,bc,b);G.Tileset_DecodeRleCompressedDataLeftColumn(a4,bc,au);a6--}}else{if(a7>aA[a4][aG]){var a6=a7-aA[a4][aG];while(a6>0){Tileset_DecodeRleCompressedDataRightColumn(a4,bc,b);Tileset_DecodeRleCompressedDataRightColumn(a4,bc,au);aA[a4][aE]++;if(aA[a4][aE]>=a5){aA[a4][aE]=0}a6--}}}bc=a9-aA[a4][r];if(bc<0){bc=0}if(bc+bd>aA[a4][aK]){bc=aA[a4][aK]-bd}if(bc>aA[a4][aF]){var bb=bc-aA[a4][aF];var a8=aA[a4][aF]+bd;while(bb>0){G.Tileset_DecodeRleCompressedDataOneLine(a4,a8,aA[a4][aB],a7,b);G.Tileset_DecodeRleCompressedDataOneLine(a4,a8,aA[a4][aB],a7,au);aA[a4][aB]++;if(aA[a4][aB]>=bd){aA[a4][aB]=0}bb--;a8++}}else{if(bc<aA[a4][aF]){var bb=aA[a4][aF]-bc;var a8=aA[a4][aF]-1;while(bb>0){aA[a4][aB]--;if(aA[a4][aB]<0){aA[a4][aB]=bd-1}G.Tileset_DecodeRleCompressedDataOneLine(a4,a8,aA[a4][aB],a7,b);G.Tileset_DecodeRleCompressedDataOneLine(a4,a8,aA[a4][aB],a7,au);bb--;a8--}}}aA[a4][aG]=a7;aA[a4][aF]=bc}}};G.Tileset_Init=function(){if(arguments){switch(arguments.length){case 2:return G.Tileset_Init_2.apply(this,arguments);case 4:return G.Tileset_Init_4.apply(this,arguments)}}else{throw new Error("InvalidArguments")}};G.Tileset_Init_2=function(a5,a4){if(arguments.length!=2){throw new Error("InvalidArguments")}if(!GLLibConfig.tileset_useEmptyTilemapLayer){Dbg("Tileset_Init (int nDestWidth, int nDestHeight): you need to enable tileset_useEmptyTilemapLayer to use this functionality")}if(GLLibConfig.tileset_useEmptyTilemapLayer){G.Tileset_Init_4(a5,a4,0,0)}};G.Tileset_Init_4=function(a9,a8,a6,a5){W=LowAPI.Gen_Array([a1],0);aA=LowAPI.Gen_Array([aX,an],0);aI=LowAPI.Gen_Array([aX,ae],null);P=LowAPI.Gen_Array([aX,K],null);if((!GLLibConfig.tileset_useEmptyTilemapLayer)||((a6>0)&&(a5>0))){aM=LowAPI.Gen_Array([aX,x],0);if(GLLibConfig.tileset_useRuntimeRleCompressedMapData){aY=LowAPI.Gen_Array([aX,x],null);aD=LowAPI.Gen_Array([aX],null);ab=LowAPI.Gen_Array([aX],null)}V=LowAPI.Gen_Array([aX],null);if(GLLibConfig.tileset_useMultiSprites){C=LowAPI.Gen_Array([aX],null)}if(GLLibConfig.tileset_useTileShift){var a4,a7;if(GLLibConfig.sprite_debugLoading){a4=a6;a7=a5}a6=Math_Log2(a6);a5=Math_Log2(a5);if(!(1<<a6)==a4){Dbg("Tileset_Init:: using GLLibConfig.tileset_UseTileShift with non power of 2 tile width"+a6)}if(!(1<<a5)==a7){Dbg("Tileset_Init:: using GLLibConfig.tileset_UseTileShift with non power of 2 tile height"+a5)}W[aC]=a6;W[aq]=1<<a6;W[aQ]=W[aq]-1;W[ak]=a5;W[q]=1<<a5;W[aT]=W[q]-1}else{W[aq]=a6;W[aQ]=0;W[q]=a5;W[aT]=0}}if(GLLibConfig.tileset_useLayerLastUpdatedArea){v=LowAPI.Gen_Array([aX,aS,m],0)}if(GLLibConfig.tileset_useLayerPadding){y=LowAPI.Gen_Array([aX],null)}W[I]=a9;W[ad]=a8;l=true};G.Tileset_LoadLayer=function(){if(arguments){switch(arguments.length){case 9:if(typeof arguments[5]=="number"){return G.Tileset_LoadLayer_9.apply(this,arguments)}return G.Tileset_LoadLayer_9b.apply(this,arguments);case 10:return G.Tileset_LoadLayer_10.apply(this,arguments);case 11:return G.Tileset_LoadLayer_11.apply(this,arguments);case 12:return G.Tileset_LoadLayer_12.apply(this,arguments)}}else{throw new Error("InvalidArguments")}};G.Tileset_LoadLayer_9b=function(a5,a4,a7,a8,a9,a6,ba,bc,bb){if(a6){G.Tileset_LoadLayer_10(a5,a4,a7,a8,a9,a5,ba,bc,bb,false)}else{G.Tileset_LoadLayer_10(a5,a4,a7,a8,a9,-1,ba,bc,bb,false)}};G.Tileset_LoadLayer_11=function(a5,a4,a9,ba,bb,a8,bc,be,bd,a6,a7){aA[a5][aR]=a6;aA[a5][a0]=a7;G.Tileset_LoadLayer_12(a5,a4,a9,ba,bb,a5,bc,be,bd,false,a6,a7)};G.Tileset_LoadLayer_9=function(a5,a4,a7,a8,a9,a6,ba,bc,bb){G.Tileset_LoadLayer_10(a5,a4,a7,a8,a9,a6,ba,bc,bb,false)};G.Tileset_LoadLayer_10=function(a5,a4,a7,a8,a9,a6,ba,bd,bc,bb){G.Tileset_LoadLayer_12(a5,a4,a7,a8,a9,a6,ba,bd,bc,bb,0,0)};G.Tileset_LoadLayer_12=function(be,a6,a5,bc,bg,bd,bm,bk,bj,bb,bi,a9){if(!(a6!=null)){Dbg("GLLibPlayer::Tileset_LoadLayer::MapSizes is null")}if(!(a5!=null||GLLibConfig.tileset_useMultiBlockTileset)){Dbg("GLLibPlayer::Tileset_LoadLayer::MapData is null")}if(!(bg!=null||GLLibConfig.tileset_useMultiSprites)){Dbg("GLLibPlayer::Tileset_LoadLayer::MapSprite is null")}if(!((bk==G.WRAP_CLAMP)||(bk==G.WRAP_REPEAT)||(bk==G.WRAP_NONE))){Dbg("GLLibPlayer::Tileset_LoadLayer:: X wrapping is not valid")}if(!((bj==G.WRAP_CLAMP)||(bj==G.WRAP_REPEAT)||(bj==G.WRAP_NONE))){Dbg("GLLibPlayer::Tileset_LoadLayer:: Y wrapping is not valid")}if(!((bm==TOP)||(bm==BOTTOM))){Dbg("GLLibPlayer::Tileset_LoadLayer:: origin is not valid")}if(GLLibConfig.sprite_debugLoading){if(bc==null&&!GLLibConfig.tileset_useMultiBlockTileset){Dbg("WARNING GLLibPlayer::Tileset_LoadLayer::MapFlip is null, no flip will occur")}}if(!l){return}G.Tileset_Destroy(be,false);aA[be][aR]=bi;aA[be][a0]=a9;if(bi==0){aA[be][aR]=W[I]}if(a9==0){aA[be][a0]=W[ad]}if(!GLLibConfig.tileset_useMultiBlockTileset){if(GLLibConfig.tileset_use4BitsPerFlipRotData&&(bc!=null)){var a4=(bc.length>>1);var a7=(bc.length&1);var bl=LowAPI.Gen_Array([a4+((a7==0)?0:1)],0);var bh=a4;var a8=bc.length-a7-1;while(bh--!=0){bl[bh]=(((bc[a8--]&15)<<4)|((bc[a8--]&15))).castToByte()}if(a7!=0){bh=bc.length-1;bl[a4]=(bc[bh]&15).castToByte()}bc=bl}else{if(GLLibConfig.tileset_use2BitsPerFlipData&&(bc!=null)){var a4=(bc.length>>2);var a7=(bc.length-(a4<<2));var bl=LowAPI.Gen_Array([a4+((a7==0)?0:1)],0);var bh=a4;var a8=bc.length-a7-1;while(bh--!=0){bl[bh]=(((bc[a8--]&3)<<6)|((bc[a8--]&3)<<4)|((bc[a8--]&3)<<2)|((bc[a8--]&3))).castToByte()}bh=bc.length-1;while(a7!=0){bl[a4]=(bl[a4]|((bc[bh]&3)<<((a7-1)<<1))).castToByte();a7--;bh--}bc=bl}}aM[be][b]=a5;aM[be][au]=bc}aA[be][aU]=Mem_GetShort(a6,aN);aA[be][aK]=Mem_GetShort(a6,ap);if(GLLibConfig.tileset_useRuntimeRleCompressedMapData){if(at==null){at=LowAPI.Gen_Array([aX,x],null)}if(ar==null){ar=LowAPI.Gen_Array([aX],null);d=LowAPI.Gen_Array([aX],null);D=LowAPI.Gen_Array([aX],null);ai=LowAPI.Gen_Array([aX],null)}}if((GLLibConfig.tileset_useMultiSprites&&a6.length>al)||GLLibConfig.tileset_useMultiBlockTileset){aA[be][o]=Mem_GetShort(a6,al)}aA[be][aJ]=aA[be][aU]*W[aq];aA[be][az]=aA[be][aK]*W[q];V[be]=bg;if(bd>-1){G.Tileset_Buffer_CalculateSize(be);if(bd==be){var bf;var ba;if(GLLibConfig.landscape_useRotatedModules){bf=Z;ba=Q}else{bf=Q;ba=Z}if(aI[be][n]==null||aI[be][n].getWidth()!=aA[be][bf]||aI[be][n].getHeight()!=aA[be][ba]){G.Tileset_Buffer_Create(be)}if(GLLibConfig.tileset_useLayerLastUpdatedArea){G.setFlag(be,B,true)}}else{if(!(aI[bd][n]!=null)){Dbg("GLLibPlayer::Tileset_LoadLayer:: layer "+bd+" has no circular buffer allocated")}aI[be][n]=aI[bd][n];P[be][aV]=P[bd][aV]}G.setFlag(be,a,true);if(GLLibConfig.tileset_useLayerLastUpdatedArea){if(bb||G.isFlag(be,B)){G.setFlag(be,af,true)}}}aA[be][j]=-1;aA[be][i]=-1;aA[be][h]=-1;aA[be][f]=-1;aA[be][F]=1;aA[be][a3]=1;aA[be][ay]=0;aA[be][ax]=0;aA[be][aw]=0;aA[be][av]=0;G.setFlag(be,N,bk==G.WRAP_REPEAT);G.setFlag(be,U,bk==G.WRAP_CLAMP);G.setFlag(be,L,bj==G.WRAP_REPEAT);G.setFlag(be,T,bj==G.WRAP_CLAMP);G.setFlag(be,k,bm==BOTTOM);if(GLLibConfig.tileset_useRuntimeRleCompressedMapData){aA[be][aG]=-1;aA[be][aF]=-1}};G.Tileset_Destroy=function(){if(arguments){switch(arguments.length){case 1:return G.Tileset_Destroy_1.apply(this,arguments);case 2:return G.Tileset_Destroy_2.apply(this,arguments)}}else{throw new Error("InvalidArguments")}};G.Tileset_Destroy_1=function(a4){G.Tileset_Destroy_2(a4,true)};G.Tileset_Destroy_2=function(a4,a5){if(!l){return}aA[a4]=LowAPI.Gen_Array([an],0);if(a5){aI[a4]=LowAPI.Gen_Array([ae],null);P[a4]=LowAPI.Gen_Array([K],null)}if((!GLLibConfig.tileset_useEmptyTilemapLayer)||(aM!=null)){aM[a4]=LowAPI.Gen_Array([x],null);V[a4]=null}if(GLLibConfig.tileset_useMultiSprites&&C[a4]!=null){C[a4]=null}if(GLLibConfig.tileset_useTilesetMask){Tileset_ReleaseSpriteMasks(a4)}if(GLLibConfig.tileset_useLayerPadding){y[a4]=null}};G.Tileset_Draw=function(){if(arguments.length==2){return G.Tileset_Draw_2.apply(this,arguments)}else{if(arguments.length==4){return G.Tileset_Draw_4.apply(this,arguments)}}throw new Error("InvalidArguments")};G.Tileset_Draw_2=function(a5,a4){G.Tileset_Draw_4(a5,0,0,a4)};G.Tileset_Draw_4=function(bB,a5,a4,bq){if(!l){return}var bb=W[I];var br=W[ad];if(bq==-1){for(var bA=0;bA<aX;bA++){if(GLLibConfig.tileset_usePixelEffects){if(bA!=J){G.Tileset_Draw(bB,a5,a4,bA)}}else{G.Tileset_Draw(bB,a5,a4,bA)}}return}bb=(aA[bq][aR]*100/G.Tileset_GetZoom()).castToInt();br=(aA[bq][a0]*100/G.Tileset_GetZoom()).castToInt();if(bb==0){aA[bq][aR]=W[I];bb=aA[bq][aR]}if(br==0){aA[bq][a0]=W[ad];bb=aA[bq][aR]}var bp=aA[bq];if((bp[F]!=1)||(bp[a3]!=1)){return}var bt=bp[ay]+bp[aw];var bs=bp[ax]+bp[av];if(G.isFlag(bq,a)){var be=0;var bc=0;var bg=0;var bm=0;if(IsClipValid(bB)){be=GetClipX(bB);bc=GetClipY(bB);bg=GetClipWidth(bB);bm=GetClipHeight(bB)}if(GLLibConfig.tileset_useLayerLastUpdatedArea){if(G.isFlag(bq,af)){ao=0}}if(GLLibConfig.tileset_useEmptyTilemapLayer&&G.isFlag(bq,A)){G.Tileset_UpdateEmptyTilemapLayer(bq)}else{var bv;var bu;var bi;var bh;if(GLLibConfig.tileset_useTileShift){bv=bt>>W[aC];bu=bs>>W[ak];bi=(bt+W[I])>>W[aC];bh=(bs+W[ad])>>W[ak]}else{var ba=bt;var a9=bs;if(ba<0){ba-=G.Tileset_GetTileW()}if(a9<0){a9-=G.Tileset_GetTileH()}bv=(ba/G.Tileset_GetTileW()).castToInt();bu=(a9/G.Tileset_GetTileH()).castToInt();bi=bv+(bp[Q]/G.Tileset_GetTileW()).castToInt()-1;bh=bu+(bp[Z]/G.Tileset_GetTileH()).castToInt()-1}var bf=0;var a7=0;var bd=0;var a6=0;if((bp[i]!=bu)||(bp[f]!=bh)){if((bp[i]<bu)||(bp[f]<bh)){if(bp[f]<bu){bd=bu;a6=bh}else{bd=bp[f]+1;a6=bh}}else{if(bp[i]>bh){bd=bu;a6=bh}else{bd=bu;a6=bp[i]-1}}}if((bp[j]!=bv)||(bp[h]!=bi)){if((bp[j]<bv)||(bp[h]<bi)){if(bp[h]<bv){bf=bv;a7=bi}else{bf=bp[h]+1;a7=bi}}else{if(bp[j]>bi){bf=bv;a7=bi}else{bf=bv;a7=bp[j]-1}}var by=bh-bu;var bz=bu;if((bp[i]!=bu)||(bp[f]!=bh)){if((bp[i]<bu)||(bp[f]<bh)){by-=(a6-bd+1)}else{by-=(a6-bd+1);bz+=(a6-bd+1)}}if(by>=0){G.Tileset_UpdateBuffer(P[bq][aV],bq,bf,bz,a7-bf,by,0,0)}bp[j]=bv;bp[h]=bi}if((bp[i]!=bu)||(bp[f]!=bh)){G.Tileset_UpdateBuffer(P[bq][aV],bq,bv,bd,bi-bv,a6-bd,0,0);bp[i]=bu;bp[f]=bh}}if(bB!=null){if(!G.isFlag(bq,U|N|A)){if(bt<0){a5-=bt;bt=0}else{if(bt>(bp[aJ]-bb)){a5-=(bt-(bp[aJ]-bb));bt=(bp[aJ]-bb)}}}else{while(bt<0){bt+=bp[Q]}}if(!G.isFlag(bq,T|L|A)){if(bs<0){a4-=bs;bs=0}else{if(bs>(bp[az]-br)){a4-=(bs-(bp[az]-br));bs=(bp[az]-br)}}}else{while(bs<0){bs+=bp[Z]}}var bD=bt%bp[Q];var bo=bs%bp[Z];var bC=(bt+bb)%bp[Q];var bn=(bs+br)%bp[Z];SetClip(bB,be,bc,bg,bm);if(bC>bD){if(bn>bo){G.Tileset_Draw2Screen(bB,bq,bD,bo,bb,br,0+a5,0+a4,be,bc,bg,bm)}else{G.Tileset_Draw2Screen(bB,bq,bD,bo,bb,br-bn,0+a5,0+a4,be,bc,bg,bm);SetClip(bB,be,bc,bg,bm);G.Tileset_Draw2Screen(bB,bq,bD,0,bb,bn,0+a5,br-bn+a4,be,bc,bg,bm)}}else{if(bn>bo){G.Tileset_Draw2Screen(bB,bq,bD,bo,bb-bC,br,0+a5,0+a4,be,bc,bg,bm);SetClip(bB,be,bc,bg,bm);G.Tileset_Draw2Screen(bB,bq,0,bo,bC,br,bb-bC+a5,0+a4,be,bc,bg,bm)}else{G.Tileset_Draw2Screen(bB,bq,bD,bo,bb-bC,br-bn,0+a5,0+a4,be,bc,bg,bm);SetClip(bB,be,bc,bg,bm);G.Tileset_Draw2Screen(bB,bq,bD,0,bb-bC,bn,0+a5,br-bn+a4,be,bc,bg,bm);SetClip(bB,be,bc,bg,bm);G.Tileset_Draw2Screen(bB,bq,0,bo,bC,br-bn,bb-bC+a5,0+a4,be,bc,bg,bm);SetClip(bB,be,bc,bg,bm);G.Tileset_Draw2Screen(bB,bq,0,0,bC,bn,bb-bC+a5,br-bn+a4,be,bc,bg,bm)}}SetClip(bB,be,bc,bg,bm)}}else{if(bB!=null){var bj;var a8;var bl;var bk;var bx;var bw;if(GLLibConfig.tileset_useTileShift){bj=bt>>W[aC];a8=bs>>W[ak];bl=bb>>W[aC];if((bl<<W[aC])<bb){bl++}bk=br>>W[ak];if((bk<<W[ak])<br){bk++}bx=(bj<<W[aC])-bt;bw=(a8<<W[ak])-bs}else{var ba=bt;var a9=bs;if(ba<0){ba-=G.Tileset_GetTileW()}if(a9<0){a9-=W[q]}bj=(ba/G.Tileset_GetTileW()).castToInt();a8=(a9/G.Tileset_GetTileH()).castToInt();bl=(bb/G.Tileset_GetTileW()).castToInt();if((bl*G.Tileset_GetTileW())<bb){bl++}bk=(br/G.Tileset_GetTileH()).castToInt();if((bk*G.Tileset_GetTileH())<br){bk++}bx=(bj*G.Tileset_GetTileW())-bt;bw=(a8*G.Tileset_GetTileH())-bs}G.Tileset_UpdateBuffer(bB,bq,bj,a8,bl,bk,bx+a5,bw+a4)}}};G.Tileset_UpdateEmptyTilemapLayer=function(bf){var bi=aA[bf];var be=bi[ay];var bd=bi[ax];var ba=W[I];var bc=W[ad];var bl=bi[aP];var a7=bi[aO];var bj=bl+bi[Q];var a6=a7+bi[Z];var a9=bi[aZ];var bm=bi[X];var bb=(bi[O]>0);var a5=be;if(be<0){a5-=(a9-1)}var a4=bd;if(bd<0){a4-=(bm-1)}if((!bb)&&Math_RectIntersect(bl,a7,bj-1,a6-1,be,bd,be+ba-1,bd+bc-1)){var bg=0;var bh=0;var bn=0,bk=0,bo=0,a8=0;if(be<bl){bn=(a5/a9).castToInt()*a9;bk=(a4/bm).castToInt()*bm;bo=bl-bn;a8=bi[Z];bg=bo;bh=bo;bi[aP]=bn;G.Tileset_UpdateEmpyTilemapBuffer(bf,bn,bk,bo,a8)}else{if((be+ba)>=bj){bn=bj;bk=(a4/bm).castToInt()*bm;bo=(((be+ba-bj)/a9).castToInt()+1)*a9;a8=bi[Z];bh=bo;bi[aP]=(a5/a9).castToInt()*a9;G.Tileset_UpdateEmpyTilemapBuffer(bf,bn,bk,bo,a8)}}if(bd<a7){bn=((a5/a9).castToInt()*a9)+bg;bk=(a4/bm).castToInt()*bm;bo=bi[Q]-bh;a8=a7-bk;bi[aO]=bk;G.Tileset_UpdateEmpyTilemapBuffer(bf,bn,bk,bo,a8)}else{if((bd+bc)>=a6){bn=((a5/a9).castToInt()*a9)+bg;bk=a6;bo=bi[Q]-bh;a8=(((bd+bc-a6)/bm).castToInt()+1)*bm;bi[aO]=(a4/bm).castToInt()*bm;G.Tileset_UpdateEmpyTilemapBuffer(bf,bn,bk,bo,a8)}}bi[aL]=0}else{var bn=(a5/a9)*a9;var bk=(a4/bm)*bm;G.Tileset_UpdateEmpyTilemapBuffer(bf,bn,bk,bi[Q],bi[Z]);bi[aP]=bn;bi[aO]=bk;if(bb){bi[O]=0}bi[aL]=1}};G.Tileset_UpdateEmpyTilemapBuffer=function(a5,bc,bb,bd,ba){var a9=P[a5][aV];a9.setColor(aA[a5][a2]);var a8=aA[a5][Q];var be=aA[a5][Z];if(GLLibConfig.landscape_useRotatedModules){ASprite.SetGraphicsSize(a8,be)}var a7=bc%a8;if(a7<0){a7+=a8}var a4=bb%be;if(a4<0){a4+=be}if((a7+bd)>a8){var a6=ba;if((a4+ba)>be){FillRect(a9,0,0,a7+bd-a8,a4+ba-be);G.Tileset_AddUpdatedArea(a5,0,0,a7+bd-a8,a4+ba-be);a6=be-a4}FillRect(a9,0,a4,a7+bd-a8,a6);G.Tileset_AddUpdatedArea(a5,0,a4,a7+bd-a8,a6);bd=a8-a7}if((a4+ba)>be){FillRect(a9,a7,0,bd,a4+ba-be);G.Tileset_AddUpdatedArea(a5,a7,0,bd,a4+ba-be);ba=be-a4}FillRect(a9,a7,a4,bd,ba);G.Tileset_AddUpdatedArea(a5,a7,a4,bd,ba);if(GLLibConfig.landscape_useRotatedModules){ASprite.SetGraphicsSize(GetScreenWidth(),GetScreenHeight())}};G.Tileset_Draw2Screen=function(bb,a5,bc,ba,a6,bf,be,bd,a8,a7,a9,a4){if((be>(a8+a9))||(bd>(a7+a4))||((be+a6)<a8)||((bd+bf)<a7)){return}if(GLLibConfig.tileset_useDrawRegionForBackBufferBlit){if(GLLibConfig.landscape_useRotatedModules){DrawRegion(bb,aI[a5][n],aA[a5][Z]-ba-bf,bc,bf,a6,0,GetGraphicsHeight()-bd-bf,be,Graphics.TOP|Graphics.LEFT,false)}else{DrawRegion(aI[a5][n],bc,ba,a6,bf,0,be,bd,Graphics.TOP|Graphics.LEFT)}}else{if(P[a5][aV].cacheToGL){aI[a5][n].m_image.getHTMLCanvasElement().reCacheTexture=true;P[a5][aV].cacheToGL=false}ClipRect(bb,be,bd,a6,bf);if(GLLibConfig.landscape_useRotatedModules){DrawImage(bb,aI[a5][n],ba-bd+GetGraphicsHeight()-aA[a5][Z],be-bc,LEFT|TOP,false)}else{DrawImage(bb,aI[a5][n],be-bc,bd-ba,LEFT|TOP)}}};G.Tileset_GetTranslatedOriginY=function(a4,a5){if(G.isFlag(a4,k)){return aA[a4][az]-W[ad]-a5}else{return a5}};G.Tileset_SetZoom=function(a4){S=a4};G.Tileset_GetZoom=function(){return S};G.isFlag=function(a5,a4){return(aA[a5][M]&a4)!=0};G.setFlag=function(a5,a4,a6){if(a6){aA[a5][M]|=a4}else{aA[a5][M]&=~a4}};G.Tileset_DecodeRleCompressedDataLeftColumn=function(a5,a6,bd){var a4=aY[a5][bd];var bf=at[a5][bd];var a9=aA[a5][ag];var bc=aA[a5][aB];var bg=bc;var bb=aA[a5][aE];var be;var a7;var a8;if(bd==b){a7=ar;a8=d}else{if(ab[a5]==null){return}a7=D;a8=ai}for(var ba=a6;ba<a6+a9;ba++){if(bd==b){be=aD[a5][bg]}else{be=ab[a5][bg]}G.Tileset_CaluateLeftTileInSourcePosRle(a5,bg,ba,a4,a7,bf);G.Tileset_CaluateLeftTileInSourcePosRle(a5,bg,ba,a4,a8,bf);if(a7[a5][(bg<<1)+1]==0){be[bb]=a4[a7[a5][(bg<<1)]]}else{be[bb]=a4[a7[a5][(bg<<1)]+1]}bg++;if(bg==a9){bg=0}}};G.Tileset_UpdateBuffer=function(bf,bt,bo,bd,br,bq,bD,bB){var bN=G.isFlag(bt,a);var bl=0;var bk=0;var bm=0;var bs=0;var bc=G.isFlag(bt,N);var bb=G.isFlag(bt,L);var bw=aA[bt][aU];var be=aA[bt][aK];var bH=W[aq];var a8=W[q];var bA;var bz;var bK=bw*be;var bP=bw;var bx=be;var bn=0;var bI=0;var bi=0;var bF=0;var bj=0;var bp=0;if(GLLibConfig.tileset_useLayerPadding&&(y[bt]!=null)){bn=y[bt][aW];bI=y[bt][R];bi=y[bt][p];bF=y[bt][aj];bp=y[bt][c];bw+=(bn+bI);be+=(bi+bF);bj=(bn+bI)+(bi+bF)}if(GLLibConfig.landscape_useRotatedModules&&bN){ASprite.SetGraphicsSize(aA[bt][Q],aA[bt][Z])}if(GLLibConfig.tileset_useClip){bl=GetClipX(bf);bk=GetClipY(bf);bm=GetClipWidth(bf);bs=GetClipHeight(bf)}if(bN){if(GLLibConfig.tileset_useTileShift){bA=((bo<<W[aC])%aA[bt][Q])+bD;bz=((bd<<W[ak])%aA[bt][Z])+bB}else{bA=((bo*W[aq])%aA[bt][Q])+bD;bz=((bd*W[q])%aA[bt][Z])+bB}if(bA<0){bA+=aA[bt][Q]}if(bz<0){bz+=aA[bt][Z]}}else{bA=bD;bz=bB}if(bc){while(bo<0){bo+=bw}while(bo>=bw){bo-=bw}}else{if(!G.isFlag(bt,U)){if(bo<0){bA-=(bo*bH);br+=bo;bo=0;if(bN&&(bA>=aA[bt][Q])){bA=0}}if((bo+br)>=bw){br=bw-bo-1}if(br<0){if(GLLibConfig.landscape_useRotatedModules){ASprite.SetGraphicsSize(GetScreenWidth(),GetScreenHeight())}return}}}if(bb){while(bd<0){bd+=be}while(bd>=be){bd-=be}}else{if(!G.isFlag(bt,T)){if(bd<0){bz-=(bd*a8);bq+=bd;bd=0;if(bN&&(bz>=aA[bt][Z])){bz=0}}if((bd+bq)>=be){bq=be-bd-1}if(bq<0){if(GLLibConfig.landscape_useRotatedModules){ASprite.SetGraphicsSize(GetScreenWidth(),GetScreenHeight())}return}}}var bU=bA;var bT=bz;var bh;var bR;var bC;var bO;var bv;var bg;var bS;var a5;var a9=(1<<aA[bt][o])-1;while(bq-->=0){bU=bA;bh=br;bR=bo;while(bh-->=0){if(GLLibConfig.tileset_useLayerPadding&&(bj!=0)){if((bR<bn)||(bR>=bP+bn)||(bd<bi)||(bd>=bx+bi)){bC=bK;if(bp!=0){SetColor(bf,bp);FillRect(bf,bU,bT,bH,a8)}else{if(GLLibConfig.tileset_debugUseLayerPadding){SetColor(bf,4278190335);FillRect(bf,bU,bT,bH,a8);SetColor(bf,4278190080);DrawRect(bf,bU,bT,bH-1,a8-1)}}}else{bC=(bR-bn)+((bd-bi)*bP)}}else{if(GLLibConfig.tileset_useRuntimeRleCompressedMapData&&aA[bt][e]!=0){bC=0}else{bC=bR+(bd*bw)}}bC=Math.floor(bC);if(bC<bK){if(GLLibConfig.tileset_useMultiSprites&&C[bt]!=null){bO=G.Tileset_GetLayerData(bt,b,bC,true);bg=(bO==65535);if(!bg){V[bt]=C[bt][bO&a9];bO=bO>>aA[bt][o]}}else{if(GLLibConfig.tileset_useIndexAsShort){bO=G.Tileset_GetLayerData(bt,b,bC,true);bg=(bO==65535)}else{if(GLLibConfig.tileset_useRuntimeRleCompressedMapData&&aA[bt][e]!=0){bO=G.Tileset_GetLayerData(bt,b,bR,bd)}else{bO=G.Tileset_GetLayerData(bt,b,bC)}bg=(bO==255)}}if(!bg){if(GLLibConfig.tileset_useRuntimeRleCompressedMapData&&aA[bt][e]!=0){if(ab[bt]==null){bv=0}else{bv=G.Tileset_GetLayerData(bt,au,bR,bd)}}else{if(G.Tileset_GetLayerBlock(bt,au,bC)==null){bv=0}else{bv=G.Tileset_GetLayerData(bt,au,bC)}}if(GLLibConfig.tileset_useClip){ClipRect(bf,bU,bT,bH,a8)}if(G.Tileset_GetZoom()!=100){PFX_EnableEffect(GLPixEffects.k_EFFECT_FREE_ROTATE_SCALE);PFX_SetParam(GLPixEffects.k_EFFECT_FREE_ROTATE_SCALE,GLPixEffects.k_PARAM_FREE_ROTATE_SCALE_PERCENT,Tileset_GetZoom());PFX_FreeRotateScale_SetScalePosition(true)}if(V[bt].GetFrameCount()==0){V[bt].PaintModule(bf,bO,bU,bT,bv,W[aq],W[q])}else{var bL=bU;var bJ=bT;if((bv&ASprite.FLAG_ROT_90)!=0){if((bv&ASprite.FLAG_FLIP_X)!=0&&(bv&ASprite.FLAG_FLIP_Y)!=0){bJ+=bH}else{if((bv&ASprite.FLAG_FLIP_X)!=0){bL+=a8;bJ+=bH}else{if((bv&ASprite.FLAG_FLIP_Y)==0){bL+=a8}}}}else{if((bv&ASprite.FLAG_FLIP_X)!=0){bL+=bH}if((bv&ASprite.FLAG_FLIP_Y)!=0){bJ+=a8}}V[bt].PaintFrame(bf,bO,bL,bJ,bv)}if(G.Tileset_GetZoom()!=100){PFX_FreeRotateScale_SetScalePosition(false);PFX_DisableEffect(GLPixEffects.k_EFFECT_FREE_ROTATE_SCALE)}if(GLLibConfig.tileset_usePixelEffects&&(bt==am)&&(J>0)){if(GLLibConfig.tileset_useIndexAsShort){bS=G.Tileset_GetLayerData(J,b,bC,true);a5=(bS==65535)}else{bS=G.Tileset_GetLayerData(J,b,bC);a5=(bS==255)}if(!a5){var by=0;if(G.Tileset_GetLayerBlock(J,au,bC)!=null){by=G.Tileset_GetLayerData(J,au,bC)}if(V[J].GetFrameCount()!=0){bS=V[J].GetFrameModule(bS,0)}if((z==TILESET_EFFECT_ADDITIVE)||(z==TILESET_EFFECT_MULTIPLICATIVE)||(z==TILESET_EFFECT_OVERLAY)||(z==TILESET_EFFECT_COLORDODGE)){V[J].RenderTilesetEffect(bf,bS,aI[bt][n],z,bU,bT,bH,a8,by)}else{if(z==TILESET_EFFECT_NORMAL){V[J].PaintModule(bf,bS,bU,bT,by)}}}}if(GLLibConfig.tileset_useClip){SetClip(bf,bl,bk,bm,bs)}}}bU+=bH;bR++;if(bR>=bw){if(bc){bR=0}else{break}}if(bN&&(bU>=aA[bt][Q])){bU=0}}bT+=a8;bd++;if(bd>=be){if(bb){bd=0}else{break}}if(bN&&(bT>=aA[bt][Z])){bT=0}}if(GLLibConfig.tileset_useLayerLastUpdatedArea){if(G.isFlag(bt,af)){var bG,bQ;if(bU>bA){bG=bU;bQ=0}else{bG=aA[bt][Q];bQ=bU}var bE,bu;if(bT>bz){bE=bT;bu=0}else{bE=aA[bt][Z];bu=bT}for(var bM=0;bM<4;bM++){if((bM==1||bM==3)&&bQ==0){continue}if((bM==2||bM==3)&&bu==0){continue}var a6=(bM==0||bM==2)?bA:0;var a4=(bM==0||bM==1)?bz:0;var a7=(bM==0||bM==2)?bG-bA:bQ;var ba=(bM==0||bM==1)?bE-bz:bu;G.Tileset_AddUpdatedArea(bt,a6,a4,a7,ba)}}}if(GLLibConfig.landscape_useRotatedModules){ASprite.SetGraphicsSize(GetScreenWidth(),GetScreenHeight())}if(P[bt][aV]!=null){P[bt][aV].cacheToGL=true}};G.Tileset_AddUpdatedArea=function(a5,a8,a7,a9,a4){if(GLLibConfig.tileset_useLayerLastUpdatedArea){if(!(ao<aS)){Dbg("Tileset_UpdateBuffer: Not enough last updated areas. Increase value for GLLibConfig.tileset_maxUpdatedAreas")}var a6=v[a5][ao];a6[u]=a8;a6[t]=a7;a6[w]=a9;a6[H]=a4;ao++}};G.Tileset_CaluateLeftTileInSourcePosRle=function(a5,be,ba,a4,a7,bf){var a8=a7[a5][be<<1];var a6=a7[a5][(be<<1)+1];if(a6==1||a6==0){var bc=a8-1;var bh=a4[bc];if(bh<0){var bb=a4[bc-1]&127;a7[a5][(be<<1)]=bc-1;a7[a5][(be<<1)+1]=bb}else{var bg=bf[ba];if(bc==bg||((a4[bc-1]&128)==0)){a7[a5][(be<<1)]=bc;a7[a5][(be<<1)+1]=0}else{var bd=1;var a9=bc-1;while(a9>=bg){if((a4[a9]&128)==0){break}bd++;a9--}if((bd&1)==0){var bb=a4[bc-1]&127;a7[a5][(be<<1)]=bc-1;a7[a5][(be<<1)+1]=bb}else{a7[a5][(be<<1)]=bc;a7[a5][(be<<1)+1]=0}}}}else{a7[a5][(be<<1)+1]=a6-1}};G.Tileset_GetLayerBlock=function(a4,a7,a5){if(arguments.length!=3){throw new Error("InvalidArguments")}var a6=aA[a4][aU];return G.Tileset_GetLayerBlock_4(a4,a7,a5%a6,(a5/a6).castToInt())};G.Tileset_GetLayerBlock_4=function(a4,a8,bb,a9){if(GLLibConfig.tileset_useMultiBlockTileset){var a7=bb;var a5=a9;var ba=(a7/s_TilesetMultiBlockHeadInfo[k_TilesetMultiBlockBlockTileColNum]).castToInt();var a6=(a5/s_TilesetMultiBlockHeadInfo[k_TilesetMultiBlockBlockTileRowNum]).castToInt();var bc=ba+a6*s_TilesetMultiBlockHeadInfo[k_TilesetMultiBlockMapBlockColNum];return s_TilesetMultiBlockLayerData[a4][bc][a8]}else{return aM[a4][a8]}};G.Tileset_GetLayerData=function(){if(arguments){switch(arguments.length){case 3:return G.Tileset_GetLayerData.apply(this,arguments);case 4:if(typeof arguments[3]=="number"){return G.Tileset_GetLayerData_4i.apply(this,arguments)}else{return G.Tileset_GetLayerData_4.apply(this,arguments)}case 5:return G.Tileset_GetLayerData_5.apply(this,arguments)}}throw new Error("InvalidArguments")};G.Tileset_GetLayerData=function(a4,a6,a5){return G.Tileset_GetLayerData_4(a4,a6,a5,false)};G.Tileset_GetLayerData_4=function(a4,a8,a6,a5){if(GLLibConfig.tileset_useMultiBlockTileset){var a7=aA[a4][aU];return G.Tileset_GetLayerData_5(a4,a8,a6%a7,(a6/a7).castToInt(),a5)}else{if(a5){return Mem_GetShort(aM[a4][a8],(a6<<1))&65535}else{if(GLLibConfig.tileset_use4BitsPerFlipRotData&&(a8==au)){return(aM[a4][a8][(a6>>1)]>>((a6&1)<<2))&15}else{if(GLLibConfig.tileset_use2BitsPerFlipData&&(a8==au)){return(aM[a4][a8][(a6>>2)]>>((a6&3)<<1))&3}else{return aM[a4][a8][a6]&255}}}}};G.Tileset_GetLayerData_4i=function(a5,a8,a4,bb){if(GLLibConfig.tileset_useRuntimeRleCompressedMapData&&aA[a5][e]!=0){var a9=a4-aA[a5][aG];var ba=bb-aA[a5][aF];var a6=ba+aA[a5][aB];if(a6>=aA[a5][ag]){a6-=aA[a5][ag]}var a7=a9+aA[a5][aE];if(a7>=aA[a5][Y]){a7-=aA[a5][Y]}if(a8==b){return aD[a5][a6][a7]&255}else{return ab[a5][a6][a7]&255}}else{if((GLLibConfig.tileset_use2BitsPerFlipData||GLLibConfig.tileset_use4BitsPerFlipRotData)&&(a8==au)){return G.Tileset_GetLayerData_5(a5,a8,a4,bb,false)}else{return G.Tileset_GetLayerData_5(a5,a8,a4,bb,GLLibConfig.tileset_useIndexAsShort)}}};G.Tileset_GetLayerData_5=function(a5,bc,bf,bd,a8){if(GLLibConfig.tileset_useMultiBlockTileset){var bb=bf;var a9=bd;var be=(bb/s_TilesetMultiBlockHeadInfo[k_TilesetMultiBlockBlockTileColNum]).castToInt();var ba=(a9/s_TilesetMultiBlockHeadInfo[k_TilesetMultiBlockBlockTileRowNum]).castToInt();var a7=bb%s_TilesetMultiBlockHeadInfo[k_TilesetMultiBlockBlockTileColNum];var bh=a9%s_TilesetMultiBlockHeadInfo[k_TilesetMultiBlockBlockTileRowNum];var bg=be+ba*s_TilesetMultiBlockHeadInfo[k_TilesetMultiBlockMapBlockColNum];var a6=a7+bh*s_TilesetMultiBlockBlockInfo[bg<<1];if(a8){return Mem_GetShort(s_TilesetMultiBlockLayerData[a5][bg][bc],(a6<<1))&65535}else{return s_TilesetMultiBlockLayerData[a5][bg][bc][a6]&255}}else{var a4=aA[a5][aU];return G.Tileset_GetLayerData_4(a5,bc,bd*a4+bf,a8)}};G.Tileset_DecodeRleCompressedDataOneLine=function(bh,bc,a9,bg,bf){var ba;var a8=aY[bh][bf];var a4=at[bh][bf];var bk;var bj;if(bf==b){ba=aD[bh][a9];bk=ar;bj=d}else{if(ab[bh]==null){return}ba=ab[bh][a9];bk=D;bj=ai}var bb=aA[bh][Y];var bo=a4[bc];var bl=bc==a4.length-1?a8.length:a4[bc+1];var a6=bo;var bm=0;var a7=false;var a5=0;var bi=aA[bh][aE];while(a6<bl&&a5<bb){var bn=a8[a6++];if(bn<0){var be=(bn&127);var bd=0;bn=a8[a6++];do{if(!a7&&bm==bg){a7=true;bk[bh][a9<<1]=a6-2;bk[bh][(a9<<1)+1]=bd+1}if(a7){ba[bi]=bn;bi++;if(bi>=bb){bi=0}a5++;if(a5==bb){bj[bh][a9<<1]=a6-2;bj[bh][(a9<<1)+1]=bd+1;break}}bm++;bd++}while(bd<be)}else{if(!a7&&bm==bg){a7=true;bk[bh][a9<<1]=a6-1;bk[bh][(a9<<1)+1]=0}if(a7){ba[bi]=bn;bi++;if(bi>=bb){bi=0}a5++;if(a5==bb){bj[bh][a9<<1]=a6-1;bj[bh][(a9<<1)+1]=0;break}}bm++}}};G.Tileset_Buffer_CalculateSize=function(a5){var a7=W[I];var ba=W[ad];if(a5>=0){a7=aA[a5][aR];ba=aA[a5][a0]}if(GLLibConfig.tileset_useTileShift){aA[a5][Q]=(a7&~W[aQ])+(1*W[aq]);aA[a5][Z]=(ba&~W[aT])+(1*W[q]);if((aA[a5][Q]-W[I])<W[aq]){aA[a5][Q]+=W[aq]}if((aA[a5][Z]-W[ad])<W[q]){aA[a5][Z]+=W[q]}}else{var a8=a7%W[aq];var a4=1+((a8!=0)?1:0);aA[a5][Q]=a7-a8+(a4*W[aq]);var a6=ba%W[q];var a9=1+((a6!=0)?1:0);aA[a5][Z]=ba-a6+(a9*W[q]);if(GLLibConfig.tileset_useBugFixImageOddSize){if((aA[a5][Q]&1)!=0){aA[a5][Q]+=W[aq]}if((aA[a5][Z]&1)!=0){aA[a5][Z]+=W[q]}}}};G.Tileset_Buffer_Create=function(a4){try{if(GLLibConfig.landscape_useRotatedModules){aI[a4][n]=Image.createImage(aA[a4][Z],aA[a4][Q])}else{aI[a4][n]=Image.createImage(aA[a4][Q],aA[a4][Z])}P[a4][aV]=aI[a4][n].getGraphics()}catch(a5){Dbg("GLLibPlayer::Tileset_LoadLayer::pb while ceating circular buffer : "+a5.message)}};G.Tileset_GetLayerWidth=function(a4){if(GLLibConfig.sprite_debugLoading){if(!l){if(!(false)){Dbg("Tileset_GetLayerWidth: Tileset player is not initialized")}return -1}if((a4<0)||(a4>=aX)){if(!(false)){Dbg("Tileset_GetLayerWidth: nLayer invalid : "+a4)}return -1}if((aA[a4][F]!=1)||(aA[a4][a3]!=1)){if(!(false)){Dbg("Tileset_GetLayerWidth: nLayer in not initialized or not enabled.")}return -1}}return aA[a4][aJ]};G.Tileset_GetLayerHeight=function(a4){if(GLLibConfig.sprite_debugLoading){if(!l){if(!(false)){Dbg("Tileset_GetLayerHeight: Tileset player is not initialized")}return -1}if((a4<0)||(a4>=aX)){if(!(false)){Dbg("Tileset_GetLayerHeight: nLayer invalid : "+a4)}return -1}if((aA[a4][F]!=1)||(aA[a4][a3]!=1)){if(!(false)){Dbg("Tileset_GetLayerHeight: nLayer in not initialized or not enabled.")}return -1}}return aA[a4][az]};G.Tileset_GetTileW=function(){return W[aq]};G.Tileset_GetTileH=function(){return W[q]};ac.GLLibPlayer=G})(window);