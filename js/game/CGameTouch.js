(function(a,c){var b=[];CGame.prototype.pointerPressedImpl=function(e){if(typeof e=="undefined"){return}var f=e.changedTouches;if(f){for(var d=0;d<f.length;d++){var h=this.copyTouch(f[d]);b.push(this.copyTouch(f[d]));if(CGame.isInsideRect(DGUI.INTERFACE_DPAD_X,DGUI.INTERFACE_DPAD_Y,DGUI.INTERFACE_DPAD_RECT_W,DGUI.INTERFACE_DPAD_RECT_H,h.pageX,h.pageY)){if(CGame.s_pointInCircle){CGame.s_pointInCircle.splice(0,1,{x:h.pageX,y:h.pageY})}CGame.s_dPadX=h.pageX;CGame.s_dPadY=h.pageY;if(CGame.s_isDPadShowed==1){CGame.s_isDPadShowed=2}CGame.s_dPadTouchIdx=b.length-1}}}};CGame.prototype.pointerDraggedImpl=function(f){if(typeof f=="undefined"){return}var h=f.changedTouches;if(h){for(var e=0;e<h.length;e++){var d=this.ongoingTouchIndexById(h[e].identifier);if(d>=0){var j=this.copyTouch(h[e]);if(d==CGame.s_dPadTouchIdx){if(CGame.isInsideCircle(CGame.s_dPadX,CGame.s_dPadY,DGUI.INTERFACE_DPAD_TOUCH_RECT_R,j.pageX,j.pageY)){if(CGame.s_pointInCircle){CGame.s_pointInCircle.splice(0,1,{x:j.pageX,y:j.pageY})}}else{if(CGame.s_pointInCircle){CGame.s_pointInCircle.pop()}}}b.splice(d,1,this.copyTouch(h[e]))}else{if(DEF.dbgEnable){Dbg("can't figure out which touch to continue")}}}}};CGame.prototype.pointerReleasedImpl=function(f){if(typeof f=="undefined"){return}var h=f.changedTouches;if(h){for(var e=0;e<h.length;e++){var d=this.ongoingTouchIndexById(h[e].identifier);if(d>=0){var j=this.copyTouch(h[e]);if(d==CGame.s_dPadTouchIdx){if(CGame.s_pointInCircle){CGame.s_pointInCircle.pop()}}if(CGame.s_isDPadShowed==2){if(d==CGame.s_dPadTouchIdx){CGame.s_dPadX=-5000;CGame.s_dPadY=-5000;CGame.s_dPadTouchIdx=-1;Dbg("out of screen: "+d)}}ResetKey();b.splice(d,1)}else{if(DEF.dbgEnable){Dbg("can't figure out which touch to end")}}}}};CGame.prototype.pointerCancelImpl=function(f){if(typeof f=="undefined"){return}var h=f.changedTouches;if(h){for(var e=0;e<h.length;e++){var d=this.ongoingTouchIndexById(h[e].identifier);if(d>=0){b.splice(d,1)}}}};CGame.prototype._handleKeyDown=function(d){var e=d.keyCode;if(!Device.isTouchDevice){switch(d.keyCode){case 65:case 37:e=GLLibConfig.keycodeLeft;break;case 83:case 40:e=GLLibConfig.keycodeDown;break;case 68:case 39:e=GLLibConfig.keycodeRight;break;case 87:case 38:e=GLLibConfig.keycodeUp;break;case 74:case 32:e=GLLibConfig.keycodeFire;break;case 75:e=GLLibConfig.keycodeUp;break}}this.keyPressed(e)};CGame.prototype._handleKeyUp=function(d){var e=d.keyCode;if(!Device.isTouchDevice){switch(d.keyCode){case 65:case 37:e=GLLibConfig.keycodeLeft;break;case 83:case 40:e=GLLibConfig.keycodeDown;break;case 68:case 39:e=GLLibConfig.keycodeRight;break;case 87:case 38:e=GLLibConfig.keycodeUp;break;case 74:case 32:e=GLLibConfig.keycodeFire;break;case 75:e=GLLibConfig.keycodeUp;break}}this.keyReleased(e)};CGame.prototype.copyTouch=function(h){var e=this.m_BoundingRect;var d=LowAPI.Float2Int((h.pageX-e.left)/this.m_ScaleToFitScreen);var f=LowAPI.Float2Int((h.pageY-e.top)/this.m_ScaleToFitScreen);return{identifier:h.identifier,pageX:d,pageY:f}};CGame.prototype.ongoingTouchIndexById=function(e){for(var d=0;d<b.length;d++){var f=b[d].identifier;if(f==e){return d}}return -1};CGame.Pointer_IsInRect=function(){if(arguments){switch(arguments.length){case 1:return CGame.Pointer_IsInRect_1.apply(this,arguments);case 4:return CGame.Pointer_IsInRect_4.apply(this,arguments)}}throw new Error("InvalidArguments")};CGame.Pointer_IsInRect_1=function(d){return CGame.Pointer_IsInRect(d[0],d[1],d[2],d[3])};CGame.Pointer_IsInRect_4=function(d,k,e,j){if(!Device.isTouchDevice){return CGame.isPointInRect(d,k,e,j)}if(DEF.dbgEnableTouchBox){g.setColor(16711680);g.drawRect(d,k,e,j)}if(b){for(var f=0;f<b.length;f++){if((b[f].pageX>d)&&(b[f].pageX<(d+e))&&(b[f].pageY>k)&&(b[f].pageY<(k+j))){return true}}}return false};CGame.isInsideTriangle=function(o,l,f,n,e,m,d,k){var j=(o-f)*(k-n)-(d-f)*(l-n);var i=(o-e)*(n-m)-(f-e)*(l-m);var h=(o-d)*(m-k)-(e-d)*(l-k);return(j>0&&i>0&&h>0)||(j<0&&i<0&&h<0)};CGame.Pointer_IsInTriangle=function(h,l,e,k,d,f){if(b){for(var j=0;j<b.length;j++){if(CGame.isInsideTriangle(b[j].pageX,b[j].pageY,h,l,e,k,d,f)){return true}}}return false};CGame.isInsideCircle=function(h,f,e,d,i){if((d-h)*(d-h)+(i-f)*(i-f)<=e*e){return true}else{return false}};CGame.isInsideRect=function(f,e,h,i,d,j){if(Math.abs(f-d)<h/2&&Math.abs(e-j)<i/2){return true}else{return false}}})(window);